## 背景与问题
- 打开聊天详情后，父级保留 ChatList 挂载；当键盘弹出时，聊天输入框基于 visualViewport 位置上移，但主底部导航（BottomNav）仍停留在原始底部，出现割离。
- 现状：App 根容器使用 `height: calc(var(--vh) * 100)`，未应用 `visualViewport.offsetTop`；ChatDetail 也使用 `--vh` 高度。两者的“顶部偏移”不同步。

## 方案概述
- 统一 App 根容器与 ChatDetail 的视窗适配策略：同时监听 `visualViewport` 的 `height` 与 `offsetTop`，将两者应用到容器样式，使所有固定定位区域（含 BottomNav、ChatList 列表区、ChatDetail 输入区）在键盘弹出时同步上移。

## 具体实现步骤
1. 在 `src/user/App.tsx` 增加 `viewportStyle` 状态：`{ height: string, top: string }`。
2. 监听 `visualViewport` 的 `resize` 与 `scroll`，计算：
   - `height = visualViewport.height + 'px'`
   - `top = visualViewport.offsetTop + 'px'`
   - 无 `visualViewport` 时回退为 `height = window.innerHeight + 'px'`，`top = '0px'`
3. 将根固定容器 `<div className="fixed inset-0 ...">` 样式替换为：
   - `style={{ ...viewportStyle, position: 'fixed', overscrollBehavior: 'none' }}`
4. 在 `src/user/components/ChatDetail.tsx` 的最外层 `<motion.div>` 恢复使用同样的 `viewportStyle`（或计算一致的本地状态），确保聊天输入区位移与底部导航一致。
5. 保持现有的 `scrollToBottom` 与软键盘适配逻辑；无需更改消息列表和动画参数。

## 预期效果
- 键盘弹出时，App 根容器与 ChatDetail 同步应用 `offsetTop`，BottomNav 与聊天输入框位于同一水平线，不再出现割离。
- 关闭键盘时，两者同时回到原位，横向滑动交互不受影响。

## 回退与兼容
- 若浏览器不支持 `visualViewport`，维持旧行为（不应用 top 偏移），但不会比当前更差。
- 参数变动仅影响样式层，无需后端或路由调整。