const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/http-bwpcOK62.js","assets/index-BFkgawJw.js","assets/index-CNJf0r43.css","assets/x-BdTO40PY.js"])))=>i.map(i=>d[i]);
import{r as f,j as n,_ as ue,R as Ea}from"./index-BFkgawJw.js";import{c as be,P as He,U as Ls,X as Qe,d as Pt,f as Ma,e as Ki,S as Yi,b as wt,C as Ra,a as jt,I as Gi,T as Xi,L as Sn}from"./x-BdTO40PY.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Xt=be("arrow-left",Da);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Va=be("arrow-right",Ia);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Fs=be("camera",La);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],qi=be("check",Fa);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Os=be("chevron-up",Oa);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],vs=be("circle-alert",za);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Ba=be("ellipsis-vertical",$a);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ha=be("eye-off",Ua);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ka=be("eye",Wa);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Ga=be("globe",Ya);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Ji=be("heart",Xa);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],Ja=be("house",qa);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Qa=be("lock",Za);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],to=be("mail",eo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],zs=be("message-circle",so);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const no=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],io=be("message-square",no);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ro=[["path",{d:"M5 12h14",key:"1ays0h"}]],ao=be("minus",ro);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oo=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],lo=be("pen-tool",oo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Tn=be("pen",co);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],ho=be("pin",uo),$s=f.createContext({});function Bs(e){const t=f.useRef(null);return t.current===null&&(t.current=e()),t.current}const qt=f.createContext(null),Us=f.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class fo extends f.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=s.offsetHeight||0,i.width=s.offsetWidth||0,i.top=s.offsetTop,i.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function mo({children:e,isPresent:t}){const s=f.useId(),i=f.useRef(null),r=f.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=f.useContext(Us);return f.useInsertionEffect(()=>{const{width:a,height:c,top:l,left:d}=r.current;if(t||!i.current||!a||!c)return;i.current.dataset.motionPopId=s;const u=document.createElement("style");return o&&(u.nonce=o),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${c}px !important;
            top: ${l}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[t]),n.jsx(fo,{isPresent:t,childRef:i,sizeRef:r,children:f.cloneElement(e,{ref:i})})}const po=({children:e,initial:t,isPresent:s,onExitComplete:i,custom:r,presenceAffectsLayout:o,mode:a})=>{const c=Bs(xo),l=f.useId(),d=f.useCallback(h=>{c.set(h,!0);for(const p of c.values())if(!p)return;i&&i()},[c,i]),u=f.useMemo(()=>({id:l,initial:t,isPresent:s,custom:r,onExitComplete:d,register:h=>(c.set(h,!1),()=>c.delete(h))}),o?[Math.random(),d]:[s,d]);return f.useMemo(()=>{c.forEach((h,p)=>c.set(p,!1))},[s]),f.useEffect(()=>{!s&&!c.size&&i&&i()},[s]),a==="popLayout"&&(e=n.jsx(mo,{isPresent:s,children:e})),n.jsx(qt.Provider,{value:u,children:e})};function xo(){return new Map}function Zi(e=!0){const t=f.useContext(qt);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:i,register:r}=t,o=f.useId();f.useEffect(()=>{e&&r(o)},[e]);const a=f.useCallback(()=>e&&i&&i(o),[o,i,e]);return!s&&i?[!1,a]:[!0]}const It=e=>e.key||"";function Cn(e){const t=[];return f.Children.forEach(e,s=>{f.isValidElement(s)&&t.push(s)}),t}const Hs=typeof window<"u",Qi=Hs?f.useLayoutEffect:f.useEffect,ot=({children:e,custom:t,initial:s=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:o="sync",propagate:a=!1})=>{const[c,l]=Zi(a),d=f.useMemo(()=>Cn(e),[e]),u=a&&!c?[]:d.map(It),h=f.useRef(!0),p=f.useRef(d),y=Bs(()=>new Map),[N,j]=f.useState(d),[P,T]=f.useState(d);Qi(()=>{h.current=!1,p.current=d;for(let $=0;$<P.length;$++){const S=It(P[$]);u.includes(S)?y.delete(S):y.get(S)!==!0&&y.set(S,!1)}},[P,u.length,u.join("-")]);const A=[];if(d!==N){let $=[...d];for(let S=0;S<P.length;S++){const C=P[S],L=It(C);u.includes(L)||($.splice(S,0,C),A.push(C))}o==="wait"&&A.length&&($=A),T(Cn($)),j(d);return}const{forceRender:R}=f.useContext($s);return n.jsx(n.Fragment,{children:P.map($=>{const S=It($),C=a&&!c?!1:d===P||u.includes(S),L=()=>{if(y.has(S))y.set(S,!0);else return;let M=!0;y.forEach(B=>{B||(M=!1)}),M&&(R==null||R(),T(p.current),a&&(l==null||l()),i&&i())};return n.jsx(po,{isPresent:C,initial:!h.current||s?void 0:!1,custom:C?void 0:t,presenceAffectsLayout:r,mode:o,onExitComplete:C?void 0:L,children:$},S)})})},Ee=e=>e;let er=Ee;function Ws(e){let t;return()=>(t===void 0&&(t=e()),t)}const lt=(e,t,s)=>{const i=t-e;return i===0?1:(s-e)/i},Oe=e=>e*1e3,ze=e=>e/1e3,go={useManualTiming:!1};function yo(e){let t=new Set,s=new Set,i=!1,r=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function c(d){o.has(d)&&(l.schedule(d),e()),d(a)}const l={schedule:(d,u=!1,h=!1)=>{const y=h&&i?t:s;return u&&o.add(d),y.has(d)||y.add(d),d},cancel:d=>{s.delete(d),o.delete(d)},process:d=>{if(a=d,i){r=!0;return}i=!0,[t,s]=[s,t],t.forEach(c),t.clear(),i=!1,r&&(r=!1,l.process(d))}};return l}const Vt=["read","resolveKeyframes","update","preRender","render","postRender"],vo=40;function tr(e,t){let s=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>s=!0,a=Vt.reduce((T,A)=>(T[A]=yo(o),T),{}),{read:c,resolveKeyframes:l,update:d,preRender:u,render:h,postRender:p}=a,y=()=>{const T=performance.now();s=!1,r.delta=i?1e3/60:Math.max(Math.min(T-r.timestamp,vo),1),r.timestamp=T,r.isProcessing=!0,c.process(r),l.process(r),d.process(r),u.process(r),h.process(r),p.process(r),r.isProcessing=!1,s&&t&&(i=!1,e(y))},N=()=>{s=!0,i=!0,r.isProcessing||e(y)};return{schedule:Vt.reduce((T,A)=>{const R=a[A];return T[A]=($,S=!1,C=!1)=>(s||N(),R.schedule($,S,C)),T},{}),cancel:T=>{for(let A=0;A<Vt.length;A++)a[Vt[A]].cancel(T)},state:r,steps:a}}const{schedule:me,cancel:We,state:Ne,steps:is}=tr(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ee,!0),sr=f.createContext({strict:!1}),kn={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ct={};for(const e in kn)ct[e]={isEnabled:t=>kn[e].some(s=>!!t[s])};function bo(e){for(const t in e)ct[t]={...ct[t],...e[t]}}const wo=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Bt(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||wo.has(e)}let nr=e=>!Bt(e);function jo(e){e&&(nr=t=>t.startsWith("on")?!Bt(t):e(t))}try{jo(require("@emotion/is-prop-valid").default)}catch{}function No(e,t,s){const i={};for(const r in e)r==="values"&&typeof e.values=="object"||(nr(r)||s===!0&&Bt(r)||!t&&!Bt(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}function So(e){if(typeof Proxy>"u")return e;const t=new Map,s=(...i)=>e(...i);return new Proxy(s,{get:(i,r)=>r==="create"?e:(t.has(r)||t.set(r,e(r)),t.get(r))})}const Jt=f.createContext({});function Nt(e){return typeof e=="string"||Array.isArray(e)}function Zt(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const Ks=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Ys=["initial",...Ks];function Qt(e){return Zt(e.animate)||Ys.some(t=>Nt(e[t]))}function ir(e){return!!(Qt(e)||e.variants)}function To(e,t){if(Qt(e)){const{initial:s,animate:i}=e;return{initial:s===!1||Nt(s)?s:void 0,animate:Nt(i)?i:void 0}}return e.inherit!==!1?t:{}}function Co(e){const{initial:t,animate:s}=To(e,f.useContext(Jt));return f.useMemo(()=>({initial:t,animate:s}),[An(t),An(s)])}function An(e){return Array.isArray(e)?e.join(" "):e}const ko=Symbol.for("motionComponentSymbol");function st(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Ao(e,t,s){return f.useCallback(i=>{i&&e.onMount&&e.onMount(i),t&&(i?t.mount(i):t.unmount()),s&&(typeof s=="function"?s(i):st(s)&&(s.current=i))},[t])}const Gs=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Po="framerAppearId",rr="data-"+Gs(Po),{schedule:Xs}=tr(queueMicrotask,!1),ar=f.createContext({});function _o(e,t,s,i,r){var o,a;const{visualElement:c}=f.useContext(Jt),l=f.useContext(sr),d=f.useContext(qt),u=f.useContext(Us).reducedMotion,h=f.useRef(null);i=i||l.renderer,!h.current&&i&&(h.current=i(e,{visualState:t,parent:c,props:s,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:u}));const p=h.current,y=f.useContext(ar);p&&!p.projection&&r&&(p.type==="html"||p.type==="svg")&&Eo(h.current,s,r,y);const N=f.useRef(!1);f.useInsertionEffect(()=>{p&&N.current&&p.update(s,d)});const j=s[rr],P=f.useRef(!!j&&!(!((o=window.MotionHandoffIsComplete)===null||o===void 0)&&o.call(window,j))&&((a=window.MotionHasOptimisedAnimation)===null||a===void 0?void 0:a.call(window,j)));return Qi(()=>{p&&(N.current=!0,window.MotionIsMounted=!0,p.updateFeatures(),Xs.render(p.render),P.current&&p.animationState&&p.animationState.animateChanges())}),f.useEffect(()=>{p&&(!P.current&&p.animationState&&p.animationState.animateChanges(),P.current&&(queueMicrotask(()=>{var T;(T=window.MotionHandoffMarkAsComplete)===null||T===void 0||T.call(window,j)}),P.current=!1))}),p}function Eo(e,t,s,i){const{layoutId:r,layout:o,drag:a,dragConstraints:c,layoutScroll:l,layoutRoot:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:or(e.parent)),e.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:!!a||c&&st(c),visualElement:e,animationType:typeof o=="string"?o:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:d})}function or(e){if(e)return e.options.allowProjection!==!1?e.projection:or(e.parent)}function Mo({preloadedFeatures:e,createVisualElement:t,useRender:s,useVisualState:i,Component:r}){var o,a;e&&bo(e);function c(d,u){let h;const p={...f.useContext(Us),...d,layoutId:Ro(d)},{isStatic:y}=p,N=Co(d),j=i(d,y);if(!y&&Hs){Do();const P=Io(p);h=P.MeasureLayout,N.visualElement=_o(r,j,p,t,P.ProjectionNode)}return n.jsxs(Jt.Provider,{value:N,children:[h&&N.visualElement?n.jsx(h,{visualElement:N.visualElement,...p}):null,s(r,d,Ao(j,N.visualElement,u),j,y,N.visualElement)]})}c.displayName=`motion.${typeof r=="string"?r:`create(${(a=(o=r.displayName)!==null&&o!==void 0?o:r.name)!==null&&a!==void 0?a:""})`}`;const l=f.forwardRef(c);return l[ko]=r,l}function Ro({layoutId:e}){const t=f.useContext($s).id;return t&&e!==void 0?t+"-"+e:e}function Do(e,t){f.useContext(sr).strict}function Io(e){const{drag:t,layout:s}=ct;if(!t&&!s)return{};const i={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(e)||s!=null&&s.isEnabled(e)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const Vo=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function qs(e){return typeof e!="string"||e.includes("-")?!1:!!(Vo.indexOf(e)>-1||/[A-Z]/u.test(e))}function Pn(e){const t=[{},{}];return e==null||e.values.forEach((s,i)=>{t[0][i]=s.get(),t[1][i]=s.getVelocity()}),t}function Js(e,t,s,i){if(typeof t=="function"){const[r,o]=Pn(i);t=t(s!==void 0?s:e.custom,r,o)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[r,o]=Pn(i);t=t(s!==void 0?s:e.custom,r,o)}return t}const bs=e=>Array.isArray(e),Lo=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),Fo=e=>bs(e)?e[e.length-1]||0:e,Te=e=>!!(e&&e.getVelocity);function Ot(e){const t=Te(e)?e.get():e;return Lo(t)?t.toValue():t}function Oo({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:s},i,r,o){const a={latestValues:zo(i,r,o,e),renderState:t()};return s&&(a.onMount=c=>s({props:i,current:c,...a}),a.onUpdate=c=>s(c)),a}const lr=e=>(t,s)=>{const i=f.useContext(Jt),r=f.useContext(qt),o=()=>Oo(e,t,i,r);return s?o():Bs(o)};function zo(e,t,s,i){const r={},o=i(e,{});for(const p in o)r[p]=Ot(o[p]);let{initial:a,animate:c}=e;const l=Qt(e),d=ir(e);t&&d&&!l&&e.inherit!==!1&&(a===void 0&&(a=t.initial),c===void 0&&(c=t.animate));let u=s?s.initial===!1:!1;u=u||a===!1;const h=u?c:a;if(h&&typeof h!="boolean"&&!Zt(h)){const p=Array.isArray(h)?h:[h];for(let y=0;y<p.length;y++){const N=Js(e,p[y]);if(N){const{transitionEnd:j,transition:P,...T}=N;for(const A in T){let R=T[A];if(Array.isArray(R)){const $=u?R.length-1:0;R=R[$]}R!==null&&(r[A]=R)}for(const A in j)r[A]=j[A]}}}return r}const ut=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],tt=new Set(ut),cr=e=>t=>typeof t=="string"&&t.startsWith(e),dr=cr("--"),$o=cr("var(--"),Zs=e=>$o(e)?Bo.test(e.split("/*")[0].trim()):!1,Bo=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ur=(e,t)=>t&&typeof e=="number"?t.transform(e):e,$e=(e,t,s)=>s>t?t:s<e?e:s,ht={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},St={...ht,transform:e=>$e(0,1,e)},Lt={...ht,default:1},_t=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Be=_t("deg"),Le=_t("%"),J=_t("px"),Uo=_t("vh"),Ho=_t("vw"),_n={...Le,parse:e=>Le.parse(e)/100,transform:e=>Le.transform(e*100)},Wo={borderWidth:J,borderTopWidth:J,borderRightWidth:J,borderBottomWidth:J,borderLeftWidth:J,borderRadius:J,radius:J,borderTopLeftRadius:J,borderTopRightRadius:J,borderBottomRightRadius:J,borderBottomLeftRadius:J,width:J,maxWidth:J,height:J,maxHeight:J,top:J,right:J,bottom:J,left:J,padding:J,paddingTop:J,paddingRight:J,paddingBottom:J,paddingLeft:J,margin:J,marginTop:J,marginRight:J,marginBottom:J,marginLeft:J,backgroundPositionX:J,backgroundPositionY:J},Ko={rotate:Be,rotateX:Be,rotateY:Be,rotateZ:Be,scale:Lt,scaleX:Lt,scaleY:Lt,scaleZ:Lt,skew:Be,skewX:Be,skewY:Be,distance:J,translateX:J,translateY:J,translateZ:J,x:J,y:J,z:J,perspective:J,transformPerspective:J,opacity:St,originX:_n,originY:_n,originZ:J},En={...ht,transform:Math.round},Qs={...Wo,...Ko,zIndex:En,size:J,fillOpacity:St,strokeOpacity:St,numOctaves:En},Yo={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Go=ut.length;function Xo(e,t,s){let i="",r=!0;for(let o=0;o<Go;o++){const a=ut[o],c=e[a];if(c===void 0)continue;let l=!0;if(typeof c=="number"?l=c===(a.startsWith("scale")?1:0):l=parseFloat(c)===0,!l||s){const d=ur(c,Qs[a]);if(!l){r=!1;const u=Yo[a]||a;i+=`${u}(${d}) `}s&&(t[a]=d)}}return i=i.trim(),s?i=s(t,r?"":i):r&&(i="none"),i}function en(e,t,s){const{style:i,vars:r,transformOrigin:o}=e;let a=!1,c=!1;for(const l in t){const d=t[l];if(tt.has(l)){a=!0;continue}else if(dr(l)){r[l]=d;continue}else{const u=ur(d,Qs[l]);l.startsWith("origin")?(c=!0,o[l]=u):i[l]=u}}if(t.transform||(a||s?i.transform=Xo(t,e.transform,s):i.transform&&(i.transform="none")),c){const{originX:l="50%",originY:d="50%",originZ:u=0}=o;i.transformOrigin=`${l} ${d} ${u}`}}const qo={offset:"stroke-dashoffset",array:"stroke-dasharray"},Jo={offset:"strokeDashoffset",array:"strokeDasharray"};function Zo(e,t,s=1,i=0,r=!0){e.pathLength=1;const o=r?qo:Jo;e[o.offset]=J.transform(-i);const a=J.transform(t),c=J.transform(s);e[o.array]=`${a} ${c}`}function Mn(e,t,s){return typeof e=="string"?e:J.transform(t+s*e)}function Qo(e,t,s){const i=Mn(t,e.x,e.width),r=Mn(s,e.y,e.height);return`${i} ${r}`}function tn(e,{attrX:t,attrY:s,attrScale:i,originX:r,originY:o,pathLength:a,pathSpacing:c=1,pathOffset:l=0,...d},u,h){if(en(e,d,h),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:y,dimensions:N}=e;p.transform&&(N&&(y.transform=p.transform),delete p.transform),N&&(r!==void 0||o!==void 0||y.transform)&&(y.transformOrigin=Qo(N,r!==void 0?r:.5,o!==void 0?o:.5)),t!==void 0&&(p.x=t),s!==void 0&&(p.y=s),i!==void 0&&(p.scale=i),a!==void 0&&Zo(p,a,c,l,!1)}const sn=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),hr=()=>({...sn(),attrs:{}}),nn=e=>typeof e=="string"&&e.toLowerCase()==="svg";function fr(e,{style:t,vars:s},i,r){Object.assign(e.style,t,r&&r.getProjectionStyles(i));for(const o in s)e.style.setProperty(o,s[o])}const mr=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function pr(e,t,s,i){fr(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(mr.has(r)?r:Gs(r),t.attrs[r])}const Ut={};function el(e){Object.assign(Ut,e)}function xr(e,{layout:t,layoutId:s}){return tt.has(e)||e.startsWith("origin")||(t||s!==void 0)&&(!!Ut[e]||e==="opacity")}function rn(e,t,s){var i;const{style:r}=e,o={};for(const a in r)(Te(r[a])||t.style&&Te(t.style[a])||xr(a,e)||((i=s==null?void 0:s.getValue(a))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(o[a]=r[a]);return o}function gr(e,t,s){const i=rn(e,t,s);for(const r in e)if(Te(e[r])||Te(t[r])){const o=ut.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[o]=e[r]}return i}function tl(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const Rn=["x","y","width","height","cx","cy","r"],sl={useVisualState:lr({scrapeMotionValuesFromProps:gr,createRenderState:hr,onUpdate:({props:e,prevProps:t,current:s,renderState:i,latestValues:r})=>{if(!s)return;let o=!!e.drag;if(!o){for(const c in r)if(tt.has(c)){o=!0;break}}if(!o)return;let a=!t;if(t)for(let c=0;c<Rn.length;c++){const l=Rn[c];e[l]!==t[l]&&(a=!0)}a&&me.read(()=>{tl(s,i),me.render(()=>{tn(i,r,nn(s.tagName),e.transformTemplate),pr(s,i)})})}})},nl={useVisualState:lr({scrapeMotionValuesFromProps:rn,createRenderState:sn})};function yr(e,t,s){for(const i in t)!Te(t[i])&&!xr(i,s)&&(e[i]=t[i])}function il({transformTemplate:e},t){return f.useMemo(()=>{const s=sn();return en(s,t,e),Object.assign({},s.vars,s.style)},[t])}function rl(e,t){const s=e.style||{},i={};return yr(i,s,e),Object.assign(i,il(e,t)),i}function al(e,t){const s={},i=rl(e,t);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=i,s}function ol(e,t,s,i){const r=f.useMemo(()=>{const o=hr();return tn(o,t,nn(i),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};yr(o,e.style,e),r.style={...o,...r.style}}return r}function ll(e=!1){return(s,i,r,{latestValues:o},a)=>{const l=(qs(s)?ol:al)(i,o,a,s),d=No(i,typeof s=="string",e),u=s!==f.Fragment?{...d,...l,ref:r}:{},{children:h}=i,p=f.useMemo(()=>Te(h)?h.get():h,[h]);return f.createElement(s,{...u,children:p})}}function cl(e,t){return function(i,{forwardMotionProps:r}={forwardMotionProps:!1}){const a={...qs(i)?sl:nl,preloadedFeatures:e,useRender:ll(r),createVisualElement:t,Component:i};return Mo(a)}}function vr(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}function es(e,t,s){const i=e.getProps();return Js(i,t,s!==void 0?s:i.custom,e)}const dl=Ws(()=>window.ScrollTimeline!==void 0);class ul{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let i=0;i<this.animations.length;i++)this.animations[i][t]=s}attachTimeline(t,s){const i=this.animations.map(r=>{if(dl()&&r.attachTimeline)return r.attachTimeline(t);if(typeof s=="function")return s(r)});return()=>{i.forEach((r,o)=>{r&&r(),this.animations[o].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class hl extends ul{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function an(e,t){return e?e[t]||e.default||e:void 0}const ws=2e4;function br(e){let t=0;const s=50;let i=e.next(t);for(;!i.done&&t<ws;)t+=s,i=e.next(t);return t>=ws?1/0:t}function on(e){return typeof e=="function"}function Dn(e,t){e.timeline=t,e.onfinish=null}const ln=e=>Array.isArray(e)&&typeof e[0]=="number",fl={linearEasing:void 0};function ml(e,t){const s=Ws(e);return()=>{var i;return(i=fl[t])!==null&&i!==void 0?i:s()}}const Ht=ml(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),wr=(e,t,s=10)=>{let i="";const r=Math.max(Math.round(t/s),2);for(let o=0;o<r;o++)i+=e(lt(0,r-1,o))+", ";return`linear(${i.substring(0,i.length-2)})`};function jr(e){return!!(typeof e=="function"&&Ht()||!e||typeof e=="string"&&(e in js||Ht())||ln(e)||Array.isArray(e)&&e.every(jr))}const mt=([e,t,s,i])=>`cubic-bezier(${e}, ${t}, ${s}, ${i})`,js={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:mt([0,.65,.55,1]),circOut:mt([.55,0,1,.45]),backIn:mt([.31,.01,.66,-.59]),backOut:mt([.33,1.53,.69,.99])};function Nr(e,t){if(e)return typeof e=="function"&&Ht()?wr(e,t):ln(e)?mt(e):Array.isArray(e)?e.map(s=>Nr(s,t)||js.easeOut):js[e]}const Ve={x:!1,y:!1};function Sr(){return Ve.x||Ve.y}function pl(e,t,s){var i;if(e instanceof Element)return[e];if(typeof e=="string"){let r=document;const o=(i=void 0)!==null&&i!==void 0?i:r.querySelectorAll(e);return o?Array.from(o):[]}return Array.from(e)}function Tr(e,t){const s=pl(e),i=new AbortController,r={passive:!0,...t,signal:i.signal};return[s,r,()=>i.abort()]}function In(e){return t=>{t.pointerType==="touch"||Sr()||e(t)}}function xl(e,t,s={}){const[i,r,o]=Tr(e,s),a=In(c=>{const{target:l}=c,d=t(c);if(typeof d!="function"||!l)return;const u=In(h=>{d(h),l.removeEventListener("pointerleave",u)});l.addEventListener("pointerleave",u,r)});return i.forEach(c=>{c.addEventListener("pointerenter",a,r)}),o}const Cr=(e,t)=>t?e===t?!0:Cr(e,t.parentElement):!1,cn=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,gl=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function yl(e){return gl.has(e.tagName)||e.tabIndex!==-1}const pt=new WeakSet;function Vn(e){return t=>{t.key==="Enter"&&e(t)}}function rs(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const vl=(e,t)=>{const s=e.currentTarget;if(!s)return;const i=Vn(()=>{if(pt.has(s))return;rs(s,"down");const r=Vn(()=>{rs(s,"up")}),o=()=>rs(s,"cancel");s.addEventListener("keyup",r,t),s.addEventListener("blur",o,t)});s.addEventListener("keydown",i,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",i),t)};function Ln(e){return cn(e)&&!Sr()}function bl(e,t,s={}){const[i,r,o]=Tr(e,s),a=c=>{const l=c.currentTarget;if(!Ln(c)||pt.has(l))return;pt.add(l);const d=t(c),u=(y,N)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),!(!Ln(y)||!pt.has(l))&&(pt.delete(l),typeof d=="function"&&d(y,{success:N}))},h=y=>{u(y,s.useGlobalTarget||Cr(l,y.target))},p=y=>{u(y,!1)};window.addEventListener("pointerup",h,r),window.addEventListener("pointercancel",p,r)};return i.forEach(c=>{!yl(c)&&c.getAttribute("tabindex")===null&&(c.tabIndex=0),(s.useGlobalTarget?window:c).addEventListener("pointerdown",a,r),c.addEventListener("focus",d=>vl(d,r),r)}),o}function wl(e){return e==="x"||e==="y"?Ve[e]?null:(Ve[e]=!0,()=>{Ve[e]=!1}):Ve.x||Ve.y?null:(Ve.x=Ve.y=!0,()=>{Ve.x=Ve.y=!1})}const kr=new Set(["width","height","top","left","right","bottom",...ut]);let zt;function jl(){zt=void 0}const Fe={now:()=>(zt===void 0&&Fe.set(Ne.isProcessing||go.useManualTiming?Ne.timestamp:performance.now()),zt),set:e=>{zt=e,queueMicrotask(jl)}};function dn(e,t){e.indexOf(t)===-1&&e.push(t)}function un(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class hn{constructor(){this.subscriptions=[]}add(t){return dn(this.subscriptions,t),()=>un(this.subscriptions,t)}notify(t,s,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](t,s,i);else for(let o=0;o<r;o++){const a=this.subscriptions[o];a&&a(t,s,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Ar(e,t){return t?e*(1e3/t):0}const Fn=30,Nl=e=>!isNaN(parseFloat(e));class Sl{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,r=!0)=>{const o=Fe.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Fe.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=Nl(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new hn);const i=this.events[t].add(s);return t==="change"?()=>{i(),me.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,i){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-i}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Fe.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>Fn)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,Fn);return Ar(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Tt(e,t){return new Sl(e,t)}function Tl(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,Tt(s))}function Cl(e,t){const s=es(e,t);let{transitionEnd:i={},transition:r={},...o}=s||{};o={...o,...i};for(const a in o){const c=Fo(o[a]);Tl(e,a,c)}}function kl(e){return!!(Te(e)&&e.add)}function Ns(e,t){const s=e.getValue("willChange");if(kl(s))return s.add(t)}function Pr(e){return e.props[rr]}const _r=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e,Al=1e-7,Pl=12;function _l(e,t,s,i,r){let o,a,c=0;do a=t+(s-t)/2,o=_r(a,i,r)-e,o>0?s=a:t=a;while(Math.abs(o)>Al&&++c<Pl);return a}function Et(e,t,s,i){if(e===t&&s===i)return Ee;const r=o=>_l(o,0,1,e,s);return o=>o===0||o===1?o:_r(r(o),t,i)}const Er=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Mr=e=>t=>1-e(1-t),Rr=Et(.33,1.53,.69,.99),fn=Mr(Rr),Dr=Er(fn),Ir=e=>(e*=2)<1?.5*fn(e):.5*(2-Math.pow(2,-10*(e-1))),mn=e=>1-Math.sin(Math.acos(e)),Vr=Mr(mn),Lr=Er(mn),Fr=e=>/^0[^.\s]+$/u.test(e);function El(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||Fr(e):!0}const gt=e=>Math.round(e*1e5)/1e5,pn=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Ml(e){return e==null}const Rl=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,xn=(e,t)=>s=>!!(typeof s=="string"&&Rl.test(s)&&s.startsWith(e)||t&&!Ml(s)&&Object.prototype.hasOwnProperty.call(s,t)),Or=(e,t,s)=>i=>{if(typeof i!="string")return i;const[r,o,a,c]=i.match(pn);return{[e]:parseFloat(r),[t]:parseFloat(o),[s]:parseFloat(a),alpha:c!==void 0?parseFloat(c):1}},Dl=e=>$e(0,255,e),as={...ht,transform:e=>Math.round(Dl(e))},Je={test:xn("rgb","red"),parse:Or("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:i=1})=>"rgba("+as.transform(e)+", "+as.transform(t)+", "+as.transform(s)+", "+gt(St.transform(i))+")"};function Il(e){let t="",s="",i="",r="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,s+=s,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const Ss={test:xn("#"),parse:Il,transform:Je.transform},nt={test:xn("hsl","hue"),parse:Or("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:i=1})=>"hsla("+Math.round(e)+", "+Le.transform(gt(t))+", "+Le.transform(gt(s))+", "+gt(St.transform(i))+")"},Se={test:e=>Je.test(e)||Ss.test(e)||nt.test(e),parse:e=>Je.test(e)?Je.parse(e):nt.test(e)?nt.parse(e):Ss.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Je.transform(e):nt.transform(e)},Vl=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Ll(e){var t,s;return isNaN(e)&&typeof e=="string"&&(((t=e.match(pn))===null||t===void 0?void 0:t.length)||0)+(((s=e.match(Vl))===null||s===void 0?void 0:s.length)||0)>0}const zr="number",$r="color",Fl="var",Ol="var(",On="${}",zl=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ct(e){const t=e.toString(),s=[],i={color:[],number:[],var:[]},r=[];let o=0;const c=t.replace(zl,l=>(Se.test(l)?(i.color.push(o),r.push($r),s.push(Se.parse(l))):l.startsWith(Ol)?(i.var.push(o),r.push(Fl),s.push(l)):(i.number.push(o),r.push(zr),s.push(parseFloat(l))),++o,On)).split(On);return{values:s,split:c,indexes:i,types:r}}function Br(e){return Ct(e).values}function Ur(e){const{split:t,types:s}=Ct(e),i=t.length;return r=>{let o="";for(let a=0;a<i;a++)if(o+=t[a],r[a]!==void 0){const c=s[a];c===zr?o+=gt(r[a]):c===$r?o+=Se.transform(r[a]):o+=r[a]}return o}}const $l=e=>typeof e=="number"?0:e;function Bl(e){const t=Br(e);return Ur(e)(t.map($l))}const Ke={test:Ll,parse:Br,createTransformer:Ur,getAnimatableNone:Bl},Ul=new Set(["brightness","contrast","saturate","opacity"]);function Hl(e){const[t,s]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[i]=s.match(pn)||[];if(!i)return e;const r=s.replace(i,"");let o=Ul.has(t)?1:0;return i!==s&&(o*=100),t+"("+o+r+")"}const Wl=/\b([a-z-]*)\(.*?\)/gu,Ts={...Ke,getAnimatableNone:e=>{const t=e.match(Wl);return t?t.map(Hl).join(" "):e}},Kl={...Qs,color:Se,backgroundColor:Se,outlineColor:Se,fill:Se,stroke:Se,borderColor:Se,borderTopColor:Se,borderRightColor:Se,borderBottomColor:Se,borderLeftColor:Se,filter:Ts,WebkitFilter:Ts},gn=e=>Kl[e];function Hr(e,t){let s=gn(e);return s!==Ts&&(s=Ke),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const Yl=new Set(["auto","none","0"]);function Gl(e,t,s){let i=0,r;for(;i<e.length&&!r;){const o=e[i];typeof o=="string"&&!Yl.has(o)&&Ct(o).values.length&&(r=e[i]),i++}if(r&&s)for(const o of t)e[o]=Hr(s,r)}const zn=e=>e===ht||e===J,$n=(e,t)=>parseFloat(e.split(", ")[t]),Bn=(e,t)=>(s,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return $n(r[1],t);{const o=i.match(/^matrix\((.+)\)$/u);return o?$n(o[1],e):0}},Xl=new Set(["x","y","z"]),ql=ut.filter(e=>!Xl.has(e));function Jl(e){const t=[];return ql.forEach(s=>{const i=e.getValue(s);i!==void 0&&(t.push([s,i.get()]),i.set(s.startsWith("scale")?1:0))}),t}const dt={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Bn(4,13),y:Bn(5,14)};dt.translateX=dt.x;dt.translateY=dt.y;const et=new Set;let Cs=!1,ks=!1;function Wr(){if(ks){const e=Array.from(et).filter(i=>i.needsMeasurement),t=new Set(e.map(i=>i.element)),s=new Map;t.forEach(i=>{const r=Jl(i);r.length&&(s.set(i,r),i.render())}),e.forEach(i=>i.measureInitialState()),t.forEach(i=>{i.render();const r=s.get(i);r&&r.forEach(([o,a])=>{var c;(c=i.getValue(o))===null||c===void 0||c.set(a)})}),e.forEach(i=>i.measureEndState()),e.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}ks=!1,Cs=!1,et.forEach(e=>e.complete()),et.clear()}function Kr(){et.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(ks=!0)})}function Zl(){Kr(),Wr()}class yn{constructor(t,s,i,r,o,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=i,this.motionValue=r,this.element=o,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(et.add(this),Cs||(Cs=!0,me.read(Kr),me.resolveKeyframes(Wr))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:i,motionValue:r}=this;for(let o=0;o<t.length;o++)if(t[o]===null)if(o===0){const a=r==null?void 0:r.get(),c=t[t.length-1];if(a!==void 0)t[0]=a;else if(i&&s){const l=i.readValue(s,c);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=c),r&&a===void 0&&r.set(t[0])}else t[o]=t[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),et.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,et.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Yr=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Ql=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ec(e){const t=Ql.exec(e);if(!t)return[,];const[,s,i,r]=t;return[`--${s??i}`,r]}function Gr(e,t,s=1){const[i,r]=ec(e);if(!i)return;const o=window.getComputedStyle(t).getPropertyValue(i);if(o){const a=o.trim();return Yr(a)?parseFloat(a):a}return Zs(r)?Gr(r,t,s+1):r}const Xr=e=>t=>t.test(e),tc={test:e=>e==="auto",parse:e=>e},qr=[ht,J,Le,Be,Ho,Uo,tc],Un=e=>qr.find(Xr(e));class Jr extends yn{constructor(t,s,i,r,o){super(t,s,i,r,o,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:i}=this;if(!s||!s.current)return;super.readKeyframes();for(let l=0;l<t.length;l++){let d=t[l];if(typeof d=="string"&&(d=d.trim(),Zs(d))){const u=Gr(d,s.current);u!==void 0&&(t[l]=u),l===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!kr.has(i)||t.length!==2)return;const[r,o]=t,a=Un(r),c=Un(o);if(a!==c)if(zn(a)&&zn(c))for(let l=0;l<t.length;l++){const d=t[l];typeof d=="string"&&(t[l]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,i=[];for(let r=0;r<t.length;r++)El(t[r])&&i.push(r);i.length&&Gl(t,i,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:i}=this;if(!t||!t.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=dt[i](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const r=s[s.length-1];r!==void 0&&t.getValue(i,r).jump(r,!1)}measureEndState(){var t;const{element:s,name:i,unresolvedKeyframes:r}=this;if(!s||!s.current)return;const o=s.getValue(i);o&&o.jump(this.measuredOrigin,!1);const a=r.length-1,c=r[a];r[a]=dt[i](s.measureViewportBox(),window.getComputedStyle(s.current)),c!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=c),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([l,d])=>{s.getValue(l).set(d)}),this.resolveNoneKeyframes()}}const Hn=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Ke.test(e)||e==="0")&&!e.startsWith("url("));function sc(e){const t=e[0];if(e.length===1)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}function nc(e,t,s,i){const r=e[0];if(r===null)return!1;if(t==="display"||t==="visibility")return!0;const o=e[e.length-1],a=Hn(r,t),c=Hn(o,t);return!a||!c?!1:sc(e)||(s==="spring"||on(s))&&i}const ic=e=>e!==null;function ts(e,{repeat:t,repeatType:s="loop"},i){const r=e.filter(ic),o=t&&s!=="loop"&&t%2===1?0:r.length-1;return!o||i===void 0?r[o]:i}const rc=40;class Zr{constructor({autoplay:t=!0,delay:s=0,type:i="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:a="loop",...c}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Fe.now(),this.options={autoplay:t,delay:s,type:i,repeat:r,repeatDelay:o,repeatType:a,...c},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>rc?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Zl(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Fe.now(),this.hasAttemptedResolve=!0;const{name:i,type:r,velocity:o,delay:a,onComplete:c,onUpdate:l,isGenerator:d}=this.options;if(!d&&!nc(t,i,r,o))if(a)this.options.duration=0;else{l&&l(ts(t,this.options,s)),c&&c(),this.resolveFinishedPromise();return}const u=this.initPlayback(t,s);u!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...u},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const ge=(e,t,s)=>e+(t-e)*s;function os(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(t-e)*6*s:s<1/2?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function ac({hue:e,saturation:t,lightness:s,alpha:i}){e/=360,t/=100,s/=100;let r=0,o=0,a=0;if(!t)r=o=a=s;else{const c=s<.5?s*(1+t):s+t-s*t,l=2*s-c;r=os(l,c,e+1/3),o=os(l,c,e),a=os(l,c,e-1/3)}return{red:Math.round(r*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:i}}function Wt(e,t){return s=>s>0?t:e}const ls=(e,t,s)=>{const i=e*e,r=s*(t*t-i)+i;return r<0?0:Math.sqrt(r)},oc=[Ss,Je,nt],lc=e=>oc.find(t=>t.test(e));function Wn(e){const t=lc(e);if(!t)return!1;let s=t.parse(e);return t===nt&&(s=ac(s)),s}const Kn=(e,t)=>{const s=Wn(e),i=Wn(t);if(!s||!i)return Wt(e,t);const r={...s};return o=>(r.red=ls(s.red,i.red,o),r.green=ls(s.green,i.green,o),r.blue=ls(s.blue,i.blue,o),r.alpha=ge(s.alpha,i.alpha,o),Je.transform(r))},cc=(e,t)=>s=>t(e(s)),Mt=(...e)=>e.reduce(cc),As=new Set(["none","hidden"]);function dc(e,t){return As.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}function uc(e,t){return s=>ge(e,t,s)}function vn(e){return typeof e=="number"?uc:typeof e=="string"?Zs(e)?Wt:Se.test(e)?Kn:mc:Array.isArray(e)?Qr:typeof e=="object"?Se.test(e)?Kn:hc:Wt}function Qr(e,t){const s=[...e],i=s.length,r=e.map((o,a)=>vn(o)(o,t[a]));return o=>{for(let a=0;a<i;a++)s[a]=r[a](o);return s}}function hc(e,t){const s={...e,...t},i={};for(const r in s)e[r]!==void 0&&t[r]!==void 0&&(i[r]=vn(e[r])(e[r],t[r]));return r=>{for(const o in i)s[o]=i[o](r);return s}}function fc(e,t){var s;const i=[],r={color:0,var:0,number:0};for(let o=0;o<t.values.length;o++){const a=t.types[o],c=e.indexes[a][r[a]],l=(s=e.values[c])!==null&&s!==void 0?s:0;i[o]=l,r[a]++}return i}const mc=(e,t)=>{const s=Ke.createTransformer(t),i=Ct(e),r=Ct(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?As.has(e)&&!r.values.length||As.has(t)&&!i.values.length?dc(e,t):Mt(Qr(fc(i,r),r.values),s):Wt(e,t)};function ea(e,t,s){return typeof e=="number"&&typeof t=="number"&&typeof s=="number"?ge(e,t,s):vn(e)(e,t)}const pc=5;function ta(e,t,s){const i=Math.max(t-pc,0);return Ar(s-e(i),t-i)}const ye={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},cs=.001;function xc({duration:e=ye.duration,bounce:t=ye.bounce,velocity:s=ye.velocity,mass:i=ye.mass}){let r,o,a=1-t;a=$e(ye.minDamping,ye.maxDamping,a),e=$e(ye.minDuration,ye.maxDuration,ze(e)),a<1?(r=d=>{const u=d*a,h=u*e,p=u-s,y=Ps(d,a),N=Math.exp(-h);return cs-p/y*N},o=d=>{const h=d*a*e,p=h*s+s,y=Math.pow(a,2)*Math.pow(d,2)*e,N=Math.exp(-h),j=Ps(Math.pow(d,2),a);return(-r(d)+cs>0?-1:1)*((p-y)*N)/j}):(r=d=>{const u=Math.exp(-d*e),h=(d-s)*e+1;return-cs+u*h},o=d=>{const u=Math.exp(-d*e),h=(s-d)*(e*e);return u*h});const c=5/e,l=yc(r,o,c);if(e=Oe(e),isNaN(l))return{stiffness:ye.stiffness,damping:ye.damping,duration:e};{const d=Math.pow(l,2)*i;return{stiffness:d,damping:a*2*Math.sqrt(i*d),duration:e}}}const gc=12;function yc(e,t,s){let i=s;for(let r=1;r<gc;r++)i=i-e(i)/t(i);return i}function Ps(e,t){return e*Math.sqrt(1-t*t)}const vc=["duration","bounce"],bc=["stiffness","damping","mass"];function Yn(e,t){return t.some(s=>e[s]!==void 0)}function wc(e){let t={velocity:ye.velocity,stiffness:ye.stiffness,damping:ye.damping,mass:ye.mass,isResolvedFromDuration:!1,...e};if(!Yn(e,bc)&&Yn(e,vc))if(e.visualDuration){const s=e.visualDuration,i=2*Math.PI/(s*1.2),r=i*i,o=2*$e(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:ye.mass,stiffness:r,damping:o}}else{const s=xc(e);t={...t,...s,mass:ye.mass},t.isResolvedFromDuration=!0}return t}function sa(e=ye.visualDuration,t=ye.bounce){const s=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=s;const o=s.keyframes[0],a=s.keyframes[s.keyframes.length-1],c={done:!1,value:o},{stiffness:l,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:y}=wc({...s,velocity:-ze(s.velocity||0)}),N=p||0,j=d/(2*Math.sqrt(l*u)),P=a-o,T=ze(Math.sqrt(l/u)),A=Math.abs(P)<5;i||(i=A?ye.restSpeed.granular:ye.restSpeed.default),r||(r=A?ye.restDelta.granular:ye.restDelta.default);let R;if(j<1){const S=Ps(T,j);R=C=>{const L=Math.exp(-j*T*C);return a-L*((N+j*T*P)/S*Math.sin(S*C)+P*Math.cos(S*C))}}else if(j===1)R=S=>a-Math.exp(-T*S)*(P+(N+T*P)*S);else{const S=T*Math.sqrt(j*j-1);R=C=>{const L=Math.exp(-j*T*C),M=Math.min(S*C,300);return a-L*((N+j*T*P)*Math.sinh(M)+S*P*Math.cosh(M))/S}}const $={calculatedDuration:y&&h||null,next:S=>{const C=R(S);if(y)c.done=S>=h;else{let L=0;j<1&&(L=S===0?Oe(N):ta(R,S,C));const M=Math.abs(L)<=i,B=Math.abs(a-C)<=r;c.done=M&&B}return c.value=c.done?a:C,c},toString:()=>{const S=Math.min(br($),ws),C=wr(L=>$.next(S*L).value,S,30);return S+"ms "+C}};return $}function Gn({keyframes:e,velocity:t=0,power:s=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:o=500,modifyTarget:a,min:c,max:l,restDelta:d=.5,restSpeed:u}){const h=e[0],p={done:!1,value:h},y=M=>c!==void 0&&M<c||l!==void 0&&M>l,N=M=>c===void 0?l:l===void 0||Math.abs(c-M)<Math.abs(l-M)?c:l;let j=s*t;const P=h+j,T=a===void 0?P:a(P);T!==P&&(j=T-h);const A=M=>-j*Math.exp(-M/i),R=M=>T+A(M),$=M=>{const B=A(M),z=R(M);p.done=Math.abs(B)<=d,p.value=p.done?T:z};let S,C;const L=M=>{y(p.value)&&(S=M,C=sa({keyframes:[p.value,N(p.value)],velocity:ta(R,M,p.value),damping:r,stiffness:o,restDelta:d,restSpeed:u}))};return L(0),{calculatedDuration:null,next:M=>{let B=!1;return!C&&S===void 0&&(B=!0,$(M),L(M)),S!==void 0&&M>=S?C.next(M-S):(!B&&$(M),p)}}}const jc=Et(.42,0,1,1),Nc=Et(0,0,.58,1),na=Et(.42,0,.58,1),Sc=e=>Array.isArray(e)&&typeof e[0]!="number",Tc={linear:Ee,easeIn:jc,easeInOut:na,easeOut:Nc,circIn:mn,circInOut:Lr,circOut:Vr,backIn:fn,backInOut:Dr,backOut:Rr,anticipate:Ir},Xn=e=>{if(ln(e)){er(e.length===4);const[t,s,i,r]=e;return Et(t,s,i,r)}else if(typeof e=="string")return Tc[e];return e};function Cc(e,t,s){const i=[],r=s||ea,o=e.length-1;for(let a=0;a<o;a++){let c=r(e[a],e[a+1]);if(t){const l=Array.isArray(t)?t[a]||Ee:t;c=Mt(l,c)}i.push(c)}return i}function kc(e,t,{clamp:s=!0,ease:i,mixer:r}={}){const o=e.length;if(er(o===t.length),o===1)return()=>t[0];if(o===2&&t[0]===t[1])return()=>t[1];const a=e[0]===e[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const c=Cc(t,i,r),l=c.length,d=u=>{if(a&&u<e[0])return t[0];let h=0;if(l>1)for(;h<e.length-2&&!(u<e[h+1]);h++);const p=lt(e[h],e[h+1],u);return c[h](p)};return s?u=>d($e(e[0],e[o-1],u)):d}function Ac(e,t){const s=e[e.length-1];for(let i=1;i<=t;i++){const r=lt(0,t,i);e.push(ge(s,1,r))}}function Pc(e){const t=[0];return Ac(t,e.length-1),t}function _c(e,t){return e.map(s=>s*t)}function Ec(e,t){return e.map(()=>t||na).splice(0,e.length-1)}function Kt({duration:e=300,keyframes:t,times:s,ease:i="easeInOut"}){const r=Sc(i)?i.map(Xn):Xn(i),o={done:!1,value:t[0]},a=_c(s&&s.length===t.length?s:Pc(t),e),c=kc(a,t,{ease:Array.isArray(r)?r:Ec(t,r)});return{calculatedDuration:e,next:l=>(o.value=c(l),o.done=l>=e,o)}}const Mc=e=>{const t=({timestamp:s})=>e(s);return{start:()=>me.update(t,!0),stop:()=>We(t),now:()=>Ne.isProcessing?Ne.timestamp:Fe.now()}},Rc={decay:Gn,inertia:Gn,tween:Kt,keyframes:Kt,spring:sa},Dc=e=>e/100;class bn extends Zr{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:s,motionValue:i,element:r,keyframes:o}=this.options,a=(r==null?void 0:r.KeyframeResolver)||yn,c=(l,d)=>this.onKeyframesResolved(l,d);this.resolver=new a(o,c,s,i,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:o,velocity:a=0}=this.options,c=on(s)?s:Rc[s]||Kt;let l,d;c!==Kt&&typeof t[0]!="number"&&(l=Mt(Dc,ea(t[0],t[1])),t=[0,100]);const u=c({...this.options,keyframes:t});o==="mirror"&&(d=c({...this.options,keyframes:[...t].reverse(),velocity:-a})),u.calculatedDuration===null&&(u.calculatedDuration=br(u));const{calculatedDuration:h}=u,p=h+r,y=p*(i+1)-r;return{generator:u,mirroredGenerator:d,mapPercentToKeyframes:l,calculatedDuration:h,resolvedDuration:p,totalDuration:y}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:i}=this;if(!i){const{keyframes:M}=this.options;return{done:!0,value:M[M.length-1]}}const{finalKeyframe:r,generator:o,mirroredGenerator:a,mapPercentToKeyframes:c,keyframes:l,calculatedDuration:d,totalDuration:u,resolvedDuration:h}=i;if(this.startTime===null)return o.next(0);const{delay:p,repeat:y,repeatType:N,repeatDelay:j,onUpdate:P}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-u/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const T=this.currentTime-p*(this.speed>=0?1:-1),A=this.speed>=0?T<0:T>u;this.currentTime=Math.max(T,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let R=this.currentTime,$=o;if(y){const M=Math.min(this.currentTime,u)/h;let B=Math.floor(M),z=M%1;!z&&M>=1&&(z=1),z===1&&B--,B=Math.min(B,y+1),!!(B%2)&&(N==="reverse"?(z=1-z,j&&(z-=j/h)):N==="mirror"&&($=a)),R=$e(0,1,z)*h}const S=A?{done:!1,value:l[0]}:$.next(R);c&&(S.value=c(S.value));let{done:C}=S;!A&&d!==null&&(C=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const L=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&C);return L&&r!==void 0&&(S.value=ts(l,this.options,r)),P&&P(S.value),L&&this.finish(),S}get duration(){const{resolved:t}=this;return t?ze(t.calculatedDuration):0}get time(){return ze(this.currentTime)}set time(t){t=Oe(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=ze(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=Mc,onPlay:s,startTime:i}=this.options;this.driver||(this.driver=t(o=>this.tick(o))),s&&s();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const Ic=new Set(["opacity","clipPath","filter","transform"]);function Vc(e,t,s,{delay:i=0,duration:r=300,repeat:o=0,repeatType:a="loop",ease:c="easeInOut",times:l}={}){const d={[t]:s};l&&(d.offset=l);const u=Nr(c,r);return Array.isArray(u)&&(d.easing=u),e.animate(d,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"})}const Lc=Ws(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Yt=10,Fc=2e4;function Oc(e){return on(e.type)||e.type==="spring"||!jr(e.ease)}function zc(e,t){const s=new bn({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const r=[];let o=0;for(;!i.done&&o<Fc;)i=s.sample(o),r.push(i.value),o+=Yt;return{times:void 0,keyframes:r,duration:o-Yt,ease:"linear"}}const ia={anticipate:Ir,backInOut:Dr,circInOut:Lr};function $c(e){return e in ia}class qn extends Zr{constructor(t){super(t);const{name:s,motionValue:i,element:r,keyframes:o}=this.options;this.resolver=new Jr(o,(a,c)=>this.onKeyframesResolved(a,c),s,i,r),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:i=300,times:r,ease:o,type:a,motionValue:c,name:l,startTime:d}=this.options;if(!c.owner||!c.owner.current)return!1;if(typeof o=="string"&&Ht()&&$c(o)&&(o=ia[o]),Oc(this.options)){const{onComplete:h,onUpdate:p,motionValue:y,element:N,...j}=this.options,P=zc(t,j);t=P.keyframes,t.length===1&&(t[1]=t[0]),i=P.duration,r=P.times,o=P.ease,a="keyframes"}const u=Vc(c.owner.current,l,t,{...this.options,duration:i,times:r,ease:o});return u.startTime=d??this.calcStartTime(),this.pendingTimeline?(Dn(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:h}=this.options;c.set(ts(t,this.options,s)),h&&h(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:i,times:r,type:a,ease:o,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return ze(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return ze(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:i}=s;i.currentTime=Oe(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:i}=s;i.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Ee;const{animation:i}=s;Dn(i,t)}return Ee}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:i,duration:r,type:o,ease:a,times:c}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:u,onComplete:h,element:p,...y}=this.options,N=new bn({...y,keyframes:i,duration:r,type:o,ease:a,times:c,isGenerator:!0}),j=Oe(this.time);d.setWithVelocity(N.sample(j-Yt).value,N.sample(j).value,Yt)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:i,repeatDelay:r,repeatType:o,damping:a,type:c}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:d}=s.owner.getProps();return Lc()&&i&&Ic.has(i)&&!l&&!d&&!r&&o!=="mirror"&&a!==0&&c!=="inertia"}}const Bc={type:"spring",stiffness:500,damping:25,restSpeed:10},Uc=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Hc={type:"keyframes",duration:.8},Wc={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Kc=(e,{keyframes:t})=>t.length>2?Hc:tt.has(e)?e.startsWith("scale")?Uc(t[1]):Bc:Wc;function Yc({when:e,delay:t,delayChildren:s,staggerChildren:i,staggerDirection:r,repeat:o,repeatType:a,repeatDelay:c,from:l,elapsed:d,...u}){return!!Object.keys(u).length}const wn=(e,t,s,i={},r,o)=>a=>{const c=an(i,e)||{},l=c.delay||i.delay||0;let{elapsed:d=0}=i;d=d-Oe(l);let u={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...c,delay:-d,onUpdate:p=>{t.set(p),c.onUpdate&&c.onUpdate(p)},onComplete:()=>{a(),c.onComplete&&c.onComplete()},name:e,motionValue:t,element:o?void 0:r};Yc(c)||(u={...u,...Kc(e,u)}),u.duration&&(u.duration=Oe(u.duration)),u.repeatDelay&&(u.repeatDelay=Oe(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(h=!0)),h&&!o&&t.get()!==void 0){const p=ts(u.keyframes,c);if(p!==void 0)return me.update(()=>{u.onUpdate(p),u.onComplete()}),new hl([])}return!o&&qn.supports(u)?new qn(u):new bn(u)};function Gc({protectedKeys:e,needsAnimating:t},s){const i=e.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,i}function ra(e,t,{delay:s=0,transitionOverride:i,type:r}={}){var o;let{transition:a=e.getDefaultTransition(),transitionEnd:c,...l}=t;i&&(a=i);const d=[],u=r&&e.animationState&&e.animationState.getState()[r];for(const h in l){const p=e.getValue(h,(o=e.latestValues[h])!==null&&o!==void 0?o:null),y=l[h];if(y===void 0||u&&Gc(u,h))continue;const N={delay:s,...an(a||{},h)};let j=!1;if(window.MotionHandoffAnimation){const T=Pr(e);if(T){const A=window.MotionHandoffAnimation(T,h,me);A!==null&&(N.startTime=A,j=!0)}}Ns(e,h),p.start(wn(h,p,y,e.shouldReduceMotion&&kr.has(h)?{type:!1}:N,e,j));const P=p.animation;P&&d.push(P)}return c&&Promise.all(d).then(()=>{me.update(()=>{c&&Cl(e,c)})}),d}function _s(e,t,s={}){var i;const r=es(e,t,s.type==="exit"?(i=e.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=r||{};s.transitionOverride&&(o=s.transitionOverride);const a=r?()=>Promise.all(ra(e,r,s)):()=>Promise.resolve(),c=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:h,staggerDirection:p}=o;return Xc(e,t,u+d,h,p,s)}:()=>Promise.resolve(),{when:l}=o;if(l){const[d,u]=l==="beforeChildren"?[a,c]:[c,a];return d().then(()=>u())}else return Promise.all([a(),c(s.delay)])}function Xc(e,t,s=0,i=0,r=1,o){const a=[],c=(e.variantChildren.size-1)*i,l=r===1?(d=0)=>d*i:(d=0)=>c-d*i;return Array.from(e.variantChildren).sort(qc).forEach((d,u)=>{d.notify("AnimationStart",t),a.push(_s(d,t,{...o,delay:s+l(u)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(a)}function qc(e,t){return e.sortNodePosition(t)}function Jc(e,t,s={}){e.notify("AnimationStart",t);let i;if(Array.isArray(t)){const r=t.map(o=>_s(e,o,s));i=Promise.all(r)}else if(typeof t=="string")i=_s(e,t,s);else{const r=typeof t=="function"?es(e,t,s.custom):t;i=Promise.all(ra(e,r,s))}return i.then(()=>{e.notify("AnimationComplete",t)})}const Zc=Ys.length;function aa(e){if(!e)return;if(!e.isControllingVariants){const s=e.parent?aa(e.parent)||{}:{};return e.props.initial!==void 0&&(s.initial=e.props.initial),s}const t={};for(let s=0;s<Zc;s++){const i=Ys[s],r=e.props[i];(Nt(r)||r===!1)&&(t[i]=r)}return t}const Qc=[...Ks].reverse(),ed=Ks.length;function td(e){return t=>Promise.all(t.map(({animation:s,options:i})=>Jc(e,s,i)))}function sd(e){let t=td(e),s=Jn(),i=!0;const r=l=>(d,u)=>{var h;const p=es(e,u,l==="exit"?(h=e.presenceContext)===null||h===void 0?void 0:h.custom:void 0);if(p){const{transition:y,transitionEnd:N,...j}=p;d={...d,...j,...N}}return d};function o(l){t=l(e)}function a(l){const{props:d}=e,u=aa(e.parent)||{},h=[],p=new Set;let y={},N=1/0;for(let P=0;P<ed;P++){const T=Qc[P],A=s[T],R=d[T]!==void 0?d[T]:u[T],$=Nt(R),S=T===l?A.isActive:null;S===!1&&(N=P);let C=R===u[T]&&R!==d[T]&&$;if(C&&i&&e.manuallyAnimateOnMount&&(C=!1),A.protectedKeys={...y},!A.isActive&&S===null||!R&&!A.prevProp||Zt(R)||typeof R=="boolean")continue;const L=nd(A.prevProp,R);let M=L||T===l&&A.isActive&&!C&&$||P>N&&$,B=!1;const z=Array.isArray(R)?R:[R];let W=z.reduce(r(T),{});S===!1&&(W={});const{prevResolvedValues:G={}}=A,ee={...G,...W},ce=V=>{M=!0,p.has(V)&&(B=!0,p.delete(V)),A.needsAnimating[V]=!0;const U=e.getValue(V);U&&(U.liveStyle=!1)};for(const V in ee){const U=W[V],K=G[V];if(y.hasOwnProperty(V))continue;let ne=!1;bs(U)&&bs(K)?ne=!vr(U,K):ne=U!==K,ne?U!=null?ce(V):p.add(V):U!==void 0&&p.has(V)?ce(V):A.protectedKeys[V]=!0}A.prevProp=R,A.prevResolvedValues=W,A.isActive&&(y={...y,...W}),i&&e.blockInitialAnimation&&(M=!1),M&&(!(C&&L)||B)&&h.push(...z.map(V=>({animation:V,options:{type:T}})))}if(p.size){const P={};p.forEach(T=>{const A=e.getBaseTarget(T),R=e.getValue(T);R&&(R.liveStyle=!0),P[T]=A??null}),h.push({animation:P})}let j=!!h.length;return i&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(j=!1),i=!1,j?t(h):Promise.resolve()}function c(l,d){var u;if(s[l].isActive===d)return Promise.resolve();(u=e.variantChildren)===null||u===void 0||u.forEach(p=>{var y;return(y=p.animationState)===null||y===void 0?void 0:y.setActive(l,d)}),s[l].isActive=d;const h=a(l);for(const p in s)s[p].protectedKeys={};return h}return{animateChanges:a,setActive:c,setAnimateFunction:o,getState:()=>s,reset:()=>{s=Jn(),i=!0}}}function nd(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!vr(t,e):!1}function Ge(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Jn(){return{animate:Ge(!0),whileInView:Ge(),whileHover:Ge(),whileTap:Ge(),whileDrag:Ge(),whileFocus:Ge(),exit:Ge()}}class Ye{constructor(t){this.isMounted=!1,this.node=t}update(){}}class id extends Ye{constructor(t){super(t),t.animationState||(t.animationState=sd(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Zt(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let rd=0;class ad extends Ye{constructor(){super(...arguments),this.id=rd++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const r=this.node.animationState.setActive("exit",!t);s&&!t&&r.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const od={animation:{Feature:id},exit:{Feature:ad}};function kt(e,t,s,i={passive:!0}){return e.addEventListener(t,s,i),()=>e.removeEventListener(t,s)}function Rt(e){return{point:{x:e.pageX,y:e.pageY}}}const ld=e=>t=>cn(t)&&e(t,Rt(t));function yt(e,t,s,i){return kt(e,t,ld(s),i)}const Zn=(e,t)=>Math.abs(e-t);function cd(e,t){const s=Zn(e.x,t.x),i=Zn(e.y,t.y);return Math.sqrt(s**2+i**2)}class oa{constructor(t,s,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=us(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,y=cd(h.offset,{x:0,y:0})>=3;if(!p&&!y)return;const{point:N}=h,{timestamp:j}=Ne;this.history.push({...N,timestamp:j});const{onStart:P,onMove:T}=this.handlers;p||(P&&P(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),T&&T(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=ds(p,this.transformPagePoint),me.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:y,onSessionEnd:N,resumeAnimation:j}=this.handlers;if(this.dragSnapToOrigin&&j&&j(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const P=us(h.type==="pointercancel"?this.lastMoveEventInfo:ds(p,this.transformPagePoint),this.history);this.startEvent&&y&&y(h,P),N&&N(h,P)},!cn(t))return;this.dragSnapToOrigin=o,this.handlers=s,this.transformPagePoint=i,this.contextWindow=r||window;const a=Rt(t),c=ds(a,this.transformPagePoint),{point:l}=c,{timestamp:d}=Ne;this.history=[{...l,timestamp:d}];const{onSessionStart:u}=s;u&&u(t,us(c,this.history)),this.removeListeners=Mt(yt(this.contextWindow,"pointermove",this.handlePointerMove),yt(this.contextWindow,"pointerup",this.handlePointerUp),yt(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),We(this.updatePoint)}}function ds(e,t){return t?{point:t(e.point)}:e}function Qn(e,t){return{x:e.x-t.x,y:e.y-t.y}}function us({point:e},t){return{point:e,delta:Qn(e,la(t)),offset:Qn(e,dd(t)),velocity:ud(t,.1)}}function dd(e){return e[0]}function la(e){return e[e.length-1]}function ud(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,i=null;const r=la(e);for(;s>=0&&(i=e[s],!(r.timestamp-i.timestamp>Oe(t)));)s--;if(!i)return{x:0,y:0};const o=ze(r.timestamp-i.timestamp);if(o===0)return{x:0,y:0};const a={x:(r.x-i.x)/o,y:(r.y-i.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}const ca=1e-4,hd=1-ca,fd=1+ca,da=.01,md=0-da,pd=0+da;function Me(e){return e.max-e.min}function xd(e,t,s){return Math.abs(e-t)<=s}function ei(e,t,s,i=.5){e.origin=i,e.originPoint=ge(t.min,t.max,e.origin),e.scale=Me(s)/Me(t),e.translate=ge(s.min,s.max,e.origin)-e.originPoint,(e.scale>=hd&&e.scale<=fd||isNaN(e.scale))&&(e.scale=1),(e.translate>=md&&e.translate<=pd||isNaN(e.translate))&&(e.translate=0)}function vt(e,t,s,i){ei(e.x,t.x,s.x,i?i.originX:void 0),ei(e.y,t.y,s.y,i?i.originY:void 0)}function ti(e,t,s){e.min=s.min+t.min,e.max=e.min+Me(t)}function gd(e,t,s){ti(e.x,t.x,s.x),ti(e.y,t.y,s.y)}function si(e,t,s){e.min=t.min-s.min,e.max=e.min+Me(t)}function bt(e,t,s){si(e.x,t.x,s.x),si(e.y,t.y,s.y)}function yd(e,{min:t,max:s},i){return t!==void 0&&e<t?e=i?ge(t,e,i.min):Math.max(e,t):s!==void 0&&e>s&&(e=i?ge(s,e,i.max):Math.min(e,s)),e}function ni(e,t,s){return{min:t!==void 0?e.min+t:void 0,max:s!==void 0?e.max+s-(e.max-e.min):void 0}}function vd(e,{top:t,left:s,bottom:i,right:r}){return{x:ni(e.x,s,r),y:ni(e.y,t,i)}}function ii(e,t){let s=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,i]=[i,s]),{min:s,max:i}}function bd(e,t){return{x:ii(e.x,t.x),y:ii(e.y,t.y)}}function wd(e,t){let s=.5;const i=Me(e),r=Me(t);return r>i?s=lt(t.min,t.max-i,e.min):i>r&&(s=lt(e.min,e.max-r,t.min)),$e(0,1,s)}function jd(e,t){const s={};return t.min!==void 0&&(s.min=t.min-e.min),t.max!==void 0&&(s.max=t.max-e.min),s}const Es=.35;function Nd(e=Es){return e===!1?e=0:e===!0&&(e=Es),{x:ri(e,"left","right"),y:ri(e,"top","bottom")}}function ri(e,t,s){return{min:ai(e,t),max:ai(e,s)}}function ai(e,t){return typeof e=="number"?e:e[t]||0}const oi=()=>({translate:0,scale:1,origin:0,originPoint:0}),it=()=>({x:oi(),y:oi()}),li=()=>({min:0,max:0}),ve=()=>({x:li(),y:li()});function De(e){return[e("x"),e("y")]}function ua({top:e,left:t,right:s,bottom:i}){return{x:{min:t,max:s},y:{min:e,max:i}}}function Sd({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Td(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:i.y,right:i.x}}function hs(e){return e===void 0||e===1}function Ms({scale:e,scaleX:t,scaleY:s}){return!hs(e)||!hs(t)||!hs(s)}function Xe(e){return Ms(e)||ha(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function ha(e){return ci(e.x)||ci(e.y)}function ci(e){return e&&e!=="0%"}function Gt(e,t,s){const i=e-s,r=t*i;return s+r}function di(e,t,s,i,r){return r!==void 0&&(e=Gt(e,r,i)),Gt(e,s,i)+t}function Rs(e,t=0,s=1,i,r){e.min=di(e.min,t,s,i,r),e.max=di(e.max,t,s,i,r)}function fa(e,{x:t,y:s}){Rs(e.x,t.translate,t.scale,t.originPoint),Rs(e.y,s.translate,s.scale,s.originPoint)}const ui=.999999999999,hi=1.0000000000001;function Cd(e,t,s,i=!1){const r=s.length;if(!r)return;t.x=t.y=1;let o,a;for(let c=0;c<r;c++){o=s[c],a=o.projectionDelta;const{visualElement:l}=o.options;l&&l.props.style&&l.props.style.display==="contents"||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&at(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,fa(e,a)),i&&Xe(o.latestValues)&&at(e,o.latestValues))}t.x<hi&&t.x>ui&&(t.x=1),t.y<hi&&t.y>ui&&(t.y=1)}function rt(e,t){e.min=e.min+t,e.max=e.max+t}function fi(e,t,s,i,r=.5){const o=ge(e.min,e.max,r);Rs(e,t,s,o,i)}function at(e,t){fi(e.x,t.x,t.scaleX,t.scale,t.originX),fi(e.y,t.y,t.scaleY,t.scale,t.originY)}function ma(e,t){return ua(Td(e.getBoundingClientRect(),t))}function kd(e,t,s){const i=ma(e,s),{scroll:r}=t;return r&&(rt(i.x,r.offset.x),rt(i.y,r.offset.y)),i}const pa=({current:e})=>e?e.ownerDocument.defaultView:null,Ad=new WeakMap;class Pd{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ve(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(Rt(u).point)},o=(u,h)=>{const{drag:p,dragPropagation:y,onDragStart:N}=this.getProps();if(p&&!y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=wl(p),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),De(P=>{let T=this.getAxisMotionValue(P).get()||0;if(Le.test(T)){const{projection:A}=this.visualElement;if(A&&A.layout){const R=A.layout.layoutBox[P];R&&(T=Me(R)*(parseFloat(T)/100))}}this.originPoint[P]=T}),N&&me.postRender(()=>N(u,h)),Ns(this.visualElement,"transform");const{animationState:j}=this.visualElement;j&&j.setActive("whileDrag",!0)},a=(u,h)=>{const{dragPropagation:p,dragDirectionLock:y,onDirectionLock:N,onDrag:j}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:P}=h;if(y&&this.currentDirection===null){this.currentDirection=_d(P),this.currentDirection!==null&&N&&N(this.currentDirection);return}this.updateAxis("x",h.point,P),this.updateAxis("y",h.point,P),this.visualElement.render(),j&&j(u,h)},c=(u,h)=>this.stop(u,h),l=()=>De(u=>{var h;return this.getAnimationState(u)==="paused"&&((h=this.getAxisMotionValue(u).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new oa(t,{onSessionStart:r,onStart:o,onMove:a,onSessionEnd:c,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:pa(this.visualElement)})}stop(t,s){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=s;this.startAnimation(r);const{onDragEnd:o}=this.getProps();o&&me.postRender(()=>o(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,i){const{drag:r}=this.getProps();if(!i||!Ft(t,r,this.currentDirection))return;const o=this.getAxisMotionValue(t);let a=this.originPoint[t]+i[t];this.constraints&&this.constraints[t]&&(a=yd(a,this.constraints[t],this.elastic[t])),o.set(a)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;s&&st(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&r?this.constraints=vd(r.layoutBox,s):this.constraints=!1,this.elastic=Nd(i),o!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&De(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=jd(r.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!st(t))return!1;const i=t.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const o=kd(i,r.root,this.visualElement.getTransformPagePoint());let a=bd(r.layout.layoutBox,o);if(s){const c=s(Sd(a));this.hasMutatedConstraints=!!c,c&&(a=ua(c))}return a}startAnimation(t){const{drag:s,dragMomentum:i,dragElastic:r,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:c}=this.getProps(),l=this.constraints||{},d=De(u=>{if(!Ft(u,s,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const p=r?200:1e6,y=r?40:1e7,N={type:"inertia",velocity:i?t[u]:0,bounceStiffness:p,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...o,...h};return this.startAxisValueAnimation(u,N)});return Promise.all(d).then(c)}startAxisValueAnimation(t,s){const i=this.getAxisMotionValue(t);return Ns(this.visualElement,t),i.start(wn(t,i,0,s,this.visualElement,!1))}stopAnimation(){De(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){De(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,i=this.visualElement.getProps(),r=i[s];return r||this.visualElement.getValue(t,(i.initial?i.initial[t]:void 0)||0)}snapToCursor(t){De(s=>{const{drag:i}=this.getProps();if(!Ft(s,i,this.currentDirection))return;const{projection:r}=this.visualElement,o=this.getAxisMotionValue(s);if(r&&r.layout){const{min:a,max:c}=r.layout.layoutBox[s];o.set(t[s]-ge(a,c,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:i}=this.visualElement;if(!st(s)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};De(a=>{const c=this.getAxisMotionValue(a);if(c&&this.constraints!==!1){const l=c.get();r[a]=wd({min:l,max:l},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),De(a=>{if(!Ft(a,t,null))return;const c=this.getAxisMotionValue(a),{min:l,max:d}=this.constraints[a];c.set(ge(l,d,r[a]))})}addListeners(){if(!this.visualElement.current)return;Ad.set(this.visualElement,this);const t=this.visualElement.current,s=yt(t,"pointerdown",l=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(l)}),i=()=>{const{dragConstraints:l}=this.getProps();st(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,o=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),me.read(i);const a=kt(window,"resize",()=>this.scalePositionWithinConstraints()),c=r.addEventListener("didUpdate",(({delta:l,hasLayoutChanged:d})=>{this.isDragging&&d&&(De(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())}));return()=>{a(),s(),o(),c&&c()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:o=!1,dragElastic:a=Es,dragMomentum:c=!0}=t;return{...t,drag:s,dragDirectionLock:i,dragPropagation:r,dragConstraints:o,dragElastic:a,dragMomentum:c}}}function Ft(e,t,s){return(t===!0||t===e)&&(s===null||s===e)}function _d(e,t=10){let s=null;return Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x"),s}class Ed extends Ye{constructor(t){super(t),this.removeGroupControls=Ee,this.removeListeners=Ee,this.controls=new Pd(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ee}unmount(){this.removeGroupControls(),this.removeListeners()}}const mi=e=>(t,s)=>{e&&me.postRender(()=>e(t,s))};class Md extends Ye{constructor(){super(...arguments),this.removePointerDownListener=Ee}onPointerDown(t){this.session=new oa(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:pa(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:mi(t),onStart:mi(s),onMove:i,onEnd:(o,a)=>{delete this.session,r&&me.postRender(()=>r(o,a))}}}mount(){this.removePointerDownListener=yt(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const $t={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pi(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const ft={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(J.test(e))e=parseFloat(e);else return e;const s=pi(e,t.target.x),i=pi(e,t.target.y);return`${s}% ${i}%`}},Rd={correct:(e,{treeScale:t,projectionDelta:s})=>{const i=e,r=Ke.parse(e);if(r.length>5)return i;const o=Ke.createTransformer(e),a=typeof r[0]!="number"?1:0,c=s.x.scale*t.x,l=s.y.scale*t.y;r[0+a]/=c,r[1+a]/=l;const d=ge(c,l,.5);return typeof r[2+a]=="number"&&(r[2+a]/=d),typeof r[3+a]=="number"&&(r[3+a]/=d),o(r)}};class Dd extends f.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:i,layoutId:r}=this.props,{projection:o}=t;el(Id),o&&(s.group&&s.group.add(o),i&&i.register&&r&&i.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),$t.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:i,drag:r,isPresent:o}=this.props,a=i.projection;return a&&(a.isPresent=o,r||t.layoutDependency!==s||s===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?a.promote():a.relegate()||me.postRender(()=>{const c=a.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Xs.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:i}=this.props,{projection:r}=t;r&&(r.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function xa(e){const[t,s]=Zi(),i=f.useContext($s);return n.jsx(Dd,{...e,layoutGroup:i,switchLayoutGroup:f.useContext(ar),isPresent:t,safeToRemove:s})}const Id={borderRadius:{...ft,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ft,borderTopRightRadius:ft,borderBottomLeftRadius:ft,borderBottomRightRadius:ft,boxShadow:Rd};function Vd(e,t,s){const i=Te(e)?e:Tt(e);return i.start(wn("",i,t,s)),i.animation}function Ld(e){return e instanceof SVGElement&&e.tagName!=="svg"}const Fd=(e,t)=>e.depth-t.depth;class Od{constructor(){this.children=[],this.isDirty=!1}add(t){dn(this.children,t),this.isDirty=!0}remove(t){un(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Fd),this.isDirty=!1,this.children.forEach(t)}}function zd(e,t){const s=Fe.now(),i=({timestamp:r})=>{const o=r-s;o>=t&&(We(i),e(o-t))};return me.read(i,!0),()=>We(i)}const ga=["TopLeft","TopRight","BottomLeft","BottomRight"],$d=ga.length,xi=e=>typeof e=="string"?parseFloat(e):e,gi=e=>typeof e=="number"||J.test(e);function Bd(e,t,s,i,r,o){r?(e.opacity=ge(0,s.opacity!==void 0?s.opacity:1,Ud(i)),e.opacityExit=ge(t.opacity!==void 0?t.opacity:1,0,Hd(i))):o&&(e.opacity=ge(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,i));for(let a=0;a<$d;a++){const c=`border${ga[a]}Radius`;let l=yi(t,c),d=yi(s,c);if(l===void 0&&d===void 0)continue;l||(l=0),d||(d=0),l===0||d===0||gi(l)===gi(d)?(e[c]=Math.max(ge(xi(l),xi(d),i),0),(Le.test(d)||Le.test(l))&&(e[c]+="%")):e[c]=d}(t.rotate||s.rotate)&&(e.rotate=ge(t.rotate||0,s.rotate||0,i))}function yi(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Ud=ya(0,.5,Vr),Hd=ya(.5,.95,Ee);function ya(e,t,s){return i=>i<e?0:i>t?1:s(lt(e,t,i))}function vi(e,t){e.min=t.min,e.max=t.max}function Re(e,t){vi(e.x,t.x),vi(e.y,t.y)}function bi(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function wi(e,t,s,i,r){return e-=t,e=Gt(e,1/s,i),r!==void 0&&(e=Gt(e,1/r,i)),e}function Wd(e,t=0,s=1,i=.5,r,o=e,a=e){if(Le.test(t)&&(t=parseFloat(t),t=ge(a.min,a.max,t/100)-a.min),typeof t!="number")return;let c=ge(o.min,o.max,i);e===o&&(c-=t),e.min=wi(e.min,t,s,c,r),e.max=wi(e.max,t,s,c,r)}function ji(e,t,[s,i,r],o,a){Wd(e,t[s],t[i],t[r],t.scale,o,a)}const Kd=["x","scaleX","originX"],Yd=["y","scaleY","originY"];function Ni(e,t,s,i){ji(e.x,t,Kd,s?s.x:void 0,i?i.x:void 0),ji(e.y,t,Yd,s?s.y:void 0,i?i.y:void 0)}function Si(e){return e.translate===0&&e.scale===1}function va(e){return Si(e.x)&&Si(e.y)}function Ti(e,t){return e.min===t.min&&e.max===t.max}function Gd(e,t){return Ti(e.x,t.x)&&Ti(e.y,t.y)}function Ci(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function ba(e,t){return Ci(e.x,t.x)&&Ci(e.y,t.y)}function ki(e){return Me(e.x)/Me(e.y)}function Ai(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Xd{constructor(){this.members=[]}add(t){dn(this.members,t),t.scheduleRender()}remove(t){if(un(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(r=>t===r);if(s===0)return!1;let i;for(let r=s;r>=0;r--){const o=this.members[r];if(o.isPresent!==!1){i=o;break}}return i?(this.promote(i),!0):!1}promote(t,s){const i=this.lead;if(t!==i&&(this.prevLead=i,this.lead=t,t.show(),i)){i.instance&&i.scheduleRender(),t.scheduleRender(),t.resumeFrom=i,s&&(t.resumeFrom.preserveOpacity=!0),i.snapshot&&(t.snapshot=i.snapshot,t.snapshot.latestValues=i.animationValues||i.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:r}=t.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:i}=t;s.onExitComplete&&s.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function qd(e,t,s){let i="";const r=e.x.translate/t.x,o=e.y.translate/t.y,a=(s==null?void 0:s.z)||0;if((r||o||a)&&(i=`translate3d(${r}px, ${o}px, ${a}px) `),(t.x!==1||t.y!==1)&&(i+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:y,skewY:N}=s;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),h&&(i+=`rotateX(${h}deg) `),p&&(i+=`rotateY(${p}deg) `),y&&(i+=`skewX(${y}deg) `),N&&(i+=`skewY(${N}deg) `)}const c=e.x.scale*t.x,l=e.y.scale*t.y;return(c!==1||l!==1)&&(i+=`scale(${c}, ${l})`),i||"none"}const qe={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},xt=typeof window<"u"&&window.MotionDebug!==void 0,fs=["","X","Y","Z"],Jd={visibility:"hidden"},Pi=1e3;let Zd=0;function ms(e,t,s,i){const{latestValues:r}=t;r[e]&&(s[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function wa(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=Pr(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:r,layoutId:o}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",me,!(r||o))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&wa(i)}function ja({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(a={},c=t==null?void 0:t()){this.id=Zd++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,xt&&(qe.totalNodes=qe.resolvedTargetDeltas=qe.recalculatedProjection=0),this.nodes.forEach(tu),this.nodes.forEach(au),this.nodes.forEach(ou),this.nodes.forEach(su),xt&&window.MotionDebug.record(qe)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Od)}addEventListener(a,c){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new hn),this.eventHandlers.get(a).add(c)}notifyListeners(a,...c){const l=this.eventHandlers.get(a);l&&l.notify(...c)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,c=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Ld(a),this.instance=a;const{layoutId:l,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),c&&(d||l)&&(this.isLayoutDirty=!0),e){let h;const p=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=zd(p,250),$t.hasAnimatedSinceResize&&($t.hasAnimatedSinceResize=!1,this.nodes.forEach(Ei))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||d)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:p,hasRelativeTargetChanged:y,layout:N})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const j=this.options.transition||u.getDefaultTransition()||hu,{onLayoutAnimationStart:P,onLayoutAnimationComplete:T}=u.getProps(),A=!this.targetLayout||!ba(this.targetLayout,N)||y,R=!p&&y;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||R||p&&(A||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,R);const $={...an(j,"layout"),onPlay:P,onComplete:T};(u.shouldReduceMotion||this.options.layoutRoot)&&($.delay=0,$.type=!1),this.startAnimation($)}else p||Ei(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=N})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,We(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(lu),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&wa(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:c,layout:l}=this.options;if(c===void 0&&!l)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(_i);return}this.isUpdating||this.nodes.forEach(iu),this.isUpdating=!1,this.nodes.forEach(ru),this.nodes.forEach(Qd),this.nodes.forEach(eu),this.clearAllSnapshots();const c=Fe.now();Ne.delta=$e(0,1e3/60,c-Ne.timestamp),Ne.timestamp=c,Ne.isProcessing=!0,is.update.process(Ne),is.preRender.process(Ne),is.render.process(Ne),Ne.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Xs.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(nu),this.sharedNodes.forEach(cu)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,me.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){me.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ve(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(c=!1),c){const l=i(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!va(this.projectionDelta),l=this.getTransformTemplate(),d=l?l(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&(c||Xe(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const c=this.measurePageBox();let l=this.removeElementScroll(c);return a&&(l=this.removeTransform(l)),fu(l),{animationId:this.root.animationId,measuredBox:c,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:c}=this.options;if(!c)return ve();const l=c.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(mu))){const{scroll:u}=this.root;u&&(rt(l.x,u.offset.x),rt(l.y,u.offset.y))}return l}removeElementScroll(a){var c;const l=ve();if(Re(l,a),!((c=this.scroll)===null||c===void 0)&&c.wasRoot)return l;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:h,options:p}=u;u!==this.root&&h&&p.layoutScroll&&(h.wasRoot&&Re(l,a),rt(l.x,h.offset.x),rt(l.y,h.offset.y))}return l}applyTransform(a,c=!1){const l=ve();Re(l,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!c&&u.options.layoutScroll&&u.scroll&&u!==u.root&&at(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Xe(u.latestValues)&&at(l,u.latestValues)}return Xe(this.latestValues)&&at(l,this.latestValues),l}removeTransform(a){const c=ve();Re(c,a);for(let l=0;l<this.path.length;l++){const d=this.path[l];if(!d.instance||!Xe(d.latestValues))continue;Ms(d.latestValues)&&d.updateSnapshot();const u=ve(),h=d.measurePageBox();Re(u,h),Ni(c,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return Xe(this.latestValues)&&Ni(c,this.latestValues),c}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ne.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var c;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==l;if(!(a||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((c=this.parent)===null||c===void 0)&&c.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:p}=this.options;if(!(!this.layout||!(h||p))){if(this.resolvedRelativeTargetAt=Ne.timestamp,!this.targetDelta&&!this.relativeTarget){const y=this.getClosestProjectingParent();y&&y.layout&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ve(),this.relativeTargetOrigin=ve(),bt(this.relativeTargetOrigin,this.layout.layoutBox,y.layout.layoutBox),Re(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ve(),this.targetWithTransforms=ve()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),gd(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Re(this.target,this.layout.layoutBox),fa(this.target,this.targetDelta)):Re(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const y=this.getClosestProjectingParent();y&&!!y.resumingFrom==!!this.resumingFrom&&!y.options.layoutScroll&&y.target&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ve(),this.relativeTargetOrigin=ve(),bt(this.relativeTargetOrigin,this.target,y.target),Re(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}xt&&qe.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Ms(this.parent.latestValues)||ha(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const c=this.getLead(),l=!!this.resumingFrom||this!==c;let d=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(d=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Ne.timestamp&&(d=!1),d)return;const{layout:u,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||h))return;Re(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,y=this.treeScale.y;Cd(this.layoutCorrected,this.treeScale,this.path,l),c.layout&&!c.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(c.target=c.layout.layoutBox,c.targetWithTransforms=ve());const{target:N}=c;if(!N){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(bi(this.prevProjectionDelta.x,this.projectionDelta.x),bi(this.prevProjectionDelta.y,this.projectionDelta.y)),vt(this.projectionDelta,this.layoutCorrected,N,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==y||!Ai(this.projectionDelta.x,this.prevProjectionDelta.x)||!Ai(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",N)),xt&&qe.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var c;if((c=this.options.visualElement)===null||c===void 0||c.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=it(),this.projectionDelta=it(),this.projectionDeltaWithTransform=it()}setAnimationOrigin(a,c=!1){const l=this.snapshot,d=l?l.latestValues:{},u={...this.latestValues},h=it();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const p=ve(),y=l?l.source:void 0,N=this.layout?this.layout.source:void 0,j=y!==N,P=this.getStack(),T=!P||P.members.length<=1,A=!!(j&&!T&&this.options.crossfade===!0&&!this.path.some(uu));this.animationProgress=0;let R;this.mixTargetDelta=$=>{const S=$/1e3;Mi(h.x,a.x,S),Mi(h.y,a.y,S),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(bt(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),du(this.relativeTarget,this.relativeTargetOrigin,p,S),R&&Gd(this.relativeTarget,R)&&(this.isProjectionDirty=!1),R||(R=ve()),Re(R,this.relativeTarget)),j&&(this.animationValues=u,Bd(u,d,this.latestValues,S,A,T)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=S},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(We(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=me.update(()=>{$t.hasAnimatedSinceResize=!0,this.currentAnimation=Vd(0,Pi,{...a,onUpdate:c=>{this.mixTargetDelta(c),a.onUpdate&&a.onUpdate(c)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Pi),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:c,target:l,layout:d,latestValues:u}=a;if(!(!c||!l||!d)){if(this!==a&&this.layout&&d&&Na(this.options.animationType,this.layout.layoutBox,d.layoutBox)){l=this.target||ve();const h=Me(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const p=Me(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+p}Re(c,l),at(c,u),vt(this.projectionDeltaWithTransform,this.layoutCorrected,c,u)}}registerSharedNode(a,c){this.sharedNodes.has(a)||this.sharedNodes.set(a,new Xd),this.sharedNodes.get(a).add(c);const d=c.options.initialPromotionConfig;c.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(c):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:c}=this.options;return c?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:c}=this.options;return c?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:c,preserveFollowOpacity:l}={}){const d=this.getStack();d&&d.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let c=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(c=!0),!c)return;const d={};l.z&&ms("z",a,d,this.animationValues);for(let u=0;u<fs.length;u++)ms(`rotate${fs[u]}`,a,d,this.animationValues),ms(`skew${fs[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}getProjectionStyles(a){var c,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Jd;const d={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=Ot(a==null?void 0:a.pointerEvents)||"",d.transform=u?u(this.latestValues,""):"none",d;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const j={};return this.options.layoutId&&(j.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,j.pointerEvents=Ot(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!Xe(this.latestValues)&&(j.transform=u?u({},""):"none",this.hasProjected=!1),j}const p=h.animationValues||h.latestValues;this.applyTransformsToTarget(),d.transform=qd(this.projectionDeltaWithTransform,this.treeScale,p),u&&(d.transform=u(p,d.transform));const{x:y,y:N}=this.projectionDelta;d.transformOrigin=`${y.origin*100}% ${N.origin*100}% 0`,h.animationValues?d.opacity=h===this?(l=(c=p.opacity)!==null&&c!==void 0?c:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:d.opacity=h===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const j in Ut){if(p[j]===void 0)continue;const{correct:P,applyTo:T}=Ut[j],A=d.transform==="none"?p[j]:P(p[j],h);if(T){const R=T.length;for(let $=0;$<R;$++)d[T[$]]=A}else d[j]=A}return this.options.layoutId&&(d.pointerEvents=h===this?Ot(a==null?void 0:a.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var c;return(c=a.currentAnimation)===null||c===void 0?void 0:c.stop()}),this.root.nodes.forEach(_i),this.root.sharedNodes.clear()}}}function Qd(e){e.updateLayout()}function eu(e){var t;const s=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=e.layout,{animationType:o}=e.options,a=s.source!==e.layout.source;o==="size"?De(h=>{const p=a?s.measuredBox[h]:s.layoutBox[h],y=Me(p);p.min=i[h].min,p.max=p.min+y}):Na(o,s.layoutBox,i)&&De(h=>{const p=a?s.measuredBox[h]:s.layoutBox[h],y=Me(i[h]);p.max=p.min+y,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+y)});const c=it();vt(c,i,s.layoutBox);const l=it();a?vt(l,e.applyTransform(r,!0),s.measuredBox):vt(l,i,s.layoutBox);const d=!va(c);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:p,layout:y}=h;if(p&&y){const N=ve();bt(N,s.layoutBox,p.layoutBox);const j=ve();bt(j,i,y.layoutBox),ba(N,j)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=j,e.relativeTargetOrigin=N,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:i,snapshot:s,delta:l,layoutDelta:c,hasLayoutChanged:d,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:i}=e.options;i&&i()}e.options.transition=void 0}function tu(e){xt&&qe.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function su(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function nu(e){e.clearSnapshot()}function _i(e){e.clearMeasurements()}function iu(e){e.isLayoutDirty=!1}function ru(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Ei(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function au(e){e.resolveTargetDelta()}function ou(e){e.calcProjection()}function lu(e){e.resetSkewAndRotation()}function cu(e){e.removeLeadSnapshot()}function Mi(e,t,s){e.translate=ge(t.translate,0,s),e.scale=ge(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function Ri(e,t,s,i){e.min=ge(t.min,s.min,i),e.max=ge(t.max,s.max,i)}function du(e,t,s,i){Ri(e.x,t.x,s.x,i),Ri(e.y,t.y,s.y,i)}function uu(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const hu={duration:.45,ease:[.4,0,.1,1]},Di=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Ii=Di("applewebkit/")&&!Di("chrome/")?Math.round:Ee;function Vi(e){e.min=Ii(e.min),e.max=Ii(e.max)}function fu(e){Vi(e.x),Vi(e.y)}function Na(e,t,s){return e==="position"||e==="preserve-aspect"&&!xd(ki(t),ki(s),.2)}function mu(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const pu=ja({attachResizeListener:(e,t)=>kt(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ps={current:void 0},Sa=ja({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!ps.current){const e=new pu({});e.mount(window),e.setOptions({layoutScroll:!0}),ps.current=e}return ps.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),xu={pan:{Feature:Md},drag:{Feature:Ed,ProjectionNode:Sa,MeasureLayout:xa}};function Li(e,t,s){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover",s==="Start");const r="onHover"+s,o=i[r];o&&me.postRender(()=>o(t,Rt(t)))}class gu extends Ye{mount(){const{current:t}=this.node;t&&(this.unmount=xl(t,s=>(Li(this.node,s,"Start"),i=>Li(this.node,i,"End"))))}unmount(){}}class yu extends Ye{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Mt(kt(this.node.current,"focus",()=>this.onFocus()),kt(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Fi(e,t,s){const{props:i}=e;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap",s==="Start");const r="onTap"+(s==="End"?"":s),o=i[r];o&&me.postRender(()=>o(t,Rt(t)))}class vu extends Ye{mount(){const{current:t}=this.node;t&&(this.unmount=bl(t,s=>(Fi(this.node,s,"Start"),(i,{success:r})=>Fi(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ds=new WeakMap,xs=new WeakMap,bu=e=>{const t=Ds.get(e.target);t&&t(e)},wu=e=>{e.forEach(bu)};function ju({root:e,...t}){const s=e||document;xs.has(s)||xs.set(s,{});const i=xs.get(s),r=JSON.stringify(t);return i[r]||(i[r]=new IntersectionObserver(wu,{root:e,...t})),i[r]}function Nu(e,t,s){const i=ju(t);return Ds.set(e,s),i.observe(e),()=>{Ds.delete(e),i.unobserve(e)}}const Su={some:0,all:1};class Tu extends Ye{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:i,amount:r="some",once:o}=t,a={root:s?s.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:Su[r]},c=l=>{const{isIntersecting:d}=l;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(l)};return Nu(this.node.current,a,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(Cu(t,s))&&this.startObserver()}unmount(){}}function Cu({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}const ku={inView:{Feature:Tu},tap:{Feature:vu},focus:{Feature:yu},hover:{Feature:gu}},Au={layout:{ProjectionNode:Sa,MeasureLayout:xa}},Is={current:null},Ta={current:!1};function Pu(){if(Ta.current=!0,!!Hs)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Is.current=e.matches;e.addListener(t),t()}else Is.current=!1}const _u=[...qr,Se,Ke],Eu=e=>_u.find(Xr(e)),Oi=new WeakMap;function Mu(e,t,s){for(const i in t){const r=t[i],o=s[i];if(Te(r))e.addValue(i,r);else if(Te(o))e.addValue(i,Tt(r,{owner:e}));else if(o!==r)if(e.hasValue(i)){const a=e.getValue(i);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=e.getStaticValue(i);e.addValue(i,Tt(a!==void 0?a:r,{owner:e}))}}for(const i in s)t[i]===void 0&&e.removeValue(i);return t}const zi=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Ru{scrapeMotionValuesFromProps(t,s,i){return{}}constructor({parent:t,props:s,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:o,visualState:a},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=yn,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const y=Fe.now();this.renderScheduledAt<y&&(this.renderScheduledAt=y,me.render(this.render,!1,!0))};const{latestValues:l,renderState:d,onUpdate:u}=a;this.onUpdate=u,this.latestValues=l,this.baseTarget={...l},this.initialValues=s.initial?{...l}:{},this.renderState=d,this.parent=t,this.props=s,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=c,this.blockInitialAnimation=!!o,this.isControllingVariants=Qt(s),this.isVariantNode=ir(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:h,...p}=this.scrapeMotionValuesFromProps(s,{},this);for(const y in p){const N=p[y];l[y]!==void 0&&Te(N)&&N.set(l[y],!1)}}mount(t){this.current=t,Oi.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,i)=>this.bindToMotionValue(i,s)),Ta.current||Pu(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Is.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Oi.delete(this.current),this.projection&&this.projection.unmount(),We(this.notifyUpdate),We(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const i=tt.has(t),r=s.on("change",c=>{this.latestValues[t]=c,this.props.onUpdate&&me.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),o=s.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{r(),o(),a&&a(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in ct){const s=ct[t];if(!s)continue;const{isEnabled:i,Feature:r}=s;if(!this.features[t]&&r&&i(this.props)&&(this.features[t]=new r(this)),this.features[t]){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ve()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let i=0;i<zi.length;i++){const r=zi[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const o="on"+r,a=t[o];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=Mu(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const i=this.values.get(t);s!==i&&(i&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let i=this.values.get(t);return i===void 0&&s!==void 0&&(i=Tt(s===null?void 0:s,{owner:this}),this.addValue(t,i)),i}readValue(t,s){var i;let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(i=this.getBaseTargetFromProps(this.props,t))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(Yr(r)||Fr(r))?r=parseFloat(r):!Eu(r)&&Ke.test(s)&&(r=Hr(t,s)),this.setBaseTarget(t,Te(r)?r.get():r)),Te(r)?r.get():r}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const a=Js(this.props,i,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);a&&(r=a[t])}if(i&&r!==void 0)return r;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!Te(o)?o:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new hn),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class Ca extends Ru{constructor(){super(...arguments),this.KeyframeResolver=Jr}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:i}){delete s[t],delete i[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Te(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function Du(e){return window.getComputedStyle(e)}class Iu extends Ca{constructor(){super(...arguments),this.type="html",this.renderInstance=fr}readValueFromInstance(t,s){if(tt.has(s)){const i=gn(s);return i&&i.default||0}else{const i=Du(t),r=(dr(s)?i.getPropertyValue(s):i[s])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(t,{transformPagePoint:s}){return ma(t,s)}build(t,s,i){en(t,s,i.transformTemplate)}scrapeMotionValuesFromProps(t,s,i){return rn(t,s,i)}}class Vu extends Ca{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ve}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(tt.has(s)){const i=gn(s);return i&&i.default||0}return s=mr.has(s)?s:Gs(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,i){return gr(t,s,i)}build(t,s,i){tn(t,s,this.isSVGTag,i.transformTemplate)}renderInstance(t,s,i,r){pr(t,s,i,r)}mount(t){this.isSVGTag=nn(t.tagName),super.mount(t)}}const Lu=(e,t)=>qs(e)?new Vu(t):new Iu(t,{allowProjection:e!==f.Fragment}),Fu=cl({...od,...ku,...xu,...Au},Lu),Ie=So(Fu),Ou=({title:e,onFilterClick:t,showAdd:s=!0,variant:i="default"})=>{const r=i==="overlay";return n.jsxs("div",{className:r?"fixed top-0 left-0 right-0 z-30 px-6 py-4 bg-gradient-to-b from-pink-200/60 via-purple-200/40 to-transparent backdrop-blur-sm flex justify-between items-center pointer-events-none":"sticky top-0 z-20 px-6 py-4 bg-primary-50/80 backdrop-blur-md flex justify-between items-center transition-all",children:[n.jsx("div",{className:r?"text-2xl font-bold text-slate-800 tracking-tight flex items-center opacity-0":"text-2xl font-bold text-slate-800 tracking-tight flex items-center",children:e}),n.jsx("div",{className:r?"flex gap-4 opacity-0":"flex gap-4",children:s&&n.jsx("button",{onClick:t,className:"p-2 rounded-full bg-white text-primary-500 shadow-sm hover:shadow-md transition-all active:scale-95","aria-label":"",children:n.jsx(He,{size:20})})})]})};var Ue=(e=>(e.ONLINE="",e.OFFLINE="",e.BUSY="",e))(Ue||{}),Ze=(e=>(e.TEXT="text",e.SYSTEM="system",e))(Ze||{}),xe=(e=>(e.HOME="home",e.CHAT="chat",e.ME="me",e))(xe||{});const zu=({activeTab:e,onTabChange:t})=>{const s=i=>`flex flex-col items-center justify-center w-full h-full transition-all duration-300 ${e===i?"text-primary-600 scale-105":"text-slate-400 hover:text-primary-400"}`;return n.jsx("div",{className:"fixed bottom-0 inset-x-0 z-30",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-20 bg-white/90 backdrop-blur-lg border-t border-primary-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] flex justify-around items-center px-4 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[n.jsxs("button",{className:s(xe.HOME),onClick:()=>t(xe.HOME),children:[n.jsx(Ja,{size:24,strokeWidth:e===xe.HOME?2.5:2}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]}),n.jsxs("button",{className:s(xe.CHAT),onClick:()=>t(xe.CHAT),children:[n.jsxs("div",{className:"relative",children:[n.jsx(zs,{size:24,strokeWidth:e===xe.CHAT?2.5:2}),n.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-400 rounded-full border-2 border-white"})]}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]}),n.jsxs("button",{className:s(xe.ME),onClick:()=>t(xe.ME),children:[n.jsx(Ls,{size:24,strokeWidth:e===xe.ME?2.5:2}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]})]})})},$i=({chat:e,onClick:t,onTogglePin:s,roundedClass:i})=>{var l;const r=d=>d.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1}),[o,a]=f.useState(!1),c=d=>{d.stopPropagation(),s()};return n.jsxs("div",{onClick:t,className:`group relative flex items-center gap-4 p-4 bg-white ${i||"rounded-2xl"} shadow-sm border border-transparent hover:border-primary-100 hover:shadow-md active:scale-[0.98] transition-all duration-200 cursor-pointer`,children:[n.jsx("div",{className:"relative flex-shrink-0",children:n.jsx("div",{className:"w-14 h-14 rounded-full p-0.5 bg-gradient-to-tr from-primary-300 to-accent-pink",children:!o&&e.character.avatar?n.jsx("img",{src:e.character.avatar,alt:e.character.name,onError:()=>a(!0),className:"w-full h-full rounded-full object-cover border-2 border-white"}):n.jsx("div",{className:"w-full h-full rounded-full border-2 border-white bg-white flex items-center justify-center text-slate-500 font-bold",children:((l=e.character.name)==null?void 0:l[0])||"?"})})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("h3",{className:"font-bold text-slate-800 text-lg truncate",children:e.character.name})}),n.jsx("span",{className:"text-xs text-slate-400 font-medium whitespace-nowrap ml-2",children:r(e.lastMessage.timestamp)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("p",{className:"text-slate-500 text-sm truncate pr-4 leading-relaxed",children:[e.lastMessage.senderId==="user"&&n.jsx("span",{className:"text-slate-400",children:": "}),e.lastMessage.text]}),n.jsxs("div",{className:"flex gap-2 items-center flex-shrink-0",children:[n.jsx("button",{onClick:c,className:`w-6 h-6 flex items-center justify-center rounded-full transition-all ${e.character.isPinned?"bg-primary-50 text-primary-400":"text-slate-200 hover:text-primary-300"}`,children:n.jsx(ho,{size:14,className:`transform rotate-45 ${e.character.isPinned?"fill-primary-400":""}`})}),e.unreadCount>0&&n.jsx("span",{className:"flex items-center justify-center min-w-[20px] h-5 px-1.5 bg-red-400 text-white text-[10px] font-bold rounded-full",children:e.unreadCount})]})]})]})]})},$u=({chats:e,onChatClick:t,onTogglePin:s,onDeleteChat:i,isDetailOpen:r=!1})=>{const o=(navigator==null?void 0:navigator.maxTouchPoints)>0,a=e.filter(C=>C.character.isPinned),c=e.filter(C=>!C.character.isPinned),[l,d]=f.useState({}),[u,h]=f.useState(null),p=f.useRef(0),y=f.useRef(0),N=f.useRef(null),[j,P]=f.useState({visible:!1,x:0,y:0,id:null}),T=(C,L)=>{p.current=C.touches[0].clientX,y.current=C.touches[0].clientY,N.current=L},A=(C,L)=>{if(N.current!==L)return;const M=C.touches[0].clientX-p.current,B=C.touches[0].clientY-y.current;if(Math.abs(B)>Math.abs(M))return;const z=Math.max(-96,Math.min(0,M));d(W=>({...W,[L]:z}))},R=C=>{if(N.current!==C)return;const M=(l[C]||0)<-60?-96:0;d(B=>({...B,[C]:M})),N.current=null},$=C=>d(L=>({...L,[C]:0})),S=(C,L)=>{if(C.preventDefault(),o)return;let M=C.clientX;const B=120;M+B>window.innerWidth&&(M=window.innerWidth-B-10),P({visible:!0,x:M,y:C.clientY,id:L})};return n.jsxs(Ie.div,{className:"px-6 pb-24 animate-in fade-in slide-in-from-bottom-4 duration-700",initial:{x:0},animate:r&&o?{x:"-100%"}:{x:0},transition:r&&o?{duration:.3,ease:"linear"}:{duration:0},children:[a.length>0&&n.jsxs("div",{className:"mb-6",children:[n.jsx("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 px-1",children:""}),a.map(C=>n.jsxs("div",{className:"relative overflow-hidden mb-3 rounded-2xl",children:[(()=>{const L=Math.min(96,Math.max(0,-(l[C.characterId]||0)));return n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${L}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>h(C.characterId),className:"text-white font-bold drop-shadow-sm",children:""})})})(),n.jsx("div",{onTouchStart:L=>T(L,C.characterId),onTouchMove:L=>A(L,C.characterId),onTouchEnd:()=>R(C.characterId),onContextMenu:L=>S(L,C.characterId),style:{transform:`translateX(${l[C.characterId]||0}px)`,transition:"transform 180ms ease"},children:n.jsx($i,{chat:C,onClick:()=>t(C),onTogglePin:()=>s(C.characterId),roundedClass:(l[C.characterId]||0)<0?"rounded-l-2xl rounded-r-none":"rounded-2xl"})})]},C.characterId))]}),c.length>0&&n.jsxs("div",{children:[n.jsx("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 px-1",children:""}),c.map(C=>n.jsxs("div",{className:"relative overflow-hidden mb-3 rounded-2xl",children:[(()=>{const L=Math.min(96,Math.max(0,-(l[C.characterId]||0)));return n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${L}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>h(C.characterId),className:"text-white font-bold drop-shadow-sm",children:""})})})(),n.jsx("div",{onTouchStart:L=>T(L,C.characterId),onTouchMove:L=>A(L,C.characterId),onTouchEnd:()=>R(C.characterId),onContextMenu:L=>S(L,C.characterId),style:{transform:`translateX(${l[C.characterId]||0}px)`,transition:"transform 180ms ease"},children:n.jsx($i,{chat:C,onClick:()=>t(C),onTogglePin:()=>s(C.characterId),roundedClass:(l[C.characterId]||0)<0?"rounded-l-2xl rounded-r-none":"rounded-2xl"})})]},C.characterId))]}),u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{$(u),h(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{const C=u;h(null),i(C)},children:""})]})]})}),n.jsx("style",{children:`
        @keyframes fadeCard { from { opacity: 0; transform: translateY(-6px) } to { opacity: 1; transform: translateY(0) } }
        @keyframes fadeBg { from { opacity: 0 } to { opacity: 1 } }
      `})]}),e.length===0&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[n.jsx("p",{className:"text-slate-500 font-medium",children:""}),n.jsx("p",{className:"text-slate-400 text-sm mt-1",children:""})]}),j.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>P(C=>({...C,visible:!1})),onContextMenu:C=>{C.preventDefault(),P(L=>({...L,visible:!1}))}}),n.jsx("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95 duration-100",style:{top:j.y,left:j.x},children:n.jsx("button",{onClick:()=>{j.id&&h(j.id),P(C=>({...C,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 transition-colors",children:""})})]})]})},Bu={type:"tween",ease:"easeInOut",duration:.28},jn={type:"tween",ease:"linear",duration:.28},ss={duration:.18},Uu="/api",Hu={async login(e,t){const s=await fetch(`${Uu}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!s.ok)throw new Error("login_failed");return s.json()}},Nn=e=>e==="male"?"":e==="female"?"":"",Wu=async e=>{const t={name:(e==null?void 0:e.name)||"",age:parseInt((e==null?void 0:e.age)||"0")||null,gender:Nn(e==null?void 0:e.gender),profession:(e==null?void 0:e.profession)||null,basic_info:(e==null?void 0:e.basicInfo)||null,personality:(e==null?void 0:e.personality)||null,avatar:(e==null?void 0:e.avatar)||null},{authFetch:s}=await ue(async()=>{const{authFetch:o}=await import("./http-bwpcOK62.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),i=await s("/user/chat-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error("create_role_failed");return(await i.json()).id},Ku=async(e,t)=>{const s={name:(t==null?void 0:t.name)||"",age:parseInt((t==null?void 0:t.age)||"0")||null,gender:Nn(t==null?void 0:t.gender),profession:(t==null?void 0:t.profession)||null,basic_info:(t==null?void 0:t.basicInfo)||null,personality:(t==null?void 0:t.personality)||null,avatar:(t==null?void 0:t.avatar)||null},{authFetch:i}=await ue(async()=>{const{authFetch:o}=await import("./http-bwpcOK62.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3]));if(!(await i(`/user/chat-role/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("update_role_failed");return!0},Yu=async()=>{const{authFetch:e}=await ue(async()=>{const{authFetch:i}=await import("./http-bwpcOK62.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),t=await e("/user/chat-role",{method:"GET"});if(!t.ok)throw new Error("fetch_roles_failed");const s=await t.json();return Array.isArray(s)?s:[]},Vs=async(e,t)=>{const s={character_id:Number(e)};typeof t=="number"&&(s.user_chat_role_id=t);const{authFetch:i}=await ue(async()=>{const{authFetch:a}=await import("./http-bwpcOK62.js");return{authFetch:a}},__vite__mapDeps([0,1,2,3])),r=await i("/chat/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("create_session_failed");const o=await r.json();return typeof o=="string"?{sessionId:o}:{sessionId:o.sessionId,model:o.model,temperature:o.temperature}},gs=(e,t)=>{const r=`${`${location.protocol==="https:"?"wss":"ws"}://${location.host}`}/ws/chat`;console.log("[ws] connecting",r);let o=null,a=!1,c=1e3;const l=1e4,d=[],u=()=>{o=new WebSocket(r),o.onmessage=N=>{try{const j=JSON.parse(String(N.data));j&&j.type==="assistant_message"&&typeof j.content=="string"&&t(j.content,j.quote,{chunkIndex:j.chunkIndex,chunkTotal:j.chunkTotal})}catch{}},o.onerror=N=>{console.error("[ws] error",N)},o.onopen=()=>{for(console.log("[ws] open"),c=1e3;d.length;){const j=d.shift();try{o==null||o.send(JSON.stringify(j))}catch{}}const N={type:"typing",sessionId:e,typing:!1};try{o==null||o.send(JSON.stringify(N))}catch{}},o.onclose=()=>{console.log("[ws] closed"),a||(setTimeout(u,c),c=Math.min(c*2,l))}};return u(),{ws:o,sendText:(N,j,P,T,A)=>{const R={sessionId:e,text:N,chatMode:j};P&&(R.userRole={name:P.name,gender:Nn(P.gender),age:P.age||"",profession:P.profession||"",basic_info:P.basicInfo||"",personality:P.personality||"",avatar:P.avatar||""}),T&&(R.model_id=T),typeof A=="number"&&(R.temperature=A),o&&o.readyState===WebSocket.OPEN?o.send(JSON.stringify(R)):d.push(R)},sendTyping:N=>{const j={type:"typing",sessionId:e,typing:N};o&&o.readyState===WebSocket.OPEN?o.send(JSON.stringify(j)):d.push(j)},close:()=>{a=!0;try{o==null||o.close()}catch{}}}},Gu=async()=>{const{authFetch:e}=await ue(async()=>{const{authFetch:i}=await import("./http-bwpcOK62.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),t=await e("/chat/models",{method:"GET"});if(!t.ok)throw new Error("list_models_failed");const s=await t.json();return Array.isArray(s.items)?s.items:[]},Xu=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:o}=await import("./http-bwpcOK62.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),s=await t(`/chat/sessions/${e}`,{method:"GET"});if(!s.ok)throw new Error("get_session_failed");const i=await s.json(),r=(i==null?void 0:i.session)||{};return{model:r==null?void 0:r.model,temperature:r==null?void 0:r.temperature}},ns=({imageSrc:e,onCrop:t,onCancel:s,aspectRatio:i,outputWidth:r,outputHeight:o})=>{const[a,c]=f.useState(1),[l,d]=f.useState({x:0,y:0}),[u,h]=f.useState(!1),[p,y]=f.useState({x:0,y:0}),N=f.useRef(new Map),j=f.useRef(null),[P,T]=f.useState(!1),A=f.useRef(null),R=f.useRef(null),$=f.useRef(null),S=f.useRef(null),C=i&&i>0?i:1,[L,M]=f.useState(Math.round(300*C)),[B,z]=f.useState(300);f.useEffect(()=>{const V=()=>{const U=R.current?R.current.clientWidth:window.innerWidth,K=R.current?R.current.clientHeight:window.innerHeight;let ne=Math.min(Math.floor(U*.9),700),Z=Math.round(ne/C);const w=Math.max(180,Math.min(K-160,380));Z>w&&(Z=w,ne=Math.round(Z*C)),M(ne),z(Z)};return V(),window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[C]);const W=(V,U,K)=>Math.min(K,Math.max(U,V)),G=(V,U,K)=>{const ne=a,Z=W(K,.5,3),w=(V-l.x)/ne,_=(U-l.y)/ne;c(Z),d({x:V-Z*w,y:U-Z*_})},ee=V=>{const U=V.nativeEvent;if(U&&U.cancelable&&V.preventDefault(),N.current.set(V.pointerId,{x:V.clientX,y:V.clientY}),V.currentTarget.setPointerCapture(V.pointerId),N.current.size===1)h(!0),y({x:V.clientX-l.x,y:V.clientY-l.y});else if(N.current.size===2){T(!0);const K=Array.from(N.current.values()),ne=K[0].x-K[1].x,Z=K[0].y-K[1].y,w=Math.hypot(ne,Z);j.current={distance:w,zoom:a}}},ce=V=>{var K,ne,Z,w;const U=V.nativeEvent;if(U&&U.cancelable&&V.preventDefault(),!!N.current.has(V.pointerId)){if(N.current.set(V.pointerId,{x:V.clientX,y:V.clientY}),N.current.size===2&&j.current){const _=Array.from(N.current.values()),D=_[0].x-_[1].x,Y=_[0].y-_[1].y,fe=Math.hypot(D,Y)/j.current.distance,oe=j.current.zoom*fe,se=((ne=(K=S.current)==null?void 0:K.getBoundingClientRect)==null?void 0:ne.call(K))||((w=(Z=R.current)==null?void 0:Z.getBoundingClientRect)==null?void 0:w.call(Z))||{left:0,top:0,width:0,height:0},we=se.left+se.width/2,k=se.top+se.height/2;G(we,k,oe);return}u&&d({x:V.clientX-p.x,y:V.clientY-p.y})}},re=V=>{N.current.delete(V.pointerId);try{V.currentTarget.releasePointerCapture(V.pointerId)}catch{}N.current.size<2&&(j.current=null,T(!1)),N.current.size===0&&h(!1)},de=()=>{const V=$.current,U=A.current;if(!V||!U)return;const K=V.getContext("2d");if(!K)return;const ne=r&&r>0?r:400,Z=o&&o>0?o:Math.round(ne/C);V.width=ne,V.height=Z;const w=U.naturalWidth,_=U.naturalHeight,D=Math.min(L/w,B/_),Y=Z/B;K.fillStyle="#000",K.fillRect(0,0,ne,Z),K.translate(ne/2,Z/2),K.translate(l.x*Y,l.y*Y),K.scale(a*Y,a*Y),K.scale(D,D),K.drawImage(U,-w/2,-_/2),t(V.toDataURL("image/jpeg",.9))};return n.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center animate-in fade-in duration-300",children:[n.jsxs("div",{className:"absolute top-0 w-full p-4 flex justify-between items-center z-20 text-white",children:[n.jsx("button",{onClick:s,className:"p-2 bg-white/10 rounded-full backdrop-blur-md",children:n.jsx(Qe,{size:24})}),n.jsx("h3",{className:"font-bold text-lg tracking-wider",children:""}),n.jsx("button",{onClick:de,className:"p-2 bg-purple-500 rounded-full text-white shadow-lg shadow-purple-500/30",children:n.jsx(qi,{size:24})})]}),n.jsxs("div",{ref:R,className:"relative w-full h-full overflow-hidden bg-black flex items-center justify-center touch-none select-none",onPointerDown:ee,onPointerMove:ce,onPointerUp:re,onPointerCancel:re,onPointerLeave:re,children:[n.jsx("img",{ref:A,src:e,alt:"Crop target",className:`absolute max-w-none pointer-events-none ${u||P?"will-change-transform":"transition-transform duration-75 ease-linear"}`,style:{transform:`translate(${l.x}px, ${l.y}px) scale(${a})`,height:B,width:"auto"},draggable:!1}),n.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 flex items-center justify-center",children:n.jsx("div",{ref:S,className:"absolute border-2 border-white box-content shadow-[0_0_0_9999px_rgba(0,0,0,0.8)]",style:{width:L,height:B},children:n.jsxs("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 opacity-30",children:[n.jsx("div",{className:"border-r border-white"}),n.jsx("div",{className:"border-r border-white"}),n.jsx("div",{className:"border-b border-white col-span-3 row-start-1"}),n.jsx("div",{className:"border-b border-white col-span-3 row-start-2"})]})})})]}),n.jsx("div",{className:"absolute bottom-0 w-full bg-slate-900/80 backdrop-blur-md p-6 pb-10 flex flex-col gap-4 z-20",children:n.jsxs("div",{className:"flex items-center gap-4 text-white justify-center",children:[n.jsx(ao,{size:20,className:"text-slate-400"}),n.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.05",value:a,onChange:V=>{var w,_,D,Y;const U=parseFloat(V.target.value),K=((_=(w=S.current)==null?void 0:w.getBoundingClientRect)==null?void 0:_.call(w))||((Y=(D=R.current)==null?void 0:D.getBoundingClientRect)==null?void 0:Y.call(D))||{left:0,top:0,width:0,height:0},ne=K.left+K.width/2,Z=K.top+K.height/2;G(ne,Z,U)},className:"w-64 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-purple-500"}),n.jsx(He,{size:20,className:"text-slate-400"})]})}),n.jsx("canvas",{ref:$,className:"hidden"})]})},ka=({currentPersona:e,roleId:t,onBack:s,onSave:i,withinContainer:r=!1})=>{const[o,a]=f.useState((e==null?void 0:e.gender)||"female"),[c,l]=f.useState((e==null?void 0:e.name)||""),[d,u]=f.useState((e==null?void 0:e.age)||""),[h,p]=f.useState((e==null?void 0:e.profession)||""),[y,N]=f.useState((e==null?void 0:e.basicInfo)||""),[j,P]=f.useState((e==null?void 0:e.personality)||""),[T,A]=f.useState(e==null?void 0:e.avatar),[R,$]=f.useState(null),[S,C]=f.useState(!1),L=f.useRef(null),M=G=>{var U;const ee=G.split(","),ce=((U=ee[0].match(/:(.*?);/))==null?void 0:U[1])||"image/jpeg",re=atob(ee[1]);let de=re.length;const V=new Uint8Array(de);for(;de--;)V[de]=re.charCodeAt(de);return new Blob([V],{type:ce})},B=async()=>{if(S)return;C(!0);const G=localStorage.getItem("user_access_token");let ee=T;try{if(T&&T.startsWith("data:image")){const re=M(T),de=new FormData,V=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;de.append("avatar",re,"avatar.jpg"),de.append("filename",V),ee=`/uploads/users/avatars/${V}`,fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:G?`Bearer ${G}`:""},body:de}).catch(()=>{})}const ce={gender:o,name:c,age:d,profession:h,basicInfo:y,personality:j,avatar:ee||void 0};typeof t=="number"?await Ku(t,ce):await Wu(ce)}catch{}i({gender:o,name:c,age:d,profession:h,basicInfo:y,personality:j,avatar:ee}),C(!1),s()},z=()=>{var G;(G=L.current)==null||G.click()},W=G=>{var ce;const ee=(ce=G.target.files)==null?void 0:ce[0];if(ee){const re=new FileReader;re.onloadend=()=>{$(re.result)},re.readAsDataURL(ee)}L.current&&(L.current.value="")};return n.jsxs("div",{className:`${r?"absolute":"fixed"} inset-0 z-[80]`,children:[n.jsx(Ie.div,{className:"absolute inset-0 bg-[#F8F9FA]",initial:{opacity:0},animate:{opacity:1},transition:ss}),n.jsxs(Ie.div,{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)] flex flex-col h-[92vh] w-full overflow-y-auto no-scrollbar",initial:{y:"100%"},animate:{y:0},transition:jn,children:[R&&n.jsx(ns,{imageSrc:R,onCancel:()=>$(null),onCrop:G=>{A(G),$(null)}}),n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm border-b border-slate-100 rounded-none md:rounded-t-3xl",children:[n.jsx("button",{onClick:s,className:"p-2 -ml-2 text-slate-800 hover:bg-slate-50 rounded-full transition-colors",children:n.jsx(Pt,{size:24})}),n.jsx("button",{onClick:B,disabled:S,className:`px-4 py-1.5 rounded-lg text-sm font-bold transition-transform ${S?"bg-purple-200 text-white cursor-not-allowed":"bg-purple-50 text-purple-600 active:scale-95"}`,children:""})]}),n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white p-4 space-y-3 pb-10 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[n.jsx("div",{className:"flex justify-center py-6",children:n.jsxs("div",{onClick:z,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-24 h-24 rounded-full bg-pink-200 flex items-center justify-center text-white shadow-sm border-4 border-white overflow-hidden",children:T?n.jsx("img",{src:T,alt:"User Avatar",className:"w-full h-full object-cover"}):n.jsx(Ls,{size:48,fill:"currentColor"})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-white p-2 rounded-full shadow-md border border-slate-100",children:n.jsx(Ma,{size:14,className:"text-slate-400"})}),n.jsx("input",{type:"file",ref:L,className:"hidden",accept:"image/*",onChange:W})]})}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-4",children:""}),n.jsxs("div",{className:"flex gap-6",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${o==="male"?"border-blue-500":"border-slate-300"}`,children:o==="male"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"male",checked:o==="male",onChange:()=>a("male"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${o==="female"?"border-blue-500":"border-slate-300"}`,children:o==="female"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"female",checked:o==="female",onChange:()=>a("female"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${o==="secret"?"border-blue-500":"border-slate-300"}`,children:o==="secret"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"secret",checked:o==="secret",onChange:()=>a("secret"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]})]})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:" ()"}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:c,onChange:G=>l(G.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:d,onChange:G=>u(G.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:h,onChange:G=>p(G.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("textarea",{placeholder:"...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:y,onChange:G=>N(G.target.value)})]}),n.jsxs("div",{className:"bg rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("textarea",{placeholder:"...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:j,onChange:G=>P(G.target.value)})]})]})]})]})},qu=e=>e===""?"male":e===""?"female":"secret",Ju=({isOpen:e,currentPersona:t,onClose:s,onAdd:i,onSelect:r})=>{const[o,a]=f.useState([]),[c,l]=f.useState(null);f.useEffect(()=>{e&&(async()=>{try{const h=await Yu();a(h)}catch{}})()},[e]),f.useEffect(()=>{if(t){const u=o.find(h=>h.name===t.name);u&&l(u.id)}},[o,t]);const d=u=>{l(u.id);const h={name:u.name||"",gender:qu(u.gender),age:u.age?String(u.age):"",profession:u.profession||"",basicInfo:u.basic_info||"",personality:u.personality||"",avatar:u.avatar||void 0};try{localStorage.setItem("user_chat_role_id",String(u.id))}catch{}r(h,u.id),s()};return n.jsx("div",{className:`fixed inset-0 z-[90] ${e?"":"pointer-events-none"}`,children:n.jsx(ot,{children:e&&n.jsxs(n.Fragment,{children:[n.jsx(Ie.div,{className:"absolute inset-0 bg-black/30 will-change-opacity",onClick:s,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:ss},"backdrop"),n.jsx(Ie.div,{className:"absolute bottom-0 left-0 right-0 bg-transparent will-change-transform transform-gpu",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:jn,children:n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)]",children:[n.jsxs("div",{className:"sticky top-0 bg-white/95 backdrop-blur-md p-3 border-b border-slate-100 flex justify-between items-center z-10",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-2",children:[n.jsx(Pt,{className:"w-6 h-6"}),n.jsx("span",{className:"font-bold text-lg",children:""})]}),n.jsx("button",{onClick:i,className:"w-9 h-9 rounded-full bg-purple-50 text-[#A855F7] flex items-center justify-center active:scale-90 transition-transform",children:n.jsx(He,{className:"w-6 h-6"})})]}),n.jsxs("div",{className:"p-4 flex flex-col gap-3 max-h-[70vh] overflow-y-auto",children:[o.map(u=>n.jsxs("div",{onClick:()=>d(u),className:`p-4 bg rounded-xl shadow-sm border border-slate-100 flex items-center gap-3 active:scale-[0.98] transition-transform ${c===u.id?"border-[#A855F7] bg-[#FBF5FF]":""}`,children:[n.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-slate-200 flex items-center justify-center text-slate-600 font-bold",children:u.avatar?n.jsx("img",{src:u.avatar,alt:u.name,className:"w-full h-full object-cover"}):(u.name||"")[0]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-800 truncate",children:u.name}),n.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[u.profession||"",u.age?`  ${u.age}`:""]})]}),c===u.id&&n.jsx(Ki,{className:"w-5 h-5 text-[#A855F7]"})]},u.id)),!o.length&&n.jsxs("div",{className:"p-6 text-center text-slate-500",children:[n.jsx("div",{className:"text-sm",children:""}),n.jsx("div",{className:"mt-3",children:n.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-[#A855F7] text-white rounded-lg text-sm font-bold",children:""})})]})]})]})},"sheet")]})})})},Zu=({isOpen:e,currentModelId:t,onClose:s,onSelect:i,temperature:r,onTempChange:o})=>{const[a,c]=f.useState([]),[l,d]=f.useState(t),[u,h]=f.useState(typeof r=="number"?r:.1);return f.useEffect(()=>{d(t)},[t]),f.useEffect(()=>{typeof r=="number"&&h(r)},[r]),f.useEffect(()=>{if(!e)return;(async()=>{try{const N=[...await Gu()].sort((j,P)=>(j.nickname||j.id).localeCompare(P.nickname||P.id,"zh-CN",{sensitivity:"base"}));c(N)}catch{}})()},[e]),n.jsx("div",{className:`fixed inset-0 z-[90] ${e?"":"pointer-events-none"}`,children:n.jsx(ot,{children:e&&n.jsxs(n.Fragment,{children:[n.jsx(Ie.div,{className:"absolute inset-0 bg-black/30 will-change-opacity",onClick:s,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:ss},"backdrop"),n.jsxs(Ie.div,{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)] will-change-transform transform-gpu",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:jn,children:[n.jsxs("div",{className:"sticky top-0 bg-white/95 backdrop-blur-md p-3 border-b border-slate-100 flex justify-between items-center z-10",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-2",children:[n.jsx(Pt,{className:"w-6 h-6"}),n.jsx("span",{className:"font-bold text-lg",children:""})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-bold text-slate-700",children:""}),n.jsx("input",{value:u,onChange:p=>{const y=parseFloat(p.target.value||"0");h(isNaN(y)?0:y),o==null||o(isNaN(y)?0:y)},type:"number",step:"0.1",min:"0",max:"2",className:"w-16 px-2 py-1 border border-slate-200 rounded-lg text-sm"})]})]}),n.jsxs("div",{className:"p-4 flex flex-col gap-3 max-h-[70vh] overflow-y-auto",children:[a.map(p=>n.jsxs("div",{onClick:()=>{d(p.id),i(p.id,p.nickname),s()},className:`relative p-4 rounded-xl shadow-sm border active:scale-[0.98] transition-transform flex items-center justify-center ${l===p.id?"bg-[#F3E8FF] border-[#A855F7]":"bg-white border-slate-100"}`,children:[n.jsx("div",{className:"w-full text-center font-bold text-slate-800 truncate",children:p.nickname||p.id}),l===p.id&&n.jsx(Ki,{className:"w-5 h-5 text-[#A855F7] absolute right-4 top-1/2 -translate-y-1/2"})]},p.id)),!a.length&&n.jsx("div",{className:"p-6 text-center text-slate-500",children:n.jsx("div",{className:"text-sm",children:""})})]})]},"sheet")]})})})},Qu=({character:e,initialMessages:t,userPersona:s,onBack:i,onUpdateLastMessage:r,onOpenUserSettings:o,onShowProfile:a,onUpdateUserPersona:c})=>{const[l,d]=f.useState(t),[u,h]=f.useState("scene"),[p,y]=f.useState(""),[N,j]=f.useState(!1),[P,T]=f.useState(!1),[A,R]=f.useState(!1),[$,S]=f.useState(!1),[C,L]=f.useState(!1),[M,B]=f.useState(void 0),[z,W]=f.useState(.1),[G,ee]=f.useState(void 0),[ce,re]=f.useState(!1),[de,V]=f.useState(!1),[U,K]=f.useState(void 0),[ne,Z]=f.useState(!1),[w,_]=f.useState(!1),D=f.useRef(null),Y=f.useRef(null),te=f.useRef(null),[fe,oe]=f.useState(null),se=f.useRef(null),we=(()=>{try{return localStorage.getItem("user_id")||"0"}catch{return"0"}})(),k=`chat_history_${we}_${e.id}`,F=`chat_config_${e.id}`,Q=`chat_model_${e.id}`,ae=`chat_temp_${e.id}`,he=`chat_model_name_${e.id}`,pe=f.useMemo(()=>{if(U)return U;try{const m=localStorage.getItem("user_nickname")||"",x=localStorage.getItem("user_avatar")||"";if(m||x)return{name:m||"",gender:"secret",age:"",profession:"",basicInfo:"",personality:"",avatar:x||void 0}}catch{}},[U]),Ce=(m,x,b)=>{d(q=>{const H=[...q];for(let g=H.length-1;g>=0;g--)if(H[g].senderId==="user"&&!H[g].read){H[g]={...H[g],read:!0};break}const X={id:(Date.now()+1).toString(),senderId:e.id,text:m,quote:x,timestamp:new Date,type:Ze.TEXT};H.push(X);try{setTimeout(()=>r(X),0)}catch{}return H}),b&&typeof b.chunkIndex=="number"&&typeof b.chunkTotal=="number"?j(b.chunkIndex<b.chunkTotal):j(!1)},ke=()=>{var m;Y.current?Y.current.scrollTop=Y.current.scrollHeight:(m=D.current)==null||m.scrollIntoView({behavior:"smooth"})};f.useEffect(()=>{ke()},[l,N]);const[je,Ae]=f.useState({height:"100%",top:0});f.useEffect(()=>{const m=()=>{window.visualViewport&&(Ae({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`}),Y.current&&(Y.current.scrollTop=Y.current.scrollHeight))};window.visualViewport&&(window.visualViewport.addEventListener("resize",m),window.visualViewport.addEventListener("scroll",m),m());const x=()=>{window.visualViewport||(Y.current?Y.current.scrollTop=Y.current.scrollHeight:ke())};return window.addEventListener("resize",x),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",m),window.visualViewport.removeEventListener("scroll",m)),window.removeEventListener("resize",x)}},[]),f.useEffect(()=>{try{const m=`chat_history_${e.id}`,x=localStorage.getItem(k)||(we==="0"?localStorage.getItem(m):null);if(x){const q=JSON.parse(x).map(H=>({id:H.id,senderId:H.senderId,text:H.text,timestamp:new Date(H.ts),type:H.type,quote:H.quote,read:H.read}));q.length&&d(q)}}catch{}},[e.id]),f.useEffect(()=>{try{const m=l.map(x=>{var b,q;return{id:x.id,senderId:x.senderId,text:x.text,ts:(q=(b=x.timestamp)==null?void 0:b.getTime)!=null&&q.call(b)?x.timestamp.getTime():Date.now(),type:x.type,quote:x.quote,read:x.read}});localStorage.setItem(k,JSON.stringify(m))}catch{}},[l]),f.useEffect(()=>{try{const m=localStorage.getItem(F);if(m){const X=JSON.parse(m);((X==null?void 0:X.chatMode)==="daily"||(X==null?void 0:X.chatMode)==="scene")&&(h(X.chatMode),y(X.chatMode==="scene"?"":"")),X!=null&&X.persona&&K(X.persona)}const x=localStorage.getItem(Q)||void 0,b=localStorage.getItem(ae),q=b?parseFloat(b):void 0;x&&(B(x),re(!0)),typeof q=="number"&&!isNaN(q)&&(W(q),V(!0));const H=localStorage.getItem(he)||void 0;H&&ee(H)}catch{}},[e.id]),f.useEffect(()=>{const m=`chat_session_${we}_${e.id}`,x=localStorage.getItem(m)||localStorage.getItem(`chat_session_${e.id}`);return(async()=>{var q;if(x){if(oe(x),!localStorage.getItem(m))try{localStorage.setItem(m,x)}catch{}try{const X=await Xu(x);if((X==null?void 0:X.temperature)!==void 0){W(X.temperature);try{localStorage.setItem(ae,String(X.temperature))}catch{}}}catch{}const H=gs(x,(X,g,E)=>{Ce(X,g,E)});se.current=H;return}try{const H=localStorage.getItem("user_chat_role_id"),X=H?parseInt(H):void 0,g=await Vs(e.id,typeof X=="number"?X:void 0),E=g.sessionId;if(localStorage.setItem(m,E),oe(E),(q=g.model)!=null&&q.id){B(g.model.id);try{localStorage.setItem(Q,g.model.id)}catch{}}if(typeof g.temperature=="number"){W(g.temperature);try{localStorage.setItem(ae,String(g.temperature))}catch{}}const O=gs(E,(ie,le,_e)=>{Ce(ie,le,_e)});se.current=O}catch{}})(),()=>{var q;(q=se.current)==null||q.close(),se.current=null}},[e.id]);const Pe=m=>{h(m),m==="scene"?!p.includes("")&&!p.includes("(")?y(x=>`${x}`):p===""&&y(""):(p===""||p==="()")&&y("");try{localStorage.setItem(F,JSON.stringify({chatMode:m,persona:s||void 0}))}catch{}},v=async()=>{var x,b;if(!p.trim()||p.trim()===""||p.trim()==="()")return;const m={id:Date.now().toString(),senderId:"user",text:p,timestamp:new Date,type:Ze.TEXT,read:!1};d(q=>[...q,m]);try{setTimeout(()=>r(m),0)}catch{}y(u==="scene"?"":""),j(!0);try{if(!fe){const q=localStorage.getItem("user_chat_role_id"),H=q?parseInt(q):void 0,g=(await Vs(e.id,typeof H=="number"?H:void 0)).sessionId;localStorage.setItem(`chat_session_${we}_${e.id}`,g),oe(g);const E=gs(g,(O,ie,le)=>{Ce(O,ie,le)});se.current=E}(x=se.current)==null||x.sendText(m.text,u,pe,ce?M:void 0,de?z:void 0),(b=se.current)==null||b.sendTyping(!1)}catch(q){console.error(q),j(!1)}},I=m=>m.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1});return n.jsx(Ie.div,{className:"fixed inset-0 bg-primary-50 z-50",style:{...je,overscrollBehavior:"none",position:"fixed"},initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col relative bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden",children:[n.jsx("div",{className:"bg-primary-50/95 backdrop-blur-md pt-[env(safe-area-inset-top)] shadow-none z-10 border-b border-white/50 flex-shrink-0",children:n.jsxs("div",{className:"px-4 h-12 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:i,className:"p-2 -ml-2 text-slate-800 hover:bg-black/5 rounded-full transition-colors",children:n.jsx(Xt,{size:24})}),n.jsx("div",{className:"flex items-center cursor-pointer active:opacity-70 transition-opacity",onClick:a,children:n.jsx("h2",{className:"font-bold text-slate-800 text-lg",children:N?"...":e.name})})]}),n.jsx("button",{onClick:()=>T(!0),className:"p-2 text-slate-800 hover:text-primary-600 rounded-full hover:bg-black/5 transition-all",children:n.jsx(Ba,{size:24})})]})}),n.jsxs("div",{ref:Y,className:"flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar bg-primary-50",style:{overflowAnchor:"none"},children:[n.jsx("div",{className:"flex justify-center my-4",children:n.jsx("span",{className:"bg-black/10 text-white text-[10px] px-3 py-1 rounded-full font-medium",children:""})}),l.map((m,x)=>{const b=m.senderId==="user";return n.jsxs("div",{className:`flex w-full ${b?"justify-end":"justify-start"} mb-4 group`,children:[!b&&n.jsx("div",{className:"flex-shrink-0 mr-3 flex flex-col items-center gap-1",children:n.jsx("div",{onClick:a,className:"w-10 h-10 rounded-full overflow-hidden bg-blue-100 flex items-center justify-center text-blue-500 font-bold border border-white cursor-pointer active:scale-95 transition-transform",children:!ne&&e.avatar?n.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full object-cover",onError:()=>Z(!0)}):e.name[0]})}),n.jsxs("div",{className:`flex flex-col ${b?"items-end":"items-start"} max-w-[75%]`,children:[n.jsx("div",{className:`
                      px-4 py-3 text-[15px] shadow-sm leading-relaxed relative
                      ${b?"bg-[#A855F7] text-white rounded-[20px] rounded-tr-sm":"bg-white text-slate-800 rounded-[20px] rounded-tl-sm border border-slate-100"}
                    `,children:m.text}),!b&&m.quote&&n.jsx("div",{className:"mt-1 max-w-full",children:n.jsx("div",{className:"inline-block bg-slate-100 text-slate-500 text-xs leading-tight rounded-[12px] px-2 py-1 border border-slate-200",children:m.quote})}),n.jsxs("div",{className:`flex items-center gap-2 mt-1 ${b?"mr-1":"ml-1"}`,children:[b&&m.read&&n.jsx("span",{className:"text-[10px] text-slate-400",children:""}),n.jsx("span",{className:"text-[10px] text-slate-400",children:I(m.timestamp)})]})]}),b&&n.jsx("div",{className:"flex-shrink-0 ml-3",children:n.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-pink-200 flex items-center justify-center text-pink-600 font-bold border border-white shadow-sm",children:!w&&(pe!=null&&pe.avatar)?n.jsx("img",{src:pe.avatar,alt:(pe==null?void 0:pe.name)||"",className:"w-full h-full object-cover",onError:()=>_(!0)}):pe!=null&&pe.name?pe.name[0]:""})})]},m.id)}),n.jsx("div",{ref:D})]}),n.jsx("div",{className:"bg-white p-3 pb-3 border-t border-slate-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] pb-[env(safe-area-inset-bottom)] mb-3 flex-shrink-0",children:n.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-[24px] px-3 py-2 border border-slate-100 shadow-[0_12px_28px_rgba(0,0,0,0.12)] transition-shadow focus-within:shadow-[0_16px_40px_rgba(0,0,0,0.16)]",children:[n.jsx("div",{className:"flex-1 flex items-center pl-2",children:n.jsx("textarea",{ref:te,value:p,onChange:m=>{var x;y(m.target.value),(x=se.current)==null||x.sendTyping(!0)},onKeyDown:m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),v())},onBlur:()=>{var m;return(m=se.current)==null?void 0:m.sendTyping(!1)},placeholder:"",className:"w-full bg-transparent border-none outline-none focus:ring-0 text-slate-700 text-sm p-0 resize-none max-h-24 overflow-y-auto leading-5 placeholder:text-slate-400",rows:1,style:{minHeight:"22px"}})}),n.jsx("button",{onClick:v,disabled:!p.trim()||p.trim()==="",className:`p-2 rounded-full transition-all duration-300 flex-shrink-0 flex items-center justify-center ${p.trim()&&p.trim()!==""?"bg-[#A855F7] text-white shadow-md active:scale-95":"bg-transparent text-[#A855F7]"}`,children:n.jsx(Yi,{size:20,className:p.trim()&&p.trim()!==""?"ml-0.5":""})})]})}),n.jsx(ot,{initial:!1,children:P&&n.jsxs(n.Fragment,{children:[n.jsx(Ie.div,{className:"absolute inset-0 bg-black/20 z-[60] will-change-opacity",onClick:()=>T(!1),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:ss}),n.jsxs(Ie.div,{className:"absolute top-0 right-0 h-full w-3/4 bg-white z-[70] shadow-2xl will-change-transform transform-gpu",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:Bu,children:[n.jsxs("div",{className:"p-5 border-b border-slate-100 flex justify-between items-center",children:[n.jsx("h3",{className:"font-bold text-lg text-slate-800",children:""}),n.jsx("button",{onClick:()=>T(!1),className:"text-slate-400 hover:text-slate-600",children:n.jsx(Qe,{size:24})})]}),n.jsxs("div",{className:"p-2",children:[n.jsxs("button",{onClick:()=>{T(!1),S(!0)},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(Ls,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsx(wt,{size:16,className:"text-slate-300"})]}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsxs("button",{onClick:()=>{T(!1),L(!0)},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(Ra,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-xs text-slate-500",children:G||""}),n.jsx(wt,{size:16,className:"text-slate-300"})]})]}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsxs("div",{className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(io,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[n.jsx("button",{onClick:()=>Pe("daily"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${u==="daily"?"bg-white text-slate-800 shadow-sm":"text-slate-400"}`,children:""}),n.jsx("button",{onClick:()=>Pe("scene"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${u==="scene"?"bg-white text-purple-600 shadow-sm":"text-slate-400"}`,children:""})]})]})]})]})]})}),A&&n.jsx(ka,{currentPersona:void 0,onBack:()=>R(!1),onSave:m=>{R(!1),S(!0)},withinContainer:!0}),n.jsx(Ju,{isOpen:$,currentPersona:s,onClose:()=>S(!1),onAdd:()=>{S(!1),R(!0)},onSelect:m=>{K(m);try{localStorage.setItem(F,JSON.stringify({chatMode:u,persona:m}))}catch{}}}),n.jsx(Zu,{isOpen:C,currentModelId:M,onClose:()=>L(!1),onSelect:(m,x)=>{B(m),re(!0),ee(x);try{localStorage.setItem(Q,m),x&&localStorage.setItem(he,x)}catch{}},temperature:z,onTempChange:m=>{W(m),V(!0);try{localStorage.setItem(ae,String(m))}catch{}}})]})})},Aa=f.createContext({showToast:()=>{},showCenter:()=>{}}),Bi=({children:e})=>{const[t,s]=f.useState([]),i=f.useRef(new Map),r=(c,l)=>{const d=i.current.get(c);d&&clearTimeout(d);const u=window.setTimeout(()=>{s(h=>h.filter(p=>p.id!==c)),i.current.delete(c)},l);i.current.set(c,u)},o=(c,l="info")=>{const d=Date.now(),u=2e3;s(h=>[...h,{id:d,text:c,type:l,position:"bottom",duration:u}]),r(d,u)},a=(c,l="info")=>{s(u=>{const h=u.find(y=>y.position==="center"&&y.text===c);if(h)return r(h.id,3e3),u;const p=Date.now();return r(p,2e3),[...u,{id:p,text:c,type:l,position:"center",duration:2e3}]})};return n.jsxs(Aa.Provider,{value:{showToast:o,showCenter:a},children:[e,n.jsx("div",{className:"fixed bottom-6 left-0 right-0 z-[100] flex justify-center pointer-events-none",children:n.jsx("div",{className:"space-y-2",children:t.filter(c=>c.position==="bottom").map(c=>n.jsx("div",{className:`${c.type==="role"?"bg-white text-pink-600 border border-pink-200 shadow-md":c.type==="error"?"bg-red-500 text-white":c.type==="success"?"bg-green-500 text-white":"bg-slate-800 text-white"} px-4 py-2 rounded-2xl shadow-lg inline-block`,children:c.text},c.id))})}),n.jsx("div",{className:"fixed top-[25%] left-1/2 -translate-x-1/2 z-[100] pointer-events-none",children:n.jsx("div",{className:"space-y-2 flex flex-col items-center",children:t.filter(c=>c.position==="center").map(c=>n.jsx("div",{className:`${c.type==="error"?"bg-white text-red-500 border-red-200":"bg-white text-slate-800 border-slate-200"} px-6 py-3 rounded-2xl shadow-2xl border whitespace-nowrap`,children:c.text},c.id))})}),n.jsx("style",{children:`
        @keyframes toastFade {
          0% { opacity: 0; transform: translateY(-6px); }
          10% { opacity: 1; transform: translateY(0); }
          90% { opacity: 1; transform: translateY(0); }
          100% { opacity: 0; transform: translateY(-6px); }
        }
      `})]})},Pa=()=>f.useContext(Aa),eh=({character:e,onBack:t,onStartChat:s,isFromChat:i=!1,isExistingChat:r=!1})=>{var y;const[o,a]=f.useState(!1),{showToast:c,showCenter:l}=Pa(),[d,u]=f.useState(!1),h=o?e.tags:e.tags.slice(0,4),p=e.tags.length>4;return n.jsx(Ie.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[n.jsx("button",{onClick:t,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(Xt,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[n.jsxs("div",{className:"relative w-full h-[55vh]",children:[!d&&(e.profileImage||e.avatar)?n.jsx("img",{src:e.profileImage||e.avatar,alt:e.name,className:"w-full h-full object-cover",onError:()=>u(!0)}):n.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:n.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((y=e.name)==null?void 0:y[0])||"?"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),n.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:e.name}),n.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[n.jsx("span",{className:"text-green-400",children:""})," ",e.roleType||""]})]}),n.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[n.jsx("span",{children:e.profession}),n.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),n.jsx("span",{children:e.age})]}),n.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",e.creator]})]})]}),n.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:h.map((N,j)=>n.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",N]},j))}),p&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>a(!o),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[o?"":""," ",o?n.jsx(Os,{size:14}):n.jsx(jt,{size:14})]})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsxs("div",{className:"relative pl-4 py-1",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),n.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["",e.oneLinePersona,""]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:e.personality})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{children:n.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[n.jsx(Ji,{size:12,fill:"currentColor"})," ",e.currentRelationship]})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:""}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),n.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:e.plotTheme})]}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:e.plotDescription}),e.openingLine&&n.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[n.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:""}),n.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),n.jsx("span",{className:"text-slate-700 font-bold text-sm",children:e.openingLine})]})]})]})]}),n.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:n.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:n.jsx("button",{onClick:()=>{if(i){s();return}if(r){l("");return}s()},className:"w-full font-bold text-lg py-4 rounded-2xl shadow-lg active:scale-[0.98] transition-all flex items-center justify-center gap-2 bg-purple-200 text-purple-900 shadow-purple-100",children:i?n.jsxs(n.Fragment,{children:[n.jsx(zs,{size:20}),""]}):""})})})]})})},th=async()=>{const{authFetch:e}=await ue(async()=>{const{authFetch:i}=await import("./http-bwpcOK62.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),t=await e("/user-characters");if(!t.ok)throw new Error("failed");const s=await t.json();return Array.isArray(s.items)?s.items:[]},At=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:i}=await import("./http-bwpcOK62.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),s=await t(`/user-characters/${e}`);if(!s.ok)throw new Error("failed");return await s.json()},sh=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:r}=await import("./http-bwpcOK62.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t("/user-characters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("create_character_failed");return(await s.json()).id},nh=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:r}=await import("./http-bwpcOK62.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t("/user-characters/draft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("create_draft_failed");return(await s.json()).id},ih=async(e,t)=>{const{authFetch:s}=await ue(async()=>{const{authFetch:r}=await import("./http-bwpcOK62.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await s(`/user-characters/${e}/draft`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("update_draft_failed");return!0},rh=async(e,t)=>{const{authFetch:s}=await ue(async()=>{const{authFetch:r}=await import("./http-bwpcOK62.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await s(`/user-characters/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("update_failed");return!0},ah=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:i}=await import("./http-bwpcOK62.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user-characters/${e}`,{method:"DELETE"})).ok)throw new Error("delete_failed");return!0},Ui=({character:e,createdId:t,onBack:s,onStartChat:i})=>{var P;const[r,o]=f.useState(!1),[a,c]=f.useState(!0),[l,d]=f.useState(e),[u,h]=f.useState(!1),[p,y]=f.useState(!1);f.useEffect(()=>{let T=!0,A;const R=async()=>{try{const S=await At(t);if(!T)return;const C=typeof(S==null?void 0:S.status)=="string"?S.status.trim():"",L=!!(S!=null&&S.hasSystemPrompt);if(C==="draft"){h(!0),c(!1),A&&clearInterval(A);return}if(C==="publishing"||!L){h(!1),c(!1);return}if(S&&(C==="published"||L)){c(!0),h(!1),d(M=>({...M,id:String(S.id||M.id),name:S.name||M.name,avatar:S.avatar||M.avatar,profileImage:M.profileImage,oneLinePersona:S.tagline||M.oneLinePersona,personality:S.personality||M.personality,profession:String(S.occupation||M.profession||""),age:String(S.age||M.age||""),currentRelationship:String(S.relationship||M.currentRelationship||""),plotTheme:String(S.plot_theme||M.plotTheme||""),plotDescription:String(S.plot_summary||M.plotDescription||""),openingLine:String(S.opening_line||M.openingLine||"")})),A&&clearInterval(A);return}}catch{}};return(async()=>{try{const S=await At(t);if(!T)return;if(S){d(M=>({...M,id:String(S.id||M.id),name:S.name||M.name,avatar:S.avatar||M.avatar,oneLinePersona:S.tagline||M.oneLinePersona,personality:S.personality||M.personality,profession:String(S.occupation||M.profession||""),age:String(S.age||M.age||""),currentRelationship:String(S.relationship||M.currentRelationship||""),plotTheme:String(S.plot_theme||M.plotTheme||""),plotDescription:String(S.plot_summary||M.plotDescription||""),openingLine:String(S.opening_line||M.openingLine||"")}));const C=!!S.hasSystemPrompt,L=typeof S.status=="string"?S.status.trim():"";if(L==="draft"){h(!0),c(!1);return}if(L==="publishing"){h(!1),c(!1),A=setInterval(R,3e3),R();return}if(!C){h(!1),c(!1),A=setInterval(R,3e3),R();return}h(!1),c(!0);return}h(!1),c(!0)}catch{h(!1),c(!0)}})(),()=>{T=!1,clearInterval(A)}},[t]);const N=r?l.tags:l.tags.slice(0,4),j=l.tags.length>4;return n.jsx(Ie.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[n.jsx("button",{onClick:s,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(Xt,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[n.jsxs("div",{className:"relative w-full h-[55vh]",children:[!p&&(l.profileImage||l.avatar)?n.jsx("img",{src:l.profileImage||l.avatar,alt:l.name,className:"w-full h-full object-cover",onError:()=>y(!0)}):n.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:n.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((P=l.name)==null?void 0:P[0])||"?"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),n.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:l.name}),n.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[n.jsx("span",{className:"text-green-400",children:""})," ",l.roleType||""]})]}),n.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[n.jsx("span",{children:l.profession}),n.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),n.jsx("span",{children:l.age})]}),n.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",l.creator]})]})]}),n.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:N.map((T,A)=>n.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",T]},A))}),j&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>o(!r),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[r?"":""," ",r?n.jsx(Os,{size:14}):n.jsx(jt,{size:14})]})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsxs("div",{className:"relative pl-4 py-1",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),n.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["",l.oneLinePersona,""]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:l.personality})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{children:n.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[n.jsx(Ji,{size:12,fill:"currentColor"})," ",l.currentRelationship]})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:""}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),n.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:l.plotTheme})]}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:l.plotDescription}),l.openingLine&&n.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[n.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:""}),n.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),n.jsx("span",{className:"text-slate-700 font-bold text-sm",children:l.openingLine})]})]})]})]}),n.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:n.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:n.jsx("button",{disabled:!a||u,onClick:()=>i(l),className:`w-full font-bold text-lg py-4 rounded-2xl shadow-lg transition-all flex items-center justify-center gap-2 ${a&&!u?"bg-purple-200 text-purple-900 shadow-purple-100 active:scale-[0.98]":"bg-slate-200 text-slate-500 cursor-not-allowed"}`,children:a&&!u?n.jsxs(n.Fragment,{children:[n.jsx(zs,{size:20}),""]}):u?"":""})})})]})})},oh=({onBack:e,onCreate:t,isEdit:s=!1,characterId:i,initial:r,onUpdated:o})=>{const[a,c]=f.useState({type:"",avatar:"",profileImage:"",name:"",gender:"",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0}),[l,d]=f.useState(!1),[u,h]=f.useState(!0),[p,y]=f.useState(!1),[N,j]=f.useState(""),[P,T]=f.useState(!1),[A,R]=f.useState({}),[$,S]=f.useState(!1),[C,L]=f.useState(null),M=f.useRef(null),B=w=>{var oe;const _=w.split(","),D=((oe=_[0].match(/:(.*?);/))==null?void 0:oe[1])||"image/jpeg",Y=atob(_[1]);let te=Y.length;const fe=new Uint8Array(te);for(;te--;)fe[te]=Y.charCodeAt(te);return new Blob([fe],{type:D})};f.useEffect(()=>{r&&c(_=>({..._,type:r.roleType||_.type,avatar:r.avatar||_.avatar,profileImage:r.profileImage||_.profileImage,name:r.name||_.name,gender:r.gender||_.gender,age:r.age||_.age,profession:r.profession||_.profession,tagline:r.oneLinePersona||_.tagline,personality:r.personality||_.personality,relationship:r.currentRelationship||_.relationship,plotTheme:r.plotTheme||_.plotTheme,plotSummary:r.plotDescription||_.plotSummary,openingLine:r.openingLine||_.openingLine,styleExamples:Array.isArray(r.styleExamples)&&r.styleExamples.length?r.styleExamples:_.styleExamples,hobbies:r.hobbies||_.hobbies,experiences:r.experiences||_.experiences,searchTags:Array.isArray(r.tags)?r.tags:_.searchTags,isPublic:typeof r.isPublic=="boolean"?r.isPublic:_.isPublic}));const w=localStorage.getItem("create_character_draft");if(w&&!s)try{const _=JSON.parse(w);c(D=>({...D,..._}))}catch(_){console.error("Failed to load draft",_)}},[r,s]),f.useEffect(()=>{if(!s||!i)return;const w=!(r&&Array.isArray(r.tags)&&r.tags.length),_=!(r&&Array.isArray(r.styleExamples)&&r.styleExamples.length);!w&&!_||(async()=>{try{const D=await At(i),Y=Array.isArray(D==null?void 0:D.styleExamples)?D.styleExamples.slice(0,3):[];for(;Y.length<3;)Y.push("");c(te=>({...te,name:(D==null?void 0:D.name)??te.name,gender:(D==null?void 0:D.gender)??te.gender,avatar:(D==null?void 0:D.avatar)??te.avatar,tagline:(D==null?void 0:D.tagline)??te.tagline,personality:(D==null?void 0:D.personality)??te.personality,relationship:(D==null?void 0:D.relationship)??te.relationship,plotTheme:(D==null?void 0:D.plot_theme)??te.plotTheme,plotSummary:(D==null?void 0:D.plot_summary)??te.plotSummary,openingLine:(D==null?void 0:D.opening_line)??te.openingLine,hobbies:(D==null?void 0:D.hobbies)??te.hobbies,experiences:(D==null?void 0:D.experiences)??te.experiences,age:(D==null?void 0:D.age)!=null?String(D.age):te.age,profession:(D==null?void 0:D.occupation)??te.profession,searchTags:Array.isArray(D==null?void 0:D.tags)?D.tags:te.searchTags,styleExamples:Y,isPublic:D!=null&&D.visibility?D.visibility==="public":te.isPublic}))}catch{}})()},[s,i,r]);const z=["","",""],W=["","","","",""],G=["M/M","M/F","BL","BG","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ee=()=>{var w;(w=M.current)==null||w.click()},ce=w=>{var D;const _=(D=w.target.files)==null?void 0:D[0];if(_){const Y=new FileReader;Y.onloadend=()=>{L(Y.result)},Y.readAsDataURL(_)}M.current&&(M.current.value="")},re=w=>{a.searchTags.includes(w)?c(_=>({..._,searchTags:_.searchTags.filter(D=>D!==w)})):c(_=>({..._,searchTags:[..._.searchTags,w]}))},de=()=>{const w=N.trim();w&&!a.searchTags.includes(w)&&(c(_=>({..._,searchTags:[..._.searchTags,w]})),j(""))},V=async w=>{if(w){try{const _=localStorage.getItem("user_access_token");let D=a.avatar||null;if(D&&D.startsWith("data:image")){const te=B(D),fe=new FormData,oe=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;fe.append("avatar",te,"avatar.jpg"),fe.append("filename",oe),D=`/uploads/users/avatars/${oe}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:_?`Bearer ${_}`:""},body:fe})}catch{}}const Y={name:a.name||"",gender:a.gender,avatar:D,identity:null,tagline:a.tagline,personality:a.personality,relationship:a.relationship,plotTheme:a.plotTheme,plotSummary:a.plotSummary,openingLine:a.openingLine,hobbies:a.hobbies,experiences:a.experiences,age:a.age&&parseInt(a.age,10)||null,occupation:a.profession,character_type:a.type,visibility:a.isPublic?"public":"private",tags:a.searchTags,styleExamples:a.styleExamples.filter(Boolean)};s&&i?await ih(i,Y):await nh(Y)}catch{}localStorage.setItem("create_character_draft",JSON.stringify(a))}else localStorage.removeItem("create_character_draft"),c({type:"",avatar:"",profileImage:"",name:"",gender:"",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0});T(!1)},U=()=>{const w={};return a.name.trim()||(w.name=!0),a.age.trim()||(w.age=!0),a.profession.trim()||(w.profession=!0),a.tagline.trim()||(w.tagline=!0),a.personality.trim()||(w.personality=!0),a.searchTags.length===0&&(w.searchTags=!0),a.relationship.trim()||(w.relationship=!0),a.plotTheme.trim()||(w.plotTheme=!0),a.plotSummary.trim()||(w.plotSummary=!0),a.openingLine.trim()||(w.openingLine=!0),R(w),Object.keys(w).length===0},K=async()=>{if(!U()){S(!0);return}let w=null;try{const D=localStorage.getItem("user_access_token");let Y=a.avatar||null;if(Y&&Y.startsWith("data:image")){const fe=B(Y),oe=new FormData,se=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;oe.append("avatar",fe,"avatar.jpg"),oe.append("filename",se),Y=`/uploads/users/avatars/${se}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:D?`Bearer ${D}`:""},body:oe})}catch{}}const te={name:a.name,gender:a.gender,avatar:Y,identity:null,tagline:a.tagline,personality:a.personality,relationship:a.relationship,plotTheme:a.plotTheme,plotSummary:a.plotSummary,openingLine:a.openingLine,hobbies:a.hobbies,experiences:a.experiences,age:a.age&&parseInt(a.age,10)||null,occupation:a.profession,character_type:a.type,visibility:a.isPublic?"public":"private",tags:a.searchTags,styleExamples:a.styleExamples.filter(Boolean)};s&&i?(await rh(i,te),w=typeof i=="number"?i:parseInt(String(i))||null):w=await sh(te)}catch{}const _={id:w?String(w):`c_${Date.now()}`,name:a.name,avatar:a.avatar||"https://image.pollinations.ai/prompt/anime%20silhouette%20purple?width=400&height=400&nologo=true",profileImage:a.profileImage||a.avatar,status:Ue.ONLINE,bio:`${a.age} ${a.profession}`,tags:a.searchTags,isPinned:!1,relationshipLevel:0,creator:"",playCount:"0",age:a.age||"",profession:a.profession||"",gender:a.gender,roleType:a.type,isOriginal:a.type==="",oneLinePersona:a.tagline,personality:a.personality,currentRelationship:a.relationship,plotTheme:a.plotTheme,plotDescription:a.plotSummary,openingLine:a.openingLine,styleExamples:a.styleExamples.filter(D=>D),hobbies:a.hobbies,experiences:a.experiences,isPublic:a.isPublic};localStorage.removeItem("create_character_draft"),s&&o?o(_):t(_)},ne=w=>["","",""][w],Z="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return n.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-3xl shadow-2xl bg font-kosugi",children:[C&&n.jsx(ns,{imageSrc:C,aspectRatio:1,outputWidth:800,outputHeight:800,onCancel:()=>{L(null),M.current&&(M.current.value="")},onCrop:w=>{c(_=>({..._,avatar:w,profileImage:C})),L(null)}}),n.jsx("div",{className:"ambient-bg hidden"}),n.jsxs("div",{className:"hidden",children:[n.jsx("div",{className:"star",style:{left:"10%",width:"4px",height:"4px"}}),n.jsx("div",{className:"star",style:{left:"80%",animationDelay:"2s",width:"6px",height:"6px"}})]}),n.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-3xl relative",children:[n.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:n.jsx(Pt,{size:20})}),n.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:s?"":""}),!s&&n.jsx("button",{onClick:()=>T(!0),className:"ml-auto text-sm font-bold text-purple-600 font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",children:[n.jsxs("section",{className:"mt-4",children:[n.jsx("div",{className:"text-[#2E1065] font-bold text-[0.9rem] mb-2 ml-1 font-kosugi",children:""}),n.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-1 mt-2",children:z.map(w=>n.jsx("button",{onClick:()=>c(_=>({..._,type:w})),className:`
                                flex-shrink-0 px-5 py-2.5 rounded-2xl text-sm font-bold transition-all whitespace-nowrap tracking-wide font-kosugi
                                ${a.type===w?"bg-purple-500 text-white shadow-purple-200 shadow-md":"bg-white/70 text-slate-500 border-transparent"}
                            `,children:w},w))})]}),n.jsxs("section",{className:"flex flex-col items-center py-2",children:[n.jsxs("div",{onClick:ee,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-24 h-24 rounded-full bg-white border-[3px] border-white shadow-xl flex items-center justify-center overflow-hidden relative",children:a.avatar?n.jsx("img",{src:a.avatar,className:"w-full h-full object-cover",alt:"avatar"}):n.jsx("div",{className:"text-purple-200 text-3xl",children:n.jsx(Fs,{size:32})})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center border-[3px] border-white shadow-md",children:n.jsx(He,{size:14})})]}),n.jsx("input",{type:"file",ref:M,className:"hidden",accept:"image/*",onChange:ce}),n.jsx("p",{className:"mt-2 text-xs text-purple-400 font-bold tracking-wide font-kosugi",children:""})]}),n.jsxs("section",{className:"glass-card p-6 space-y-6",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:""}),n.jsxs("div",{children:[n.jsxs("label",{className:`${Z} flex items-center gap-1`,children:["",A.name&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("div",{className:"relative",children:n.jsx("input",{value:a.name,onChange:w=>c(_=>({..._,name:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold ${A.name?"border-red-300 bg-red-50":""}`})})]}),n.jsxs("div",{children:[n.jsx("label",{className:Z,children:""}),n.jsx("div",{className:"flex gap-3",children:["","",""].map(w=>n.jsx("button",{onClick:()=>c(_=>({..._,gender:w})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition font-kosugi ${a.gender===w?w===""?"bg-blue-100 text-blue-600 ring-2 ring-blue-200":w===""?"bg-pink-100 text-pink-600 ring-2 ring-pink-200":"bg-purple-100 text-purple-600 ring-2 ring-purple-200":"bg-white/50 text-slate-400"}`,children:w},w))})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"w-full",children:[n.jsxs("label",{className:`${Z} flex items-center gap-1`,children:["",A.age&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.age,onChange:w=>c(_=>({..._,age:w.target.value})),type:"text",placeholder:"28",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${A.age?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"w-full",children:[n.jsxs("label",{className:`${Z} flex items-center gap-1`,children:["",A.profession&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.profession,onChange:w=>c(_=>({..._,profession:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${A.profession?"border-red-300 bg-red-50":""}`})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${Z} flex items-center gap-1`,children:["",A.tagline&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.tagline,onChange:w=>c(_=>({..._,tagline:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm ${A.tagline?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${Z} flex items-center gap-1`,children:["",A.personality&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("textarea",{value:a.personality,onChange:w=>c(_=>({..._,personality:w.target.value})),rows:3,placeholder:"...",className:`dream-input w-full px-4 py-3 text-sm resize-none ${A.personality?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${Z} flex items-center gap-1`,children:["",A.searchTags&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsxs("div",{onClick:()=>y(!0),className:`dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition ${A.searchTags?"border-red-300 bg-red-50":""}`,children:[a.searchTags.length===0&&n.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:" (# #...)"}),a.searchTags.map(w=>n.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",w,n.jsx(Qe,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:_=>{_.stopPropagation(),re(w)}})]},w)),n.jsx(wt,{className:"ml-auto text-purple-300",size:16})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${Z} flex items-center gap-1`,children:["",A.relationship&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[n.jsx("button",{onClick:()=>{d(!0),c(w=>({...w,relationship:""}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${l?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:""}),W.map(w=>n.jsx("button",{onClick:()=>{d(!1),c(_=>({..._,relationship:w}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${a.relationship===w&&!l?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:w},w))]}),l&&n.jsx("div",{className:"relative animate-in fade-in",children:n.jsx("input",{value:a.relationship,onChange:w=>c(_=>({..._,relationship:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-2 text-sm ${A.relationship?"border-red-300 bg-red-50":""}`})})]})]}),n.jsxs("section",{className:"glass-card p-6 space-y-5",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-4",children:""}),n.jsxs("p",{className:"text-xs text-slate-500 leading-relaxed bg-purple-50/50 p-3 rounded-xl border border-purple-100 flex gap-1",children:[n.jsx(Gi,{size:14,className:"text-purple-400 mt-0.5 flex-shrink-0"}),n.jsx("span",{children:""})]}),n.jsxs("div",{className:"bg-white/40 p-4 rounded-3xl border border-purple-100/50 space-y-4",children:[n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",A.plotTheme&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("input",{value:a.plotTheme,onChange:w=>c(_=>({..._,plotTheme:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 ${A.plotTheme?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",A.plotSummary&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:a.plotSummary,onChange:w=>c(_=>({..._,plotSummary:w.target.value})),rows:5,placeholder:"......",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none leading-relaxed ${A.plotSummary?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",A.openingLine&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:a.openingLine,onChange:w=>c(_=>({..._,openingLine:w.target.value})),rows:2,placeholder:"",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none ${A.openingLine?"border-red-300 bg-red-50":""}`})]})]})]}),n.jsxs("section",{className:"glass-card p-0 overflow-hidden transition-all",children:[n.jsxs("button",{onClick:()=>h(!u),className:"w-full flex items-center justify-between p-6 bg-transparent transition",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:""}),n.jsx("span",{className:"text-[10px] bg-purple-100 text-purple-500 px-1.5 py-0.5 rounded font-bold border border-purple-200 self-center font-kosugi",children:""})]}),u?n.jsx(Os,{className:"text-purple-400"}):n.jsx(jt,{className:"text-purple-400"})]}),u&&n.jsxs("div",{className:"p-6 pt-0 space-y-5 animate-in slide-in-from-top-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:Z,children:""}),n.jsx("div",{className:"space-y-3",children:[0,1,2].map(w=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs font-bold text-purple-300 w-4 font-mono",children:["0",w+1]}),n.jsx("input",{value:a.styleExamples[w],onChange:_=>{const D=[...a.styleExamples];D[w]=_.target.value,c(Y=>({...Y,styleExamples:D}))},type:"text",placeholder:ne(w),className:"dream-input flex-1 px-3 py-2.5 rounded-xl text-sm"})]},w))})]}),n.jsxs("div",{children:[n.jsx("label",{className:Z,children:""}),n.jsx("textarea",{value:a.hobbies,onChange:w=>c(_=>({..._,hobbies:w.target.value})),rows:2,placeholder:"...",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:Z,children:""}),n.jsx("textarea",{value:a.experiences,onChange:w=>c(_=>({..._,experiences:w.target.value})),rows:2,placeholder:"",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),n.jsxs("div",{className:"pt-2 border-t border-purple-100",children:[n.jsx("label",{className:`${Z} mb-1`,children:""}),n.jsx("p",{className:"text-[10px] text-slate-500 leading-tight mb-3",children:""}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:()=>c(w=>({...w,isPublic:!0})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${a.isPublic?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:[n.jsx(Ga,{size:14})," "]}),n.jsxs("button",{onClick:()=>c(w=>({...w,isPublic:!1})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${a.isPublic?"bg-white text-slate-500 border border-purple-100":"bg-purple-500 text-white shadow-md"}`,children:[n.jsx(Qa,{size:14})," "]})]})]})]})]})]}),n.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-b-3xl shadow-2xl",children:n.jsx("button",{onClick:K,className:"w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition-transform flex items-center justify-center tracking-widest text-lg font-kosugi",children:s?"":""})}),p&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>y(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 w-full bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[80vh] animate-in slide-in-from-bottom duration-300",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[n.jsx("button",{onClick:()=>y(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:n.jsx(jt,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:" #"}),n.jsx("button",{onClick:()=>y(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:""}),n.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[a.searchTags.length===0&&n.jsx("span",{className:"text-xs text-slate-400 self-center",children:""}),a.searchTags.map(w=>n.jsxs("button",{onClick:()=>re(w),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1 font-kosugi",children:["#",w," ",n.jsx(Qe,{size:10,className:"opacity-80"})]},w))]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:" ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:N,onChange:w=>j(w.target.value),onKeyDown:w=>w.key==="Enter"&&de(),type:"text",placeholder:"#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),n.jsx("button",{onClick:de,className:"bg-gradient-to-r from-purple-400 to-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition font-kosugi",children:""})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:""}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:G.map(w=>n.jsxs("button",{onClick:()=>re(w),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis font-kosugi
                                            ${a.searchTags.includes(w)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",w]},w))})]})]})]})]}),P&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-4 font-kosugi",children:s?"":""}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>V(!1),className:"flex-1 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors font-kosugi",children:s?"":""}),n.jsx("button",{onClick:()=>V(!0),className:"flex-1 py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:s?"":""})]})]})}),$&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:n.jsx(vs,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:""}),n.jsx("button",{onClick:()=>S(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:""})]})})]})})},lh=({onBack:e,onPublish:t,onSaveDraft:s,availableCharacters:i,myUserCharacters:r=[],initialStory:o,importableRoles:a=[]})=>{const{showCenter:c}=Pa(),[l,d]=f.useState(()=>o?{title:o.title,description:o.description,image:o.image,content:o.content,tags:o.tags,roles:o.availableRoles||[]}:{title:"",description:"",image:"",content:"",tags:[],roles:[]}),[u,h]=f.useState(!1),[p,y]=f.useState(!1),[N,j]=f.useState(!1),[P,T]=f.useState({}),[A,R]=f.useState(""),[$,S]=f.useState(null),[C,L]=f.useState(!1),M=f.useRef(null),[B,z]=f.useState(a),W=f.useRef(!1);f.useEffect(()=>{z(a||[])},[a]),f.useEffect(()=>{W.current||B&&B.length||(W.current=!0,(async()=>{try{const{authFetch:k}=await ue(async()=>{const{authFetch:Q}=await import("./http-bwpcOK62.js");return{authFetch:Q}},__vite__mapDeps([0,1,2,3])),F=await k("/stories/combine");if(F&&F.ok){const Q=await F.json(),ae=Array.isArray(Q==null?void 0:Q.items)?Q.items:[];z(ae.map(he=>({id:String(he.character_id),name:he.character_name,avatar:he.character_avatar||"",desc:he.desc||"",isPrivate:!!he.isPrivate,isMine:!!he.isMine})))}}catch{}})())},[]),Ea.useMemo(()=>(Array.isArray(r)?r:[]).filter(F=>F.isPublished===!0&&F.isPublic===!1).map(F=>({id:String(F.id),name:F.name,avatar:F.avatar,desc:F.oneLinePersona||F.bio||"",isPrivate:!0,isMine:!0})),[r]);const G=f.useRef(!1);f.useEffect(()=>{if(G.current)return;const k=Array.isArray(o==null?void 0:o.characterIds)?o.characterIds:[];if(!k.length||!B||!B.length)return;const F=new Set(k.map(ae=>String(ae))),Q=B.filter(ae=>F.has(String(ae.id))).map(ae=>({name:ae.name,avatar:ae.avatar,description:ae.desc||""}));Q.length&&(G.current=!0,d(ae=>({...ae,roles:Q})))},[o,B]),f.useEffect(()=>{if(!o)return;const k=o.availableRoles||[];k.length&&(d(F=>({...F,roles:k})),G.current=!0)},[o]),f.useEffect(()=>{o&&d(k=>({...k,title:o.title||k.title,description:o.description||k.description,image:o.image||k.image,content:o.content||k.content,tags:Array.isArray(o.tags)?o.tags:k.tags}))},[o]),f.useEffect(()=>{if(!C)return;const k=setTimeout(()=>L(!1),6e3);return()=>clearTimeout(k)},[C]),f.useEffect(()=>{if(!C)return;const k=F=>{const Q=M.current;if(!Q){L(!1);return}const ae=F.target;Q.contains(ae)||L(!1)};return window.addEventListener("click",k,!0),()=>window.removeEventListener("click",k,!0)},[C]);const ee=f.useRef(null),ce=k=>{var Ce;const F=k.split(","),Q=((Ce=F[0].match(/:(.*?);/))==null?void 0:Ce[1])||"image/jpeg",ae=atob(F[1]);let he=ae.length;const pe=new Uint8Array(he);for(;he--;)pe[he]=ae.charCodeAt(he);return new Blob([pe],{type:Q})},re=["BG","BL","GL","","","","","","","","","","","HE","BE","","","","",""],de=()=>{var k;(k=ee.current)==null||k.click()},V=k=>{var Q;const F=(Q=k.target.files)==null?void 0:Q[0];if(F){const ae=new FileReader;ae.onloadend=()=>{S(ae.result)},ae.readAsDataURL(F)}ee.current&&(ee.current.value="")},U=k=>{l.tags.includes(k)?d(F=>({...F,tags:F.tags.filter(Q=>Q!==k)})):d(F=>({...F,tags:[...F.tags,k]}))},K=()=>{const k=A.trim();k&&!l.tags.includes(k)&&(d(F=>({...F,tags:[...F.tags,k]})),R(""))},ne=k=>{if(l.roles.some(Q=>Q.name===k.name))return;const F={name:k.name,avatar:k.avatar,description:k.oneLinePersona||k.bio||""};d(Q=>({...Q,roles:[...Q.roles,F]})),y(!1)},Z=k=>{d(F=>({...F,roles:F.roles.filter(Q=>Q.name!==k)}))},w=()=>{const k=l.roles.map(Q=>Q.name),F={};return a.forEach(Q=>{F[Q.name]=Q.id}),k.map(Q=>F[Q]).filter(Boolean)},[_,D]=f.useState("none"),Y=async k=>{try{D(k==="published"?"publish":"draft");let F=l.image||"";try{const je=localStorage.getItem("user_access_token");if(l.image&&l.image.startsWith("data:image")){const Ae=ce(l.image),Pe=new FormData,v=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;F=`/uploads/covers/${v}`,Pe.append("cover",Ae,"cover.jpg"),Pe.append("filename",v);const I=await fetch("/api/uploads/cover",{method:"POST",headers:{Authorization:je?`Bearer ${je}`:""},body:Pe});if(I&&I.ok){const m=await I.json();m&&m.url&&(F=m.url)}}}catch{}const Q={title:l.title,description:l.description,image:F,status:k,content:l.content,tags:l.tags,characterIds:w()},{authFetch:ae}=await ue(async()=>{const{authFetch:je}=await import("./http-bwpcOK62.js");return{authFetch:je}},__vite__mapDeps([0,1,2,3])),he=!!o,pe=he?`/user/stories/${o==null?void 0:o.id}`:"/user/stories",ke=await ae(pe,{method:he?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(ke&&ke.ok){let je;try{const Pe=await ke.json();je=Pe==null?void 0:Pe.id}catch{je=o==null?void 0:o.id}const Ae={id:typeof je=="number"?je:o?o.id:Date.now(),title:l.title,description:l.description,image:F||l.image,content:l.content,tags:l.tags,author:localStorage.getItem("user_nickname")||"",likes:"0",availableRoles:l.roles,status:k};k==="published"?t(Ae):s(Ae);return}c("","error")}catch{c("","error")}finally{D("none")}},te=async()=>{try{D("draft");let k=l.image||"";try{const he=localStorage.getItem("user_access_token");if(l.image&&l.image.startsWith("data:image")){const pe=ce(l.image),Ce=new FormData,ke=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;k=`/uploads/covers/${ke}`,Ce.append("cover",pe,"cover.jpg"),Ce.append("filename",ke);const je=await fetch("/api/uploads/cover",{method:"POST",headers:{Authorization:he?`Bearer ${he}`:""},body:Ce});if(je&&je.ok){const Ae=await je.json();Ae&&Ae.url&&(k=Ae.url)}}}catch{}const F={title:l.title,description:l.description,image:k,content:l.content,tags:l.tags,characterIds:w()},{authFetch:Q}=await ue(async()=>{const{authFetch:he}=await import("./http-bwpcOK62.js");return{authFetch:he}},__vite__mapDeps([0,1,2,3])),ae=await Q(`/user/stories/${o==null?void 0:o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)});if(ae&&ae.ok){const he={id:typeof(o==null?void 0:o.id)=="number"?o.id:Date.now(),title:l.title,description:l.description,image:k||l.image,content:l.content,tags:l.tags,author:localStorage.getItem("user_nickname")||"",likes:"0",availableRoles:l.roles,status:o==null?void 0:o.status};s(he);return}c("","error")}catch{c("","error")}finally{D("none")}},fe=()=>{const k={};return l.title.trim()||(k.title=!0),l.content.trim()||(k.content=!0),T(k),Object.keys(k).length===0},oe=()=>{if(!fe()){j(!0);return}Y("published")},se=()=>{if(o){te();return}Y("draft")},we="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return n.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-none md:rounded-3xl shadow-2xl bg font-kosugi",children:[$&&n.jsx(ns,{imageSrc:$,aspectRatio:2,outputWidth:800,outputHeight:400,onCancel:()=>{S(null),ee.current&&(ee.current.value="")},onCrop:k=>{d(F=>({...F,image:k})),S(null)}}),n.jsx("div",{className:"ambient-bg hidden"}),n.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-none md:rounded-t-3xl relative",children:[o&&n.jsx("button",{onClick:se,disabled:_!=="none",className:`absolute right-4 text-sm font-bold font-kosugi ${_!=="none"?"text-slate-400 cursor-not-allowed":"text-purple-600"}`,children:""}),n.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:n.jsx(Pt,{size:20})}),n.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:o?"":""}),!o&&n.jsx("button",{onClick:se,disabled:_!=="none",className:`ml-auto text-sm font-bold font-kosugi ${_!=="none"?"text-slate-400 cursor-not-allowed":"text-purple-600"}`,children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",children:[n.jsxs("section",{className:"flex flex-col items-center py-2",children:[n.jsxs("div",{onClick:de,className:"relative group cursor-pointer active:scale-95 transition-transform w-full h-40 rounded-3xl overflow-hidden shadow-lg border-4 border-white bg-white/50",children:[l.image?n.jsx("img",{src:l.image,className:"w-full h-full object-cover",alt:"cover"}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-purple-300",children:[n.jsx(Fs,{size:32}),n.jsx("span",{className:"text-xs font-bold mt-2",children:""})]}),n.jsx("div",{className:"absolute bottom-2 right-2 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-md",children:n.jsx(He,{size:14})})]}),n.jsx("input",{type:"file",ref:ee,className:"hidden",accept:"image/*",onChange:V})]}),n.jsxs("section",{className:"glass-card p-6 space-y-4",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:""}),n.jsxs("div",{children:[n.jsxs("label",{className:`${we} flex items-center gap-1`,children:["",P.title&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:l.title,onChange:k=>d(F=>({...F,title:k.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold ${P.title?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsx("label",{className:we,children:""}),n.jsx("input",{value:l.description,onChange:k=>d(F=>({...F,description:k.target.value})),type:"text",placeholder:"",className:"dream-input w-full px-4 py-3 text-sm"})]}),n.jsxs("div",{children:[n.jsx("label",{className:we,children:""}),n.jsxs("div",{onClick:()=>h(!0),className:"dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition",children:[l.tags.length===0&&n.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:""}),l.tags.map(k=>n.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",k,n.jsx(Qe,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:F=>{F.stopPropagation(),U(k)}})]},k)),n.jsx(wt,{className:"ml-auto text-purple-300",size:16})]})]})]}),n.jsxs("section",{className:"glass-card p-6 space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2 relative",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:""}),n.jsx("button",{onClick:()=>L(!0),className:"w-5 h-5 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center border border-purple-100",children:n.jsx(vs,{size:12})})]}),n.jsx("button",{onClick:()=>y(!0),className:"text-xs bg-purple-100 text-purple-600 px-3 py-1.5 rounded-full font-bold hover:bg-purple-200 transition",children:"+ "}),C&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[60]",onClick:()=>L(!1)}),n.jsxs("div",{ref:M,className:"absolute left-0 top-8 z-[61] bg-white rounded-2xl shadow-xl border border-slate-100 p-3 w-[88%]",children:[n.jsx("div",{className:"text-xs text-slate-700 font-kosugi",children:""}),n.jsx("div",{className:"text-[10px] text-slate-400 mt-1 font-kosugi",children:""})]})]})]}),l.roles.length===0?n.jsx("div",{className:"text-center py-6 text-slate-400 text-xs border border-dashed border-purple-200 rounded-xl",children:""}):n.jsx("div",{className:"flex flex-col divide-y divide-slate-200",children:l.roles.map(k=>n.jsxs("div",{className:"flex items-center gap-3 bg-white/60 py-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden",children:k.avatar?n.jsx("img",{src:k.avatar,alt:k.name,className:"w-full h-full object-cover"}):n.jsx("span",{className:"text-sm font-bold text-slate-500",children:(k.name||"?")[0]})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-700 text-sm",children:k.name}),n.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:k.description})]}),n.jsx("button",{onClick:()=>Z(k.name),className:"text-slate-400 hover:text-red-400 p-2",children:n.jsx(Xi,{size:16})})]},k.name))})]}),n.jsxs("section",{className:"glass-card p-6 h-auto min-h-[300px] flex flex-col",children:[n.jsxs("div",{className:"section-title !font-kosugi !text-purple-900 mb-4 flex items-center gap-1",children:["",P.content&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:l.content,onChange:k=>d(F=>({...F,content:k.target.value})),placeholder:"...",className:`flex-1 w-full bg-transparent border-none outline-none resize-none text-slate-700 leading-relaxed text-base min-h-[200px] placeholder:text-slate-300 ${P.content?"border-red-300 bg-red-50":""}`})]})]}),n.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-none md:rounded-b-3xl shadow-2xl",children:n.jsxs("button",{onClick:oe,disabled:_!=="none",className:`w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition flex items-center justify-center gap-2 ${_!=="none"?"opacity-70 cursor-not-allowed":""}`,children:[n.jsx(Yi,{size:18})," ",_==="publish"?"...":""]})}),u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>h(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[70vh] animate-in slide-in-from-bottom duration-300",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[n.jsx("button",{onClick:()=>h(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:n.jsx(jt,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:""}),n.jsx("button",{onClick:()=>h(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[l.tags.length===0&&n.jsx("span",{className:"text-xs text-slate-400 self-center",children:""}),l.tags.map(k=>n.jsxs("button",{onClick:()=>U(k),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1",children:["#",k," ",n.jsx(Qe,{size:10,className:"opacity-80"})]},k))]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:A,onChange:k=>R(k.target.value),onKeyDown:k=>k.key==="Enter"&&K(),type:"text",placeholder:"",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),n.jsx("button",{onClick:K,className:"bg-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition",children:""})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:re.map(k=>n.jsxs("button",{onClick:()=>U(k),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis
                                            ${l.tags.includes(k)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",k]},k))})]})]})]})]}),p&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>y(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-[30px] overflow-hidden z-[62] flex flex-col h-[70vh] animate-in slide-in-from-bottom duration-300 shadow-[0_-10px_40px_rgba(0,0,0,0.1)]",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50",children:[n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:""}),n.jsx("button",{onClick:()=>y(!1),className:"p-2 bg-slate-100 rounded-full",children:n.jsx(Qe,{size:16})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:(B||[]).filter(k=>!l.roles.some(F=>F.name===k.name)).sort((k,F)=>k.isPrivate===F.isPrivate?0:k.isPrivate?-1:1).map(k=>n.jsxs("div",{onClick:()=>ne({name:k.name,avatar:k.avatar,oneLinePersona:k.desc,bio:k.desc}),className:"flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-2xl shadow-sm active:scale-[0.98] transition cursor-pointer hover:border-purple-200",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden",children:k.avatar?n.jsx("img",{src:k.avatar,alt:k.name,className:"w-full h-full object-cover"}):n.jsx("span",{className:"text-base font-bold text-slate-500",children:(k.name||"?")[0]})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-800",children:k.name}),n.jsx("div",{className:"text-xs text-slate-400 truncate w-48",children:k.desc})]}),k.isMine&&k.isPrivate&&n.jsx("span",{className:"text-pink-500 text-[10px] font-bold mr-2",children:""}),n.jsx("div",{className:"ml-auto bg-purple-50 text-purple-600 p-2 rounded-full",children:n.jsx(He,{size:16})})]},`imp_${k.id||k.name}`))})]})]}),N&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:n.jsx(vs,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:""}),n.jsx("button",{onClick:()=>j(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:""})]})})]})})},ch=({onLogin:e})=>{const[t,s]=f.useState(""),[i,r]=f.useState(""),[o,a]=f.useState(!1),[c,l]=f.useState(!1),[d,u]=f.useState(null),[h,p]=f.useState({height:"100%",top:0}),y=f.useRef(null),N=f.useRef(null),j=f.useRef(null);f.useEffect(()=>{const T=()=>{window.visualViewport&&p({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`})};return window.visualViewport&&(window.visualViewport.addEventListener("resize",T),window.visualViewport.addEventListener("scroll",T),T()),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",T),window.visualViewport.removeEventListener("scroll",T))}},[]),f.useEffect(()=>{var T;try{(T=N.current)==null||T.focus()}catch{}},[]);const P=async T=>{if(T.preventDefault(),u(null),!t.trim()||!i.trim()){u("");return}l(!0);try{const A=await Hu.login(t.trim(),i.trim());if(A!=null&&A.access_token)try{localStorage.setItem("user_access_token",A.access_token)}catch{}if(A!=null&&A.refresh_token)try{localStorage.setItem("user_refresh_token",A.refresh_token)}catch{}e()}catch{u("")}finally{l(!1)}};return n.jsx("div",{ref:y,className:"fixed left-0 w-full bg-primary-50 overflow-y-auto no-scrollbar scroll-smooth font-sans animate-in fade-in duration-700",style:{...h,overscrollBehavior:"none"},children:n.jsx("div",{className:"h-full w-full max-w-md mx-auto bg-white rounded-none md:rounded-3xl shadow-2xl border border-slate-200 overflow-hidden",children:n.jsx("div",{className:"min-h-full w-full flex flex-col px-8 py-10",children:n.jsxs("div",{className:"w-full flex flex-col items-center z-10 max-w-sm m-auto",children:[n.jsx("div",{className:"text-center mb-12",children:n.jsx("h1",{className:"text-[40px] font-extrabold text-[#A855F7] mb-0 tracking-tight font-sans",children:"YumeCrush"})}),n.jsxs("form",{onSubmit:P,className:"w-full space-y-5",children:[n.jsx("input",{type:"text",placeholder:"",value:t,onChange:T=>s(T.target.value),ref:N,className:"w-full h-[60px] px-6 rounded-2xl bg-white border border-[#F3F4F6] text-[#374151] placeholder:text-[#D1D5DB] outline-none focus:border-[#C084FC] focus:bg focus:ring-4 focus:ring-[#F3E8FF] transition-all text-[15px] font-medium shadow-sm"}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:o?"text":"password",placeholder:"",value:i,onChange:T=>r(T.target.value),ref:j,className:"w-full h-[60px] px-6 rounded-2xl bg border border-[#F3F4F6] text-[#374151] placeholder:text-[#D1D5DB] outline-none focus:border-[#C084FC] focus:bg focus:ring-4 focus:ring-[#F3E8FF] transition-all text-[15px] font-medium shadow-sm"}),n.jsx("button",{type:"button",onClick:()=>a(!o),className:"absolute right-5 top-1/2 -translate-y-1/2 text-[#9CA3AF] hover:text-[#C084FC] transition-colors",children:o?n.jsx(Ha,{size:20}):n.jsx(Ka,{size:20})})]}),d&&n.jsx("div",{className:"text-red-500 text-xs font-bold",children:d}),n.jsx("button",{type:"submit",disabled:c,className:`w-full h-[60px] ${c?"bg-[#A855F7]/70":"bg-[#A855F7] hover:bg-[#9333EA]"} text-white font-bold text-[16px] rounded-2xl shadow-[0_10px_30px_rgba(168,85,247,0.3)] active:scale-[0.98] transition-all mt-4`,children:c?"...":""})]})]})})})})},dh=e=>({id:typeof(e==null?void 0:e.mypage_id)=="number"?e.mypage_id:(e==null?void 0:e.id)??Date.now(),title:(e==null?void 0:e.mypage_title)??(e==null?void 0:e.title)??"",description:(e==null?void 0:e.mypage_description)??(e==null?void 0:e.description)??"",image:(e==null?void 0:e.mypage_image)??(e==null?void 0:e.image)??"",status:(e==null?void 0:e.mypage_status)??(e==null?void 0:e.status)??void 0,tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[]}),uh=async e=>{const t=new URLSearchParams;e&&t.set("includeDrafts",String(e.includeDrafts));const{authFetch:s}=await ue(async()=>{const{authFetch:a}=await import("./http-bwpcOK62.js");return{authFetch:a}},__vite__mapDeps([0,1,2,3])),i=await s(`/user/stories?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return(Array.isArray(r==null?void 0:r.items)?r.items:[]).map(dh)},Hi=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:r}=await import("./http-bwpcOK62.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/user/stories/${e}`);if(!s.ok)throw new Error("failed");const i=await s.json();return{id:(i==null?void 0:i.id)??e,title:(i==null?void 0:i.title)??"",description:(i==null?void 0:i.description)??"",image:(i==null?void 0:i.image)??"",user_avatar:(i==null?void 0:i.user_avatar)??"",status:(i==null?void 0:i.status)??void 0,content:(i==null?void 0:i.content)??"",publishDate:(i==null?void 0:i.publish_date)??void 0,tags:Array.isArray(i==null?void 0:i.tags)?i.tags:[],characterIds:Array.isArray(i==null?void 0:i.characterIds)?i.characterIds:[]}},hh=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:i}=await import("./http-bwpcOK62.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user/stories/${e}`,{method:"DELETE"})).ok)throw new Error("failed");return!0},fh=({avatar:e,name:t})=>{const[s,i]=f.useState(!1);return n.jsx("div",{className:"w-14 h-14 rounded-full bg-slate-100 flex-shrink-0 overflow-hidden border border-slate-50 flex items-center justify-center",children:!s&&e?n.jsx("img",{src:e,className:"w-full h-full object-cover",alt:t,onError:()=>i(!0)}):n.jsx("span",{className:"text-base font-bold text-slate-500",children:(t==null?void 0:t[0])||"?"})})},mh=({userProfile:e,myCharacters:t,myUserCharacters:s,myStories:i,onUpdateProfile:r,onCharacterClick:o,onLogout:a,onEditStory:c,onDeleteStory:l,onEditCharacter:d,onDeleteCharacter:u,onReadStory:h,onAddStory:p,onAddCharacter:y})=>{var X;const[N,j]=f.useState(!1),[P,T]=f.useState(e.nickname),[A,R]=f.useState(!1),[$,S]=f.useState(null),[C,L]=f.useState(!1),M=(navigator==null?void 0:navigator.maxTouchPoints)>0,[B,z]=f.useState(i||[]),[W,G]=f.useState({}),[ee,ce]=f.useState(null),re=f.useRef(0),de=f.useRef(0),V=f.useRef(null),U=f.useRef(0),[K,ne]=f.useState(s||[]),[Z,w]=f.useState({}),[_,D]=f.useState(null),Y=f.useRef(0),te=f.useRef(0),fe=f.useRef(null),oe=f.useRef(0),[se,we]=f.useState({visible:!1,x:0,y:0,id:null,type:null}),k=(g,E,O)=>{if(g.preventDefault(),M)return;let ie=g.clientX;const le=140;ie+le>window.innerWidth&&(ie=window.innerWidth-le-10),we({visible:!0,x:ie,y:g.clientY,id:E,type:O})},F=f.useRef(null),Q=g=>{var Dt;const E=g.split(","),O=((Dt=E[0].match(/:(.*?);/))==null?void 0:Dt[1])||"image/jpeg",ie=atob(E[1]);let le=ie.length;const _e=new Uint8Array(le);for(;le--;)_e[le]=ie.charCodeAt(le);return new Blob([_e],{type:O})},ae=()=>{var g;(g=F.current)==null||g.click()},he=g=>{var O;const E=(O=g.target.files)==null?void 0:O[0];if(E){const ie=new FileReader;ie.onloadend=()=>{S(ie.result)},ie.readAsDataURL(E)}F.current&&(F.current.value="")},pe=async()=>{const g=P.trim();if(!g){T(e.nickname),j(!1);return}try{const{authFetch:E}=await ue(async()=>{const{authFetch:O}=await import("./http-bwpcOK62.js");return{authFetch:O}},__vite__mapDeps([0,1,2,3]));await E("/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:g})}),r({...e,nickname:g})}catch{T(e.nickname)}j(!1)};f.useEffect(()=>{z(i||[])},[e.usedCount]),f.useEffect(()=>{z(i||[])},[i]),f.useEffect(()=>{ne(s||[])},[s]);const Ce=(g,E)=>{re.current=g.touches[0].clientX,de.current=g.touches[0].clientY,V.current=E,U.current=W[E]||0},ke=(g,E)=>{if(V.current!==E)return;const O=g.touches[0].clientX-re.current,ie=g.touches[0].clientY-de.current;if(Math.abs(ie)>Math.abs(O))return;let le=0;U.current===0?le=Math.max(-96,Math.min(96,O)):U.current>0?le=Math.max(0,Math.min(96,U.current+O)):le=Math.min(0,Math.max(-96,U.current+O)),G(_e=>({..._e,[E]:le}))},je=g=>{if(V.current!==g)return;const E=W[g]||0;let O=0;U.current===0?O=E>60?96:E<-60?-96:0:U.current>0?O=E>60?96:0:O=E<-60?-96:0,G(ie=>({...ie,[g]:O})),V.current=null},Ae=g=>G(E=>({...E,[g]:0})),Pe=(g,E)=>{Y.current=g.touches[0].clientX,te.current=g.touches[0].clientY,fe.current=E,oe.current=Z[E]||0},v=(g,E)=>{if(fe.current!==E)return;const O=g.touches[0].clientX-Y.current,ie=g.touches[0].clientY-te.current;if(Math.abs(ie)>Math.abs(O))return;let le=0;oe.current===0?le=Math.max(-96,Math.min(96,O)):oe.current>0?le=Math.max(0,Math.min(96,oe.current+O)):le=Math.min(0,Math.max(-96,oe.current+O)),w(_e=>({..._e,[E]:le}))},I=g=>{if(fe.current!==g)return;const E=Z[g]||0;let O=0;oe.current===0?O=E>60?96:E<-60?-96:0:oe.current>0?O=E>60?96:0:O=E<-60?-96:0,w(ie=>({...ie,[g]:O})),fe.current=null},m=g=>w(E=>({...E,[g]:0})),x=g=>{Ae(g.id),c&&c(g)},b=async g=>{const E=B.find(O=>O.id===g);if(ce(null),l&&E){l(E);return}try{await hh(g),z(O=>O.filter(ie=>ie.id!==g))}catch{}},q=g=>{m(g.id),d&&d(g)},H=async g=>{const E=K.find(O=>O.id===g);D(null),u&&E&&u(E);try{await ah(g),ne(O=>O.filter(ie=>ie.id!==g)),u&&E&&u(E)}catch{}};return n.jsxs("div",{className:"h-full w-full bg-[#F8F9FB] flex flex-col font-kosugi relative",children:[$&&n.jsx(ns,{imageSrc:$,onCancel:()=>S(null),onCrop:async g=>{const E=localStorage.getItem("user_access_token");let O=g;try{if(g&&g.startsWith("data:image")){const ie=Q(g),le=new FormData,_e=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;le.append("avatar",ie,"avatar.jpg"),le.append("filename",_e),O=`/uploads/users/avatars/${_e}`,await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:E?`Bearer ${E}`:""},body:le}).catch(()=>{})}}catch{}try{const{authFetch:ie}=await ue(async()=>{const{authFetch:le}=await import("./http-bwpcOK62.js");return{authFetch:le}},__vite__mapDeps([0,1,2,3]));await ie("/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:O})})}catch{}r({...e,avatar:O||e.avatar}),S(null)}}),n.jsxs("div",{className:"relative pb-4",children:[n.jsxs("div",{className:"h-40 bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 rounded-b-[40px] relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-[-20px] left-[-20px] w-40 h-40 bg-white/20 rounded-full blur-xl"}),n.jsx("div",{className:"absolute bottom-[-10px] right-[-10px] w-32 h-32 bg-purple-400/20 rounded-full blur-xl"})]}),n.jsxs("div",{className:"absolute top-16 left-4 right-4 bg-white rounded-3xl shadow-lg p-4 flex flex-col items-center animate-in slide-in-from-bottom-4 duration-500",children:[n.jsxs("div",{className:"relative -mt-12 mb-2 group cursor-pointer",onClick:ae,children:[n.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white shadow-md overflow-hidden bg-slate-100 flex items-center justify-center",children:!C&&(e.avatar||!0)?n.jsx("img",{src:e.avatar||"/uploads/avatars/default_avatar.jpg",alt:"Me",className:"w-full h-full object-cover",onError:()=>L(!0)}):n.jsx("span",{className:"text-xl font-bold text-slate-500",children:((X=e.nickname)==null?void 0:X[0])||"?"})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-primary-500 p-1.5 rounded-full text-white border-2 border-white shadow-sm",children:n.jsx(Fs,{size:10})}),n.jsx("input",{type:"file",ref:F,className:"hidden",accept:"image/*",onChange:he})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[N?n.jsx("input",{value:P,onChange:g=>T(g.target.value),onBlur:pe,onKeyDown:g=>g.key==="Enter"&&pe(),autoFocus:!0,className:"text-lg font-bold text-center text-slate-800 border-b-2 border-primary-300 outline-none bg-transparent min-w-[100px]"}):n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:e.nickname}),!N&&n.jsx("button",{onClick:()=>j(!0),className:"text-slate-400 hover:text-primary-500",children:n.jsx(Tn,{size:12})})]}),n.jsx("div",{className:"flex flex-col items-center gap-1 mb-1",children:n.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-[10px] font-bold bg-slate-50 px-3 py-0.5 rounded-full",children:[n.jsx(to,{size:10}),n.jsx("span",{className:"tracking-wide",children:e.email})]})})]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-24 space-y-6 no-scrollbar mt-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-1 h-4 bg-indigo-400 rounded-full"}),n.jsx("h3",{className:"font-bold text-slate-700",children:""})]}),n.jsx("button",{onClick:p,className:"w-6 h-6 flex items-center justify-center rounded-full bg-white text-purple-500 border border-purple-100 shadow-sm hover:bg-purple-50 active:scale-95",children:n.jsx(He,{size:14})})]}),B&&B.length>0?n.jsx("div",{className:"flex flex-col gap-3",children:B.map(g=>n.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[(()=>{const E=W[g.id]||0,O=Math.min(96,Math.max(0,-E)),ie=Math.min(96,Math.max(0,E));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${O}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>ce(g.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-2xl shadow-sm",style:{width:`${ie}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>x(g),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onTouchStart:E=>Ce(E,g.id),onTouchMove:E=>ke(E,g.id),onTouchEnd:()=>je(g.id),onContextMenu:E=>k(E,g.id,"story"),onClick:()=>{(W[g.id]||0)===0&&h&&h(g)},style:{transform:`translateX(${W[g.id]||0}px)`,transition:"transform 180ms ease"},className:`${(W[g.id]||0)<0?"rounded-l-2xl rounded-r-none":(W[g.id]||0)>0?"rounded-l-none rounded-r-2xl":"rounded-2xl"} bg-white p-3 shadow-sm flex gap-4 border border-transparent hover:border-indigo-100 group relative overflow-hidden`,children:[n.jsx("div",{className:"w-16 h-20 rounded-xl bg-slate-100 flex-shrink-0 overflow-hidden relative",children:n.jsx("img",{src:g.image||"/uploads/covers/default_storyimg.jpg",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:g.title})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:"font-bold text-slate-800 text-base",children:g.title}),n.jsx("div",{className:"flex flex-col items-end gap-0.5",children:n.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${g.status==="published"?"bg-green-100 text-green-600":"bg-slate-100 text-slate-400"}`,children:g.status==="published"?"":""})})]}),n.jsx("p",{className:"text-xs text-slate-400 line-clamp-1",children:g.description}),n.jsx("div",{className:"flex gap-2 mt-2",children:(g.tags||[]).slice(0,2).map(E=>n.jsx("span",{className:"text-[10px] bg-slate-50 text-slate-400 px-1.5 py-0.5 rounded",children:E},E))})]}),n.jsx("div",{className:"self-center",children:n.jsx(lo,{size:16,className:"text-slate-300"})})]})]},g.id))}):n.jsx("div",{className:"bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-50 border-dashed",children:n.jsx("p",{className:"text-xs text-slate-400",children:""})})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-1 h-4 bg-purple-400 rounded-full"}),n.jsx("h3",{className:"font-bold text-slate-700",children:""})]}),n.jsx("button",{onClick:y,className:"w-6 h-6 flex items-center justify-center rounded-full bg-white text-purple-500 border border-purple-100 shadow-sm hover:bg-purple-50 active:scale-95",children:n.jsx(He,{size:14})})]}),K.length>0?n.jsx("div",{className:"flex flex-col gap-3",children:K.map(g=>n.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[(()=>{const E=Z[g.id]||0,O=Math.min(96,Math.max(0,-E)),ie=Math.min(96,Math.max(0,E));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${O}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>D(g.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-2xl shadow-sm",style:{width:`${ie}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>q(g),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onClick:()=>o(g),onTouchStart:E=>Pe(E,g.id),onTouchMove:E=>v(E,g.id),onTouchEnd:()=>I(g.id),onContextMenu:E=>k(E,g.id,"character"),style:{transform:`translateX(${Z[g.id]||0}px)`,transition:"transform 180ms ease"},className:`${(Z[g.id]||0)<0?"rounded-l-2xl rounded-r-none":(Z[g.id]||0)>0?"rounded-l-none rounded-r-2xl":"rounded-2xl"} bg-white p-3 shadow-sm flex items-center gap-4 active:scale-[0.98] transition-all cursor-pointer border border-transparent hover:border-purple-100 group relative overflow-hidden`,children:[n.jsx(fh,{avatar:g.avatar,name:g.name}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:"font-bold text-slate-800",children:g.name}),n.jsx("div",{className:"flex flex-col items-end gap-0.5",children:n.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${g.isPublished?g.isPublic?"bg-green-100 text-green-600":"bg-pink-100 text-pink-600":"bg-slate-100 text-slate-400"}`,children:g.isPublished?g.isPublic?"":"":""})})]}),n.jsx("p",{className:"text-xs text-slate-400 truncate mt-1",children:g.oneLinePersona||g.bio})]}),n.jsx(wt,{size:16,className:"text-slate-300"})]})]},g.id))}):n.jsx("div",{className:"bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-50 border-dashed",children:n.jsx("p",{className:"text-xs text-slate-400",children:""})})]}),n.jsx("div",{className:"bg-white rounded-3xl shadow-sm p-2",children:n.jsxs("button",{onClick:()=>R(!0),className:"w-full flex items-center justify-center gap-3 p-2 hover:bg-red-50 active:bg-red-100 active:scale-95 rounded-2xl transition-all group",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-red-50 text-red-400 flex items-center justify-center group-hover:bg-red-100 group-hover:text-red-500 transition-colors",children:n.jsx(Sn,{size:16})}),n.jsx("span",{className:"text-center font-bold text-slate-700 text-sm group-hover:text-red-500",children:""})]})})]}),A&&n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-[32px] p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-50 text-red-400 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Sn,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:""}),n.jsx("p",{className:"text-xs text-slate-400 mb-6 px-4 leading-relaxed"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>R(!1),className:"flex-1 py-3 rounded-2xl bg-slate-100 text-slate-600 font-bold hover:bg-slate-200 transition-colors text-sm",children:""}),n.jsx("button",{onClick:a,className:"flex-1 py-3 rounded-2xl bg-red-500 text-white font-bold shadow-lg shadow-red-200 hover:bg-red-600 transition-colors text-sm",children:""})]})]})}),ee&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{ee!=null&&Ae(ee),ce(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{b(ee)},children:""})]})]})}),n.jsx("style",{children:`
            @keyframes fadeCard { from { opacity: 0; transform: translateY(-6px) } to { opacity: 1; transform: translateY(0) } }
            @keyframes fadeBg { from { opacity: 0 } to { opacity: 1 } }
          `})]}),_&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{_!=null&&m(_),D(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{H(_)},children:""})]})]})})]}),se.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>we(g=>({...g,visible:!1})),onContextMenu:g=>{g.preventDefault(),we(E=>({...E,visible:!1}))}}),n.jsxs("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95 duration-100",style:{top:se.y,left:se.x},children:[n.jsxs("button",{onClick:()=>{if(se.type==="story"){const g=B.find(E=>E.id===se.id);g&&x(g)}else if(se.type==="character"){const g=K.find(E=>E.id===se.id);g&&q(g)}we(g=>({...g,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50 flex items-center gap-2 transition-colors",children:[n.jsx(Tn,{size:16,className:"text-indigo-500"}),""]}),n.jsx("div",{className:"h-[1px] bg-slate-100 w-full"}),n.jsxs("button",{onClick:()=>{se.type==="story"?ce(se.id):se.type==="character"&&D(se.id),we(g=>({...g,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 flex items-center gap-2 transition-colors",children:[n.jsx(Xi,{size:16}),""]})]})]})]})},ph=async e=>{const t=new URLSearchParams;t.set("limit",String(e.limit));const{authFetch:s}=await ue(async()=>{const{authFetch:a}=await import("./http-bwpcOK62.js");return{authFetch:a}},__vite__mapDeps([0,1,2,3])),i=await s(`/stories/?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return Array.isArray(r==null?void 0:r.items)?r.items:[]},xh=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:r}=await import("./http-bwpcOK62.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/stories/${e}`);if(!s.ok)throw new Error("failed");return await s.json()},gh=({story:e,onBack:t,onStartRoleplay:s,connectedRoleNames:i=[],validRoleNames:r=[]})=>{const o=f.useRef(null),a=f.useRef(null),[c,l]=f.useState(20),[d,u]=f.useState(0),[h,p]=f.useState(!1),[y,N]=f.useState(!1),[j,P]=f.useState(null),[T,A]=f.useState(!1),R=f.useRef(0),$=f.useRef(0),S=f.useCallback(()=>{if(!o.current||!a.current)return;const{scrollTop:z,scrollHeight:W,clientHeight:G}=o.current,ee=a.current.clientHeight;if(W<=G){l(ee),u(0);return}const ce=G/W,re=Math.max(ce*ee,30);l(re);const de=W-G,V=ee-re,U=z/de;u(U*V)},[]);f.useEffect(()=>{const z=new ResizeObserver(()=>{S()});o.current&&z.observe(o.current),a.current&&z.observe(a.current);const W=setTimeout(S,100);return()=>{z.disconnect(),clearTimeout(W)}},[S]);const C=z=>{z.preventDefault(),z.stopPropagation(),p(!0);const W="touches"in z?z.touches[0].clientX:z.clientY;R.current=W,$.current=d};f.useEffect(()=>{const z=G=>{if(!h||!o.current||!a.current)return;G.preventDefault();const ce=("touches"in G?G.touches[0].clientY:G.clientY)-R.current,de=a.current.clientHeight-c,V=o.current.scrollHeight-o.current.clientHeight;if(de<=0)return;let U=$.current+ce;U=Math.max(0,Math.min(U,de));const K=U/de;o.current.scrollTop=K*V},W=()=>{p(!1)};return h&&(document.addEventListener("mousemove",z),document.addEventListener("mouseup",W),document.addEventListener("touchmove",z,{passive:!1}),document.addEventListener("touchend",W)),()=>{document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",W),document.removeEventListener("touchmove",z),document.removeEventListener("touchend",W)}},[h,c]);const L=()=>{if(j){if(i.includes(j)){A(!0);return}const z=(e.availableRoles||[]).find(W=>W.name===j);z&&s(z)}},M=e.content.split(`
`).filter(z=>z.trim()!==""),B=(e.availableRoles||[]).filter(z=>r&&r.length?r.includes(z.name):!0);return n.jsxs("div",{className:"fixed inset-0 bg-white z-[60] flex flex-col h-full w-full animate-in slide-in-from-right duration-300",children:[n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col relative bg-white rounded-none md:rounded-3xl md:overflow-hidden shadow-2xl",children:[n.jsx("button",{onClick:t,className:"absolute top-4 left-4 z-[100] w-10 h-10 bg-black/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(Xt,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar bg-[#FAFAFA]",onScroll:S,ref:o,children:[n.jsxs("div",{className:"w-full h-64 relative",children:[n.jsx("img",{src:e.image||"/uploads/covers/default_storyimg.jpg",alt:e.title,className:"w-full h-full object-cover"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#FAFAFA] to-transparent"})]}),n.jsxs("div",{className:"px-6 -mt-12 relative z-10 pb-20",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4 leading-tight",children:e.title}),n.jsxs("div",{className:"flex items-center mt-2",children:[n.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-200 overflow-hidden border border-white shadow-sm mr-3",children:n.jsx("img",{src:e.user_avatar||`https://api.dicebear.com/7.x/miniavs/svg?seed=${e.author}`,alt:"author",className:"w-full h-full object-cover"})}),n.jsx("span",{className:"text-sm font-bold text-slate-700",children:e.author})]})]}),n.jsx("article",{className:"prose prose-slate max-w-none",children:M.map((z,W)=>n.jsx("p",{className:"mb-6 text-justify tracking-wide text-[16px]",style:{lineHeight:1.8,color:"#334155"},children:z},W))}),n.jsx("div",{className:"flex items-center justify-center my-10",children:n.jsx("span",{className:"text-slate-400/80 text-sm font-medium tracking-widest",children:"  "})}),n.jsx("div",{className:"mb-12 flex flex-wrap gap-4 pl-1",children:e.tags.map(z=>n.jsxs("span",{className:"text-sm text-slate-400",children:["#",z]},z))}),B.length>0&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-6 py-3 bg-purple-100 rounded-full shadow-lg shadow-purple-200/50 hover:bg-purple-200 transition-all active:scale-95 cursor-pointer",children:[n.jsx("span",{className:"text-lg font-bold text-purple-600 tracking-widest",children:""}),n.jsx(Va,{size:18,className:"text-purple-600"})]})})]})]}),n.jsx("div",{ref:a,className:"absolute right-1 top-4 bottom-4 w-1.5 z-[70]",children:n.jsx("div",{className:"w-full rounded-full cursor-pointer transition-colors duration-200 bg-slate-400/40 hover:bg-slate-400/60",style:{height:`${c}px`,transform:`translateY(${d}px)`,touchAction:"none"},onMouseDown:C,onTouchStart:C})})]}),y&&n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:n.jsxs("div",{className:"bg-white w-[85%] max-w-sm rounded-[32px] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300",children:[n.jsxs("div",{className:"p-6 pb-2",children:[n.jsx("h3",{className:"text-xl font-bold text-slate-900 text-center mb-6 font-kosugi",children:""}),n.jsx("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto no-scrollbar py-2 px-1",children:B.length>0?B.map(z=>{const W=j===z.name,G=i.includes(z.name);return n.jsxs("div",{onClick:()=>P(z.name),className:`
                                            relative p-4 rounded-2xl flex items-center justify-between cursor-pointer transition-all border-2
                                            ${W?"bg-purple-50 border-purple-500 shadow-md scale-[1.02]":"bg-slate-50 border-transparent hover:bg-slate-100"}
                                        `,children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:`font-bold text-base ${W?"text-purple-700":"text-slate-800"}`,children:z.name}),G&&n.jsx("span",{className:"text-[10px] text-green-500 font-bold mt-1",children:" "})]}),W&&n.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center text-white shadow-sm",children:n.jsx(qi,{size:12,strokeWidth:3})})]},z.name)}):n.jsx("p",{className:"text-center text-slate-400 py-4 text-sm",children:""})})]}),n.jsx("div",{className:"p-6 pt-2 bg-gradient-to-t from-white via-white to-transparent",children:n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>N(!1),className:"flex-1 py-3.5 rounded-2xl border border-slate-200 font-bold text-slate-500 hover:bg-slate-50 text-sm",children:""}),n.jsx("button",{onClick:L,disabled:!j,className:`
                                   flex-1 py-3.5 rounded-2xl font-bold text-white text-sm shadow-lg transition-all flex items-center justify-center gap-2
                                   ${j?"bg-purple-600 shadow-purple-200 hover:bg-purple-700 active:scale-95":"bg-slate-300 shadow-none cursor-not-allowed"}
                               `,children:""})]})})]})}),T&&n.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center text-center",children:[n.jsx("div",{className:"w-12 h-12 bg-purple-100 text-purple-500 rounded-full flex items-center justify-center mb-4",children:n.jsx(Gi,{size:24})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 mb-6 font-kosugi",children:""}),n.jsx("button",{onClick:()=>A(!1),className:"w-full py-3 rounded-2xl bg-purple-600 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-700 transition-colors text-sm font-kosugi",children:""})]})})]})},_a=e=>({id:(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.character_id)??String(Date.now()),name:(e==null?void 0:e.name)??(e==null?void 0:e.title)??"",avatar:(e==null?void 0:e.avatar)??(e==null?void 0:e.cover)??(e==null?void 0:e.image)??"",profileImage:(e==null?void 0:e.profileImage)??(e==null?void 0:e.banner)??(e==null?void 0:e.image)??"",bio:(e==null?void 0:e.bio)??(e==null?void 0:e.tagline)??(e==null?void 0:e.description)??"",tags:(e==null?void 0:e.tags)??(e==null?void 0:e.keywords)??[],creator:(e==null?void 0:e.creator)??(e==null?void 0:e.author)??"",oneLinePersona:(e==null?void 0:e.oneLinePersona)??(e==null?void 0:e.tagline)??"",personality:(e==null?void 0:e.personality)??(e==null?void 0:e.personality)??"",profession:(e==null?void 0:e.profession)??(e==null?void 0:e.occupation)??"",age:(e==null?void 0:e.age)??"",roleType:(e==null?void 0:e.roleType)??(e==null?void 0:e.character_type)??"",currentRelationship:(e==null?void 0:e.currentRelationship)??(e==null?void 0:e.relationship)??"",plotTheme:(e==null?void 0:e.plotTheme)??(e==null?void 0:e.plot_theme)??"",plotDescription:(e==null?void 0:e.plotDescription)??(e==null?void 0:e.plot_summary)??"",openingLine:(e==null?void 0:e.openingLine)??(e==null?void 0:e.opening_line)??""}),yh=async e=>{const t=new URLSearchParams;e!=null&&e.tag&&t.set("tag",e.tag),t.set("limit",String(e.limit));const{authFetch:s}=await ue(async()=>{const{authFetch:a}=await import("./http-bwpcOK62.js");return{authFetch:a}},__vite__mapDeps([0,1,2,3])),i=await s(`/characters/?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return(Array.isArray(r==null?void 0:r.items)?r.items:[]).map(_a)},Wi=async e=>{const{authFetch:t}=await ue(async()=>{const{authFetch:r}=await import("./http-bwpcOK62.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/characters/${e}`);if(!s.ok)throw new Error("failed");const i=await s.json();return _a(i)},vh=[],bh=({char:e})=>{var i;const[t,s]=f.useState(!1);return n.jsx("div",{className:"w-20 h-28 flex-shrink-0 rounded-xl overflow-hidden bg-slate-100 relative group flex items-center justify-center",children:!t&&e.avatar?n.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",onError:()=>s(!0)}):n.jsx("span",{className:"text-2xl font-bold text-slate-500",children:((i=e.name)==null?void 0:i[0])||"?"})})},wh=()=>{const[e,t]=f.useState(xe.HOME),[s,i]=f.useState(vh),[r,o]=f.useState([]),[a,c]=f.useState(!1),[l,d]=f.useState(null),[u,h]=f.useState(null),[p,y]=f.useState("stories"),[N,j]=f.useState(!1),[P,T]=f.useState(void 0),[A,R]=f.useState(!1),[$,S]=f.useState(!1),[C,L]=f.useState(null),[M,B]=f.useState(null),[z,W]=f.useState([]),[G,ee]=f.useState(null),[ce,re]=f.useState([]),[de,V]=f.useState(null),[U,K]=f.useState([]),[ne,Z]=f.useState(!!localStorage.getItem("user_access_token")),[w,_]=f.useState(()=>{const v=localStorage.getItem("user_nickname")||"",I=localStorage.getItem("user_email")||"me@example.com",m=localStorage.getItem("user_avatar")||"";return{nickname:v,email:I,avatar:m}}),[D,Y]=f.useState(!1),[te,fe]=f.useState(!1),[oe,se]=f.useState([]),[we,k]=f.useState(!1),[F,Q]=f.useState({height:"100%",top:0}),ae=()=>{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token"),localStorage.removeItem("user_nickname"),localStorage.removeItem("user_email"),localStorage.removeItem("user_avatar"),T(void 0),d(null),h(null),t(xe.HOME),Z(!1)};if(f.useEffect(()=>{ne&&((async()=>{try{const{authFetch:v}=await ue(async()=>{const{authFetch:m}=await import("./http-bwpcOK62.js");return{authFetch:m}},__vite__mapDeps([0,1,2,3])),I=await v("/user/profile");if(I&&I.ok){const m=await I.json(),x=(m==null?void 0:m.nickname)||"",b=(m==null?void 0:m.email)||"me@example.com",q=(m==null?void 0:m.avatar)||"",H=typeof(m==null?void 0:m.used_count)=="number"?m.used_count:0;_({nickname:x,email:b,avatar:q,usedCount:H});try{localStorage.setItem("user_nickname",x),localStorage.setItem("user_email",b),q&&localStorage.setItem("user_avatar",q);const X=(m==null?void 0:m.id)??(m==null?void 0:m.user_id)??(m==null?void 0:m.uid);X!=null&&localStorage.setItem("user_id",String(X))}catch{}}}catch{}})(),(async()=>{try{const v=await ph({limit:12});W(v)}catch{W([])}})(),c(!0),yh({limit:24}).then(v=>{const I=v.map(m=>({id:String(m.id),name:m.name||"",avatar:m.avatar||"",profileImage:m.profileImage||"",status:Ue.ONLINE,bio:m.bio||"",tags:Array.isArray(m.tags)?m.tags:[],creator:m.creator||"",oneLinePersona:m.oneLinePersona||"",personality:m.personality||"",profession:m.profession||"",age:m.age||"",roleType:m.roleType||"",currentRelationship:m.currentRelationship||"",plotTheme:m.plotTheme||"",plotDescription:m.plotDescription||"",openingLine:m.openingLine||""}));o(I);try{const m=[],x=localStorage.getItem("user_id")||"0";if(!x||x==="0"){i([]);return}Object.keys(localStorage).filter(H=>H.startsWith(`chat_history_${x}_`)).forEach(H=>{const X=H.replace(`chat_history_${x}_`,""),g=I.find(Dt=>String(Dt.id)===String(X));if(!g)return;const E=localStorage.getItem(H);if(!E)return;const O=JSON.parse(E);if(!O.length||!!!localStorage.getItem(`chat_session_${x}_${X}`))return;const le=O[O.length-1],_e={id:le.id,senderId:le.senderId,text:le.text,timestamp:new Date(le.ts),type:le.type};m.push({characterId:String(X),character:g,lastMessage:_e,unreadCount:0})}),m.length&&i(m)}catch{}}).catch(()=>o([])).finally(()=>c(!1)),(async()=>{try{const v=await th(),m=(Array.isArray(v)?v.filter(x=>typeof(x==null?void 0:x.mypage_id)<"u"&&typeof(x==null?void 0:x.mypage_name)=="string"&&typeof(x==null?void 0:x.mypage_visibility)=="string"&&typeof(x==null?void 0:x.mypage_status)=="string"):[]).map(x=>({id:String(x.mypage_id),name:x.mypage_name||"",avatar:x.mypage_avatar||"",profileImage:"",status:Ue.ONLINE,bio:"",tags:[],creator:w.nickname||"",oneLinePersona:x.mypage_tagline||"",personality:"",profession:"",age:"",roleType:"",gender:"",currentRelationship:"",plotTheme:"",plotDescription:"",openingLine:"",styleExamples:[],hobbies:"",experiences:"",isPublic:x.mypage_visibility?x.mypage_visibility==="public":!1,isPublished:x.mypage_status==="published"}));se(m)}catch{se([])}})(),(async()=>{try{const I=(await uh({includeDrafts:!0})).map(m=>({id:typeof m.id=="number"?m.id:Number(Date.now()),title:m.title||"",description:m.description||"",image:m.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(m.tags)?m.tags:[],author:w.nickname||"",likes:"0",content:"",status:m.status}));re(I)}catch{re([])}})())},[ne]),f.useEffect(()=>{if(!((navigator==null?void 0:navigator.maxTouchPoints)>0))return;const I=document.querySelector('meta[name="viewport"]'),m=(I==null?void 0:I.getAttribute("content"))||"";I&&I.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no");let b=0;const q=H=>{const X=Date.now();X-b<=300&&H.preventDefault(),b=X};return document.addEventListener("touchend",q,{passive:!1}),document.body.style.touchAction="manipulation",()=>{I&&I.setAttribute("content",m),document.removeEventListener("touchend",q),document.body.style.touchAction=""}},[]),f.useEffect(()=>{const v=()=>{window.visualViewport&&Q({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`})};window.visualViewport&&(window.visualViewport.addEventListener("resize",v),window.visualViewport.addEventListener("scroll",v),v());const I=()=>{window.visualViewport||Q({height:window.innerHeight,top:0})};return window.addEventListener("resize",I),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",v),window.visualViewport.removeEventListener("scroll",v)),window.removeEventListener("resize",I)}},[]),f.useEffect(()=>{const v=()=>{const m=window.visualViewport&&window.visualViewport.height?window.visualViewport.height:window.innerHeight;document.documentElement.style.setProperty("--vh",`${m*.01}px`)};v();const I=()=>v();return window.addEventListener("resize",I),window.visualViewport&&window.visualViewport.addEventListener("resize",I),()=>{window.removeEventListener("resize",I),window.visualViewport&&window.visualViewport.removeEventListener("resize",I)}},[]),!ne)return n.jsx(Bi,{children:n.jsx("div",{className:"fixed inset-0 w-full bg-primary-50 overflow-hidden",style:{height:"calc(var(--vh) * 100)",overscrollBehavior:"none"},children:n.jsx("div",{className:"h-full w-full max-w-md mx-auto bg relative shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden flex",children:n.jsx(ch,{onLogin:()=>Z(!0)})})})});const he=v=>{try{const m=`chat_history_${localStorage.getItem("user_id")||"0"}_${v.characterId}`,x=localStorage.getItem(m);if(x){const q=JSON.parse(x).map(H=>({id:H.id,senderId:H.senderId,text:H.text,timestamp:new Date(H.ts),type:H.type,quote:H.quote,read:H.read}));if(q.length)return q}}catch{}return[]},pe=v=>{l&&i(I=>I.map(m=>m.characterId===l.characterId?{...m,lastMessage:v,unreadCount:0}:m))},Ce=v=>{i(I=>I.map(m=>m.characterId===v?{...m,character:{...m.character,isPinned:!m.character.isPinned}}:m))},ke=async v=>{const I=s.find(m=>m.characterId===v.id);if(I){h(null),k(!1),d(I),t(xe.CHAT);return}try{const m=localStorage.getItem("user_id")||"0",x=`chat_session_${m}_${v.id}`;let b=localStorage.getItem(x)||"";b||(b=(await Vs(v.id)).sessionId,localStorage.setItem(x,b));const q=v.openingLine||v.oneLinePersona||"",H=`msg_${Date.now()}`,X={id:H,senderId:v.id,text:q,timestamp:new Date,type:Ze.TEXT};try{const E=`chat_history_${m}_${v.id}`,O={id:H,senderId:v.id,text:q,ts:Date.now(),type:Ze.TEXT};localStorage.setItem(E,JSON.stringify([O]))}catch{}const g={characterId:v.id,character:v,lastMessage:X,unreadCount:0};i(E=>[g,...E]),h(null),k(!1),d(g),t(xe.CHAT)}catch{const m=v.openingLine||v.oneLinePersona||"",x=`msg_${Date.now()}`,b={id:x,senderId:v.id,text:m,ts:Date.now(),type:Ze.TEXT};try{const X=`chat_history_${localStorage.getItem("user_id")||"0"}_${v.id}`;localStorage.setItem(X,JSON.stringify([b]))}catch{}const q={characterId:v.id,character:v,lastMessage:{id:x,senderId:v.id,text:m,timestamp:new Date,type:Ze.TEXT},unreadCount:0};i(H=>[q,...H]),h(null),k(!1),d(q),t(xe.CHAT)}},je=v=>{R(!1),B({character:v,id:String(v.id)})},Ae=()=>n.jsxs("div",{className:"flex items-center gap-5",children:[n.jsxs("button",{onClick:()=>y("stories"),className:`relative transition-all duration-300 ${p==="stories"?"text-slate-800 font-extrabold text-2xl scale-105":"text-slate-400 font-semibold text-lg hover:text-slate-600"}`,children:["",p==="stories"&&n.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-1 bg-primary-500 rounded-full"})]}),n.jsx("div",{className:"h-5 w-[1px] bg-slate-300/50 rounded-full"}),n.jsxs("button",{onClick:()=>y("characters"),className:`relative transition-all duration-300 ${p==="characters"?"text-slate-800 font-extrabold text-2xl scale-105":"text-slate-400 font-semibold text-lg hover:text-slate-600"}`,children:["",p==="characters"&&n.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-1 bg-primary-500 rounded-full"})]})]}),Pe=()=>{switch(e){case xe.HOME:return n.jsx("div",{className:"px-6 pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:p==="stories"?n.jsxs("div",{className:"space-y-6 mt-2",children:[z.map(v=>n.jsxs("div",{className:"group relative bg-white rounded-3xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer border border-transparent hover:border-primary-100 hover:-translate-y-0.5 duration-200",onClick:async()=>{try{const I=v;if(typeof(I==null?void 0:I.content)=="string"&&I.content.length){const m={id:typeof v.id=="number"?v.id:Number(Date.now()),title:v.title,description:v.description||"",image:v.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(v.tags)?v.tags:[],author:v.author||w.nickname||"",likes:"0",content:I.content,publishDate:I.publishDate||void 0,status:I.status,availableRoles:Array.isArray(I.availableRoles)?I.availableRoles:[]};ee(m)}else{const m=await xh(v.id),x={id:Number(m.id),title:m.title,description:m.description||"",image:m.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(m.tags)?m.tags:[],author:m.author||"",user_avatar:(m==null?void 0:m.user_avatar)||"",likes:"",content:m.content||"",publishDate:m.publish_date||void 0,availableRoles:Array.isArray(m==null?void 0:m.roles)?m.roles.map(b=>({id:b.id,name:b.name,avatar:"",description:""})):[]};ee(x)}}catch{}},children:[n.jsxs("div",{className:"h-40 overflow-hidden relative",children:[n.jsx("img",{src:v.image||"/uploads/covers/default_storyimg.jpg",alt:v.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent"}),n.jsx("div",{className:"absolute bottom-4 left-4",children:n.jsx("h3",{className:"text-xl font-bold text-white",children:v.title})})]}),n.jsxs("div",{className:"p-5",children:[n.jsx("p",{className:"text-slate-500 text-sm leading-relaxed mb-4 line-clamp-2",children:v.description}),n.jsx("div",{className:"flex justify-between items-center",children:n.jsx("div",{className:"flex gap-2 flex-wrap",children:(v.tags||[]).map(I=>n.jsxs("span",{className:"text-[10px] font-bold text-primary-600 bg-primary-50 px-2 py-1 rounded-full",children:["#",I]},I))})})]})]},v.id)),!z.length&&n.jsx("div",{className:"text-center text-xs text-slate-400",children:""})]}):n.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[a&&n.jsx("div",{className:"text-center text-xs text-slate-400",children:"..."}),!a&&r.map(v=>{var I;return n.jsxs("div",{className:"bg rounded-2xl p-4 shadow-sm flex gap-4 hover:shadow-md transition-all cursor-pointer border border-transparent hover:border-primary-100",onClick:()=>{Y(!1),fe(!1),h(v)},children:[n.jsx(bh,{char:v}),n.jsxs("div",{className:"flex-1 flex flex-col justify-between py-1 min-w-0",children:[n.jsxs("div",{children:[n.jsx("div",{className:"flex justify-between items-start",children:n.jsx("h3",{className:"font-bold text-slate-800 text-lg leading-tight",children:v.name})}),n.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2 mb-2",children:(I=v.tags)==null?void 0:I.slice(0,4).map(m=>n.jsx("span",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded-md bg-pink-50 text-pink-500",children:m},m))}),n.jsx("p",{className:"text-xs text-slate-500 line-clamp-2 leading-relaxed mb-2",children:v.oneLinePersona||v.bio})]}),n.jsx("div",{className:"flex items-center justify-end mt-1 border-t border-slate-50 pt-2",children:n.jsxs("div",{className:"text-[10px] text-slate-400",children:["by ",v.creator||""]})})]})]},v.id)}),!a&&r.length===0&&n.jsx("div",{className:"mt-2 text-center",children:n.jsx("p",{className:"text-xs text-slate-300",children:" ~"})})]})});case xe.ME:return n.jsx(mh,{userProfile:w,myCharacters:r,myUserCharacters:oe,myStories:ce,onUpdateProfile:v=>{_(v);try{localStorage.setItem("user_nickname",v.nickname||""),localStorage.setItem("user_email",v.email||"me@example.com"),v.avatar&&localStorage.setItem("user_avatar",v.avatar)}catch{}},onCharacterClick:v=>{Y(!1),fe(!0),h(v)},onReadStory:async v=>{try{const I=v;if(typeof(I==null?void 0:I.content)=="string"&&I.content.length){const m={id:typeof v.id=="number"?v.id:Number(Date.now()),title:v.title,description:v.description||"",image:v.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(v.tags)?v.tags:[],author:w.nickname||"",likes:"0",content:I.content,publishDate:I.publishDate||void 0,status:I.status};ee(m)}else{const m=await Hi(v.id),x=Array.isArray(m==null?void 0:m.characterIds)?m.characterIds:[];let b=[];if(x.length){const H=X=>r.find(g=>String(g.id)===String(X))||oe.find(g=>String(g.id)===String(X));b=x.map(X=>{const g=H(X);return g?{id:X,name:g.name,avatar:g.avatar,description:g.oneLinePersona||g.bio||""}:null}).filter(Boolean)}const q={id:Number(m.id),title:m.title,description:m.description||"",image:m.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(m.tags)?m.tags:[],author:w.nickname||"",user_avatar:(m==null?void 0:m.user_avatar)||"",likes:"0",content:m.content||"",publishDate:(m==null?void 0:m.publishDate)??void 0,status:v.status||void 0,availableRoles:b};ee(q)}}catch{}},onEditStory:v=>{const I={id:typeof v.id=="number"?v.id:Number(Date.now()),title:v.title,description:v.description||"",image:v.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(v.tags)?v.tags:[],author:w.nickname||"",likes:"0",content:"",status:v.status||void 0,availableRoles:[]};V(I),S(!0),(async()=>{try{const m=await Hi(v.id),x=Array.isArray(m==null?void 0:m.characterIds)?m.characterIds:[];let b=[];try{const{authFetch:g}=await ue(async()=>{const{authFetch:O}=await import("./http-bwpcOK62.js");return{authFetch:O}},__vite__mapDeps([0,1,2,3])),E=await g("/stories/combine");if(E&&E.ok){const O=await E.json();b=Array.isArray(O==null?void 0:O.items)?O.items:[]}}catch{}K(b.map(g=>({id:String(g.character_id),name:g.character_name,avatar:g.character_avatar||"",desc:g.desc||"",isPrivate:!!g.isPrivate,isMine:!!g.isMine})));const q=g=>{const E=b.find(O=>String(O.character_id)===String(g));return E?{id:g,name:E.character_name,avatar:E.character_avatar||"",description:E.desc||""}:null};let H=x.map(q).filter(Boolean);if(!H.length){const g=E=>r.find(O=>String(O.id)===String(E))||oe.find(O=>String(O.id)===String(E));H=x.map(E=>{const O=g(E);return O?{id:E,name:O.name,avatar:O.avatar,description:O.oneLinePersona||O.bio||""}:null}).filter(Boolean)}const X={id:Number(m.id),title:m.title,description:m.description||"",image:m.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(m.tags)?m.tags:[],author:w.nickname||"",likes:"0",content:m.content||"",publishDate:(m==null?void 0:m.publishDate)??void 0,status:v.status||void 0,availableRoles:H,...x&&{characterIds:x}};V(X)}catch{}})()},onEditCharacter:v=>{L({initial:v,id:v.id,isEdit:!0}),R(!0)},onDeleteCharacter:v=>{se(I=>I.filter(m=>m.id!==v.id)),o(I=>I.filter(m=>m.id!==v.id))},onAddCharacter:()=>{L(null),R(!0)},onAddStory:()=>{V(null),S(!0),(async()=>{try{const{authFetch:v}=await ue(async()=>{const{authFetch:m}=await import("./http-bwpcOK62.js");return{authFetch:m}},__vite__mapDeps([0,1,2,3])),I=await v("/stories/combine");if(I&&I.ok){const m=await I.json(),x=Array.isArray(m==null?void 0:m.items)?m.items:[];K(x.map(b=>({id:String(b.character_id),name:b.character_name,avatar:b.character_avatar||"",desc:b.desc||"",isPrivate:!!b.isPrivate,isMine:!!b.isMine})))}else K([])}catch{K([])}})()},onLogout:ae});case xe.CHAT:default:return n.jsx(n.Fragment,{children:(!l||we)&&n.jsx($u,{chats:s,onChatClick:v=>{k(!0),d(v)},onTogglePin:Ce,onDeleteChat:v=>{i(m=>m.filter(x=>x.characterId!==v));const I=localStorage.getItem("user_id")||"0";localStorage.removeItem(`chat_session_${I}_${v}`),localStorage.removeItem(`chat_history_${I}_${v}`),(l==null?void 0:l.characterId)===v&&d(null)},isDetailOpen:we&&!!l})})}};return n.jsx(Bi,{children:n.jsx("div",{className:"fixed inset-0 w-full bg-primary-50 overflow-hidden",style:{...F,overscrollBehavior:"none",position:"fixed"},children:n.jsxs("div",{className:"h-full w-full max-w-md mx-auto bg relative shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden flex flex-col",children:[A&&n.jsx(oh,{onBack:()=>{R(!1),L(null)},onCreate:je,isEdit:!!(C!=null&&C.isEdit),characterId:C==null?void 0:C.id,initial:C==null?void 0:C.initial,onUpdated:v=>{R(!1),L(null),h(v)}}),N&&n.jsx(ka,{currentPersona:P,onBack:()=>j(!1),onSave:v=>T(v)}),$&&n.jsx(lh,{onBack:()=>{S(!1),V(null)},onPublish:v=>{W(I=>ys(I,v)),re(I=>ys(I,v)),S(!1),V(null)},onSaveDraft:v=>{re(I=>ys(I,v)),S(!1),V(null)},availableCharacters:r,myUserCharacters:oe,initialStory:de||void 0,importableRoles:U}),n.jsx(ot,{initial:!1,children:l&&!N&&!A&&n.jsx(Qu,{character:l.character,initialMessages:he(l),userPersona:P,onBack:()=>{d(null),k(!1)},onUpdateLastMessage:pe,onOpenUserSettings:()=>j(!0),onUpdateUserPersona:v=>T(v),onShowProfile:()=>{Y(!0),fe(!1),B(null),h(l.character)}})}),n.jsx(ot,{initial:!1,children:u&&!N&&!A&&!M&&(te?n.jsx(Ui,{character:u,createdId:u.id,onBack:()=>h(null),onStartChat:v=>ke(v)}):n.jsx(eh,{character:u,onBack:()=>h(null),onStartChat:()=>ke(u),isFromChat:D,isExistingChat:!!s.find(v=>v.characterId===u.id)}))}),M&&!N&&!A&&n.jsx(Ui,{character:M.character,createdId:M.id,onBack:()=>B(null),onStartChat:v=>{B(null),ke(v)}}),G&&n.jsx(gh,{story:G,onBack:()=>ee(null),connectedRoleNames:s.map(v=>v.character.name),validRoleNames:(G.availableRoles||[]).map(v=>v.name),onStartRoleplay:v=>{ee(null);const I=v==null?void 0:v.id;let m;if(I!=null&&(m=r.find(x=>String(x.id)===String(I))||oe.find(x=>String(x.id)===String(I))),!m){const x=(v==null?void 0:v.name)||"";m=r.find(b=>b.name===x)||oe.find(b=>b.name===x)}m&&(h(m),Y(!1),fe(!1),(async()=>{try{if(!!oe.find(b=>String(b.id)===String(m.id))){const b=await At(m.id),q={id:String(m.id),name:(b==null?void 0:b.name)||m.name,avatar:(b==null?void 0:b.avatar)||m.avatar||"",profileImage:m.profileImage||"",status:Ue.ONLINE,bio:(b==null?void 0:b.tagline)||"",tags:Array.isArray(b==null?void 0:b.tags)?b.tags:[],creator:w.nickname||"",oneLinePersona:(b==null?void 0:b.tagline)||"",personality:(b==null?void 0:b.personality)||"",profession:(b==null?void 0:b.occupation)||"",age:b!=null&&b.age?String(b.age):"",roleType:"",gender:(b==null?void 0:b.gender)||"",currentRelationship:(b==null?void 0:b.relationship)||"",plotTheme:(b==null?void 0:b.plot_theme)||"",plotDescription:(b==null?void 0:b.plot_summary)||"",openingLine:(b==null?void 0:b.opening_line)||"",styleExamples:Array.isArray(b==null?void 0:b.styleExamples)?b.styleExamples:[],hobbies:(b==null?void 0:b.hobbies)||"",experiences:(b==null?void 0:b.experiences)||"",isPublic:String((b==null?void 0:b.visibility)||"")==="public",isPublished:String((b==null?void 0:b.status)||"")==="published"};h(q)}else{const b=await Wi(m.id),q={id:String(b.id),name:b.name||m.name,avatar:b.avatar||m.avatar||"",profileImage:b.profileImage||m.profileImage||"",status:Ue.ONLINE,bio:b.bio||"",tags:Array.isArray(b.tags)?b.tags:[],creator:b.creator||"",oneLinePersona:b.oneLinePersona||"",personality:b.personality||"",profession:b.profession||b.occupation||"",age:b.age||"",roleType:b.roleType||"",currentRelationship:b.currentRelationship||b.relationship||"",plotTheme:b.plotTheme||b.plot_theme||"",plotDescription:b.plotDescription||b.plot_summary||"",openingLine:b.openingLine||""};h(q)}}catch{}})()),!m&&I!=null&&(async()=>{try{const x=await Wi(I),b={id:String(x.id),name:x.name||"",avatar:x.avatar||"",profileImage:x.profileImage||"",status:Ue.ONLINE,bio:x.bio||"",tags:Array.isArray(x.tags)?x.tags:[],creator:x.creator||"",oneLinePersona:x.oneLinePersona||"",personality:x.personality||"",profession:x.profession||x.occupation||"",age:x.age||"",roleType:x.roleType||"",currentRelationship:x.currentRelationship||x.relationship||"",plotTheme:x.plotTheme||x.plot_theme||"",plotDescription:x.plotDescription||x.plot_summary||"",openingLine:x.openingLine||""};h(b),Y(!1),fe(!1);return}catch{}try{const x=await At(I),b={id:String(I),name:(x==null?void 0:x.name)||"",avatar:(x==null?void 0:x.avatar)||"",profileImage:"",status:Ue.ONLINE,bio:(x==null?void 0:x.tagline)||"",tags:Array.isArray(x==null?void 0:x.tags)?x.tags:[],creator:w.nickname||"",oneLinePersona:(x==null?void 0:x.tagline)||"",personality:(x==null?void 0:x.personality)||"",profession:(x==null?void 0:x.occupation)||"",age:x!=null&&x.age?String(x.age):"",roleType:"",gender:(x==null?void 0:x.gender)||"",currentRelationship:(x==null?void 0:x.relationship)||"",plotTheme:(x==null?void 0:x.plot_theme)||"",plotDescription:(x==null?void 0:x.plot_summary)||"",openingLine:(x==null?void 0:x.opening_line)||"",styleExamples:Array.isArray(x==null?void 0:x.styleExamples)?x.styleExamples:[],hobbies:(x==null?void 0:x.hobbies)||"",experiences:(x==null?void 0:x.experiences)||"",isPublic:String((x==null?void 0:x.visibility)||"")==="public",isPublished:String((x==null?void 0:x.status)||"")==="published"};h(b),Y(!1),fe(!1)}catch{}})()}}),!N&&!A&&n.jsxs(n.Fragment,{children:[n.jsx(Ou,{title:e===xe.HOME?Ae():e===xe.CHAT?"":"",variant:e===xe.ME?"overlay":"default",onFilterClick:()=>{e===xe.HOME&&(p==="characters"?R(!0):p==="stories"&&(V(null),K([]),S(!0),(async()=>{try{const{authFetch:v}=await ue(async()=>{const{authFetch:m}=await import("./http-bwpcOK62.js");return{authFetch:m}},__vite__mapDeps([0,1,2,3])),I=await v("/stories/combine");if(I&&I.ok){const m=await I.json(),x=Array.isArray(m==null?void 0:m.items)?m.items:[];K(x.map(b=>({id:String(b.character_id),name:b.character_name,avatar:b.character_avatar||"",desc:b.desc||"",isPrivate:!!b.isPrivate,isMine:!!b.isMine})))}}catch{}})()))},showAdd:e===xe.HOME}),n.jsx(ot,{initial:!1,children:n.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar scroll-smooth min-h-0",children:Pe()})}),n.jsx(zu,{activeTab:e,onTabChange:t})]})]})})})},ys=(e,t)=>[t,...e.filter(s=>String(s.id)!==String(t.id))],Th=Object.freeze(Object.defineProperty({__proto__:null,default:wh},Symbol.toStringTag,{value:"Module"}));export{Th as A,Uu as B};
//# sourceMappingURL=App-Bk3_h9f8.js.map
