import{r as i,j as e}from"./index-DiMvcmcb.js";import{C as L}from"./chevron-left-B3HkbiML.js";import{S as V}from"./save-DC2LZN-i.js";import{X as F}from"./x-CKT7hpuC.js";import{S as R,T as Y,u as B,t as y}from"./AdminDashboard-D62DCIkd.js";import{P as D}from"./plus-Bz3dnY0B.js";import{I as G}from"./info-Bu7G037R.js";import{C as H}from"./circle-check-big-IblmQXOf.js";import{c as K}from"./createLucideIcon-CiU7U1is.js";import{P as X}from"./pen-line-BpKLzpbM.js";import{C as Z}from"./copy-SCIkRcbw.js";import{T as q}from"./trash-2-CCl4-mF6.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],O=K("star",J),Q=({onCancel:N,initialData:r,onSave:j,notify:g})=>{const[a,o]=i.useState({name:"",type:"恋爱",customType:"",tags:[],content:""}),[p,h]=i.useState(""),[d,m]=i.useState(!1),k=["恋爱","玄幻","悬疑","职场","科幻","同人"];i.useEffect(()=>{r&&(o({name:r.name||"",type:r.type||"恋爱",customType:"",tags:r.tags||[],content:r.content||""}),m(!1))},[r]);const c=s=>{s.key==="Enter"&&p.trim()&&(s.preventDefault(),a.tags.includes(p.trim())||o(l=>({...l,tags:[...l.tags,p.trim()]})),h(""))},u=s=>{const l=[...a.tags];l.splice(s,1),o(v=>({...v,tags:l}))},w=s=>{m(!1),o(l=>({...l,type:s}))},x=()=>{if(!a.name.trim()){typeof g=="function"&&g("保存失败：请输入模版名称","error");return}const s={id:r==null?void 0:r.id,name:a.name.trim(),type:d&&a.customType.trim()||a.type,tags:a.tags,content:a.content,refCount:(r==null?void 0:r.refCount)??0,creator:(r==null?void 0:r.creator)??"Admin"};try{j&&j(s)}catch{typeof g=="function"&&g("保存失败：请稍后重试","error")}};return e.jsxs("div",{className:"animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:N,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(L,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:r?"编辑提示词模版":"新建提示词模版"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"定义基础 Prompt 框架"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:N,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:x,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text白 font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(V,{size:16})," 保存模版"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:[e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 模版基础信息"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版名称"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>o({...a,name:s.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700 bg-gray-50/50 focus:bg-white",placeholder:"例如：病娇反派通用模版"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版类型"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[k.map(s=>e.jsx("button",{onClick:()=>w(s),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all cute-font tracking-wide border ${!d&&a.type===s?"bg-pink-500 text白 border-pink-500 shadow-md shadow-pink-200":"bg白 text灰-500 border-gray-100 hover:border-pink-200"}`,children:s},s)),e.jsx("button",{onClick:()=>m(!0),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all cute-font tracking-wide border ${d?"bg-pink-500 text白 border-pink-500 shadow-md shadow-pink-200":"bg白 text灰-500 border-gray-100 hover:border-pink-200"}`,children:"自定义..."})]}),d&&e.jsx("div",{className:"animate-fade-in mt-2",children:e.jsx("input",{type:"text",value:a.customType,onChange:s=>o({...a,customType:s.target.value}),placeholder:"请输入自定义类型名称",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版标签 (回车生成)"}),e.jsxs("div",{className:"dream-input w-full px-4 py-3 rounded-xl min-h-[50px] flex flex-wrap gap-2 items-center bg-gray-50/50 focus-within:bg-white",children:[a.tags.map((s,l)=>e.jsxs("span",{className:"tag-pill px-3 py-1 flex items-center shadow-sm gap-1",children:["#",s," ",e.jsx("button",{onClick:()=>u(l),className:"hover:text-red-500 opacity-60 hover:opacity-100 transition-opacity",children:e.jsx(F,{size:12})})]},l)),e.jsx("input",{value:p,onChange:s=>h(s.target.value),onKeyDown:c,type:"text",className:"bg-transparent outline-none text-sm w-40 placeholder-gray-400 h-8",placeholder:"输入标签按回车..."})]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-4",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," Prompt 内容配置"]}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{rows:"15",value:a.content,onChange:s=>o({...a,content:s.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-600 bg-gray-50/50 focus:bg-white resize-y",placeholder:`在此输入系统提示词框架（System Instruction）...
可以使用 {'{{user}}'} 和 {'{{name}}'} 作为占位符。`})})]})]}),e.jsx("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:e.jsxs("div",{className:"solid-card p-6 rounded-3xl bg-gradient-to-br from-pink-500 to-pink-600 text白 shadow-xl shadow-pink-200/50",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2 text-lg font-cute",children:[e.jsx(R,{size:18,className:"text-yellow-300"})," 编写指南"]}),e.jsxs("ul",{className:"space-y-3 text-sm opacity-90 leading-relaxed list-disc list-inside",children:[e.jsxs("li",{children:["使用 ",e.jsx("b",{children:"{{name}}"})," 代表角色姓名。"]}),e.jsxs("li",{children:["使用 ",e.jsx("b",{children:"{{user}}"})," 代表用户昵称。"]}),e.jsxs("li",{children:["建议明确规定角色的",e.jsx("b",{children:"说话风格"}),"、",e.jsx("b",{children:"禁忌事项"}),"以及",e.jsx("b",{children:"背景设定"}),"。"]})]})]})})]})]})},U=()=>{const[N,r]=i.useState("list"),[j,g]=i.useState([]),[a,o]=i.useState(1),p=6,[h,d]=i.useState(null),[m,k]=i.useState(null),{showToast:c}=B(),u=async()=>{try{const t=await y.list();g(t.items||[])}catch{c("加载失败：请稍后再试","error")}};i.useEffect(()=>{u()},[]);const w=[...j].sort((t,n)=>{if(t.isDefault&&!n.isDefault)return-1;if(!t.isDefault&&n.isDefault)return 1;const b=t.createdAt?new Date(t.createdAt).getTime():0,f=n.createdAt?new Date(n.createdAt).getTime():0;return b-f}),x=Math.max(1,Math.ceil(w.length/p)),s=(a-1)*p,l=w.slice(s,s+p);i.useEffect(()=>{a>x&&o(x)},[j]);const v=t=>{if(!t)return"-";const n=new Date(t),b=n.getFullYear(),f=String(n.getMonth()+1).padStart(2,"0"),A=String(n.getDate()).padStart(2,"0"),M=String(n.getHours()).padStart(2,"0"),_=String(n.getMinutes()).padStart(2,"0");return`${b}/${f}/${A} ${M}:${_}`},T=async t=>{try{await y.setDefault(t),c("已设为默认"),u()}catch{c("操作失败","error")}},S=t=>{d(t),r("create")},z=t=>{const n={...t,id:void 0,name:`${t.name}_copy`};d(n),r("create"),c("复制成功，已进入编辑")},E=async t=>{try{await y.remove(t)}catch{throw new Error("failed")}},P=t=>k(t),C=()=>k(null),I=async()=>{if(m)try{await E(m.id),c("删除成功"),u()}catch{c("删除失败","error")}finally{C()}},$=async t=>{try{h&&h.id?(await y.update(h.id,t),c("保存成功：模版已更新")):(await y.create(t),c("创建成功：模版已保存")),d(null),r("list"),u()}catch{c("保存失败：请稍后重试","error")}};return N==="create"?e.jsx(Q,{onCancel:()=>{d(null),r("list")},initialData:h,onSave:$,notify:c}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"提示词模版库"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"管理用于生成角色的基础 Prompt"})]}),e.jsxs("button",{onClick:()=>{d(null),r("create")},className:"bg-pink-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(D,{size:16})," 新建模版"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-pink-50 p-4 rounded-2xl border border-pink-100 text-sm text-pink-700",children:[e.jsx(G,{size:18,className:"flex-shrink-0 text-pink-500"}),e.jsxs("span",{children:["提示：用户创建角色时，默认使用当前",e.jsx("span",{className:"font-bold",children:"“默认”"}),"提示词模板作为参考生成角色提示词。"]})]}),e.jsxs("div",{className:"glass-card rounded-3xl overflow-hidden",children:[e.jsxs("table",{className:"w-full text-left rounded-2xl overflow-hidden border-collapse",children:[e.jsx("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 pl-6 w-16",children:"序号"}),e.jsx("th",{className:"p-3 pl-7",children:"模版名称"}),e.jsx("th",{className:"p-3",children:"类型"}),e.jsx("th",{className:"p-3",children:"标签"}),e.jsx("th",{className:"p-3",children:"创建时间"}),e.jsx("th",{className:"p-3",children:"引用数"}),e.jsx("th",{className:"p-3",children:"状态 / 操作"}),e.jsx("th",{className:"p-3 text-right pr-8",children:"操作"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-pink-100",children:l.map((t,n)=>{var b;return e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-3 pl-6 text-gray-500 font-mono",children:s+n+1}),e.jsx("td",{className:"p-3 pl-8 font-bold text-gray-700",children:t.name}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"bg-pink-100 text-pink-600 px-2.5 py-1 rounded-lg text-xs font-bold",children:t.type})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex gap-1",children:(b=t.tags)==null?void 0:b.map(f=>e.jsx("span",{className:"text-[10px] bg-white border border-pink-100 text-pink-400 px-1.5 py-0.5 rounded",children:f},f))})}),e.jsx("td",{className:"p-3 text-gray-500",children:v(t.createdAt)}),e.jsx("td",{className:"p-3 text-gray-500 font-mono",children:typeof t.refCount=="number"?t.refCount:0}),e.jsx("td",{className:"p-3",children:t.isDefault?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-green-100 text-green-700 text-xs font-bold border border-green-200",children:[e.jsx(H,{size:14,className:"text-green-600"}),"当前默认"]}):e.jsxs("button",{onClick:()=>T(t.id),className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-gray-200 text-gray-500 text-xs font-bold hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50 transition-all group",children:[e.jsx(O,{size:14,className:"group-hover:fill-pink-200"}),"设为默认"]})}),e.jsxs("td",{className:"p-3 text-right pr-8 space-x-2",children:[e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>S(t),"aria-label":"编辑",className:"text-pink-400 hover:text-pink-600 p-1",children:e.jsx(X,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"编辑"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>z(t),"aria-label":"复制",className:"text-pink-400 hover:text-pink-600 p-1",children:e.jsx(Z,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"复制"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>P(t),"aria-label":"删除",className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(q,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"删除"})]})]})]},t.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border-t border-pink-100",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["第 ",a," / ",x," 页"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:a===1,onClick:()=>o(t=>Math.max(1,t-1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${a===1?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"上一页"}),Array.from({length:x}).map((t,n)=>e.jsx("button",{onClick:()=>o(n+1),className:`w-8 h-8 rounded-lg text-xs font-bold ${a===n+1?"bg-pink-500 text-white":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:n+1},n)),e.jsx("button",{disabled:a===x,onClick:()=>o(t=>Math.min(x,t+1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${a===x?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"下一页"})]})]})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:C}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除提示词模版"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",m.name,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:C,className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:I,className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]})]})},xe=()=>e.jsx(Y,{children:e.jsx(U,{})});export{xe as default};
//# sourceMappingURL=TemplatesView-6P7Cp-uJ.js.map
