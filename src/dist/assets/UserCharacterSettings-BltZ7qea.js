import{r as l,j as e}from"./index-DiMvcmcb.js";import{m as S,e as D,h as q}from"./App-Bl6Z-21V.js";import{I as E}from"./ImageCropper-u3NJns5t.js";import{C as L}from"./chevron-left-B3HkbiML.js";import{U as M}from"./user-DjmimaIa.js";import{P as G}from"./pencil-DPfzMC3o.js";const P={type:"tween",ease:"easeInOut",duration:.28},W={type:"tween",ease:"linear",duration:.28},H={duration:.18},J=({currentPersona:t,roleId:w,onBack:N,onSave:k,withinContainer:U=!1})=>{const[s,x]=l.useState((t==null?void 0:t.gender)||"female"),[h,A]=l.useState((t==null?void 0:t.name)||""),[p,R]=l.useState((t==null?void 0:t.age)||""),[u,_]=l.useState((t==null?void 0:t.profession)||""),[b,$]=l.useState((t==null?void 0:t.basicInfo)||""),[f,z]=l.useState((t==null?void 0:t.personality)||""),[r,I]=l.useState(t==null?void 0:t.avatar),[y,g]=l.useState(null),[v,C]=l.useState(!1),m=l.useRef(null),F=a=>{var j;const o=a.split(","),n=((j=o[0].match(/:(.*?);/))==null?void 0:j[1])||"image/jpeg",i=atob(o[1]);let d=i.length;const c=new Uint8Array(d);for(;d--;)c[d]=i.charCodeAt(d);return new Blob([c],{type:n})},B=async()=>{if(v)return;C(!0);const a=localStorage.getItem("user_access_token");let o=r;try{if(r&&r.startsWith("data:image")){const i=F(r),d=new FormData,c=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;d.append("avatar",i,"avatar.jpg"),d.append("filename",c),o=`/uploads/users/avatars/${c}`,fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:a?`Bearer ${a}`:""},body:d}).catch(()=>{})}const n={gender:s,name:h,age:p,profession:u,basicInfo:b,personality:f,avatar:o||void 0};typeof w=="number"?await D(w,n):await q(n)}catch{}k({gender:s,name:h,age:p,profession:u,basicInfo:b,personality:f,avatar:o}),C(!1),N()},O=()=>{var a;(a=m.current)==null||a.click()},T=a=>{var n;const o=(n=a.target.files)==null?void 0:n[0];if(o){const i=new FileReader;i.onloadend=()=>{g(i.result)},i.readAsDataURL(o)}m.current&&(m.current.value="")};return e.jsxs("div",{className:`${U?"absolute":"fixed"} inset-0 z-[80]`,children:[e.jsx(S.div,{className:"absolute inset-0 bg-[#F8F9FA]",initial:{opacity:0},animate:{opacity:1},transition:H}),e.jsxs(S.div,{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)] flex flex-col h-[92vh] w-full overflow-y-auto no-scrollbar",initial:{y:"100%"},animate:{y:0},transition:W,children:[y&&e.jsx(E,{imageSrc:y,onCancel:()=>g(null),onCrop:a=>{I(a),g(null)}}),e.jsxs("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm border-b border-slate-100 rounded-none md:rounded-t-3xl",children:[e.jsx("button",{onClick:N,className:"p-2 -ml-2 text-slate-800 hover:bg-slate-50 rounded-full transition-colors",children:e.jsx(L,{size:24})}),e.jsx("button",{onClick:B,disabled:v,className:`px-4 py-1.5 rounded-lg text-sm font-bold transition-transform ${v?"bg-purple-200 text-white cursor-not-allowed":"bg-purple-50 text-purple-600 active:scale-95"}`,children:"完成"})]}),e.jsxs("div",{className:"mx-auto w-full max-w-md bg-white p-4 space-y-3 pb-10 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("div",{onClick:O,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-pink-200 flex items-center justify-center text-white shadow-sm border-4 border-white overflow-hidden",children:r?e.jsx("img",{src:r,alt:"User Avatar",className:"w-full h-full object-cover"}):e.jsx(M,{size:48,fill:"currentColor"})}),e.jsx("div",{className:"absolute bottom-0 right-0 bg-white p-2 rounded-full shadow-md border border-slate-100",children:e.jsx(G,{size:14,className:"text-slate-400"})}),e.jsx("input",{type:"file",ref:m,className:"hidden",accept:"image/*",onChange:T})]})}),e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[e.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-4",children:"性别"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${s==="male"?"border-blue-500":"border-slate-300"}`,children:s==="male"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),e.jsx("input",{type:"radio",name:"gender",value:"male",checked:s==="male",onChange:()=>x("male"),className:"hidden"}),e.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:"男性"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${s==="female"?"border-blue-500":"border-slate-300"}`,children:s==="female"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),e.jsx("input",{type:"radio",name:"gender",value:"female",checked:s==="female",onChange:()=>x("female"),className:"hidden"}),e.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:"女性"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${s==="secret"?"border-blue-500":"border-slate-300"}`,children:s==="secret"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),e.jsx("input",{type:"radio",name:"gender",value:"secret",checked:s==="secret",onChange:()=>x("secret"),className:"hidden"}),e.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:"未透露"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[e.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:"名字 (必填)"}),e.jsx("input",{type:"text",placeholder:"请输入您的名字",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:h,onChange:a=>A(a.target.value)})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[e.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:"年龄"}),e.jsx("input",{type:"text",placeholder:"请输入角色年龄",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:p,onChange:a=>R(a.target.value)})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[e.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:"职业"}),e.jsx("input",{type:"text",placeholder:"请输入角色职业",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:u,onChange:a=>_(a.target.value)})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[e.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:"基本信息"}),e.jsx("textarea",{placeholder:"角色身份背景和外貌特征...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:b,onChange:a=>$(a.target.value)})]}),e.jsxs("div",{className:"bg白 rounded-xl p-5 shadow-sm",children:[e.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:"性格描述"}),e.jsx("textarea",{placeholder:"请输入性格描述...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:f,onChange:a=>z(a.target.value)})]})]})]})]})},ee=Object.freeze(Object.defineProperty({__proto__:null,UserCharacterSettings:J},Symbol.toStringTag,{value:"Module"}));export{J as U,W as a,P as b,ee as c,H as f};
//# sourceMappingURL=UserCharacterSettings-BltZ7qea.js.map
