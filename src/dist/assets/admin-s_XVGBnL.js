import{R as e,r as s}from"./vendor-react-C8XDWPrG.js";import{S as re,L as _e,F as ue,B as Je,U as Ie,a as Ye,b as He,C as Ze,D as Xe,c as Ke,d as We,e as Pe,f as qe,g as oe,h as te,X as Q,P as Z,I as ze,i as je,j as Qe,k as fe,l as Me,T as ce,m as et,n as tt,R as at,Z as nt,o as lt,p as xe,q as we,W as de,A as st,r as rt,s as ot}from"./vendor-icons-BT5Yb3Aw.js";import"./vendor-jsJWjJTf.js";const le="/api/admin",ct=()=>localStorage.getItem("admin_access_token")||"",mt=()=>localStorage.getItem("admin_refresh_token")||"",it=(t,r)=>{t&&localStorage.setItem("admin_access_token",t),r&&localStorage.setItem("admin_refresh_token",r)},ge=()=>{localStorage.removeItem("admin_access_token"),localStorage.removeItem("admin_refresh_token");const t="/super-admin/login";typeof window<"u"&&window.location&&(typeof window.location.replace=="function"?window.location.replace(t):window.location.href=t)},ve=()=>({Authorization:`Bearer ${ct()}`});let se=null;const dt=async()=>{const t=mt();if(!t)throw ge(),new Error("unauthorized");const r=await fetch(`${le}/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t})});if(!r.ok)throw ge(),new Error("refresh_failed");const i=await r.json();return it(i.access_token,i.refresh_token),i},z=async(t,r={})=>{const i={...r},o=typeof FormData<"u"&&i.body instanceof FormData,a=ve(),c=o?{}:{"Content-Type":"application/json"};i.headers={...i.headers||{},...c,...a};let u=await fetch(`${le}${t}`,i);if(u.status===401){se||(se=dt());try{await se}finally{se=null}const d=ve(),x=o?{}:{"Content-Type":"application/json"};if(i.headers={...i.headers||{},...x,...d},u=await fetch(`${le}${t}`,i),u.status===401)throw ge(),new Error("unauthorized")}if(!u.ok)throw new Error("failed");if(!u.ok){let d="";try{d=await u.text()}catch{}throw console.error("[admin.api.request] failed",{path:t,status:u.status,body:d}),new Error("failed")}return u.json()},q={async list(){return z("/templates")},async create(t){return z("/templates",{method:"POST",body:JSON.stringify(t)})},async update(t,r){return z(`/templates/${t}`,{method:"PUT",body:JSON.stringify(r)})},async remove(t){return z(`/templates/${t}`,{method:"DELETE"})},async copy(t){return z(`/templates/${t}/copy`,{method:"POST"})},async setDefault(t){return z(`/templates/${t}/default`,{method:"POST"})}},ae={async list(t){const r=t?"?"+new URLSearchParams(t).toString():"";return z(`/characters${r}`)},async get(t){return z(`/characters/${t}`)},async create(t){return z("/characters",{method:"POST",body:JSON.stringify(t)})},async update(t,r){return z(`/characters/${t}`,{method:"PUT",body:JSON.stringify(r)})},async remove(t){return z(`/characters/${t}`,{method:"DELETE"})},async setStatus(t,r){return z(`/characters/${t}/status`,{method:"POST",body:JSON.stringify({status:r})})}},ne={async list(){return z("/models")},async create(t){return z("/models",{method:"POST",body:JSON.stringify(t)})},async remove(t){return z(`/models/${t}`,{method:"DELETE"})}},Ne={async get(){return z("/settings")},async save(t){return z("/settings",{method:"PUT",body:JSON.stringify(t)})}},ke={async generate(t){return z("/sysprompt/generate",{method:"POST",body:JSON.stringify(t)})},async generateNoScene(t){return z("/sysprompt/generate-noscene",{method:"POST",body:JSON.stringify(t)})}},$e={async avatar(t){const r=new FormData;return r.append("avatar",t),z("/uploads/avatar",{method:"POST",body:r})}},ee={async list(t){const r=t?`?q=${encodeURIComponent(t)}`:"";return z(`/users${r}`)},async create({username:t,nickname:r,email:i,password:o,chatLimit:a}){return z("/users",{method:"POST",body:JSON.stringify({username:t,nickname:r,email:i,password:o,chatLimit:a})})},async update(t,r){return z(`/users/${t}`,{method:"PUT",body:JSON.stringify(r)})},async remove(t){return z(`/users/${t}`,{method:"DELETE"})},async changePassword(t,r){return z(`/users/${t}/password`,{method:"POST",body:JSON.stringify({password:r})})}},H={async list(t){const r=t?`?q=${encodeURIComponent(t)}`:"";return z(`/admins${r}`)},async create({username:t,email:r,password:i}){return z("/admins",{method:"POST",body:JSON.stringify({username:t,email:r,password:i})})},async update(t,r){return z(`/admins/${t}`,{method:"PUT",body:JSON.stringify(r)})},async remove(t){return z(`/admins/${t}`,{method:"DELETE"})},async changePassword(t,r){return z(`/admins/${t}/password`,{method:"POST",body:JSON.stringify({password:r})})},async getMyAvatar(){return z("/admins/me/avatar")},async updateMe(t){return z("/admins/me",{method:"PUT",body:JSON.stringify(t)})}},Se=()=>e.createElement("style",null,`
    @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Varela+Round&display=swap');
    body { font-family: 'Varela Round', 'PingFang SC', sans-serif; background-color: #FFFFFF; color: #4A4060; }
    .font-cute { font-family: 'ZCOOL KuaiLe', cursive; }
    .glass-card { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.9); box-shadow: 0 8px 30px rgba(236, 72, 153, 0.08); }
    .solid-card { background: #FFFFFF; border: 1px solid #FCE7F3; box-shadow: 0 4px 20px rgba(236, 72, 153, 0.05); }
    .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); border-right: 1px solid rgba(255, 255, 255, 0.5); }
    .dream-input { background: rgba(255, 255, 255, 0.6); border: 2px solid #FCE7F3; transition: all 0.3s ease; color: #5D5476; }
    .dream-input:focus { background: #FFFFFF; border-color: #F472B6; outline: none; box-shadow: 0 0 0 4px rgba(244, 114, 182, 0.15); }
    .tag-pill { background: linear-gradient(135deg, #FBCFE8 0%, #FCE7F3 100%); color: #BE185D; font-weight: 700; font-size: 0.75rem; border-radius: 8px; }
    .tag-select-btn { background: #FCE7F3; color: #BE185D; border: 1px solid transparent; border-radius: 20px; font-weight: bold; font-size: 0.85rem; padding: 8px 10px; transition: all 0.2s; white-space: nowrap; }
    .tag-select-btn.active { background: #EC4899; color: white; border-color: #DB2777; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3); }
    .ambient-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(at 0% 0%, hsla(330, 70%, 98%, 1) 0, transparent 50%), radial-gradient(at 50% 100%, hsla(330, 85%, 95%, 1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(330, 80%, 97%, 1) 0, transparent 50%); background-size: 200% 200%; animation: gradientMove 15s ease infinite; }
    @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.02); }
    ::-webkit-scrollbar-thumb { background: #FBCFE8; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #F472B6; }
    .glass-card p, .glass-card h4, .glass-card li, .glass-card ul { color: #4A4060; }
    .solid-card p, .solid-card h4, .solid-card li, .solid-card ul { color: #4A4060; }
  `),Le=s.createContext(null),X=()=>s.useContext(Le),K=({children:t})=>{const[r,i]=s.useState([]),o=s.useCallback((a,c="success")=>{const u=Date.now()+Math.random();i(d=>[...d,{id:u,message:a,type:c}]),setTimeout(()=>{i(d=>d.filter(x=>x.id!==u))},3e3)},[]);return e.createElement(Le.Provider,{value:{showToast:o}},t,e.createElement("div",{className:"fixed top-6 left-64 right-0 z-50 flex flex-col items-center gap-3 pointer-events-none"},r.map(a=>e.createElement("div",{key:a.id,className:`pointer-events-auto flex items-center justify-center text-center px-4 py-2 rounded-2xl shadow-xl border max-w-[480px] min-w-[180px] mx-auto ${a.type==="success"?"bg-white border-green-200 text-green-700":"bg-white border-red-200 text-red-700"}`},a.message))))},pt=({onLogin:t})=>{const[r,i]=s.useState(""),[o,a]=s.useState(""),{showToast:c}=X(),u=async()=>{try{const h=(await(await fetch(`${le}/crypto/public-key`)).text()).replace(/-----BEGIN PUBLIC KEY-----/,"").replace(/-----END PUBLIC KEY-----/,"").replace(/\s+/g,""),k=Uint8Array.from(atob(h),m=>m.charCodeAt(0)),E=await window.crypto.subtle.importKey("spki",k.buffer,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]),_=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},E,new TextEncoder().encode(o)),C=btoa(String.fromCharCode(...new Uint8Array(_))),b=await fetch(`${le}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password_encrypted:C})});if(!b.ok){c("登录失败","error");return}const g=await b.json();g?.access_token&&localStorage.setItem("admin_access_token",g.access_token),g?.refresh_token&&localStorage.setItem("admin_refresh_token",g.refresh_token),localStorage.setItem("admin_username",r),t()}catch{c("登录失败","error")}};return e.createElement("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden"},e.createElement("div",{className:"ambient-bg"}),e.createElement("div",{className:"glass-card p-10 rounded-3xl w-full max-w-md shadow-2xl transform transition-all hover:scale-[1.01]"},e.createElement("div",{className:"text-center mb-8"},e.createElement("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-pink-100 text-pink-600 mb-4 shadow-inner"},e.createElement(re,{size:32})),e.createElement("h1",{className:"text-3xl font-cute text-pink-900 mb-2"},"Linkusrge"),e.createElement("p",{className:"text-pink-400 text-sm"},"运营管理平台")),e.createElement("div",{className:"space-y-5"},e.createElement("div",null,e.createElement("label",{className:"block text-sm font-bold text-pink-800 mb-2 ml-1"},"管理员账号"),e.createElement("input",{type:"text",placeholder:"admin",value:r,onChange:d=>i(d.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl"})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-bold text-pink-800 mb-2 ml-1"},"密码"),e.createElement("input",{type:"password",placeholder:"••••••••",value:o,onChange:d=>a(d.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl"})),e.createElement("button",{onClick:u,className:"w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-pink-200 transition-all transform active:scale-95 flex items-center justify-center gap-2"},e.createElement(_e,{size:18,className:"rotate-180"})," 登录后台"))))},ut=({activeTab:t,setActiveTab:r,onLogout:i,username:o,onEditProfile:a})=>{const[c,u]=s.useState(["characters","settings"]),d=[{id:"templates",label:"提示词模版",icon:ue},{id:"characters",label:"角色管理",icon:Ye,subItems:[{id:"official_characters",label:"官方角色",icon:Je},{id:"user_characters",label:"用户角色",icon:Ie}]},{id:"users",label:"用户管理",icon:He},{id:"settings",label:"系统设置",icon:We,subItems:[{id:"model_settings",label:"模型设置",icon:Ze},...o==="admin"?[{id:"model_manage",label:"模型管理",icon:Xe},{id:"admin_accounts",label:"管理员账号",icon:Ke}]:[]]}];s.useEffect(()=>{const n=d.find(f=>f.subItems?.some($=>$.id===t));n&&u(f=>f.includes(n.id)?f:[...f,n.id])},[t]);const x=n=>{u(f=>f.includes(n)?f.filter($=>$!==n):[...f,n])},h=n=>{u(f=>f.includes(n)?f:[...f,n])},k=n=>{d.find(A=>A.id===n)?.subItems?.some(A=>A.id===t)||u(A=>A.filter(U=>U!==n))},E=n=>{n.subItems?x(n.id):(r(n.id),u([]))},[_,C]=s.useState(!1),[b,g]=s.useState(""),[m,j]=s.useState(""),[N,S]=s.useState(""),T=async()=>{const n={};if(b&&b.trim()&&(n.nickname=b.trim()),m){if(m!==N)return;n.password=m}try{await H.updateMe(n),C(!1),g(""),j(""),S("")}catch{}};return e.createElement("div",{className:"w-16 xl:w-56 glass-nav h-screen fixed left-0 top-0 flex flex-col z-20 transition-all duration-300",style:{backgroundColor:"#f4f6fb"}},e.createElement("div",{className:"p-4 xl:p-8 flex items-center justify-center xl:justify-start gap-3"},e.createElement("div",{className:"w-8 h-8 bg-pink-500 rounded-lg flex items-center justify-center text-white flex-shrink-0"},e.createElement(re,{size:18})),e.createElement("span",{className:"text-xl font-cute text-pink-900 tracking-wide hidden xl:block"},"Linksurge Admin")),e.createElement("nav",{className:"flex-1 px-4 space-y-2"},d.map(n=>e.createElement("div",{key:n.id,onMouseEnter:()=>n.subItems&&h(n.id),onMouseLeave:()=>n.subItems&&k(n.id)},e.createElement("button",{onClick:()=>E(n),className:`w-full flex items-center justify-center xl:justify-start gap-3 px-2 xl:px-4 py-3.5 rounded-2xl transition-all duration-300 font-bold text-sm ${t===n.id||n.subItems&&n.subItems.some(f=>f.id===t)?"bg-pink-100 text-pink-700 shadow-sm":"text-gray-500 hover:bg-white/50 hover:text-pink-600"}`},e.createElement(n.icon,{size:18,className:"flex-shrink-0"}),e.createElement("span",{className:"hidden xl:block flex-1 text-left"},n.label),n.subItems&&e.createElement("span",{className:"hidden xl:block transition-transform duration-300"},c.includes(n.id)?e.createElement(Pe,{size:14}):e.createElement(qe,{size:14}))),n.subItems&&e.createElement("div",{className:`grid transition-all duration-300 ease-in-out ${c.includes(n.id)?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"}`},e.createElement("div",{className:"overflow-hidden"},e.createElement("div",{className:"mt-1 space-y-1 xl:pl-4"},n.subItems.map(f=>e.createElement("button",{key:f.id,onClick:$=>{$.stopPropagation(),r(f.id)},className:`w-full flex items-center justify-center xl:justify-start gap-2 px-2 xl:px-4 py-2.5 rounded-xl transition-all duration-300 text-xs font-bold ${t===f.id?"bg-pink-200/50 text-pink-800":"text-gray-400 hover:text-pink-600 hover:bg-white/30"}`},f.icon?e.createElement(f.icon,{size:16,className:"flex-shrink-0 hidden xl:block"}):e.createElement("span",{className:"w-1.5 h-1.5 rounded-full bg-current flex-shrink-0 hidden xl:block"}),e.createElement("span",{className:"hidden xl:block"},f.label),e.createElement("span",{className:"xl:hidden"},f.icon?e.createElement(f.icon,{size:14}):f.label.substring(0,1)))))))))),e.createElement("div",{className:"p-4 border-t border-pink-100"},e.createElement("div",{className:"w-full flex xl:flex-row flex-col items-center xl:justify-start justify-center gap-3"},e.createElement("div",{className:"group relative",onClick:()=>a&&a()},e.createElement(xt,{username:o}),e.createElement("div",{className:"absolute left-1/2 -translate-x-1/2 -translate-y-full -top-2 bg-pink-700 text-white text-xs px-2 py-1 rounded shadow opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-50"},o)),e.createElement("button",{onClick:i,className:"w-full xl:flex-1 flex items-center justify-center xl:justify-start gap-3 px-2 xl:px-4 py-3 text-red-400 hover:bg-red-50 rounded-2xl transition-colors font-bold text-sm"},e.createElement(_e,{size:18,className:"flex-shrink-0"}),e.createElement("span",{className:"hidden xl:block"},"退出登录")))),_&&e.createElement("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40"},e.createElement("div",{className:"bg-white rounded-2xl p-6 w-96 shadow-2xl"},e.createElement("div",{className:"font-bold mb-4 text-pink-900"},"修改资料"),e.createElement("div",{className:"space-y-3"},e.createElement("div",null,e.createElement("input",{type:"text",placeholder:`昵称（当前：${o}）`,value:b,onChange:n=>g(n.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})),e.createElement("div",null,e.createElement("input",{type:"password",placeholder:"新密码",value:m,onChange:n=>j(n.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})),e.createElement("div",null,e.createElement("input",{type:"password",placeholder:"再次输入新密码",value:N,onChange:n=>S(n.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"}))),e.createElement("div",{className:"flex gap-2 justify-end mt-5"},e.createElement("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{C(!1),g(""),j(""),S("")}},"取消"),e.createElement("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:T,disabled:!b.trim()&&!m},"保存"))),e.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-[1px] bg-slate-300"})))},xt=({username:t})=>{const[r,i]=s.useState("");return s.useEffect(()=>{let o=!0;return H.getMyAvatar().then(a=>{o&&i(a?.avatar||"/uploads/avatars/default_admin.jpg")}).catch(()=>{o&&i("/uploads/avatars/default_admin.jpg")}),()=>{o=!1}},[t]),e.createElement("div",{className:"group relative w-8 h-8 rounded-full overflow-hidden border border-pink-200 bg-white flex items-center justify-center"},r?e.createElement("img",{src:r,alt:t,className:"w-full h-full object-cover"}):e.createElement(Ie,{size:16,className:"text-pink-500"}))},gt=({onCancel:t,initialData:r,onSave:i,notify:o})=>{const[a,c]=s.useState({name:"",type:"恋爱",customType:"",tags:[],content:""}),[u,d]=s.useState(""),[x,h]=s.useState(!1),k=["恋爱","玄幻","悬疑","职场","科幻","同人"];s.useEffect(()=>{r&&(c({name:r.name||"",type:r.type||"恋爱",customType:"",tags:r.tags||[],content:r.content||""}),h(!1))},[r]);const E=g=>{g.key==="Enter"&&u.trim()&&(g.preventDefault(),a.tags.includes(u.trim())||c(m=>({...m,tags:[...m.tags,u.trim()]})),d(""))},_=g=>{const m=[...a.tags];m.splice(g,1),c(j=>({...j,tags:m}))},C=g=>{h(!1),c(m=>({...m,type:g}))},b=()=>{if(!a.name.trim()){typeof o=="function"&&o("保存失败：请输入模版名称","error");return}const g={id:r?.id,name:a.name.trim(),type:x&&a.customType.trim()||a.type,tags:a.tags,content:a.content,refCount:r?.refCount??0,creator:r?.creator??"Admin"};try{i&&i(g)}catch{typeof o=="function"&&o("保存失败：请稍后重试","error")}};return e.createElement("div",{className:"animate-fade-in pb-20"},e.createElement("div",{className:"flex items-center gap-4 mb-6"},e.createElement("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors"},e.createElement(oe,{size:20})),e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900"},r?"编辑提示词模版":"新建提示词模版"),e.createElement("p",{className:"text-gray-400 text-xs"},"定义基础 Prompt 框架")),e.createElement("div",{className:"ml-auto flex gap-3"},e.createElement("button",{onClick:t,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50"},"取消"),e.createElement("button",{onClick:b,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text白 font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2"},e.createElement(te,{size:16})," 保存模版"))),e.createElement("div",{className:"grid grid-cols-12 gap-6"},e.createElement("div",{className:"col-span-12 lg:col-span-8 space-y-6"},e.createElement("div",{className:"solid-card p-8 rounded-3xl space-y-6"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 模版基础信息"),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"模版名称"),e.createElement("input",{type:"text",value:a.name,onChange:g=>c({...a,name:g.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700 bg-gray-50/50 focus:bg-white",placeholder:"例如：病娇反派通用模版"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"模版类型"),e.createElement("div",{className:"flex flex-wrap gap-2 mb-2"},k.map(g=>e.createElement("button",{key:g,onClick:()=>C(g),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all cute-font tracking-wide border ${!x&&a.type===g?"bg-pink-500 text白 border-pink-500 shadow-md shadow-pink-200":"bg白 text灰-500 border-gray-100 hover:border-pink-200"}`},g)),e.createElement("button",{onClick:()=>h(!0),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all cute-font tracking-wide border ${x?"bg-pink-500 text白 border-pink-500 shadow-md shadow-pink-200":"bg白 text灰-500 border-gray-100 hover:border-pink-200"}`},"自定义...")),x&&e.createElement("div",{className:"animate-fade-in mt-2"},e.createElement("input",{type:"text",value:a.customType,onChange:g=>c({...a,customType:g.target.value}),placeholder:"请输入自定义类型名称",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"}))),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"模版标签 (回车生成)"),e.createElement("div",{className:"dream-input w-full px-4 py-3 rounded-xl min-h-[50px] flex flex-wrap gap-2 items-center bg-gray-50/50 focus-within:bg-white"},a.tags.map((g,m)=>e.createElement("span",{key:m,className:"tag-pill px-3 py-1 flex items-center shadow-sm gap-1"},"#",g," ",e.createElement("button",{onClick:()=>_(m),className:"hover:text-red-500 opacity-60 hover:opacity-100 transition-opacity"},e.createElement(Q,{size:12})))),e.createElement("input",{value:u,onChange:g=>d(g.target.value),onKeyDown:E,type:"text",className:"bg-transparent outline-none text-sm w-40 placeholder-gray-400 h-8",placeholder:"输入标签按回车..."})))),e.createElement("div",{className:"solid-card p-8 rounded-3xl space-y-4"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," Prompt 内容配置"),e.createElement("div",{className:"relative"},e.createElement("textarea",{rows:"15",value:a.content,onChange:g=>c({...a,content:g.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-600 bg-gray-50/50 focus:bg-white resize-y",placeholder:`在此输入系统提示词框架（System Instruction）...
可以使用 {'{{user}}'} 和 {'{{name}}'} 作为占位符。`})))),e.createElement("div",{className:"col-span-12 lg:col-span-4 space-y-6"},e.createElement("div",{className:"solid-card p-6 rounded-3xl bg-gradient-to-br from-pink-500 to-pink-600 text白 shadow-xl shadow-pink-200/50"},e.createElement("h4",{className:"font-bold mb-3 flex items-center gap-2 text-lg font-cute"},e.createElement(re,{size:18,className:"text-yellow-300"})," 编写指南"),e.createElement("ul",{className:"space-y-3 text-sm opacity-90 leading-relaxed list-disc list-inside"},e.createElement("li",null,"使用 ",e.createElement("b",null,"{{name}}")," 代表角色姓名。"),e.createElement("li",null,"使用 ",e.createElement("b",null,"{{user}}")," 代表用户昵称。"),e.createElement("li",null,"建议明确规定角色的",e.createElement("b",null,"说话风格"),"、",e.createElement("b",null,"禁忌事项"),"以及",e.createElement("b",null,"背景设定"),"。"))))))},ft=()=>{const[t,r]=s.useState("list"),[i,o]=s.useState([]),[a,c]=s.useState(1),u=6,[d,x]=s.useState(null),[h,k]=s.useState(null),{showToast:E}=X(),_=async()=>{try{const y=await q.list();o(y.items||[])}catch{E("加载失败：请稍后再试","error")}};s.useEffect(()=>{_()},[]);const C=[...i].sort((y,L)=>{if(y.isDefault&&!L.isDefault)return-1;if(!y.isDefault&&L.isDefault)return 1;const R=y.createdAt?new Date(y.createdAt).getTime():0,I=L.createdAt?new Date(L.createdAt).getTime():0;return R-I}),b=Math.max(1,Math.ceil(C.length/u)),g=(a-1)*u,m=C.slice(g,g+u);s.useEffect(()=>{a>b&&c(b)},[i]);const j=y=>{if(!y)return"-";const L=new Date(y),R=L.getFullYear(),I=String(L.getMonth()+1).padStart(2,"0"),p=String(L.getDate()).padStart(2,"0"),D=String(L.getHours()).padStart(2,"0"),F=String(L.getMinutes()).padStart(2,"0");return`${R}/${I}/${p} ${D}:${F}`},N=async y=>{try{await q.setDefault(y),E("已设为默认"),_()}catch{E("操作失败","error")}},S=y=>{x(y),r("create")},T=y=>{const L={...y,id:void 0,name:`${y.name}_copy`};x(L),r("create"),E("复制成功，已进入编辑")},n=async y=>{try{await q.remove(y)}catch{throw new Error("failed")}},f=y=>k(y),$=()=>k(null),A=async()=>{if(h)try{await n(h.id),E("删除成功"),_()}catch{E("删除失败","error")}finally{$()}},U=async y=>{try{d&&d.id?(await q.update(d.id,y),E("保存成功：模版已更新")):(await q.create(y),E("创建成功：模版已保存")),x(null),r("list"),_()}catch{E("保存失败：请稍后重试","error")}};return t==="create"?e.createElement(gt,{onCancel:()=>{x(null),r("list")},initialData:d,onSave:U,notify:E}):e.createElement("div",{className:"space-y-6 animate-fade-in"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"提示词模版库"),e.createElement("p",{className:"text-gray-400 text-xs mt-1 ml-4"},"管理用于生成角色的基础 Prompt")),e.createElement("button",{onClick:()=>{x(null),r("create")},className:"bg-pink-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-sm"},e.createElement(Z,{size:16})," 新建模版")),e.createElement("div",{className:"flex items-center gap-2 bg-pink-50 p-4 rounded-2xl border border-pink-100 text-sm text-pink-700"},e.createElement(ze,{size:18,className:"flex-shrink-0 text-pink-500"}),e.createElement("span",null,"提示：用户创建角色时，默认使用当前",e.createElement("span",{className:"font-bold"},"“默认”"),"提示词模板作为参考生成角色提示词。")),e.createElement("div",{className:"glass-card rounded-3xl overflow-hidden"},e.createElement("table",{className:"w-full text-left rounded-2xl overflow-hidden border-collapse"},e.createElement("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm"},e.createElement("tr",null,e.createElement("th",{className:"p-3 pl-6 w-16"},"序号"),e.createElement("th",{className:"p-3 pl-7"},"模版名称"),e.createElement("th",{className:"p-3"},"类型"),e.createElement("th",{className:"p-3"},"标签"),e.createElement("th",{className:"p-3"},"创建时间"),e.createElement("th",{className:"p-3"},"引用数"),e.createElement("th",{className:"p-3"},"状态 / 操作"),e.createElement("th",{className:"p-3 text-right pr-8"},"操作"))),e.createElement("tbody",{className:"text-sm divide-y divide-pink-100"},m.map((y,L)=>e.createElement("tr",{key:y.id,className:"hover:bg-pink-50/30 transition-colors"},e.createElement("td",{className:"p-3 pl-6 text-gray-500 font-mono"},g+L+1),e.createElement("td",{className:"p-3 pl-8 font-bold text-gray-700"},y.name),e.createElement("td",{className:"p-3"},e.createElement("span",{className:"bg-pink-100 text-pink-600 px-2.5 py-1 rounded-lg text-xs font-bold"},y.type)),e.createElement("td",{className:"p-3"},e.createElement("div",{className:"flex gap-1"},y.tags?.map(R=>e.createElement("span",{key:R,className:"text-[10px] bg-white border border-pink-100 text-pink-400 px-1.5 py-0.5 rounded"},R)))),e.createElement("td",{className:"p-3 text-gray-500"},j(y.createdAt)),e.createElement("td",{className:"p-3 text-gray-500 font-mono"},typeof y.refCount=="number"?y.refCount:0),e.createElement("td",{className:"p-3"},y.isDefault?e.createElement("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-green-100 text-green-700 text-xs font-bold border border-green-200"},e.createElement(je,{size:14,className:"text-green-600"}),"当前默认"):e.createElement("button",{onClick:()=>N(y.id),className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-gray-200 text-gray-500 text-xs font-bold hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50 transition-all group"},e.createElement(Qe,{size:14,className:"group-hover:fill-pink-200"}),"设为默认")),e.createElement("td",{className:"p-3 text-right pr-8 space-x-2"},e.createElement("span",{className:"relative inline-flex group"},e.createElement("button",{onClick:()=>S(y),"aria-label":"编辑",className:"text-pink-400 hover:text-pink-600 p-1"},e.createElement(fe,{size:16})),e.createElement("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100"},"编辑")),e.createElement("span",{className:"relative inline-flex group"},e.createElement("button",{onClick:()=>T(y),"aria-label":"复制",className:"text-pink-400 hover:text-pink-600 p-1"},e.createElement(Me,{size:16})),e.createElement("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100"},"复制")),e.createElement("span",{className:"relative inline-flex group"},e.createElement("button",{onClick:()=>f(y),"aria-label":"删除",className:"text-red-400 hover:text-red-600 p-1"},e.createElement(ce,{size:16})),e.createElement("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100"},"删除"))))))),e.createElement("div",{className:"flex items-center justify-between p-3 border-t border-pink-100"},e.createElement("div",{className:"text-xs text-gray-500"},"第 ",a," / ",b," 页"),e.createElement("div",{className:"flex items-center gap-2"},e.createElement("button",{disabled:a===1,onClick:()=>c(y=>Math.max(1,y-1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${a===1?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`},"上一页"),Array.from({length:b}).map((y,L)=>e.createElement("button",{key:L,onClick:()=>c(L+1),className:`w-8 h-8 rounded-lg text-xs font-bold ${a===L+1?"bg-pink-500 text-white":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`},L+1)),e.createElement("button",{disabled:a===b,onClick:()=>c(y=>Math.min(b,y+1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${a===b?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`},"下一页")))),h&&e.createElement(e.Fragment,null,e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:$}),e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4"},e.createElement("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 mb-2"},"删除提示词模版"),e.createElement("p",{className:"text-sm text-gray-500 mb-4"},"确定删除“",h.name,"”吗？此操作不可撤回。"),e.createElement("div",{className:"flex justify-end gap-3"},e.createElement("button",{onClick:$,className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50"},"取消"),e.createElement("button",{onClick:A,className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600"},"确认删除"))))))},bt=()=>e.createElement(K,null,e.createElement(ft,null)),ht=t=>new Promise(r=>{const i=new FileReader;i.addEventListener("load",()=>r(i.result),!1),i.readAsDataURL(t)}),yt=t=>new Promise((r,i)=>{const o=new Image;o.addEventListener("load",()=>r(o)),o.addEventListener("error",a=>i(a)),o.setAttribute("crossOrigin","anonymous"),o.src=t});function Ce({initialImage:t,onSave:r,onCancel:i}){const[o,a]=s.useState(t?"main":"upload"),[c,u]=s.useState(t||null),[d,x]=s.useState(null),h=async E=>{if(E.target.files&&E.target.files.length>0){const _=E.target.files[0],C=await ht(_);x(C),a("edit")}},k=E=>{u(E),r(E)};return e.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200"},e.createElement("div",{className:"relative w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200"},e.createElement(Et,{step:o,onBack:()=>a(o==="edit"?"upload":"main"),onClose:i}),e.createElement("div",{className:"flex-1 overflow-y-auto custom-scrollbar"},o==="main"&&e.createElement(wt,{avatarUrl:c,onChangeClick:()=>a("upload"),onRemoveClick:()=>{u(null),r(null)}}),o==="upload"&&e.createElement(vt,{onFileChange:h}),o==="edit"&&d&&e.createElement(Nt,{imageSrc:d,onSave:k,onCancel:()=>a("upload")}))))}function Et({step:t,onBack:r,onClose:i}){let o="头像设置";return t==="upload"&&(o="更换头像"),t==="edit"&&(o="裁剪与旋转"),e.createElement("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 shrink-0 bg-white"},e.createElement("div",{className:"flex items-center gap-2"},t!=="main"&&t!=="upload"&&e.createElement("button",{onClick:r,className:"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-pink-600 transition-colors"},e.createElement(oe,{size:20})),t==="upload"&&r&&null,e.createElement("h2",{className:"text-lg font-cute text-pink-900"},o)),e.createElement("button",{onClick:i,className:"p-2 -mr-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-red-500 transition-colors"},e.createElement(Q,{size:20})))}function wt({avatarUrl:t,onChangeClick:r,onRemoveClick:i}){return e.createElement("div",{className:"flex flex-col h-full bg-gray-50/50"},e.createElement("div",{className:"p-8 flex flex-col items-center text-center flex-1 justify-center"},e.createElement("div",{className:"relative group mb-8"},e.createElement("div",{className:"w-48 h-48 rounded-full overflow-hidden ring-8 ring-white shadow-2xl bg-gray-200 flex items-center justify-center"},t?e.createElement("img",{src:t,alt:"Profile",className:"w-full h-full object-cover"}):e.createElement("span",{className:"text-6xl font-medium text-gray-400"},"?"))),e.createElement("p",{className:"text-sm text-gray-500 mb-2"},"设置一个好看的头像，让角色更具吸引力")),e.createElement("div",{className:"flex items-stretch border-t border-gray-100 bg-white divide-x divide-gray-100"},e.createElement("button",{onClick:r,className:"flex-1 py-4 flex items-center justify-center gap-2 text-pink-600 hover:bg-pink-50 transition-colors font-bold text-sm"},e.createElement(et,{size:16}),"更换头像"),e.createElement("button",{onClick:i,className:"flex-1 py-4 flex items-center justify-center gap-2 text-gray-400 hover:bg-red-50 hover:text-red-500 transition-colors font-bold text-sm"},e.createElement(ce,{size:16}),"移除头像")))}function vt({onFileChange:t}){const[r,i]=s.useState(!1),o=s.useRef(null),a=d=>{d.preventDefault(),i(!0)},c=d=>{d.preventDefault(),i(!1)},u=d=>{d.preventDefault(),i(!1),d.dataTransfer.files&&d.dataTransfer.files.length>0&&t({target:{files:d.dataTransfer.files}})};return e.createElement("div",{className:"flex flex-col h-full bg-white"},e.createElement("div",{className:"flex-1 p-8 flex flex-col items-center justify-center"},e.createElement("div",{onDragOver:a,onDragLeave:c,onDrop:u,onClick:()=>o.current.click(),className:`w-full max-w-xs aspect-square rounded-3xl flex flex-col items-center justify-center transition-all duration-300 cursor-pointer border-2 border-dashed ${r?"bg-pink-50 border-pink-400 scale-105":"bg-gray-50 border-gray-200 hover:border-pink-300 hover:bg-pink-50/30"}`},e.createElement("div",{className:"w-20 h-20 rounded-full bg-white shadow-sm flex items-center justify-center mb-4 text-pink-500"},e.createElement(tt,{size:32})),e.createElement("p",{className:"text-gray-600 font-bold mb-1"},"点击或拖拽上传"),e.createElement("p",{className:"text-gray-400 text-xs"},"支持 JPG, PNG, GIF"))),e.createElement("input",{type:"file",ref:o,onChange:t,className:"hidden",accept:"image/*"}))}function Nt({imageSrc:t,onSave:r,onCancel:i}){const o=s.useRef(null),[a,c]=s.useState(null),[u,d]=s.useState(!1),[x,h]=s.useState(0),[k,E]=s.useState({x:0,y:0}),[_,C]=s.useState(!1),[b,g]=s.useState({x:0,y:0}),[m,j]=s.useState(1),[N,S]=s.useState(1),T=400,n=280;s.useEffect(()=>{(async()=>{try{const p=await yt(t);c(p);const D=T/p.width,F=T/p.height,w=Math.max(D,F);j(w),S(1)}catch(p){console.error(p)}})()},[t]);const f=I=>{I.preventDefault();const p=I.deltaY*-.001;S(D=>Math.max(.5,Math.min(D+p,3)))},$=s.useCallback(()=>{if(!a||!o.current)return;const p=o.current.getContext("2d");p.clearRect(0,0,T,T),p.fillStyle="#18181b",p.fillRect(0,0,T,T),p.save(),p.translate(T/2,T/2),p.rotate(x*Math.PI/180),p.translate(-T/2,-T/2);let D=x*Math.PI/180,F=k.x*Math.cos(-D)-k.y*Math.sin(-D),w=k.x*Math.sin(-D)+k.y*Math.cos(-D);const O=m*N,V=a.width*O,B=a.height*O,Y=T/2,W=T/2;p.drawImage(a,Y-V/2+F,W-B/2+w,V,B),p.restore();const M=(T-n)/2;p.fillStyle="rgba(0, 0, 0, 0.6)",p.beginPath(),p.rect(0,0,T,T),p.rect(M+n,M,-n,n),p.fill("evenodd"),p.strokeStyle="white",p.lineWidth=3;const G=20;p.beginPath(),p.moveTo(M,M+G),p.lineTo(M,M),p.lineTo(M+G,M),p.stroke(),p.beginPath(),p.moveTo(M+n-G,M),p.lineTo(M+n,M),p.lineTo(M+n,M+G),p.stroke(),p.beginPath(),p.moveTo(M,M+n-G),p.lineTo(M,M+n),p.lineTo(M+G,M+n),p.stroke(),p.beginPath(),p.moveTo(M+n-G,M+n),p.lineTo(M+n,M+n),p.lineTo(M+n,M+n-G),p.stroke()},[a,x,k,m,N]);s.useEffect(()=>{$()},[$]);const A=I=>{C(!0);const p=o.current.getBoundingClientRect(),D=I.clientX||I.touches[0].clientX,F=I.clientY||I.touches[0].clientY;g({x:D-p.left,y:F-p.top})},U=I=>{if(!_)return;const p=o.current.getBoundingClientRect(),D=I.clientX||(I.touches?I.touches[0].clientX:0),F=I.clientY||(I.touches?I.touches[0].clientY:0),w=D-p.left,O=F-p.top,V=w-b.x,B=O-b.y;E(Y=>({x:Y.x+V,y:Y.y+B})),g({x:w,y:O})},y=()=>{C(!1)},L=()=>{h(I=>(I+90)%360)},R=async()=>{if(!(!o.current||u)){d(!0);try{const I=document.createElement("canvas"),p=n;I.width=p,I.height=p;const D=I.getContext("2d"),F=(T-n)/2;D.drawImage(o.current,F,F,p,p,0,0,p,p);const w=await new Promise((B,Y)=>{I.toBlob(W=>W?B(W):Y(new Error("blob_failed")),"image/jpeg",.92)}),O=new File([w],`avatar_${Date.now()}.jpg`,{type:"image/jpeg"}),V=await $e.avatar(O);r(V.url)}catch(I){console.error(I)}finally{d(!1)}}};return e.createElement("div",{className:"flex flex-col h-full bg-white"},e.createElement("div",{className:"flex-1 relative flex items-center justify-center bg-gray-900 overflow-hidden"},e.createElement("canvas",{ref:o,width:T,height:T,onMouseDown:A,onMouseMove:U,onMouseUp:y,onMouseLeave:y,onTouchStart:A,onTouchMove:U,onTouchEnd:y,onWheel:f,className:"cursor-move max-w-full max-h-full",style:{width:"100%",height:"auto",maxHeight:"400px"}})),e.createElement("div",{className:"p-4 bg-white flex items-center justify-between border-t border-gray-100 gap-4"},e.createElement("button",{onClick:L,className:"flex flex-col itemscenter gap-1 text-pink-600 hover:text-pink-700 transition text-xs font-bold px-2 py-2 rounded-xl hover:bg-pink-50 shrink-0"},e.createElement(at,{size:20}),"旋转"),e.createElement("div",{className:"flex items-center gap-2 flex-1 max-w-[200px]"},e.createElement(nt,{size:16,className:"text-gray-400 shrink-0"}),e.createElement("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:N,onChange:I=>S(parseFloat(I.target.value)),className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-pink-500"}),e.createElement(lt,{size:16,className:"text-gray-400 shrink-0"})),e.createElement("div",{className:"flex gap-2 shrink-0"},e.createElement("button",{onClick:i,className:"px-4 py-2 rounded-xl text-gray-500 font-bold text-sm hover:bg-gray-100 transition-colors"},"取消"),e.createElement("button",{onClick:R,disabled:u,className:`px-5 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 transition-all ${u?"opacity-60 cursor-not-allowed":"hover:opacity-90"}`},u?"上传中...":"完成"))))}const kt=({initialData:t,onCancel:r,mode:i="new",notify:o})=>{const[a,c]=s.useState({name:"",gender:"男",identity:"",tagline:"",tags:[],plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",published:!1,generatedPrompt:"",personality:"",relationship:"陌生人",customRelationship:"",sceneDescription:"",sceneGeneratedPrompt:"",avatar:"",characterType:"原创角色",age:"",occupation:""}),u=["陌生人","暧昧","恋爱中","冷战","分手"],[d,x]=s.useState(!1),[h,k]=s.useState(!0);s.useEffect(()=>{if(t){const l=u.includes(t.relationship);c({name:t.name||"",gender:t.gender||"男",identity:t.identity||"",tagline:t.tagline||"",tags:t.tags||[],plotTheme:t.plotTheme||"",plotSummary:t.plotSummary||"",openingLine:t.openingLine||t.opening||"",styleExamples:t.styleExamples||["","",""],hobbies:t.hobbies||"",experiences:t.experiences||"",published:t.status==="published",generatedPrompt:t.systemPrompt||"",personality:t.personality||"",relationship:l?t.relationship||"陌生人":"",customRelationship:l?"":t.relationship||"",avatar:t.avatar||"",sceneDescription:t.sceneDescription||"",sceneGeneratedPrompt:t.systemPromptScene||"",templateIdScene:t.sceneTemplateId?String(t.sceneTemplateId):"",characterType:t.characterType||t.type||"原创角色",age:t.age||"",occupation:t.occupation||""}),x(!l&&!!t.relationship),I(t.promptModelId||""),w(typeof t.promptTemperature=="number"?t.promptTemperature:t.promptTemperature||.1),D(t.sceneModelId||""),V(typeof t.sceneTemperature=="number"?t.sceneTemperature:t.sceneTemperature||.1)}},[t]);const[E,_]=s.useState(!1),[C,b]=s.useState(!1),[g,m]=s.useState(!1),[j,N]=s.useState(""),[S,T]=s.useState(!1),n=s.useRef(null),[f,$]=s.useState(!1),[A,U]=s.useState(!1),y=s.useRef(null),L=s.useRef(null),[R,I]=s.useState(""),[p,D]=s.useState(""),[F,w]=s.useState(.1),[O,V]=s.useState(.1),[B,Y]=s.useState([]),[W,M]=s.useState(!1),[G,me]=s.useState(""),[ie,Ae]=s.useState([]),[Oe,be]=s.useState(!1),Fe=["M/M","M/F","BL","BG","耽美","百合","责任感","偶像","占有欲","霸道","调戏","腹黑","温柔","年下","年上","感性","体贴","理性","反差","激情","校园","贴心","偏执","疯批","傲娇","职场","冷漠","忧郁","人夫","养胃","控制欲","黏人","可爱","成熟","性感"];s.useEffect(()=>{const l=P=>{S&&n.current&&!n.current.contains(P.target)&&T(!1),f&&y.current&&!y.current.contains(P.target)&&$(!1),A&&L.current&&!L.current.contains(P.target)&&U(!1)},v=P=>{P.key==="Escape"&&(T(!1),$(!1),U(!1))};return document.addEventListener("mousedown",l),document.addEventListener("keydown",v),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",v)}},[S,f,A]),s.useEffect(()=>{(async()=>{try{const l=await ne.list(),v=P=>{const Ee=(P.model_nickname||"").match(/^模型-([A-Z])$/i);return Ee?Ee[1].toUpperCase():P.model_name||P.model_id||""};Y((l.items||[]).sort((P,J)=>v(P).localeCompare(v(J))))}catch{}})()},[]),s.useEffect(()=>{(async()=>{try{be(!0);const l=await q.list();Ae(l.items||[])}catch{}finally{be(!1)}})()},[]);const he=l=>{const v=B.find(P=>P.model_id===l);return v?v.model_nickname||v.model_name||v.model_id:"-- 请选择 --"},Re=a.templateIdScene?ie.find(l=>l.id===parseInt(a.templateIdScene))?.name:"-- 请选择 --",De=async()=>{T(!S)},Ue=async()=>{_(!0),c(l=>({...l,generatedPrompt:""}));try{const l={model:R||void 0,temperature:F===""?void 0:parseFloat(F),sourcePrompt:a.sceneGeneratedPrompt||""},v=await ke.generateNoScene(l);c(P=>({...P,generatedPrompt:v.prompt||""}))}catch{}finally{_(!1)}},ye=l=>{c(v=>({...v,templateIdScene:l})),T(!1)},Be=l=>{x(!1),c(v=>({...v,relationship:l,customRelationship:""}))},Ge=()=>{x(!0),c(l=>({...l,relationship:""}))},Ve=(l,v)=>{const P=[...a.styleExamples];P[l]=v,c(J=>({...J,styleExamples:P}))};return e.createElement("div",{className:"animate-fade-in pb-20"},e.createElement("div",{className:"flex items-center gap-4 mb-6"},e.createElement("button",{onClick:r,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors"},e.createElement(oe,{size:20})),e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900"},t?"编辑角色":"创建新角色"),e.createElement("p",{className:"text-gray-400 text-xs"},t?"修改角色设定与提示词":"填写设定并生成专属提示词")),e.createElement("div",{className:"ml-auto flex gap-3"},e.createElement("button",{onClick:r,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50"},"取消"),e.createElement("button",{onClick:async()=>{if(!a.name||!a.name.trim()){o&&o("保存失败：请输入角色名称","error");return}const l={name:a.name.trim(),gender:a.gender,sceneTemplateId:a.templateIdScene?parseInt(a.templateIdScene):t?.sceneTemplateId??null,identity:a.identity||null,tagline:a.tagline||null,personality:a.personality||null,relationship:d?a.customRelationship||null:a.relationship||null,plotTheme:a.plotTheme||null,plotSummary:a.plotSummary||null,openingLine:a.openingLine||null,systemPrompt:a.generatedPrompt||null,systemPromptScene:a.sceneGeneratedPrompt||null,promptModelId:R||null,promptTemperature:F===""?null:parseFloat(F),sceneModelId:p||null,sceneTemperature:O===""?null:parseFloat(O),hobbies:a.hobbies||null,experiences:a.experiences||null,status:a.published?"published":"draft",tags:a.tags||[],styleExamples:a.styleExamples||[],avatar:a.avatar||null,characterType:a.characterType||null,age:a.age===""?null:parseInt(a.age,10),occupation:a.occupation||null};try{i==="edit"&&t?.id?(await ae.update(t.id,l),o&&o("保存成功：角色已更新")):(await ae.create(l),o&&o("保存成功：角色已保存")),r()}catch(v){console.error("[characters.save] failed",{mode:i,payload:l,error:v}),o&&o("保存失败：请稍后重试","error")}},className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2"},e.createElement(te,{size:16})," 保存角色"))),e.createElement("div",{className:"grid grid-cols-12 gap-6"},e.createElement("div",{className:"col-span-12 lg:col-span-8 space-y-6"},e.createElement("div",{className:"solid-card p-8 rounded-3xl space-y-4"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色类型设置"),e.createElement("div",{className:"flex flex-wrap gap-3"},["原创角色","二次创作","其他"].map(l=>e.createElement("button",{key:l,onClick:()=>c({...a,characterType:l}),className:`px-6 py-3 rounded-2xl text-sm font-bold transition-all ${a.characterType===l?"bg-pink-500 text-white shadow-md":"bg-white text-gray-500 hover:text-pink-600"}`},l)))),e.createElement("div",{className:"solid-card p-8 rounded-3xl space-y-6"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 基础设定"),e.createElement("div",{className:"grid grid-cols-2 gap-6"},e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"角色名称"),e.createElement("input",{value:a.name,onChange:l=>c({...a,name:l.target.value}),type:"text",className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"角色姓名"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"性别"),e.createElement("div",{className:"flex bg-gray-50 p-1 rounded-xl border border-gray-200"},["男","女","其他"].map(l=>e.createElement("button",{key:l,onClick:()=>c({...a,gender:l}),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${a.gender===l?"bg-pink-500 text-white shadow-md":"text-gray-400 hover:text-pink-500"}`},l)))),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"年龄"),e.createElement("input",{value:a.age,onChange:l=>c({...a,age:l.target.value}),type:"number",min:"0",max:"200",className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"年龄"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"职业"),e.createElement("input",{value:a.occupation,onChange:l=>c({...a,occupation:l.target.value}),type:"text",className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"职业"}))),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"身份背景 (Identity)"),e.createElement("textarea",{value:a.identity,onChange:l=>c({...a,identity:l.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"角色的年龄、职业、过往经历..."})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"一句话人设 (Tagline)"),e.createElement("input",{value:a.tagline,onChange:l=>c({...a,tagline:l.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例如：表面温柔克己实则腹黑"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"性格 (Personality)"),e.createElement("textarea",{value:a.personality,onChange:l=>c({...a,personality:l.target.value}),rows:"2",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：占有欲强，容易吃醋..."})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"角色标签"),e.createElement("div",{onClick:()=>M(!0),className:"dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white transition rounded-2xl border border-pink-100"},a.tags.length===0&&e.createElement("span",{className:"text-xs text-[#B3A4C8] ml-1"},"点击添加标签 (#傲娇 #高冷...)"),a.tags.map(l=>e.createElement("span",{key:l,className:"tag-pill px-2 py-1 flex items-center shadow-sm"},"#",l,e.createElement("button",{onClick:v=>{v.stopPropagation(),c(P=>({...P,tags:P.tags.filter(J=>J!==l)}))},className:"ml-1 opacity-60 hover:opacity-100"},e.createElement(Q,{size:12})))),e.createElement("span",{className:"ml-auto text-pink-300 text-xs"},"›"))),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"当下的关系"),e.createElement("div",{className:"flex flex-wrap gap-2 mb-2"},e.createElement("button",{onClick:Ge,className:`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${d?"bg-pink-500 text-white shadow-md border-pink-500":"bg-white text-gray-500 border-gray-200 hover:border-pink-300"}`},"自定义"),u.map(l=>e.createElement("button",{key:l,onClick:()=>Be(l),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${!d&&a.relationship===l?"bg-pink-500 text-white shadow-md border-pink-500":"bg-white text-gray-500 border-gray-200 hover:border-pink-300"}`},l))),d&&e.createElement("div",{className:"animate-fade-in mt-2"},e.createElement("input",{type:"text",value:a.customRelationship,onChange:l=>c({...a,customRelationship:l.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm",placeholder:"请输入自定义关系"})))),e.createElement("div",{className:"solid-card p-8 rounded-3xl space-y-6"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 第一情节"),e.createElement("div",{className:"bg-pink-50 border border-pink-100 rounded-2xl p-4 flex gap-3 text-pink-700 text-sm leading-relaxed"},e.createElement(ze,{size:18,className:"flex-shrink-0 mt-0.5 text-pink-500"}),e.createElement("div",null,"第一情节的内容将被应用于和角色的第一次聊天。此外，设定第一情节并选择公开角色后，情节内容将显示在角色资料页上。")),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"主题"),e.createElement("input",{value:a.plotTheme,onChange:l=>c({...a,plotTheme:l.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例：当温柔人夫终于爆发腹黑属性"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"情节梗概"),e.createElement("textarea",{value:a.plotSummary,onChange:l=>c({...a,plotSummary:l.target.value}),rows:"4",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：在一起这么久了，他还是一如既往的温柔体贴，从来不干涉你的个人生活。今天晚上你去酒吧玩，故意装作喝醉和他打电话，却在他应了一声后开始软声叫着别人的名字......"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"开场白"),e.createElement("input",{value:a.openingLine,onChange:l=>c({...a,openingLine:l.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例：“出来，我在酒吧门口”"}))),e.createElement("div",{className:"solid-card rounded-3xl overflow-hidden"},e.createElement("div",{className:"p-8 pb-4 flex justify-between items-center cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>k(!h)},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"}),e.createElement("h3",{className:"font-cute text-lg text-pink-900"},"进阶设定"),e.createElement("span",{className:"text-[10px] px-2 py-0.5 bg-pink-100 text-pink-600 rounded"},"可选")),e.createElement(Pe,{size:20,className:`text-gray-400 transition-transform duration-300 ${h?"rotate-180":""}`})),h&&e.createElement("div",{className:"p-8 pt-0 space-y-6 animate-in slide-in-from-top-4 fade-in duration-300"},e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-3"},"说话风格示例"),e.createElement("div",{className:"space-y-3"},[0,1,2].map(l=>e.createElement("div",{key:l,className:"relative flex items-center gap-3"},e.createElement("span",{className:"text-xs font-bold text-pink-300 font-mono"},"0",l+1),e.createElement("input",{type:"text",value:a.styleExamples[l]||"",onChange:v=>Ve(l,v.target.value),className:"dream-input flex-1 px-4 py-3 rounded-xl text-sm",placeholder:l===0?"例：哼，别以为我会感谢你。":l===1?"例：今晚月色真美，不一起走走吗？":"例：再靠近一步，我就不客气了。"}))))),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"爱好"),e.createElement("textarea",{value:a.hobbies,onChange:l=>c({...a,hobbies:l.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：喜欢看书、收集古董怀表..."})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"经历"),e.createElement("textarea",{value:a.experiences,onChange:l=>c({...a,experiences:l.target.value}),rows:"4",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"请填写角色个人经历或你们的共同经历"})))),e.createElement("div",{className:"solid-card p-8 rounded-3xl relative overflow-visible bg-gradient-to-r from-pink-50 to-pink-100 border-pink-100"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 mb-4 flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色提示词配置（带场景描述）"),e.createElement("div",{className:"mb-4"},e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"角色提示词AI模型（场景）"),e.createElement("div",{className:"flex items-center gap-4"},e.createElement("div",{className:"relative z-50 flex-1",ref:L},e.createElement("button",{onClick:()=>U(!A),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${A?"border-pink-500 ring-4 ring-pink-100/50":""}`},e.createElement("span",{className:`${p?"text-gray-700":"text-gray-400 font-normal"}`},he(p)),e.createElement("div",{className:`text-pink-400 transition-transform ${A?"rotate-180":""}`},"▼")),A&&e.createElement("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50"},B.length===0?e.createElement("li",{className:"px-4 py-3 text-sm text-gray-400"},"暂无模型"):B.map(l=>e.createElement("li",{key:l.id,onClick:()=>{D(l.model_id),U(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${p===l.model_id?"bg-pink-100 font-bold text-pink-700":""}`},l.model_nickname||l.model_name||l.model_id)))),e.createElement("div",{className:"flex items-center gap-2 min-w-[140px] justify-end"},e.createElement("input",{type:"number",min:"0",max:"2",step:"0.05",value:O,onChange:l=>V(l.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.createElement("div",{className:"relative group"},e.createElement(xe,{size:18,className:"text-pink-400 cursor-help"}),e.createElement("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center"},"温度：高数值输出随机，低数值输出集中。"))))),e.createElement("div",{className:"flex gap-4 items-end mt-4"},e.createElement("div",{className:"flex-1"},e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"选择基础模版"),e.createElement("div",{className:"relative z-20 flex-1",ref:n},e.createElement("button",{onClick:De,className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${S?"border-pink-500 ring-4 ring-pink-100/50":""}`},e.createElement("span",{className:`${a.templateIdScene?"text-gray-700":"text-gray-400 font-normal"}`},Re),e.createElement("div",{className:`text-pink-400 transition-transform ${S?"rotate-180":""}`},"▼")),S&&e.createElement("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50"},e.createElement("li",{onClick:()=>ye(""),className:"px-4 py-3 text-sm text-gray-400 hover:bg-pink-50 cursor-pointer border-b border-pink-50"},"-- 请选择 --"),Oe?e.createElement("li",{className:"px-4 py-3 text-sm text-gray-400"},"加载中..."):ie.map(l=>e.createElement("li",{key:l.id,onClick:()=>ye(l.id.toString()),className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${a.templateIdScene==l.id?"bg-pink-100 font-bold text-pink-700":""}`},l.name," (",l.type,")"))))),e.createElement("button",{onClick:async()=>{if(!a.templateIdScene)return alert("请先选择一个提示词模版");b(!0),c(l=>({...l,sceneGeneratedPrompt:""}));try{const v={templateContent:ie.find(J=>J.id===parseInt(a.templateIdScene))?.content||"",model:p||void 0,temperature:O===""?void 0:parseFloat(O),name:a.name,gender:a.gender,age:a.age,occupation:a.occupation,identity:a.identity,tagline:a.tagline,tags:a.tags,personality:a.personality,relationship:d?a.customRelationship:a.relationship,styleExamples:a.styleExamples,hobbies:a.hobbies,experiences:a.experiences},P=await ke.generate(v);c(J=>({...J,sceneGeneratedPrompt:P.prompt||""}))}catch{}finally{b(!1)}},disabled:C,className:"px-6 py-3 rounded-xl bg-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] justify-center z-0"},C?e.createElement("span",{className:"animate-spin"},e.createElement(we,{size:16})):e.createElement(de,{size:16,className:"text-yellow-300"}),C?"生成中...":"生成提示词")),e.createElement("p",{className:"text-xs text-pink-400 mt-2 ml-1"},"* 将根据上方填写的设定，自动填充到模版占位符中"),e.createElement("div",{className:"mt-4 relative"},e.createElement("textarea",{rows:"12",value:a.sceneGeneratedPrompt,onChange:l=>c({...a,sceneGeneratedPrompt:l.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner",placeholder:"点击上方“生成提示词”按钮，或在此直接编写 Prompt..."}),!a.sceneGeneratedPrompt&&e.createElement("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-30"},e.createElement("div",{className:"text-center"},e.createElement(ue,{size:48,className:"mx-auto mb-2 text-pink-300"}),e.createElement("p",{className:"text-sm font-bold text-pink-400"},"等待生成..."))))),e.createElement("div",{className:"solid-card p-8 rounded-3xl relative overflow-visible bg-gradient-to-r from-pink-50 to-pink-100 border-pink-100"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 mb-4 flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色提示词配置"),e.createElement("div",{className:"mb-4"},e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"角色提示词AI模型"),e.createElement("div",{className:"flex items-center gap-4"},e.createElement("div",{className:"relative z-50 flex-1",ref:y},e.createElement("button",{onClick:()=>$(!f),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${f?"border-pink-500 ring-4 ring-pink-100/50":""}`},e.createElement("span",{className:`${R?"text-gray-700":"text-gray-400 font-normal"}`},he(R)),e.createElement("div",{className:`text-pink-400 transition-transform ${f?"rotate-180":""}`},"▼")),f&&e.createElement("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50"},B.length===0?e.createElement("li",{className:"px-4 py-3 text-sm text-gray-400"},"暂无模型"):B.map(l=>e.createElement("li",{key:l.id,onClick:()=>{I(l.model_id),$(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${R===l.model_id?"bg-pink-100 font-bold text-pink-700":""}`},l.model_nickname||l.model_name||l.model_id)))),e.createElement("div",{className:"flex items-center gap-2 min-w-[140px] justify-end"},e.createElement("input",{type:"number",min:"0",max:"2",step:"0.05",value:F,onChange:l=>w(l.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.createElement("div",{className:"relative group"},e.createElement(xe,{size:18,className:"text-pink-400 cursor-help"}),e.createElement("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center"},"温度：高数值输出随机，低数值输出集中。"))),e.createElement("button",{onClick:Ue,disabled:E,className:"px-6 py-3 rounded-xl bg-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] justify-center z-0"},E?e.createElement("span",{className:"animate-spin"},e.createElement(we,{size:16})):e.createElement(de,{size:16,className:"text-yellow-300"}),E?"生成中...":"生成提示词"))),e.createElement("p",{className:"text-xs text-pink-400 mt-2 ml-1"},"* 将根据上方输出的提示词，进行二次生成不带场景描述的提示词。"),e.createElement("div",{className:"mt-4 relative"},e.createElement("textarea",{rows:"12",value:a.generatedPrompt,onChange:l=>c({...a,generatedPrompt:l.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner",placeholder:"点击上方“生成提示词”按钮，或在此直接编写 Prompt..."}),!a.generatedPrompt&&e.createElement("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-30"},e.createElement("div",{className:"text-center"},e.createElement(ue,{size:48,className:"mx-auto mb-2 text-pink-300"}),e.createElement("p",{className:"text-sm font-bold text-pink-400"},"等待生成...")))))),e.createElement("div",{className:"col-span-12 lg:col-span-4 space-y-6"},e.createElement("div",{className:"glass-card p-6 rounded-3xl flex flex-col items-center text-center"},e.createElement("h3",{className:"font-cute text-pink-900 mb-4 w-full text-left border-b border-pink-100 pb-2"},"头像预览"),e.createElement("div",{onClick:()=>m(!0),className:"w-32 h-32 rounded-full bg-gray-100 border-4 border-white shadow-xl flex items-center justify-center mb-4 relative group cursor-pointer overflow-hidden"},a.avatar?e.createElement("img",{src:a.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.createElement("div",{className:"text-4xl text-gray-300 font-bold"},a.name?a.name[0]:"?"),e.createElement("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold"},"更换头像")),e.createElement("div",{className:"w-full"},e.createElement("label",{className:"flex items-center justify-between p-4 bg-white/50 rounded-xl cursor-pointer hover:bg-white transition-colors border border-pink-50"},e.createElement("span",{className:"text-sm font-bold text-gray-700"},"发布到广场"),e.createElement("div",{onClick:()=>c({...a,published:!a.published}),className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${a.published?"bg-pink-500":"bg-gray-300"}`},e.createElement("div",{className:`w-4 h-4 rounded-full bg-white shadow-sm transform transition-transform duration-300 ${a.published?"translate-x-6":""}`}))),e.createElement("p",{className:"text-xs text-left text-gray-400 mt-2 px-1"},"开启后，该角色将出现在公共广场，所有用户可见。"))),e.createElement("div",{className:"glass-card p-6 rounded-3xl bg-gradient-to-br from-pink-500 to-pink-600 text-white"},e.createElement("h4",{className:"font-bold mb-2 flex items-center gap-2"},e.createElement("span",{className:"inline-block"},e.createElement(de,{size:16,className:"text-yellow-300"}))," 提示"),e.createElement("p",{className:"text-xs opacity-90 leading-relaxed"},"好的 Prompt 决定了角色的灵魂。建议生成后仔细检查，补充更多细节。")))),W&&e.createElement(e.Fragment,null,e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:()=>M(!1)}),e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4"},e.createElement("div",{className:"w-full max-w-4xl rounded-3xl bg-white p-6 shadow-2xl border border-pink-50"},e.createElement("div",{className:"flex justify-between items-center mb-4"},e.createElement("button",{onClick:()=>M(!1),className:"w-8 h-8 rounded-full bg-pink-50 text-pink-800 flex items-center justify-center"},"‹"),e.createElement("h3",{className:"text-lg font-bold font-cute text-pink-900"},"添加 #标签"),e.createElement("button",{onClick:()=>M(!1),className:"text-sm font-bold text-pink-600 bg-pink-50 px-3 py-1 rounded-full"},"完成")),e.createElement("div",{className:"space-y-6 max-h-[70vh] overflow-y-auto"},e.createElement("div",null,e.createElement("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1"},"选定的标签"),e.createElement("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-pink-50/50 p-3 rounded-xl border border-pink-100 border-dashed"},a.tags.length===0?e.createElement("span",{className:"text-xs text-gray-400"},"暂无标签"):a.tags.map(l=>e.createElement("button",{key:l,onClick:()=>c(v=>({...v,tags:v.tags.filter(P=>P!==l)})),className:"bg-pink-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1"},"#",l," ",e.createElement("span",{className:"text-[10px] ml-1 opacity-80"},"×"))))),e.createElement("div",null,e.createElement("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1"},"直接添加 (自定义)"),e.createElement("div",{className:"flex gap-2"},e.createElement("input",{value:G,onChange:l=>me(l.target.value),onKeyDown:l=>{if(l.key==="Enter"){l.preventDefault();const v=G.trim();v&&c(P=>P.tags.includes(v)?P:{...P,tags:[...P.tags,v]}),me("")}},type:"text",placeholder:"输入标签，不用加#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white rounded-xl"}),e.createElement("button",{onClick:()=>{const l=G.trim();l&&c(v=>v.tags.includes(l)?v:{...v,tags:[...v.tags,l]}),me("")},className:"bg-gradient-to-r from-pink-400 to-pink-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition"},"添加"))),e.createElement("div",null,e.createElement("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1"},"标签选择"),e.createElement("div",{className:"grid grid-cols-4 gap-2"},Fe.map(l=>e.createElement("button",{key:l,onClick:()=>c(v=>({...v,tags:v.tags.includes(l)?v.tags.filter(P=>P!==l):[...v.tags,l]})),className:`tag-select-btn flex items-center justify-center ${a.tags.includes(l)?"active":""}`},"#",l)))))))),g&&e.createElement(Ce,{initialImage:a.avatar||null,onSave:async l=>{try{const v=await $e.avatar(l);c(P=>({...P,avatar:v.url}))}catch{}m(!1)},onCancel:()=>m(!1)}),g&&e.createElement(Ce,{initialImage:a.avatar,onSave:l=>{c(v=>({...v,avatar:l})),m(!1)},onCancel:()=>m(!1)}))},St=({creatorRole:t})=>{const[r,i]=s.useState("list"),[o,a]=s.useState(null),[c,u]=s.useState([]),[d,x]=s.useState("new"),{showToast:h}=X(),[k,E]=s.useState(null),_=300,C=async()=>{try{const n=t?{creator_role:t}:{},f=await ae.list(n);u(f.items||[])}catch{h("加载失败","error")}};s.useEffect(()=>{C()},[t]);const b=n=>{a(n),x("edit"),i("create")},g=()=>{a(null),x("new"),i("create")},m=n=>{const f={...n,id:void 0,name:`${n.name}_copy`,status:"draft"};a(f),x("copy"),i("create"),h("复制成功，已进入编辑")},j=async(n,f)=>{try{await ae.setStatus(n,f==="published"?"draft":"published"),await C()}catch{h("操作失败","error")}},N=n=>E(n),S=()=>E(null),T=async()=>{if(k)try{await ae.remove(k.id),h("删除成功"),await C()}catch{h("删除失败","error")}finally{S()}};return r==="create"?e.createElement(kt,{initialData:o,onCancel:()=>{i("list"),C()},mode:d,notify:h}):e.createElement("div",{className:"space-y-6 animate-fade-in"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),t==="user_role"?"用户角色":"官方角色"),e.createElement("p",{className:"text-gray-400 text-xs mt-1 ml-4"},t==="user_role"?"查看用户创建的角色":"管理官方发布的 AI 角色")),t!=="user_role"&&e.createElement("button",{onClick:g,className:"bg-gradient-to-r from-pink-500 to-pink-600 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:opacity-90 transition-all flex items-center gap-2 text-sm"},e.createElement(Z,{size:16})," 创建角色")),e.createElement("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(auto-fit, minmax(320px, 360px))"}},c.map(n=>e.createElement("div",{key:n.id,className:"relative w-full"},e.createElement("div",{className:"glass-card p-4 rounded-3xl hover:shadow-xl transition-all group relative overflow-hidden h-[220px] flex flex-col"},e.createElement("div",{className:`absolute top-4 right-4 text-xs px-2 py-0.5 rounded-md font-bold ${n.status==="published"?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"}`},n.status==="published"?"已发布":"草稿"),e.createElement("div",{className:"flex items-start gap-4"},e.createElement("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-pink-200 to-pink-300 flex items-center justify-center text-white text-xl font-bold shadow-inner border-2 border-white overflow-hidden flex-shrink-0"},n.avatar?e.createElement("img",{src:n.avatar,alt:"avatar",className:"w-full h-full object-cover"}):e.createElement("span",null,n.name?n.name[0]:"?")),e.createElement("div",{className:"flex-1 min-w-0"},e.createElement("div",{className:"flex items-baseline gap-2"},e.createElement("h3",{className:"font-bold text-lg text-gray-800 truncate"},n.name),e.createElement("div",{className:"text-xs text-gray-400 truncate"},n.age!=null&&n.age!==""?`${n.age}岁`:"",n.occupation?`${n.age!=null&&n.age!==""?" · ":""}${n.occupation}`:"")),e.createElement("div",{className:"flex gap-1 mt-2 flex-nowrap whitespace-nowrap overflow-hidden",style:{maxWidth:_}},n.tags.map(f=>e.createElement("span",{key:f,className:"text-[10px] bg-pink-50 text-pink-600 px-1.5 py-0.5 rounded border border-pink-100"},"#",f))))),e.createElement("div",{className:"mt-3"},e.createElement("p",{className:"text-gray-600 text-sm leading-relaxed break-words"},n.tagline||"暂无一句话人设")),e.createElement("div",{className:"mt-auto flex gap-2 pt-3 border-t border-white/50"},e.createElement("button",{onClick:()=>b(n),className:"flex-1 py-2 text-xs font-bold text-pink-600 bg-pink-50 hover:bg-pink-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1"},e.createElement(fe,{size:12})," 编辑"),e.createElement("button",{onClick:()=>m(n),className:"flex-1 py-2 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1"},e.createElement(Me,{size:12})," 复制"),n.status==="published"?e.createElement("button",{onClick:()=>j(n.id,n.status),className:"flex-1 py-2 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1"},e.createElement(st,{size:12})," 回收"):e.createElement("button",{onClick:()=>j(n.id,n.status),className:"flex-1 py-2 text-xs font-bold text-green-600 bg-green-50 hover:bg-green-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1"},e.createElement(rt,{size:12})," 发布"))),e.createElement("button",{onClick:()=>N(n),className:"absolute -top-2 -right-2 z-10 w-8 h-8 rounded-full bg-white/60 backdrop-blur-md shadow-lg border border-pink-100 flex items-center justify-center text-gray-400 hover:text-red-500 transition"},e.createElement(Q,{size:12}))))),k&&e.createElement(e.Fragment,null,e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:S}),e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4"},e.createElement("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 mb-2"},"删除角色"),e.createElement("p",{className:"text-sm text-gray-500 mb-4"},"确定删除“",k.name,"”吗？此操作不可撤回。"),e.createElement("div",{className:"flex justify-end gap-3"},e.createElement("button",{onClick:S,className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50"},"取消"),e.createElement("button",{onClick:T,className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600"},"确认删除"))))))},Te=({creatorRole:t})=>e.createElement(K,null,e.createElement(St,{creatorRole:t})),Ct=({user:t,onSaveLimit:r,onDelete:i,onChangePwd:o})=>{const[a,c]=s.useState(t.chatLimit),u=a!==t.chatLimit,d=()=>{r(t.id,a)};return e.createElement("tr",{className:"hover:bg-pink-50/30 transition-colors"},e.createElement("td",{className:"p-5 pl-8"},e.createElement("img",{src:t.avatar||"/uploads/avatars/default_avatar.jpg",alt:t.username,className:"w-10 h-10 rounded-full object-cover shadow-sm"})),e.createElement("td",{className:"p-5 font-mono text-gray-500"},t.id.toString().padStart(4,"0")),e.createElement("td",{className:"p-5"},e.createElement("div",{className:"font-bold text-gray-700"},t.username),e.createElement("div",{className:"text-xs text-gray-400"},t.email)),e.createElement("td",{className:"p-5"},e.createElement("div",{className:"text-xs text-gray-700"},t.nickname||"-")),e.createElement("td",{className:"p-5"},e.createElement("span",{className:"font-mono text-pink-600 font-bold"},t.used)," 次"),e.createElement("td",{className:"p-5"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("input",{type:"number",value:a,onChange:x=>c(parseInt(x.target.value)||0),className:"dream-input w-24 px-4 py-2 rounded-2xl text-sm text-center",min:"0"}))),e.createElement("td",{className:"p-5 text-right pr-8"},e.createElement("div",{className:"space-x-2"},e.createElement("span",{className:"relative inline-flex group"},e.createElement("button",{onClick:d,disabled:!u,className:`p-1 rounded ${u?"text-green-600 hover:text-green-700":"text-gray-300 cursor-not-allowed"}`,"aria-label":"保存设置"},e.createElement(je,{size:16})),e.createElement("span",{className:`absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap transition-opacity ${u?"opacity-0 group-hover:opacity-100":"hidden"}`},"保存设置")),e.createElement("span",{className:"relative inline-flex group"},e.createElement("button",{onClick:o,className:"p-1 rounded text-pink-400 hover:text-pink-600","aria-label":"修改密码"},e.createElement(fe,{size:16})),e.createElement("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100"},"修改密码")),e.createElement("span",{className:"relative inline-flex group"},e.createElement("button",{onClick:i,className:"p-1 rounded text-red-400 hover:text-red-600","aria-label":"删除"},e.createElement(ce,{size:16})),e.createElement("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100"},"删除")))))},Tt=({onCancel:t,onSave:r,notify:i})=>{const[o,a]=s.useState({username:"",nickname:"",email:"",password:"",chatLimit:0}),c=d=>{const{name:x,value:h}=d.target;a(k=>({...k,[x]:x==="chatLimit"?parseInt(h)||0:h}))},u=()=>{if(!o.username||!o.password){i&&i("创建失败：请填写用户名和密码","error");return}const d={username:o.username,nickname:o.nickname||null,email:o.email||`${o.username.toLowerCase()}@example.com`,password:o.password,chatLimit:o.chatLimit};r(d)};return e.createElement("div",{className:"animate-fade-in pb-10"},e.createElement("div",{className:"flex items-center gap-4 mb-6"},e.createElement("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors"},e.createElement(oe,{size:20})),e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900"},"添加新用户"),e.createElement("p",{className:"text-gray-400 text-xs"},"分配后台登录权限和聊天额度")),e.createElement("div",{className:"ml-auto flex gap-3"},e.createElement("button",{onClick:t,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50"},"取消"),e.createElement("button",{onClick:u,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text白 font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2"},e.createElement(Z,{size:16})," 创建用户"))),e.createElement("div",{className:"solid-card p-8 rounded-3xl space-y-6 max-w-2xl mx-auto"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 用户基础信息"),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"用户名"),e.createElement("input",{type:"text",name:"username",value:o.username,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"为新用户设置一个用户名"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"昵称"),e.createElement("input",{type:"text",name:"nickname",value:o.nickname,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"显示名称（可选）"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"邮箱"),e.createElement("input",{type:"email",name:"email",value:o.email,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"用于联系与通知（可选）"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"密码 (初始密码)"),e.createElement("input",{type:"password",name:"password",value:o.password,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"设置初始密码"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"聊天额度 (次数)"),e.createElement("input",{type:"number",name:"chatLimit",value:o.chatLimit,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"0 表示默认无额度",min:"0"}),e.createElement("p",{className:"text-xs text-gray-400 mt-1"},"设置用户默认可用的聊天次数，0 次表示用户初始无额度。"))))},_t=()=>{const[t,r]=s.useState([]),[i,o]=s.useState("list"),[a,c]=s.useState(""),[u,d]=s.useState(null),[x,h]=s.useState(""),[k,E]=s.useState(""),[_,C]=s.useState(null),{showToast:b}=X();s.useEffect(()=>{ee.list().then(r).catch(()=>{})},[]);const g=async n=>{try{const{id:f}=await ee.create(n);r($=>[...$,{...n,id:f,used:0}]),b(`用户 ${n.username} 创建成功`),o("list")}catch{b("创建失败","error")}},m=async(n,f)=>{try{await ee.update(n,{chatLimit:f}),r(A=>A.map(U=>U.id===n?{...U,chatLimit:f}:U));const $=t.find(A=>A.id===n);b(`用户 ${$?.username??n} 限额已更新`)}catch{b("保存失败","error")}},j=async n=>{try{await ee.remove(n),r(f=>f.filter($=>$.id!==n)),b("用户已删除")}catch{b("删除失败","error")}},N=_&&e.createElement("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center"},e.createElement("div",{className:"bg-white rounded-2xl p-6 w-80"},e.createElement("div",{className:"font-bold mb-3"},"确认删除该用户？"),e.createElement("p",{className:"text-sm text-gray-500 mb-5"},"此操作不可恢复。"),e.createElement("div",{className:"flex gap-2 justify-end"},e.createElement("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>C(null)},"取消"),e.createElement("button",{className:"px-4 py-2 rounded-xl bg-red-500 text-white",onClick:()=>{const n=_.id;C(null),j(n)}},"删除")))),S=u&&e.createElement("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center"},e.createElement("div",{className:"bg-white rounded-2xl p-6 w-96"},e.createElement("div",{className:"font-bold mb-3"},"为用户 ",u.username," 修改密码"),e.createElement("div",{className:"space-y-3"},e.createElement("input",{type:"password",placeholder:"输入新密码",className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700",value:x,onChange:n=>h(n.target.value)}),e.createElement("input",{type:"password",placeholder:"再次输入新密码",className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700",value:k,onChange:n=>E(n.target.value)})),e.createElement("div",{className:"flex gap-2 justify-end mt-5"},e.createElement("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{d(null),h(""),E("")}},"取消"),e.createElement("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:async()=>{if(!x||x!==k){b("两次输入密码不一致","error");return}try{await ee.changePassword(u.id,x),b("密码已更新")}catch{b("更新失败","error")}d(null),h(""),E("")}},"确认修改")))),T=t.filter(n=>n.username?.toLowerCase().includes(a.toLowerCase())||(n.nickname?n.nickname.toLowerCase().includes(a.toLowerCase()):!1)||n.email?.toLowerCase().includes(a.toLowerCase()));return i==="create"?e.createElement(Tt,{onCancel:()=>o("list"),onSave:g,notify:b}):e.createElement("div",{className:"space-y-6 animate-fade-in"},N,S,e.createElement("div",{className:"flex justify-between items-center"},e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"})," 用户管理"),e.createElement("p",{className:"text-gray-400 text-xs mt-1 ml-4"},"监控用户使用情况与限额")),e.createElement("div",{className:"flex gap-3"},e.createElement("div",{className:"relative"},e.createElement("input",{type:"text",placeholder:"搜索用户名/邮箱...",className:"dream-input pl-10 pr-4 py-2 rounded-xl text-sm w-64",value:a,onChange:n=>c(n.target.value)}),e.createElement(ot,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-pink-300"})),e.createElement("button",{onClick:()=>o("create"),className:"bg-pink-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-sm"},e.createElement(Z,{size:16})," 添加用户"))),e.createElement("div",{className:"glass-card rounded-3xl overflow-hidden"},e.createElement("table",{className:"w-full text-left"},e.createElement("thead",{className:"bg-pink-50/50 text-pink-900 font-cute text-sm"},e.createElement("tr",null,e.createElement("th",{className:"p-5 pl-8"},"头像"),e.createElement("th",{className:"p-5"},"用户 ID"),e.createElement("th",{className:"p-5"},"用户名 / 邮箱"),e.createElement("th",{className:"p-5"},"昵称"),e.createElement("th",{className:"p-5"},"已用次数"),e.createElement("th",{className:"p-5"},"剩余额度"),e.createElement("th",{className:"p-5 text-right pr-8"},"操作"))),e.createElement("tbody",{className:"text-sm divide-y divide-pink-50"},T.length>0?T.map(n=>e.createElement(Ct,{key:n.id,user:n,onSaveLimit:m,onDelete:()=>C(n),onChangePwd:()=>d(n)})):e.createElement("tr",null,e.createElement("td",{colSpan:"5",className:"p-10 text-center text-gray-400"},"未找到匹配的用户。"))))))},It=()=>e.createElement(K,null,e.createElement(_t,null)),pe=({value:t,onChange:r})=>e.createElement("div",{className:"flex items-center gap-2"},e.createElement("input",{type:"number",min:"0",max:"2",step:"0.05",value:t,onChange:i=>r(i.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.createElement("div",{className:"relative group"},e.createElement(xe,{size:18,className:"text-pink-400 cursor-help"}),e.createElement("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center"},"温度：高数值输出随机，低数值输出集中。"))),Pt=()=>{const[t,r]=s.useState([]),[i,o]=s.useState(""),[a,c]=s.useState(!1),u=s.useRef(null),[d,x]=s.useState(""),[h,k]=s.useState(!1),E=s.useRef(null),[_,C]=s.useState(""),[b,g]=s.useState(!1),m=s.useRef(null),[j,N]=s.useState(.1),[S,T]=s.useState(.1),[n,f]=s.useState(.1),[$,A]=s.useState(null),{showToast:U}=X(),y=w=>{const O=t.find(V=>V.model_id===w);return O?O.model_name||O.model_id:"-- 请选择 --"},L=async()=>{try{const w=await ne.list();r(w.items||[])}catch{U("模型列表加载失败","error")}};s.useEffect(()=>{L(),(async()=>{try{const w=await Ne.get();o(w.selected_model),x(w.selected_chat_model),C(w.selected_story_model),N(Number(w.model_temperature||.1)),T(Number(w.chat_temperature||.1)),f(Number(w.story_temperature||.1)),A(w.default_template_id||null)}catch{U("加载设置失败","error")}})()},[]),s.useEffect(()=>{const w=O=>{a&&u.current&&!u.current.contains(O.target)&&c(!1),h&&E.current&&!E.current.contains(O.target)&&k(!1),b&&m.current&&!m.current.contains(O.target)&&g(!1)};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[a,h,b]);const R=[...t].sort((w,O)=>(w.model_name||w.model_id).localeCompare(O.model_name||O.model_id)),I=y(i),p=y(d),D=y(_),F=async()=>{try{await Ne.save({selected_model:i,selected_chat_model:d,selected_story_model:_,model_temperature:Number(j),chat_temperature:Number(S),story_temperature:Number(n),default_template_id:$}),U("设置已保存")}catch{U("保存失败","error")}};return e.createElement("div",{className:"space-y-6 animate-fade-in"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"模型设置"),e.createElement("p",{className:"text-gray-400 text-xs mt-1 ml-4"},"配置全局模型与温度参数"))),e.createElement("div",{className:"solid-card p-8 rounded-3xl"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-4"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"}),"模型配置"),e.createElement("div",{className:"space-y-5"},e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"角色提示词AI模型"),e.createElement("div",{className:"flex items-center gap-4"},e.createElement("div",{className:"relative w-full max-w-md",ref:u},e.createElement("button",{onClick:()=>c(!a),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${a?"border-pink-500 ring-4 ring-pink-100/50":""}`},e.createElement("span",{className:`${i?"text-gray-700":"text-gray-400 font-normal"}`},I),e.createElement("div",{className:`text-pink-400 transition-transform ${a?"rotate-180":""}`},"▼")),a&&e.createElement("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50"},R.length===0?e.createElement("li",{className:"px-4 py-3 text-sm text-gray-400"},"暂无模型，请先添加"):R.map(w=>e.createElement("li",{key:w.id,onClick:()=>{o(w.model_id),c(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${i===w.model_id?"bg-pink-100 font-bold text-pink-700":""}`},w.model_name||w.model_id)))),e.createElement(pe,{value:j,onChange:N}),e.createElement("button",{onClick:F,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2"},e.createElement(te,{size:16})," 确认"))),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"角色聊天AI模型"),e.createElement("div",{className:"flex items-center gap-4"},e.createElement("div",{className:"relative w-full max-w-md",ref:E},e.createElement("button",{onClick:()=>k(!h),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${h?"border-pink-500 ring-4 ring-pink-100/50":""}`},e.createElement("span",{className:`${d?"text-gray-700":"text-gray-400 font-normal"}`},p),e.createElement("div",{className:`text-pink-400 transition-transform ${h?"rotate-180":""}`},"▼")),h&&e.createElement("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50"},R.length===0?e.createElement("li",{className:"px-4 py-3 text-sm text-gray-400"},"暂无模型，请先添加"):R.map(w=>e.createElement("li",{key:w.id,onClick:()=>{x(w.model_id),k(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${d===w.model_id?"bg-pink-100 font-bold text-pink-700":""}`},w.model_name||w.model_id)))),e.createElement(pe,{value:S,onChange:T}),e.createElement("button",{onClick:F,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2"},e.createElement(te,{size:16})," 确认"))),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"故事生成AI模型"),e.createElement("div",{className:"flex items-center gap-4"},e.createElement("div",{className:"relative w-full max-w-md",ref:m},e.createElement("button",{onClick:()=>g(!b),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${b?"border-pink-500 ring-4 ring-pink-100/50":""}`},e.createElement("span",{className:`${_?"text-gray-700":"text-gray-400 font-normal"}`},D),e.createElement("div",{className:`text-pink-400 transition-transform ${b?"rotate-180":""}`},"▼")),b&&e.createElement("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50"},R.length===0?e.createElement("li",{className:"px-4 py-3 text-sm text-gray-400"},"暂无模型，请先添加"):R.map(w=>e.createElement("li",{key:w.id,onClick:()=>{C(w.model_id),g(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${_===w.model_id?"bg-pink-100 font-bold text-pink-700":""}`},w.model_name||w.model_id)))),e.createElement(pe,{value:n,onChange:f}),e.createElement("button",{onClick:F,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2"},e.createElement(te,{size:16})," 确认"))))))},zt=()=>e.createElement(K,null,e.createElement(Pt,null)),jt=()=>{const{showToast:t}=X(),[r,i]=s.useState([]),[o,a]=s.useState(1),c=6,[u,d]=s.useState(!1),[x,h]=s.useState({model_id:"",model_name:"",model_nickname:""}),[k,E]=s.useState(null),_=async()=>{try{const N=await ne.list();i(N.items||[])}catch{t("模型列表加载失败","error")}};s.useEffect(()=>{_()},[]);const C=N=>{if(!N)return"-";const S=new Date(N),T=S.getFullYear(),n=String(S.getMonth()+1).padStart(2,"0"),f=String(S.getDate()).padStart(2,"0"),$=String(S.getHours()).padStart(2,"0"),A=String(S.getMinutes()).padStart(2,"0");return`${T}/${n}/${f} ${$}:${A}`},b=Math.max(1,Math.ceil(r.length/c)),g=(o-1)*c,m=r.slice(g,g+c);s.useEffect(()=>{o>b&&a(b)},[r]);const j=async()=>{if(!x.model_id||!x.model_name){t("请填写完整信息","error");return}try{await ne.create(x),t("模型添加成功"),d(!1),h({model_id:"",model_name:"",model_nickname:""}),_()}catch{t("添加失败","error")}};return e.createElement("div",{className:"space-y-6 animate-fade-in"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"模型管理"),e.createElement("p",{className:"text-gray-400 text-xs mt-1 ml-4"},"维护可用的模型列表")),e.createElement("button",{onClick:()=>d(!0),className:"bg-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-xs"},e.createElement(Z,{size:14})," 添加模型")),e.createElement("div",{className:"glass-card rounded-2xl overflow-hidden border border-pink-100"},e.createElement("table",{className:"w-full text-left border-collapse"},e.createElement("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm"},e.createElement("tr",null,e.createElement("th",{className:"p-3 pl-6 w-16"},"序号"),e.createElement("th",{className:"p-3"},"模型名称"),e.createElement("th",{className:"p-3"},"模型ID"),e.createElement("th",{className:"p-3"},"盲测模型昵称"),e.createElement("th",{className:"p-3"},"添加时间"),e.createElement("th",{className:"p-3 text-right pr-6"},"操作"))),e.createElement("tbody",{className:"text-sm divide-y divide-pink-100"},m.map((N,S)=>e.createElement("tr",{key:N.id,className:"hover:bg-pink-50/30 transition-colors"},e.createElement("td",{className:"p-3 pl-6 text-gray-500 font-mono"},g+S+1),e.createElement("td",{className:"p-3 font-bold text-pink-700"},N.model_name),e.createElement("td",{className:"p-3 font-mono text-gray-600"},N.model_id),e.createElement("td",{className:"p-3 text-gray-600"},N.model_nickname||"-"),e.createElement("td",{className:"p-3 text-gray-500"},C(N.created_at)),e.createElement("td",{className:"p-3 text-right pr-6"},e.createElement("button",{onClick:()=>E(N),className:"text-red-400 hover:text-red-600 p-1"},e.createElement(ce,{size:16}))))),r.length===0&&e.createElement("tr",null,e.createElement("td",{colSpan:"5",className:"p-8 text-center text-gray-400 text-sm"},"暂无模型数据")))),e.createElement("div",{className:"flex items-center justify-between p-3"},e.createElement("div",{className:"text-xs text-gray-500"},"第 ",o," / ",b," 页"),e.createElement("div",{className:"flex items-center gap-2"},e.createElement("button",{disabled:o===1,onClick:()=>a(N=>Math.max(1,N-1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${o===1?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`},"上一页"),Array.from({length:b}).map((N,S)=>e.createElement("button",{key:S,onClick:()=>a(S+1),className:`w-8 h-8 rounded-lg text-xs font-bold ${o===S+1?"bg-pink-500 text-white":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`},S+1)),e.createElement("button",{disabled:o===b,onClick:()=>a(N=>Math.min(b,N+1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${o===b?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`},"下一页")))),k&&e.createElement(e.Fragment,null,e.createElement("div",{className:"fixed inset-0 bg-black/30 z-50",onClick:()=>E(null)}),e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-0 z-50 flex items-center justify-center p-4"},e.createElement("div",{className:"bg白 rounded-3xl border border-pink-100 p-6 w-full max-w-md shadow-2xl"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 mb-2"},"删除模型"),e.createElement("p",{className:"text-sm text-gray-500 mb-4"},"确定删除“",k.model_name,"”吗？此操作不可撤回。"),e.createElement("div",{className:"flex justify-end gap-3"},e.createElement("button",{onClick:()=>E(null),className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50"},"取消"),e.createElement("button",{onClick:async()=>{try{await ne.remove(k.id),t("删除成功"),E(null),_()}catch{t("删除失败","error")}},className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600"},"确认删除"))))),u&&e.createElement(e.Fragment,null,e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50 backdrop-blur-sm",onClick:()=>d(!1)}),e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4"},e.createElement("div",{className:"bg白 rounded-3xl border border-pink-100 shadow-2xl p-6 animate-fade-in w-full max-w-md"},e.createElement("div",{className:"flex justify-between items-center mb-6"},e.createElement("h3",{className:"font-cute text-xl text-pink-900"},"添加新模型"),e.createElement("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600 transition-colors"},e.createElement(Q,{size:20}))),e.createElement("div",{className:"space-y-4"},e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-1.5"},"模型ID ",e.createElement("span",{className:"text-red-400"},"*")),e.createElement("input",{type:"text",value:x.model_id,onChange:N=>h({...x,model_id:N.target.value}),placeholder:"例如: gpt-4-turbo",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-1.5"},"模型名称 ",e.createElement("span",{className:"text-red-400"},"*")),e.createElement("input",{type:"text",value:x.model_name,onChange:N=>h({...x,model_name:N.target.value}),placeholder:"例如: GPT-4 Turbo",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-1.5"},"盲测模型昵称"),e.createElement("input",{type:"text",value:x.model_nickname,onChange:N=>h({...x,model_nickname:N.target.value}),placeholder:"例如: 智慧之星",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"}))),e.createElement("div",{className:"flex justify-end gap-3 mt-8"},e.createElement("button",{onClick:()=>d(!1),className:"px-5 py-2.5 rounded-xl bg-gray-50 text-gray-600 font-bold text-sm hover:bg-gray-100 transition-colors"},"取消"),e.createElement("button",{onClick:j,className:"px-6 py-2.5 rounded-xl bg-pink-500 text白 font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-600 transition-all"},"保存模型"))))))},Mt=()=>e.createElement(K,null,e.createElement(jt,null)),$t=()=>{const{showToast:t}=X(),[r,i]=s.useState([]),[o,a]=s.useState("list"),[c,u]=s.useState({username:"",email:"",password:""}),[d,x]=s.useState(null),[h,k]=s.useState(""),E=async()=>{try{const m=await H.list();i(m)}catch{t("加载失败","error")}};s.useEffect(()=>{E()},[]);const _=async()=>{if(!c.username||!c.password){t("请填写必填项","error");return}try{const{id:m}=await H.create(c);i(j=>[...j,{id:m,username:c.username,email:c.email||"",isActive:1}]),a("list"),u({username:"",email:"",password:""}),t("管理员添加成功")}catch{t("添加失败","error")}},C=async(m,j)=>{try{await H.update(m,{isActive:j}),i(N=>N.map(S=>S.id===m?{...S,isActive:j}:S)),t(j?"已启用":"已禁用")}catch{t("更新失败","error")}},b=async m=>{try{await H.remove(m),i(j=>j.filter(N=>N.id!==m)),t("删除成功")}catch{t("删除失败","error")}},g=async()=>{if(!h){t("请输入新密码","error");return}try{await H.changePassword(d.id,h),x(null),k(""),t("密码已更新")}catch{t("更新失败","error")}};return o==="create"?e.createElement("div",{className:"animate-fade-in pb-10"},e.createElement("div",{className:"flex items-center gap-4 mb-6"},e.createElement("button",{onClick:()=>a("list"),className:"px-5 py-2.5 rounded-xl bg-white text-gray-600 font-bold text-sm shadow-sm hover:bg-gray-50"},"返回"),e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900"},"添加管理员"),e.createElement("p",{className:"text-gray-400 text-xs"},"创建新的后台管理员账号")),e.createElement("div",{className:"ml-auto flex gap-3"},e.createElement("button",{onClick:()=>a("list"),className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50"},"取消"),e.createElement("button",{onClick:_,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2"},e.createElement(Z,{size:16})," 创建管理员"))),e.createElement("div",{className:"solid-card p-8 rounded-3xl space-y-6 max-w-2xl mx-auto"},e.createElement("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2"},e.createElement("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 管理员信息"),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"用户名"),e.createElement("input",{type:"text",value:c.username,onChange:m=>u({...c,username:m.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"邮箱"),e.createElement("input",{type:"email",value:c.email,onChange:m=>u({...c,email:m.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})),e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-2"},"初始密码"),e.createElement("input",{type:"password",value:c.password,onChange:m=>u({...c,password:m.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})))):e.createElement("div",{className:"space-y-6 animate-fade-in"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2"},e.createElement("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"管理员账号"),e.createElement("p",{className:"text-gray-400 text-xs mt-1 ml-4"},"管理后台管理员列表、禁用与密码修改")),e.createElement("button",{onClick:()=>a("create"),className:"bg-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-xs"},e.createElement(Z,{size:14})," 添加管理员")),e.createElement("div",{className:"glass-card rounded-2xl overflow-hidden border border-pink-100"},e.createElement("table",{className:"w-full text-left border-collapse"},e.createElement("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm"},e.createElement("tr",null,e.createElement("th",{className:"p-3 pl-6 w-20"},"头像"),e.createElement("th",{className:"p-3 w-20"},"ID"),e.createElement("th",{className:"p-3"},"用户名"),e.createElement("th",{className:"p-3"},"昵称"),e.createElement("th",{className:"p-3"},"邮箱"),e.createElement("th",{className:"p-3"},"状态"),e.createElement("th",{className:"p-3 text-right pr-6"},"操作"))),e.createElement("tbody",{className:"text-sm divide-y divide-pink-100"},r.map(m=>e.createElement("tr",{key:m.id,className:"hover:bg-pink-50/30 transition-colors"},e.createElement("td",{className:"p-3 pl-6"},e.createElement("img",{src:m.avatar||"/uploads/avatars/default_admin.jpg",alt:m.username,className:"w-8 h-8 rounded-full object-cover shadow-sm"})),e.createElement("td",{className:"p-3 text-gray-500 font-mono"},m.id.toString().padStart(4,"0")),e.createElement("td",{className:"p-3 font-bold text-pink-700"},m.username),e.createElement("td",{className:"p-3 text-gray-700"},m.nickname||"-"),e.createElement("td",{className:"p-3 text-gray-600"},m.email||"-"),e.createElement("td",{className:"p-3"},m.isActive===1?"启用":"禁用"),e.createElement("td",{className:"p-3 text-right pr-6"},e.createElement("div",{className:"flex items-center gap-2 justify-end"},e.createElement("button",{onClick:()=>x(m),className:"px-3 py-1 rounded bg-white border border-gray-200 text-gray-600 text-xs hover:bg-gray-50"},"改密"),e.createElement("button",{onClick:()=>C(m.id,m.isActive===1?0:1),className:`px-3 py-1 rounded text-xs font-bold ${m.isActive===1?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`},m.isActive===1?"禁用":"启用"),e.createElement("button",{onClick:()=>b(m.id),className:"px-3 py-1 rounded bg-red-500 text-white text-xs hover:bg-red-600"},"删除"))))),r.length===0&&e.createElement("tr",null,e.createElement("td",{colSpan:"5",className:"p-8 text-center text-gray-400 text-sm"},"暂无管理员"))))),d&&e.createElement(e.Fragment,null,e.createElement("div",{className:"fixed inset-0 bg-black/30 z-50",onClick:()=>x(null)}),e.createElement("div",{className:"fixed top-0 right-0 bottom-0 left-0 z-50 flex items-center justify-center p-4"},e.createElement("div",{className:"bg-white rounded-3xl border border-pink-100 p-6 w-full max-w-md shadow-2xl"},e.createElement("div",{className:"flex justify-between items-center mb-6"},e.createElement("h3",{className:"font-cute text-lg text-pink-900"},"修改密码"),e.createElement("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-600 transition-colors"},e.createElement(Q,{size:20}))),e.createElement("div",{className:"space-y-4"},e.createElement("div",null,e.createElement("label",{className:"block text-xs font-bold text-pink-800 mb-1.5"},"新密码"),e.createElement("input",{type:"password",value:h,onChange:m=>k(m.target.value),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"}))),e.createElement("div",{className:"flex justify-end gap-3 mt-8"},e.createElement("button",{onClick:()=>x(null),className:"px-5 py-2.5 rounded-xl bg-gray-50 text-gray-600 font-bold text-sm hover:bg-gray-100 transition-colors"},"取消"),e.createElement("button",{onClick:g,className:"px-6 py-2.5 rounded-xl bg-pink-500 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-600 transition-all"},"确认修改"))))))},Lt=()=>e.createElement(K,null,e.createElement($t,null)),Rt=()=>{const[t,r]=s.useState(!1),[i,o]=s.useState("templates"),[a,c]=s.useState(""),[u,d]=s.useState(!1),[x,h]=s.useState(""),[k,E]=s.useState(""),[_,C]=s.useState(""),b=async()=>{const m={};if(x&&x.trim()&&(m.nickname=x.trim()),k){if(k!==_)return;m.password=k}try{await H.updateMe(m),d(!1),h(""),E(""),C("")}catch{}},g=m=>{window.history&&window.history.replaceState&&window.history.replaceState(null,"",m)};return s.useEffect(()=>{const m=localStorage.getItem("admin_access_token"),j=localStorage.getItem("admin_username"),N=window.location.pathname;m?(r(!0),j&&c(j),o("templates"),N!=="/super-admin/sysprompt"&&g("/super-admin/sysprompt")):(r(!1),N!=="/super-admin/login"&&g("/super-admin/login"))},[]),t?e.createElement("div",{className:"flex min-h-screen bg-white"},e.createElement(Se,null),e.createElement(ut,{activeTab:i,setActiveTab:m=>{o(m),m==="templates"&&g("/super-admin/sysprompt")},onLogout:()=>{r(!1),localStorage.removeItem("admin_access_token"),localStorage.removeItem("admin_refresh_token"),localStorage.removeItem("admin_username"),g("/super-admin/login")},username:a,onEditProfile:()=>d(!0)}),e.createElement("main",{className:"flex-1 ml-16 xl:ml-56 p-8 relative z-10 transition-all duration-300 h-screen overflow-y-auto"},e.createElement("div",{className:"absolute top-0 right-0 p-4 pointer-events-none opacity-20"},e.createElement(re,{size:120,className:"text-pink-300"})),i==="templates"&&e.createElement(bt,null),(i==="characters"||i==="official_characters")&&e.createElement(Te,{creatorRole:"admin_role"}),i==="user_characters"&&e.createElement(Te,{creatorRole:"user_role"}),i==="users"&&e.createElement(It,null),i==="model_settings"&&e.createElement(zt,null),i==="model_manage"&&a==="admin"&&e.createElement(Mt,null),i==="admin_accounts"&&a==="admin"&&e.createElement(Lt,null)),e.createElement("div",{className:"ambient-bg"}),u&&e.createElement("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/40"},e.createElement("div",{className:"bg-white rounded-2xl p-6 w-96 shadow-2xl"},e.createElement("div",{className:"font-bold mb-4 text-pink-900"},"修改资料"),e.createElement("div",{className:"space-y-3"},e.createElement("div",null,e.createElement("input",{type:"text",placeholder:`昵称（当前：${a}）`,value:x,onChange:m=>h(m.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})),e.createElement("div",null,e.createElement("input",{type:"password",placeholder:"新密码",value:k,onChange:m=>E(m.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})),e.createElement("div",null,e.createElement("input",{type:"password",placeholder:"再次输入新密码",value:_,onChange:m=>C(m.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"}))),e.createElement("div",{className:"flex gap-2 justify-end mt-5"},e.createElement("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{d(!1),h(""),E(""),C("")}},"取消"),e.createElement("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:b,disabled:!x.trim()&&!k},"保存"))))):e.createElement(e.Fragment,null,e.createElement(Se,null),e.createElement(K,null,e.createElement(pt,{onLogin:()=>{r(!0);const m=localStorage.getItem("admin_username");m&&c(m),o("templates"),g("/super-admin/sysprompt")}})))};export{Rt as default};
