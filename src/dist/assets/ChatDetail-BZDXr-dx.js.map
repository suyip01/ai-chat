{"version":3,"file":"ChatDetail-BZDXr-dx.js","sources":["../../node_modules/lucide-react/dist/esm/icons/ellipsis-vertical.js","../../node_modules/lucide-react/dist/esm/icons/message-square.js","../../user/components/UserRoleSelectorSheet.tsx","../../user/components/ModelSelectorSheet.tsx","../../user/components/ChatDetail.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.555.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"1\", key: \"41hilf\" }],\n  [\"circle\", { cx: \"12\", cy: \"5\", r: \"1\", key: \"gxeob9\" }],\n  [\"circle\", { cx: \"12\", cy: \"19\", r: \"1\", key: \"lyex9k\" }]\n];\nconst EllipsisVertical = createLucideIcon(\"ellipsis-vertical\", __iconNode);\n\nexport { __iconNode, EllipsisVertical as default };\n//# sourceMappingURL=ellipsis-vertical.js.map\n","/**\n * @license lucide-react v0.555.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z\",\n      key: \"18887p\"\n    }\n  ]\n];\nconst MessageSquare = createLucideIcon(\"message-square\", __iconNode);\n\nexport { __iconNode, MessageSquare as default };\n//# sourceMappingURL=message-square.js.map\n","import React, { useEffect, useState } from 'react'\nimport { ChevronLeft, CheckCircle, Plus } from 'lucide-react'\nimport { UserPersona } from '../types'\nimport { fetchUserChatRoles } from '../services/chatService'\nimport { AnimatePresence, motion } from 'framer-motion'\nimport { androidBottomSheet, fade } from '../animations'\n\ninterface Props {\n  isOpen: boolean\n  currentPersona?: UserPersona\n  onClose: () => void\n  onAdd: () => void\n  onSelect: (persona: UserPersona, roleId?: number) => void\n}\n\nconst mapGender = (g?: string): 'male' | 'female' | 'secret' => {\n  if (g === '男') return 'male'\n  if (g === '女') return 'female'\n  return 'secret'\n}\n\nexport const UserRoleSelectorSheet: React.FC<Props> = ({ isOpen, currentPersona, onClose, onAdd, onSelect }) => {\n  const [roles, setRoles] = useState<Array<{ id: number; name: string; age: number | null; gender: string; profession: string | null; basic_info: string | null; personality: string | null; avatar: string | null }>>([])\n  const [selected, setSelected] = useState<number | null>(null)\n\n  useEffect(() => {\n    if (isOpen) {\n      const load = async () => {\n        try {\n          const list = await fetchUserChatRoles()\n          setRoles(list)\n        } catch { }\n      }\n      load()\n    }\n  }, [isOpen])\n\n  useEffect(() => {\n    if (currentPersona) {\n      const m = roles.find(r => r.name === currentPersona.name)\n      if (m) setSelected(m.id)\n    }\n  }, [roles, currentPersona])\n\n  const handleSelect = (r: any) => {\n    setSelected(r.id)\n    const persona: UserPersona = {\n      name: r.name || '',\n      gender: mapGender(r.gender),\n      age: r.age ? String(r.age) : '',\n      profession: r.profession || '',\n      basicInfo: r.basic_info || '',\n      personality: r.personality || '',\n      avatar: r.avatar || undefined\n    }\n    try { localStorage.setItem('user_chat_role_id', String(r.id)) } catch { }\n    onSelect(persona, r.id)\n    onClose()\n  }\n\n  return (\n    <div className={`fixed inset-0 z-[90] ${isOpen ? '' : 'pointer-events-none'}`}>\n      <AnimatePresence>\n        {isOpen && (\n          <>\n            <motion.div\n              key=\"backdrop\"\n              className=\"absolute inset-0 bg-black/30 will-change-opacity\"\n              onClick={onClose}\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              transition={fade}\n            />\n            <motion.div\n              key=\"sheet\"\n              className=\"absolute bottom-0 left-0 right-0 bg-transparent will-change-transform transform-gpu\"\n              initial={{ y: '100%' }}\n              animate={{ y: 0 }}\n              exit={{ y: '100%' }}\n              transition={androidBottomSheet}\n            >\n              <div className=\"mx-auto w-full max-w-md bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)]\">\n                <div className=\"sticky top-0 bg-white/95 backdrop-blur-md p-3 border-b border-slate-100 flex justify-between items-center z-10\">\n                  <button onClick={onClose} className=\"flex items-center gap-2\"><ChevronLeft className=\"w-6 h-6\" /><span className=\"font-bold text-lg\">我的多重个人资料</span></button>\n                  <button onClick={onAdd} className=\"w-9 h-9 rounded-full bg-purple-50 text-[#A855F7] flex items-center justify-center active:scale-90 transition-transform\">\n                    <Plus className=\"w-6 h-6\" />\n                  </button>\n                </div>\n                <div className=\"p-4 flex flex-col gap-3 max-h-[70vh] overflow-y-auto\">\n                  {roles.map(r => (\n                    <div key={r.id} onClick={() => handleSelect(r)} className={`p-4 bg白 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3 active:scale-[0.98] transition-transform ${selected === r.id ? 'border-[#A855F7] bg-[#FBF5FF]' : ''}`}>\n                      <div className=\"w-10 h-10 rounded-full overflow-hidden bg-slate-200 flex items-center justify-center text-slate-600 font-bold\">\n                        {r.avatar ? <img src={r.avatar} alt={r.name} className=\"w-full h-full object-cover\" /> : (r.name || '我')[0]}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"font-bold text-slate-800 truncate\">{r.name}</div>\n                        <div className=\"text-xs text-slate-500 truncate\">{r.profession || ''}{r.age ? ` · ${r.age}` : ''}</div>\n                      </div>\n                      {selected === r.id && <CheckCircle className=\"w-5 h-5 text-[#A855F7]\" />}\n                    </div>\n                  ))}\n                  {!roles.length && (\n                    <div className=\"p-6 text-center text-slate-500\">\n                      <div className=\"text-sm\">暂无角色</div>\n                      <div className=\"mt-3\"><button onClick={onAdd} className=\"px-3 py-1.5 bg-[#A855F7] text-white rounded-lg text-sm font-bold\">添加角色</button></div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </motion.div>\n          </>\n        )}\n      </AnimatePresence>\n    </div>\n  )\n}\n\nexport default UserRoleSelectorSheet\n","import React, { useEffect, useState } from 'react'\nimport { ChevronLeft, CheckCircle } from 'lucide-react'\nimport { AnimatePresence, motion } from 'framer-motion'\nimport { androidBottomSheet, fade } from '../animations'\nimport { listModels } from '../services/chatService'\n\ninterface Props {\n  isOpen: boolean\n  currentModelId?: string\n  onClose: () => void\n  onSelect: (modelId: string, nickname?: string) => void\n  temperature?: number\n  onTempChange?: (t: number) => void\n}\n\nexport const ModelSelectorSheet: React.FC<Props> = ({ isOpen, currentModelId, onClose, onSelect, temperature, onTempChange }) => {\n  const [models, setModels] = useState<Array<{ id: string; nickname: string }>>([])\n  const [selected, setSelected] = useState<string | undefined>(currentModelId)\n  const [temp, setTemp] = useState<number>(typeof temperature === 'number' ? temperature : 0.1)\n\n  useEffect(() => { setSelected(currentModelId) }, [currentModelId])\n  useEffect(() => { if (typeof temperature === 'number') setTemp(temperature) }, [temperature])\n\n  useEffect(() => {\n    if (!isOpen) return\n    const load = async () => { try {\n      const items = await listModels();\n      const sorted = [...items].sort((a,b) => ((a.nickname || a.id).localeCompare(b.nickname || b.id, 'zh-CN', { sensitivity: 'base' })))\n      setModels(sorted)\n    } catch {} }\n    load()\n  }, [isOpen])\n\n  return (\n    <div className={`fixed inset-0 z-[90] ${isOpen ? '' : 'pointer-events-none'}`}>\n      <AnimatePresence>\n        {isOpen && (\n          <>\n            <motion.div key=\"backdrop\" className=\"absolute inset-0 bg-black/30 will-change-opacity\" onClick={onClose} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={fade} />\n            <motion.div key=\"sheet\" className=\"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)] will-change-transform transform-gpu\" initial={{ y: '100%' }} animate={{ y: 0 }} exit={{ y: '100%' }} transition={androidBottomSheet}>\n              <div className=\"sticky top-0 bg-white/95 backdrop-blur-md p-3 border-b border-slate-100 flex justify-between items-center z-10\">\n                <button onClick={onClose} className=\"flex items-center gap-2\"><ChevronLeft className=\"w-6 h-6\" /><span className=\"font-bold text-lg\">我的模型</span></button>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm font-bold text-slate-700\">温度</span>\n                  <input value={temp} onChange={e => { const v = parseFloat(e.target.value || '0'); setTemp(isNaN(v) ? 0 : v); onTempChange?.(isNaN(v) ? 0 : v) }} type=\"number\" step=\"0.1\" min=\"0\" max=\"2\" className=\"w-16 px-2 py-1 border border-slate-200 rounded-lg text-sm\" />\n                </div>\n              </div>\n              <div className=\"p-4 flex flex-col gap-3 max-h-[70vh] overflow-y-auto\">\n                {models.map(m => (\n                  <div\n                    key={m.id}\n                    onClick={() => { setSelected(m.id); onSelect(m.id, m.nickname); onClose() }}\n                    className={`relative p-4 rounded-xl shadow-sm border active:scale-[0.98] transition-transform flex items-center justify-center ${selected === m.id ? 'bg-[#F3E8FF] border-[#A855F7]' : 'bg-white border-slate-100'}`}\n                  >\n                    <div className=\"w-full text-center font-bold text-slate-800 truncate\">{m.nickname || m.id}</div>\n                    {selected === m.id && <CheckCircle className=\"w-5 h-5 text-[#A855F7] absolute right-4 top-1/2 -translate-y-1/2\" />}\n                  </div>\n                ))}\n                {!models.length && (\n                  <div className=\"p-6 text-center text-slate-500\">\n                    <div className=\"text-sm\">暂无模型</div>\n                  </div>\n                )}\n              </div>\n            </motion.div>\n          </>\n        )}\n      </AnimatePresence>\n    </div>\n  )\n}\n\nexport default ModelSelectorSheet\n","\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { ArrowLeft, Send, MoreVertical, X, ChevronRight, User as UserIcon, MessageSquare, Cpu } from 'lucide-react';\nimport { AnimatePresence, motion } from 'framer-motion'\nimport { androidSlideRight, fade } from '../animations'\nimport { UserCharacterSettings } from './UserCharacterSettings';\nimport { UserRoleSelectorSheet } from './UserRoleSelectorSheet';\nimport { ModelSelectorSheet } from './ModelSelectorSheet';\nimport { Character, Message, MessageType, UserPersona } from '../types';\nimport { createChatSession, connectChatWs, updateSessionConfig, getSessionInfo } from '../services/chatService';\n\ninterface ChatDetailProps {\n  character: Character;\n  initialMessages: Message[];\n  userPersona?: UserPersona;\n  onBack: () => void;\n  onUpdateLastMessage: (msg: Message) => void;\n  onOpenUserSettings: () => void;\n  onShowProfile: () => void;\n  onUpdateUserPersona?: (persona: UserPersona) => void;\n}\n\nexport const ChatDetail: React.FC<ChatDetailProps> = ({\n  character,\n  initialMessages,\n  userPersona,\n  onBack,\n  onUpdateLastMessage,\n  onOpenUserSettings,\n  onShowProfile,\n  onUpdateUserPersona\n}) => {\n  const [messages, setMessages] = useState<Message[]>(initialMessages);\n  // Default to Scene mode with brackets pre-filled\n  const [chatMode, setChatMode] = useState<'daily' | 'scene'>('scene');\n  const [input, setInput] = useState('（）');\n  const [isTyping, setIsTyping] = useState(false);\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n  const [isUserSettingsOpenLocal, setIsUserSettingsOpenLocal] = useState(false);\n  const [isRoleSheetOpen, setIsRoleSheetOpen] = useState(false);\n  const [isModelSheetOpen, setIsModelSheetOpen] = useState(false);\n  const [modelId, setModelId] = useState<string | undefined>(undefined)\n  const [modelTemp, setModelTemp] = useState<number>(0.1)\n  const [modelNick, setModelNick] = useState<string | undefined>(undefined)\n  const [hasModelOverride, setHasModelOverride] = useState<boolean>(false)\n  const [hasTempOverride, setHasTempOverride] = useState<boolean>(false)\n  const [personaLocal, setPersonaLocal] = useState<UserPersona | undefined>(undefined)\n  const [charImgError, setCharImgError] = useState(false)\n  const [userImgError, setUserImgError] = useState(false)\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const updatePersona = onUpdateUserPersona ?? ((_: UserPersona) => { });\n  const [sessionId, setSessionId] = useState<string | null>(null);\n  const wsRef = useRef<{ sendText: (t: string, chatMode?: 'daily' | 'scene', userRole?: UserPersona, modelId?: string, temperature?: number) => void; sendTyping: (typing: boolean) => void; close: () => void } | null>(null);\n  const currentUserId = (() => { try { return localStorage.getItem('user_id') || '0' } catch { return '0' } })();\n  const histKey = `chat_history_${currentUserId}_${character.id}`;\n  const configKey = `chat_config_${character.id}`;\n  const modelKey = `chat_model_${character.id}`;\n  const tempKey = `chat_temp_${character.id}`;\n  const modelNameKey = `chat_model_name_${character.id}`;\n\n  const effectivePersona = useMemo<UserPersona | undefined>(() => {\n    if (personaLocal) return personaLocal;\n    try {\n      const nickname = localStorage.getItem('user_nickname') || '';\n      const avatar = localStorage.getItem('user_avatar') || '';\n      if (nickname || avatar) {\n        return {\n          name: nickname || '我',\n          gender: 'secret',\n          age: '',\n          profession: '',\n          basicInfo: '',\n          personality: '',\n          avatar: avatar || undefined,\n        };\n      }\n    } catch { }\n    return undefined;\n  }, [personaLocal]);\n\n  const appendAssistantWithRead = (text: string, quote?: string, meta?: { chunkIndex?: number; chunkTotal?: number }) => {\n    setMessages(prev => {\n      const next = [...prev];\n      for (let i = next.length - 1; i >= 0; i--) {\n        if (next[i].senderId === 'user' && !(next[i] as any).read) { next[i] = { ...next[i], read: true }; break; }\n      }\n      const msg: Message = { id: (Date.now() + 1).toString(), senderId: character.id, text, quote, timestamp: new Date(), type: MessageType.TEXT };\n      next.push(msg);\n      try { setTimeout(() => onUpdateLastMessage(msg), 0) } catch { }\n      return next;\n    });\n    if (meta && typeof meta.chunkIndex === 'number' && typeof meta.chunkTotal === 'number') {\n      setIsTyping(meta.chunkIndex < meta.chunkTotal);\n    } else {\n      setIsTyping(false);\n    }\n  }\n\n  const scrollToBottom = () => {\n    if (contentRef.current) {\n      contentRef.current.scrollTop = contentRef.current.scrollHeight;\n    } else {\n      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    }\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, isTyping]);\n\n  const [viewportStyle, setViewportStyle] = useState<{ height: string | number; top: string | number }>({ height: '100%', top: 0 });\n\n  useEffect(() => {\n    const handleVisualViewport = () => {\n      if (window.visualViewport) {\n        setViewportStyle({\n          height: `${window.visualViewport.height}px`,\n          top: `${window.visualViewport.offsetTop}px`\n        });\n\n        // Ensure input is visible by scrolling to bottom\n        if (contentRef.current) {\n          contentRef.current.scrollTop = contentRef.current.scrollHeight;\n        }\n      }\n    };\n\n    if (window.visualViewport) {\n      window.visualViewport.addEventListener('resize', handleVisualViewport);\n      window.visualViewport.addEventListener('scroll', handleVisualViewport);\n      // Initial set\n      handleVisualViewport();\n    }\n\n    const onResize = () => {\n      if (!window.visualViewport) {\n        if (contentRef.current) {\n          contentRef.current.scrollTop = contentRef.current.scrollHeight;\n        } else {\n          scrollToBottom();\n        }\n      }\n    }\n    window.addEventListener('resize', onResize)\n\n    return () => {\n      if (window.visualViewport) {\n        window.visualViewport.removeEventListener('resize', handleVisualViewport);\n        window.visualViewport.removeEventListener('scroll', handleVisualViewport);\n      }\n      window.removeEventListener('resize', onResize)\n    }\n  }, [])\n\n  useEffect(() => {\n    try {\n      const legacyKey = `chat_history_${character.id}`\n      const raw = localStorage.getItem(histKey) || (currentUserId === '0' ? localStorage.getItem(legacyKey) : null);\n      if (raw) {\n        const arr = JSON.parse(raw) as Array<{ id: string; senderId: string; text: string; ts: number; type: string; quote?: string; read?: boolean }>;\n        const msgs: Message[] = arr.map(m => ({ id: m.id, senderId: m.senderId, text: m.text, timestamp: new Date(m.ts), type: m.type as MessageType, quote: m.quote, read: m.read }));\n        if (msgs.length) setMessages(msgs);\n      }\n    } catch { }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [character.id]);\n\n  useEffect(() => {\n    try {\n      const arr = messages.map(m => ({ id: m.id, senderId: m.senderId, text: m.text, ts: m.timestamp?.getTime?.() ? m.timestamp.getTime() : Date.now(), type: m.type, quote: m.quote, read: (m as any).read }));\n      localStorage.setItem(histKey, JSON.stringify(arr));\n    } catch { }\n  }, [messages]);\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(configKey);\n      if (raw) {\n        const cfg = JSON.parse(raw) as { chatMode?: 'daily' | 'scene'; persona?: UserPersona };\n        if (cfg?.chatMode === 'daily' || cfg?.chatMode === 'scene') {\n          setChatMode(cfg.chatMode);\n          setInput(cfg.chatMode === 'scene' ? '（）' : '');\n        }\n        if (cfg?.persona) setPersonaLocal(cfg.persona);\n      }\n      const mid = localStorage.getItem(modelKey) || undefined\n      const tRaw = localStorage.getItem(tempKey)\n      const t = tRaw ? parseFloat(tRaw) : undefined\n      if (mid) { setModelId(mid); setHasModelOverride(true) }\n      if (typeof t === 'number' && !isNaN(t)) { setModelTemp(t); setHasTempOverride(true) }\n      const mname = localStorage.getItem(modelNameKey) || undefined\n      if (mname) setModelNick(mname)\n    } catch { }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [character.id]);\n\n  useEffect(() => {\n    const key = `chat_session_${currentUserId}_${character.id}`;\n    const sid = localStorage.getItem(key) || localStorage.getItem(`chat_session_${character.id}`);\n    const setup = async () => {\n      if (sid) {\n        setSessionId(sid);\n        // migrate legacy session key\n        if (!localStorage.getItem(key)) { try { localStorage.setItem(key, sid) } catch { } }\n        try {\n          const info = await getSessionInfo(sid)\n          if (info?.temperature !== undefined) { setModelTemp(info.temperature as number); try { localStorage.setItem(tempKey, String(info.temperature)) } catch { } }\n        } catch { }\n        const conn = connectChatWs(sid, (text, quote, meta) => {\n          appendAssistantWithRead(text, quote, meta);\n        });\n        wsRef.current = conn;\n        return;\n      }\n      try {\n        const ridRaw = localStorage.getItem('user_chat_role_id');\n        const rid = ridRaw ? parseInt(ridRaw) : undefined;\n        const created = await createChatSession(character.id, typeof rid === 'number' ? rid : undefined);\n        const sid = created.sessionId;\n        localStorage.setItem(key, sid);\n        setSessionId(sid);\n        if (created.model?.id) { setModelId(created.model.id); try { localStorage.setItem(modelKey, created.model.id) } catch { } }\n\n        if (typeof created.temperature === 'number') { setModelTemp(created.temperature!); try { localStorage.setItem(tempKey, String(created.temperature!)) } catch { } }\n        const conn = connectChatWs(sid, (text, quote, meta) => {\n          appendAssistantWithRead(text, quote, meta);\n        });\n        wsRef.current = conn;\n      } catch { }\n    };\n    setup();\n    return () => { wsRef.current?.close(); wsRef.current = null };\n  }, [character.id]);\n\n  const handleModeSwitch = (mode: 'daily' | 'scene') => {\n    setChatMode(mode);\n    if (mode === 'scene') {\n      // Add brackets if not present\n      if (!input.includes('（') && !input.includes('(')) {\n        setInput(prev => `（）${prev}`);\n      } else if (input === '') {\n        setInput('（）');\n      }\n    } else {\n      // Remove empty brackets when switching to daily\n      if (input === '（）' || input === '()') {\n        setInput('');\n      }\n    }\n    try { localStorage.setItem(configKey, JSON.stringify({ chatMode: mode, persona: userPersona || undefined })); } catch { }\n  };\n\n  const handleSend = async () => {\n    if (!input.trim()) return;\n    // Don't send if it's just empty brackets\n    if (input.trim() === '（）' || input.trim() === '()') return;\n\n    const userMsg: Message = {\n      id: Date.now().toString(),\n      senderId: 'user',\n      text: input,\n      timestamp: new Date(),\n      type: MessageType.TEXT,\n      read: false\n    };\n\n    setMessages(prev => [...prev, userMsg]);\n    try { setTimeout(() => onUpdateLastMessage(userMsg), 0) } catch { }\n    // Reset input based on mode\n    setInput(chatMode === 'scene' ? '（）' : '');\n    setIsTyping(true);\n\n    try {\n      if (!sessionId) {\n        const ridRaw = localStorage.getItem('user_chat_role_id');\n        const rid = ridRaw ? parseInt(ridRaw) : undefined;\n        const created = await createChatSession(character.id, typeof rid === 'number' ? rid : undefined);\n        const sid = created.sessionId;\n        localStorage.setItem(`chat_session_${currentUserId}_${character.id}`, sid);\n        setSessionId(sid);\n        const conn = connectChatWs(sid, (text, quote, meta) => {\n          appendAssistantWithRead(text, quote, meta);\n        });\n        wsRef.current = conn;\n      }\n      wsRef.current?.sendText(\n        userMsg.text,\n        chatMode,\n        effectivePersona,\n        hasModelOverride ? modelId : undefined,\n        hasTempOverride ? modelTemp : undefined\n      );\n      wsRef.current?.sendTyping(false);\n    } catch (e) {\n      console.error(e);\n      setIsTyping(false);\n    }\n  };\n\n  const formatTime = (date: Date) => {\n    return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false });\n  };\n\n  return (\n    <motion.div\n      className=\"fixed inset-0 bg-primary-50 z-50\"\n      style={{ ...viewportStyle, overscrollBehavior: 'none', position: 'fixed' }}\n      initial={{ x: ((navigator as any)?.maxTouchPoints > 0) ? '100%' : 0 }}\n      animate={{ x: 0 }}\n      exit={{ x: ((navigator as any)?.maxTouchPoints > 0) ? '100%' : 0 }}\n      transition={{ duration: ((navigator as any)?.maxTouchPoints > 0) ? 0.3 : 0, ease: 'linear' }}\n    >\n      <div className=\"mx-auto w-full max-w-md h-full flex flex-col relative bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden\">\n        <div className=\"bg-primary-50/95 backdrop-blur-md pt-[env(safe-area-inset-top)] shadow-none z-10 border-b border-white/50 flex-shrink-0\">\n          <div className=\"px-4 h-12 flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <button onClick={onBack} className=\"p-2 -ml-2 text-slate-800 hover:bg-black/5 rounded-full transition-colors\">\n                <ArrowLeft size={24} />\n              </button>\n\n              {/* Header Name - Clickable */}\n              <div\n                className=\"flex items-center cursor-pointer active:opacity-70 transition-opacity\"\n                onClick={onShowProfile}\n              >\n                <h2 className=\"font-bold text-slate-800 text-lg\">\n                  {isTyping ? '对方正在输入中...' : character.name}\n                </h2>\n              </div>\n            </div>\n            <button\n              onClick={() => setIsSettingsOpen(true)}\n              className=\"p-2 text-slate-800 hover:text-primary-600 rounded-full hover:bg-black/5 transition-all\"\n            >\n              <MoreVertical size={24} />\n            </button>\n          </div>\n        </div>\n\n        <div ref={contentRef} className=\"flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar bg-primary-50\" style={{ overflowAnchor: 'none' }}>\n          <div className=\"flex justify-center my-4\">\n            <span className=\"bg-black/10 text-white text-[10px] px-3 py-1 rounded-full font-medium\">今天</span>\n          </div>\n\n          {messages.map((msg, index) => {\n            const isMe = msg.senderId === 'user';\n\n            return (\n              <div key={msg.id} className={`flex w-full ${isMe ? 'justify-end' : 'justify-start'} mb-4 group`}>\n\n                {/* Character Avatar */}\n                {!isMe && (\n                  <div className=\"flex-shrink-0 mr-3 flex flex-col items-center gap-1\">\n                    <div\n                      onClick={onShowProfile}\n                      className=\"w-10 h-10 rounded-full overflow-hidden bg-blue-100 flex items-center justify-center text-blue-500 font-bold border border-white cursor-pointer active:scale-95 transition-transform\"\n                    >\n                      {(!charImgError && character.avatar) ? (\n                        <img src={character.avatar} alt={character.name} className=\"w-full h-full object-cover\" onError={() => setCharImgError(true)} />\n                      ) : (\n                        character.name[0]\n                      )}\n                    </div>\n                  </div>\n                )}\n\n                {/* Message Bubble */}\n                <div className={`flex flex-col ${isMe ? 'items-end' : 'items-start'} max-w-[75%]`}>\n                  <div\n                    className={`\n                      px-4 py-3 text-[15px] shadow-sm leading-relaxed relative\n                      ${isMe\n                        ? 'bg-[#A855F7] text-white rounded-[20px] rounded-tr-sm'\n                        : 'bg-white text-slate-800 rounded-[20px] rounded-tl-sm border border-slate-100'\n                      }\n                    `}\n                  >\n                    {msg.text}\n                  </div>\n                  {!isMe && msg.quote && (\n                    <div className=\"mt-1 max-w-full\">\n                      <div className=\"inline-block bg-slate-100 text-slate-500 text-xs leading-tight rounded-[12px] px-2 py-1 border border-slate-200\">\n                        {msg.quote}\n                      </div>\n                    </div>\n                  )}\n                  {/* Timestamp */}\n                  <div className={`flex items-center gap-2 mt-1 ${isMe ? 'mr-1' : 'ml-1'}`}>\n                    {isMe && msg.read && (\n                      <span className=\"text-[10px] text-slate-400\">已读</span>\n                    )}\n                    <span className=\"text-[10px] text-slate-400\">{formatTime(msg.timestamp)}</span>\n                  </div>\n                </div>\n\n                {/* User Avatar */}\n                {isMe && (\n                  <div className=\"flex-shrink-0 ml-3\">\n                    <div className=\"w-10 h-10 rounded-full overflow-hidden bg-pink-200 flex items-center justify-center text-pink-600 font-bold border border-white shadow-sm\">\n                      {(!userImgError && effectivePersona?.avatar) ? (\n                        <img src={effectivePersona.avatar} alt={effectivePersona?.name || '我'} className=\"w-full h-full object-cover\" onError={() => setUserImgError(true)} />\n                      ) : (\n                        (effectivePersona?.name ? effectivePersona.name[0] : '我')\n                      )}\n                    </div>\n                  </div>\n                )}\n\n              </div>\n            );\n          })}\n\n          {/* 顶部状态显示替代下方打字提示，不再渲染会话内loading气泡 */}\n          <div ref={messagesEndRef} />\n        </div>\n\n        <div className=\"bg-white p-3 pb-3 border-t border-slate-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] pb-[env(safe-area-inset-bottom)] mb-3 flex-shrink-0\">\n          <div className=\"flex items-center gap-2 bg-white rounded-[24px] px-3 py-2 border border-slate-100 shadow-[0_12px_28px_rgba(0,0,0,0.12)] transition-shadow focus-within:shadow-[0_16px_40px_rgba(0,0,0,0.16)]\">\n\n            <div className=\"flex-1 flex items-center pl-2\">\n              <textarea\n                ref={textareaRef}\n                value={input}\n                onChange={(e) => { setInput(e.target.value); wsRef.current?.sendTyping(true); }}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSend();\n                  }\n                }}\n                onBlur={() => wsRef.current?.sendTyping(false)}\n                placeholder=\"\"\n                className=\"w-full bg-transparent border-none outline-none focus:ring-0 text-slate-700 text-sm p-0 resize-none max-h-24 overflow-y-auto leading-5 placeholder:text-slate-400\"\n                rows={1}\n                style={{ minHeight: '22px' }}\n              />\n            </div>\n\n            <button\n              onClick={handleSend}\n              disabled={!input.trim() || input.trim() === '（）'}\n              className={`p-2 rounded-full transition-all duration-300 flex-shrink-0 flex items-center justify-center ${input.trim() && input.trim() !== '（）' ? 'bg-[#A855F7] text-white shadow-md active:scale-95' : 'bg-transparent text-[#A855F7]'}`}\n            >\n              <Send size={20} className={input.trim() && input.trim() !== '（）' ? 'ml-0.5' : ''} />\n            </button>\n          </div>\n        </div>\n\n        <AnimatePresence initial={false}>\n          {isSettingsOpen && (\n            <>\n              <motion.div className=\"absolute inset-0 bg-black/20 z-[60] will-change-opacity\" onClick={() => setIsSettingsOpen(false)} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={fade} />\n              <motion.div className=\"absolute top-0 right-0 h-full w-3/4 bg-white z-[70] shadow-2xl will-change-transform transform-gpu\" initial={{ x: '100%' }} animate={{ x: 0 }} exit={{ x: '100%' }} transition={androidSlideRight}>\n                <div className=\"p-5 border-b border-slate-100 flex justify-between items-center\">\n                  <h3 className=\"font-bold text-lg text-slate-800\">聊天设置</h3>\n                  <button onClick={() => setIsSettingsOpen(false)} className=\"text-slate-400 hover:text-slate-600\">\n                    <X size={24} />\n                  </button>\n                </div>\n\n                <div className=\"p-2\">\n                  {/* My Character Settings */}\n                  <button\n                    onClick={() => {\n                      setIsSettingsOpen(false);\n                      setIsRoleSheetOpen(true);\n                    }}\n                    className=\"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors\"\n                  >\n                    <div className=\"flex items-center gap-3 text-slate-700\">\n                      <div className=\"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600\">\n                        <UserIcon size={18} />\n                      </div>\n                      <span className=\"font-bold text-sm\">我的角色设置</span>\n                    </div>\n                    <ChevronRight size={16} className=\"text-slate-300\" />\n                  </button>\n\n                  <div className=\"h-[1px] bg-slate-50 mx-4\"></div>\n\n                  {/* Model */}\n                  <button\n                    onClick={() => { setIsSettingsOpen(false); setIsModelSheetOpen(true) }}\n                    className=\"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors\"\n                  >\n                    <div className=\"flex items-center gap-3 text-slate-700\">\n                      <div className=\"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600\">\n                        <Cpu size={18} />\n                      </div>\n                      <span className=\"font-bold text-sm\">模型</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-xs text-slate-500\">{modelNick || '默认'}</span>\n                      <ChevronRight size={16} className=\"text-slate-300\" />\n                    </div>\n                  </button>\n\n                  <div className=\"h-[1px] bg-slate-50 mx-4\"></div>\n\n                  {/* Chat Mode */}\n                  <div className=\"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors\">\n                    <div className=\"flex items-center gap-3 text-slate-700\">\n                      <div className=\"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600\">\n                        <MessageSquare size={18} />\n                      </div>\n                      <span className=\"font-bold text-sm\">聊天模式</span>\n                    </div>\n\n                    {/* Toggle */}\n                    <div className=\"flex bg-slate-100 p-1 rounded-lg\">\n                      <button\n                        onClick={() => handleModeSwitch('daily')}\n                        className={`px-3 py-1 text-xs font-bold rounded-md transition-all ${chatMode === 'daily' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-400'}`}\n                      >\n                        日常\n                      </button>\n                      <button\n                        onClick={() => handleModeSwitch('scene')}\n                        className={`px-3 py-1 text-xs font-bold rounded-md transition-all ${chatMode === 'scene' ? 'bg-white text-purple-600 shadow-sm' : 'text-slate-400'}`}\n                      >\n                        场景\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </motion.div>\n            </>\n          )}\n        </AnimatePresence>\n\n        {isUserSettingsOpenLocal && (\n          <UserCharacterSettings\n            currentPersona={undefined}\n            onBack={() => setIsUserSettingsOpenLocal(false)}\n            onSave={(_) => {\n              setIsUserSettingsOpenLocal(false);\n              setIsRoleSheetOpen(true);\n            }}\n            withinContainer\n          />\n        )}\n\n        <UserRoleSelectorSheet\n          isOpen={isRoleSheetOpen}\n          currentPersona={userPersona}\n          onClose={() => setIsRoleSheetOpen(false)}\n          onAdd={() => { setIsRoleSheetOpen(false); setIsUserSettingsOpenLocal(true); }}\n          onSelect={(persona) => { setPersonaLocal(persona); try { localStorage.setItem(configKey, JSON.stringify({ chatMode, persona })); } catch { } }}\n        />\n\n        <ModelSelectorSheet\n          isOpen={isModelSheetOpen}\n          currentModelId={modelId}\n          onClose={() => setIsModelSheetOpen(false)}\n          onSelect={(mid, nickname) => { setModelId(mid); setHasModelOverride(true); setModelNick(nickname); try { localStorage.setItem(modelKey, mid); if (nickname) localStorage.setItem(modelNameKey, nickname) } catch { } }}\n          temperature={modelTemp}\n          onTempChange={(t) => { setModelTemp(t); setHasTempOverride(true); try { localStorage.setItem(tempKey, String(t)) } catch { } }}\n        />\n\n      </div>\n    </motion.div>\n  );\n};\n"],"names":["__iconNode","EllipsisVertical","createLucideIcon","MessageSquare","mapGender","g","UserRoleSelectorSheet","isOpen","currentPersona","onClose","onAdd","onSelect","roles","setRoles","useState","selected","setSelected","useEffect","list","fetchUserChatRoles","m","r","handleSelect","persona","jsx","AnimatePresence","jsxs","Fragment","motion","fade","androidBottomSheet","ChevronLeft","Plus","CheckCircle","ModelSelectorSheet","currentModelId","temperature","onTempChange","models","setModels","temp","setTemp","sorted","listModels","a","b","e","v","ChatDetail","character","initialMessages","userPersona","onBack","onUpdateLastMessage","onOpenUserSettings","onShowProfile","onUpdateUserPersona","messages","setMessages","chatMode","setChatMode","input","setInput","isTyping","setIsTyping","isSettingsOpen","setIsSettingsOpen","isUserSettingsOpenLocal","setIsUserSettingsOpenLocal","isRoleSheetOpen","setIsRoleSheetOpen","isModelSheetOpen","setIsModelSheetOpen","modelId","setModelId","modelTemp","setModelTemp","modelNick","setModelNick","hasModelOverride","setHasModelOverride","hasTempOverride","setHasTempOverride","personaLocal","setPersonaLocal","charImgError","setCharImgError","userImgError","setUserImgError","messagesEndRef","useRef","contentRef","textareaRef","sessionId","setSessionId","wsRef","currentUserId","histKey","configKey","modelKey","tempKey","modelNameKey","effectivePersona","useMemo","nickname","avatar","appendAssistantWithRead","text","quote","meta","prev","next","i","msg","MessageType","scrollToBottom","_a","viewportStyle","setViewportStyle","handleVisualViewport","onResize","legacyKey","raw","msgs","arr","_b","cfg","mid","tRaw","t","mname","key","sid","info","getSessionInfo","conn","connectChatWs","ridRaw","rid","created","createChatSession","handleModeSwitch","mode","handleSend","userMsg","formatTime","date","ArrowLeft","MoreVertical","index","isMe","Send","androidSlideRight","X","UserIcon","ChevronRight","Cpu","UserCharacterSettings","_"],"mappings":"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","x_google_ignoreList":[0,1]}