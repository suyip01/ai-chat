import{j as e,r as n}from"./index-CNUsM2zR.js";import{c as B,L as Ee,U as $e,C as et,a as Pe,b as tt,d as te,X as W,P as X,I as Le,e as Ae,T as de,f as st,S as Oe}from"./x-CTp4qmlj.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Fe=B("archive",at);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],lt=B("bot",nt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],fe=B("circle-question-mark",rt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],Re=B("cloud-upload",ot);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Ue=B("copy",it);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],dt=B("database",ct);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ce=B("file-text",xt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],xe=B("pen-line",mt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Se=B("refresh-cw",pt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],De=B("rotate-cw",ht);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ee=B("save",ut);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ft=B("search",gt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],yt=B("settings",bt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],vt=B("shield",jt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],me=B("sparkles",wt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],kt=B("star",Nt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ct=B("user-cog",St);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Mt=B("users",_t);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],ue=B("wand-sparkles",Tt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Ve=B("zoom-in",zt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Be=B("zoom-out",It),oe="/api/admin",Et=()=>localStorage.getItem("admin_access_token")||"",$t=()=>localStorage.getItem("admin_refresh_token")||"",Pt=(t,l)=>{t&&localStorage.setItem("admin_access_token",t),l&&localStorage.setItem("admin_refresh_token",l)},be=()=>{localStorage.removeItem("admin_access_token"),localStorage.removeItem("admin_refresh_token");const t="/super-admin/login";typeof window<"u"&&window.location&&(typeof window.location.replace=="function"?window.location.replace(t):window.location.href=t)},Ce=()=>({Authorization:`Bearer ${Et()}`});let ie=null;const Lt=async()=>{const t=$t();if(!t)throw be(),new Error("unauthorized");const l=await fetch(`${oe}/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t})});if(!l.ok)throw be(),new Error("refresh_failed");const i=await l.json();return Pt(i.access_token,i.refresh_token),i},I=async(t,l={})=>{const i={...l},a=typeof FormData<"u"&&i.body instanceof FormData,s=Ce(),c=a?{}:{"Content-Type":"application/json"};i.headers={...i.headers||{},...c,...s};let h=await fetch(`${oe}${t}`,i);if(h.status===401){ie||(ie=Lt());try{await ie}finally{ie=null}const m=Ce(),p=a?{}:{"Content-Type":"application/json"};if(i.headers={...i.headers||{},...p,...m},h=await fetch(`${oe}${t}`,i),h.status===401)throw be(),new Error("unauthorized")}if(!h.ok)throw new Error("failed");if(!h.ok){let m="";try{m=await h.text()}catch{}throw console.error("[admin.api.request] failed",{path:t,status:h.status,body:m}),new Error("failed")}return h.json()},Q={async list(){return I("/templates")},async create(t){return I("/templates",{method:"POST",body:JSON.stringify(t)})},async update(t,l){return I(`/templates/${t}`,{method:"PUT",body:JSON.stringify(l)})},async remove(t){return I(`/templates/${t}`,{method:"DELETE"})},async copy(t){return I(`/templates/${t}/copy`,{method:"POST"})},async setDefault(t){return I(`/templates/${t}/default`,{method:"POST"})}},ne={async list(t){const l=t?"?"+new URLSearchParams(t).toString():"";return I(`/characters${l}`)},async get(t){return I(`/characters/${t}`)},async create(t){return I("/characters",{method:"POST",body:JSON.stringify(t)})},async update(t,l){return I(`/characters/${t}`,{method:"PUT",body:JSON.stringify(l)})},async remove(t){return I(`/characters/${t}`,{method:"DELETE"})},async setStatus(t,l){return I(`/characters/${t}/status`,{method:"POST",body:JSON.stringify({status:l})})}},le={async list(){return I("/models")},async create(t){return I("/models",{method:"POST",body:JSON.stringify(t)})},async remove(t){return I(`/models/${t}`,{method:"DELETE"})}},_e={async get(){return I("/settings")},async save(t){return I("/settings",{method:"PUT",body:JSON.stringify(t)})}},re={async list(){return I("/stories")},async get(t){return I(`/stories/${t}`)},async create(t){return I("/stories",{method:"POST",body:JSON.stringify(t)})},async update(t,l){return I(`/stories/${t}`,{method:"PUT",body:JSON.stringify(l)})},async remove(t){return I(`/stories/${t}`,{method:"DELETE"})},async setStatus(t,l){return I(`/stories/${t}/status`,{method:"POST",body:JSON.stringify({status:l})})}},Me={async generate(t){return I("/sysprompt/generate",{method:"POST",body:JSON.stringify(t)})},async generateNoScene(t){return I("/sysprompt/generate-noscene",{method:"POST",body:JSON.stringify(t)})}},ye={async avatar(t){const l=new FormData;return l.append("avatar",t),I("/uploads/avatar",{method:"POST",body:l})},async cover(t){const l=new FormData;return l.append("cover",t),I("/uploads/cover",{method:"POST",body:l})}},ae={async list(t){const l=t?`?q=${encodeURIComponent(t)}`:"";return I(`/users${l}`)},async create({username:t,nickname:l,email:i,password:a,chatLimit:s}){return I("/users",{method:"POST",body:JSON.stringify({username:t,nickname:l,email:i,password:a,chatLimit:s})})},async update(t,l){return I(`/users/${t}`,{method:"PUT",body:JSON.stringify(l)})},async remove(t){return I(`/users/${t}`,{method:"DELETE"})},async changePassword(t,l){return I(`/users/${t}/password`,{method:"POST",body:JSON.stringify({password:l})})}},q={async list(t){const l=t?`?q=${encodeURIComponent(t)}`:"";return I(`/admins${l}`)},async create({username:t,email:l,password:i}){return I("/admins",{method:"POST",body:JSON.stringify({username:t,email:l,password:i})})},async update(t,l){return I(`/admins/${t}`,{method:"PUT",body:JSON.stringify(l)})},async remove(t){return I(`/admins/${t}`,{method:"DELETE"})},async changePassword(t,l){return I(`/admins/${t}/password`,{method:"POST",body:JSON.stringify({password:l})})},async getMyAvatar(){return I("/admins/me/avatar")},async updateMe(t){return I("/admins/me",{method:"PUT",body:JSON.stringify(t)})}},Te=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Varela+Round&display=swap');
    body { font-family: 'Varela Round', 'PingFang SC', sans-serif; background-color: #FFFFFF; color: #4A4060; }
    .font-cute { font-family: 'ZCOOL KuaiLe', cursive; }
    .glass-card { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.9); box-shadow: 0 8px 30px rgba(236, 72, 153, 0.08); }
    .solid-card { background: #FFFFFF; border: 1px solid #FCE7F3; box-shadow: 0 4px 20px rgba(236, 72, 153, 0.05); }
    .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); border-right: 1px solid rgba(255, 255, 255, 0.5); }
    .dream-input { background: rgba(255, 255, 255, 0.6); border: 2px solid #FCE7F3; transition: all 0.3s ease; color: #5D5476; }
    .dream-input:focus { background: #FFFFFF; border-color: #F472B6; outline: none; box-shadow: 0 0 0 4px rgba(244, 114, 182, 0.15); }
    .tag-pill { background: linear-gradient(135deg, #FBCFE8 0%, #FCE7F3 100%); color: #BE185D; font-weight: 700; font-size: 0.75rem; border-radius: 8px; }
    .tag-select-btn { background: #FCE7F3; color: #BE185D; border: 1px solid transparent; border-radius: 20px; font-weight: bold; font-size: 0.85rem; padding: 8px 10px; transition: all 0.2s; white-space: nowrap; }
    .tag-select-btn.active { background: #EC4899; color: white; border-color: #DB2777; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3); }
    .ambient-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(at 0% 0%, hsla(330, 70%, 98%, 1) 0, transparent 50%), radial-gradient(at 50% 100%, hsla(330, 85%, 95%, 1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(330, 80%, 97%, 1) 0, transparent 50%); background-size: 200% 200%; animation: gradientMove 15s ease infinite; }
    @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.02); }
    ::-webkit-scrollbar-thumb { background: #FBCFE8; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #F472B6; }
    .glass-card p, .glass-card h4, .glass-card li, .glass-card ul { color: #4A4060; }
    .solid-card p, .solid-card h4, .solid-card li, .solid-card ul { color: #4A4060; }
  `}),He=n.createContext(null),Z=()=>n.useContext(He),K=({children:t})=>{const[l,i]=n.useState([]),a=n.useCallback((s,c="success")=>{const h=Date.now()+Math.random();i(m=>[...m,{id:h,message:s,type:c}]),setTimeout(()=>{i(m=>m.filter(p=>p.id!==h))},3e3)},[]);return e.jsxs(He.Provider,{value:{showToast:a},children:[t,e.jsx("div",{className:"fixed top-6 left-64 right-0 z-50 flex flex-col items-center gap-3 pointer-events-none",children:l.map(s=>e.jsx("div",{className:`pointer-events-auto flex items-center justify-center text-center px-4 py-2 rounded-2xl shadow-xl border max-w-[480px] min-w-[180px] mx-auto ${s.type==="success"?"bg-white border-green-200 text-green-700":"bg-white border-red-200 text-red-700"}`,children:s.message},s.id))})]})},At=({onLogin:t})=>{const[l,i]=n.useState(""),[a,s]=n.useState(""),{showToast:c}=Z(),h=async()=>{try{const y=(await(await fetch(`${oe}/crypto/public-key`)).text()).replace(/-----BEGIN PUBLIC KEY-----/,"").replace(/-----END PUBLIC KEY-----/,"").replace(/\s+/g,""),v=Uint8Array.from(atob(y),d=>d.charCodeAt(0)),w=await window.crypto.subtle.importKey("spki",v.buffer,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]),g=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},w,new TextEncoder().encode(a)),S=btoa(String.fromCharCode(...new Uint8Array(g))),x=await fetch(`${oe}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,password_encrypted:S})});if(!x.ok){c("登录失败","error");return}const u=await x.json();u!=null&&u.access_token&&localStorage.setItem("admin_access_token",u.access_token),u!=null&&u.refresh_token&&localStorage.setItem("admin_refresh_token",u.refresh_token),localStorage.setItem("admin_username",l),t()}catch{c("登录失败","error")}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"ambient-bg"}),e.jsxs("div",{className:"glass-card p-10 rounded-3xl w-full max-w-md shadow-2xl transform transition-all hover:scale-[1.01]",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-pink-100 text-pink-600 mb-4 shadow-inner",children:e.jsx(me,{size:32})}),e.jsx("h1",{className:"text-3xl font-cute text-pink-900 mb-2",children:"YumeCrush"}),e.jsx("p",{className:"text-pink-400 text-sm",children:"运营管理平台"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-pink-800 mb-2 ml-1",children:"管理员账号"}),e.jsx("input",{type:"text",placeholder:"请输入管理员账号",value:l,onChange:m=>i(m.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-pink-800 mb-2 ml-1",children:"密码"}),e.jsx("input",{type:"password",placeholder:"••••••••",value:a,onChange:m=>s(m.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl"})]}),e.jsxs("button",{onClick:h,className:"w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-pink-200 transition-all transform active:scale-95 flex items-center justify-center gap-2",children:[e.jsx(Ee,{size:18,className:"rotate-180"})," 登录后台"]})]})]})]})},Ot=({activeTab:t,setActiveTab:l,onLogout:i,username:a,onEditProfile:s})=>{const[c,h]=n.useState(["characters","settings"]),m=[{id:"stories",label:"故事管理",icon:ce},{id:"templates",label:"提示词模版",icon:ce},{id:"characters",label:"角色管理",icon:Mt,subItems:[{id:"official_characters",label:"官方角色",icon:lt},{id:"user_characters",label:"用户角色",icon:$e}]},{id:"users",label:"用户管理",icon:Ct},{id:"settings",label:"系统设置",icon:yt,subItems:[{id:"model_settings",label:"模型设置",icon:et},...a==="admin"?[{id:"model_manage",label:"模型管理",icon:dt},{id:"admin_accounts",label:"管理员账号",icon:vt}]:[]]}];n.useEffect(()=>{const o=m.find(b=>{var $;return($=b.subItems)==null?void 0:$.some(F=>F.id===t)});o&&h(b=>b.includes(o.id)?b:[...b,o.id])},[t]);const p=o=>{h(b=>b.includes(o)?b.filter($=>$!==o):[...b,o])},y=o=>{h(b=>b.includes(o)?b:[...b,o])},v=o=>{var F;const b=m.find(R=>R.id===o);((F=b==null?void 0:b.subItems)==null?void 0:F.some(R=>R.id===t))||h(R=>R.filter(j=>j!==o))},w=o=>{o.subItems?p(o.id):(l(o.id),h([]))},[g,S]=n.useState(!1),[x,u]=n.useState(""),[d,A]=n.useState(""),[C,T]=n.useState(""),k=async()=>{const o={};if(x&&x.trim()&&(o.nickname=x.trim()),d){if(d!==C)return;o.password=d}try{await q.updateMe(o),S(!1),u(""),A(""),T("")}catch{}};return e.jsxs("div",{className:"w-16 xl:w-56 glass-nav h-screen fixed left-0 top-0 flex flex-col z-20 transition-all duration-300",style:{backgroundColor:"#f4f6fb"},children:[e.jsxs("div",{className:"p-4 xl:p-8 flex items-center justify-center xl:justify-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-pink-500 rounded-lg flex items-center justify-center text-white flex-shrink-0",children:e.jsx(me,{size:18})}),e.jsx("span",{className:"text-xl font-cute text-pink-900 tracking-wide hidden xl:block",children:"YumeCrush Admin"})]}),e.jsx("nav",{className:"flex-1 px-4 space-y-2",children:m.map(o=>e.jsxs("div",{onMouseEnter:()=>o.subItems&&y(o.id),onMouseLeave:()=>o.subItems&&v(o.id),children:[e.jsxs("button",{onClick:()=>w(o),className:`w-full flex items-center justify-center xl:justify-start gap-3 px-2 xl:px-4 py-3.5 rounded-2xl transition-all duration-300 font-bold text-sm ${t===o.id||o.subItems&&o.subItems.some(b=>b.id===t)?"bg-pink-100 text-pink-700 shadow-sm":"text-gray-500 hover:bg-white/50 hover:text-pink-600"}`,children:[e.jsx(o.icon,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"hidden xl:block flex-1 text-left",children:o.label}),o.subItems&&e.jsx("span",{className:"hidden xl:block transition-transform duration-300",children:c.includes(o.id)?e.jsx(Pe,{size:14}):e.jsx(tt,{size:14})})]}),o.subItems&&e.jsx("div",{className:`grid transition-all duration-300 ease-in-out ${c.includes(o.id)?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"mt-1 space-y-1 xl:pl-4",children:o.subItems.map(b=>e.jsxs("button",{onClick:$=>{$.stopPropagation(),l(b.id)},className:`w-full flex items-center justify-center xl:justify-start gap-2 px-2 xl:px-4 py-2.5 rounded-xl transition-all duration-300 text-xs font-bold ${t===b.id?"bg-pink-200/50 text-pink-800":"text-gray-400 hover:text-pink-600 hover:bg-white/30"}`,children:[b.icon?e.jsx(b.icon,{size:16,className:"flex-shrink-0 hidden xl:block"}):e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-current flex-shrink-0 hidden xl:block"}),e.jsx("span",{className:"hidden xl:block",children:b.label}),e.jsx("span",{className:"xl:hidden",children:b.icon?e.jsx(b.icon,{size:14}):b.label.substring(0,1)})]},b.id))})})})]},o.id))}),e.jsx("div",{className:"p-4 border-t border-pink-100",children:e.jsxs("div",{className:"w-full flex xl:flex-row flex-col items-center xl:justify-start justify-center gap-3",children:[e.jsxs("div",{className:"group relative",onClick:()=>s&&s(),children:[e.jsx(Ft,{username:a}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -translate-y-full -top-2 bg-pink-700 text-white text-xs px-2 py-1 rounded shadow opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-50",children:a})]}),e.jsxs("button",{onClick:i,className:"w-full xl:flex-1 flex items-center justify-center xl:justify-start gap-3 px-2 xl:px-4 py-3 text-red-400 hover:bg-red-50 rounded-2xl transition-colors font-bold text-sm",children:[e.jsx(Ee,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"hidden xl:block",children:"退出登录"})]})]})}),g&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-96 shadow-2xl",children:[e.jsx("div",{className:"font-bold mb-4 text-pink-900",children:"修改资料"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:`昵称（当前：${a}）`,value:x,onChange:o=>u(o.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"新密码",value:d,onChange:o=>A(o.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"再次输入新密码",value:C,onChange:o=>T(o.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-5",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{S(!1),u(""),A(""),T("")},children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:k,disabled:!x.trim()&&!d,children:"保存"})]})]}),e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-[1px] bg-slate-300"})]})]})},Ft=({username:t})=>{const[l,i]=n.useState("");return n.useEffect(()=>{let a=!0;return q.getMyAvatar().then(s=>{a&&i((s==null?void 0:s.avatar)||"/uploads/avatars/default_admin.jpg")}).catch(()=>{a&&i("/uploads/avatars/default_admin.jpg")}),()=>{a=!1}},[t]),e.jsx("div",{className:"group relative w-8 h-8 rounded-full overflow-hidden border border-pink-200 bg-white flex items-center justify-center",children:l?e.jsx("img",{src:l,alt:t,className:"w-full h-full object-cover"}):e.jsx($e,{size:16,className:"text-pink-500"})})},Rt=({onCancel:t,initialData:l,onSave:i,notify:a})=>{const[s,c]=n.useState({name:"",type:"恋爱",customType:"",tags:[],content:""}),[h,m]=n.useState(""),[p,y]=n.useState(!1),v=["恋爱","玄幻","悬疑","职场","科幻","同人"];n.useEffect(()=>{l&&(c({name:l.name||"",type:l.type||"恋爱",customType:"",tags:l.tags||[],content:l.content||""}),y(!1))},[l]);const w=u=>{u.key==="Enter"&&h.trim()&&(u.preventDefault(),s.tags.includes(h.trim())||c(d=>({...d,tags:[...d.tags,h.trim()]})),m(""))},g=u=>{const d=[...s.tags];d.splice(u,1),c(A=>({...A,tags:d}))},S=u=>{y(!1),c(d=>({...d,type:u}))},x=()=>{if(!s.name.trim()){typeof a=="function"&&a("保存失败：请输入模版名称","error");return}const u={id:l==null?void 0:l.id,name:s.name.trim(),type:p&&s.customType.trim()||s.type,tags:s.tags,content:s.content,refCount:(l==null?void 0:l.refCount)??0,creator:(l==null?void 0:l.creator)??"Admin"};try{i&&i(u)}catch{typeof a=="function"&&a("保存失败：请稍后重试","error")}};return e.jsxs("div",{className:"animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(te,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:l?"编辑提示词模版":"新建提示词模版"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"定义基础 Prompt 框架"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:t,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:x,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text白 font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(ee,{size:16})," 保存模版"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:[e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 模版基础信息"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版名称"}),e.jsx("input",{type:"text",value:s.name,onChange:u=>c({...s,name:u.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700 bg-gray-50/50 focus:bg-white",placeholder:"例如：病娇反派通用模版"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版类型"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[v.map(u=>e.jsx("button",{onClick:()=>S(u),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all cute-font tracking-wide border ${!p&&s.type===u?"bg-pink-500 text白 border-pink-500 shadow-md shadow-pink-200":"bg白 text灰-500 border-gray-100 hover:border-pink-200"}`,children:u},u)),e.jsx("button",{onClick:()=>y(!0),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all cute-font tracking-wide border ${p?"bg-pink-500 text白 border-pink-500 shadow-md shadow-pink-200":"bg白 text灰-500 border-gray-100 hover:border-pink-200"}`,children:"自定义..."})]}),p&&e.jsx("div",{className:"animate-fade-in mt-2",children:e.jsx("input",{type:"text",value:s.customType,onChange:u=>c({...s,customType:u.target.value}),placeholder:"请输入自定义类型名称",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版标签 (回车生成)"}),e.jsxs("div",{className:"dream-input w-full px-4 py-3 rounded-xl min-h-[50px] flex flex-wrap gap-2 items-center bg-gray-50/50 focus-within:bg-white",children:[s.tags.map((u,d)=>e.jsxs("span",{className:"tag-pill px-3 py-1 flex items-center shadow-sm gap-1",children:["#",u," ",e.jsx("button",{onClick:()=>g(d),className:"hover:text-red-500 opacity-60 hover:opacity-100 transition-opacity",children:e.jsx(W,{size:12})})]},d)),e.jsx("input",{value:h,onChange:u=>m(u.target.value),onKeyDown:w,type:"text",className:"bg-transparent outline-none text-sm w-40 placeholder-gray-400 h-8",placeholder:"输入标签按回车..."})]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-4",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," Prompt 内容配置"]}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{rows:"15",value:s.content,onChange:u=>c({...s,content:u.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-600 bg-gray-50/50 focus:bg-white resize-y",placeholder:`在此输入系统提示词框架（System Instruction）...
可以使用 {'{{user}}'} 和 {'{{name}}'} 作为占位符。`})})]})]}),e.jsx("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:e.jsxs("div",{className:"solid-card p-6 rounded-3xl bg-gradient-to-br from-pink-500 to-pink-600 text白 shadow-xl shadow-pink-200/50",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2 text-lg font-cute",children:[e.jsx(me,{size:18,className:"text-yellow-300"})," 编写指南"]}),e.jsxs("ul",{className:"space-y-3 text-sm opacity-90 leading-relaxed list-disc list-inside",children:[e.jsxs("li",{children:["使用 ",e.jsx("b",{children:"{{name}}"})," 代表角色姓名。"]}),e.jsxs("li",{children:["使用 ",e.jsx("b",{children:"{{user}}"})," 代表用户昵称。"]}),e.jsxs("li",{children:["建议明确规定角色的",e.jsx("b",{children:"说话风格"}),"、",e.jsx("b",{children:"禁忌事项"}),"以及",e.jsx("b",{children:"背景设定"}),"。"]})]})]})})]})]})},Ut=()=>{const[t,l]=n.useState("list"),[i,a]=n.useState([]),[s,c]=n.useState(1),h=6,[m,p]=n.useState(null),[y,v]=n.useState(null),{showToast:w}=Z(),g=async()=>{try{const j=await Q.list();a(j.items||[])}catch{w("加载失败：请稍后再试","error")}};n.useEffect(()=>{g()},[]);const S=[...i].sort((j,O)=>{if(j.isDefault&&!O.isDefault)return-1;if(!j.isDefault&&O.isDefault)return 1;const U=j.createdAt?new Date(j.createdAt).getTime():0,z=O.createdAt?new Date(O.createdAt).getTime():0;return U-z}),x=Math.max(1,Math.ceil(S.length/h)),u=(s-1)*h,d=S.slice(u,u+h);n.useEffect(()=>{s>x&&c(x)},[i]);const A=j=>{if(!j)return"-";const O=new Date(j),U=O.getFullYear(),z=String(O.getMonth()+1).padStart(2,"0"),f=String(O.getDate()).padStart(2,"0"),_=String(O.getHours()).padStart(2,"0"),E=String(O.getMinutes()).padStart(2,"0");return`${U}/${z}/${f} ${_}:${E}`},C=async j=>{try{await Q.setDefault(j),w("已设为默认"),g()}catch{w("操作失败","error")}},T=j=>{p(j),l("create")},k=j=>{const O={...j,id:void 0,name:`${j.name}_copy`};p(O),l("create"),w("复制成功，已进入编辑")},o=async j=>{try{await Q.remove(j)}catch{throw new Error("failed")}},b=j=>v(j),$=()=>v(null),F=async()=>{if(y)try{await o(y.id),w("删除成功"),g()}catch{w("删除失败","error")}finally{$()}},R=async j=>{try{m&&m.id?(await Q.update(m.id,j),w("保存成功：模版已更新")):(await Q.create(j),w("创建成功：模版已保存")),p(null),l("list"),g()}catch{w("保存失败：请稍后重试","error")}};return t==="create"?e.jsx(Rt,{onCancel:()=>{p(null),l("list")},initialData:m,onSave:R,notify:w}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"提示词模版库"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"管理用于生成角色的基础 Prompt"})]}),e.jsxs("button",{onClick:()=>{p(null),l("create")},className:"bg-pink-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(X,{size:16})," 新建模版"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-pink-50 p-4 rounded-2xl border border-pink-100 text-sm text-pink-700",children:[e.jsx(Le,{size:18,className:"flex-shrink-0 text-pink-500"}),e.jsxs("span",{children:["提示：用户创建角色时，默认使用当前",e.jsx("span",{className:"font-bold",children:"“默认”"}),"提示词模板作为参考生成角色提示词。"]})]}),e.jsxs("div",{className:"glass-card rounded-3xl overflow-hidden",children:[e.jsxs("table",{className:"w-full text-left rounded-2xl overflow-hidden border-collapse",children:[e.jsx("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 pl-6 w-16",children:"序号"}),e.jsx("th",{className:"p-3 pl-7",children:"模版名称"}),e.jsx("th",{className:"p-3",children:"类型"}),e.jsx("th",{className:"p-3",children:"标签"}),e.jsx("th",{className:"p-3",children:"创建时间"}),e.jsx("th",{className:"p-3",children:"引用数"}),e.jsx("th",{className:"p-3",children:"状态 / 操作"}),e.jsx("th",{className:"p-3 text-right pr-8",children:"操作"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-pink-100",children:d.map((j,O)=>{var U;return e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-3 pl-6 text-gray-500 font-mono",children:u+O+1}),e.jsx("td",{className:"p-3 pl-8 font-bold text-gray-700",children:j.name}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"bg-pink-100 text-pink-600 px-2.5 py-1 rounded-lg text-xs font-bold",children:j.type})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex gap-1",children:(U=j.tags)==null?void 0:U.map(z=>e.jsx("span",{className:"text-[10px] bg-white border border-pink-100 text-pink-400 px-1.5 py-0.5 rounded",children:z},z))})}),e.jsx("td",{className:"p-3 text-gray-500",children:A(j.createdAt)}),e.jsx("td",{className:"p-3 text-gray-500 font-mono",children:typeof j.refCount=="number"?j.refCount:0}),e.jsx("td",{className:"p-3",children:j.isDefault?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-green-100 text-green-700 text-xs font-bold border border-green-200",children:[e.jsx(Ae,{size:14,className:"text-green-600"}),"当前默认"]}):e.jsxs("button",{onClick:()=>C(j.id),className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-gray-200 text-gray-500 text-xs font-bold hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50 transition-all group",children:[e.jsx(kt,{size:14,className:"group-hover:fill-pink-200"}),"设为默认"]})}),e.jsxs("td",{className:"p-3 text-right pr-8 space-x-2",children:[e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>T(j),"aria-label":"编辑",className:"text-pink-400 hover:text-pink-600 p-1",children:e.jsx(xe,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"编辑"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>k(j),"aria-label":"复制",className:"text-pink-400 hover:text-pink-600 p-1",children:e.jsx(Ue,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"复制"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>b(j),"aria-label":"删除",className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(de,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"删除"})]})]})]},j.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border-t border-pink-100",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["第 ",s," / ",x," 页"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:s===1,onClick:()=>c(j=>Math.max(1,j-1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${s===1?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"上一页"}),Array.from({length:x}).map((j,O)=>e.jsx("button",{onClick:()=>c(O+1),className:`w-8 h-8 rounded-lg text-xs font-bold ${s===O+1?"bg-pink-500 text-white":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:O+1},O)),e.jsx("button",{disabled:s===x,onClick:()=>c(j=>Math.min(x,j+1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${s===x?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"下一页"})]})]})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:$}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除提示词模版"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",y.name,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:$,className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:F,className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]})]})},Dt=()=>e.jsx(K,{children:e.jsx(Ut,{})}),Vt=t=>new Promise(l=>{const i=new FileReader;i.addEventListener("load",()=>l(i.result),!1),i.readAsDataURL(t)}),Bt=t=>new Promise((l,i)=>{const a=new Image;a.addEventListener("load",()=>l(a)),a.addEventListener("error",s=>i(s)),a.setAttribute("crossOrigin","anonymous"),a.src=t});function ze({initialImage:t,onSave:l,onCancel:i}){const[a,s]=n.useState(t?"main":"upload"),[c,h]=n.useState(t||null),[m,p]=n.useState(null),y=async w=>{if(w.target.files&&w.target.files.length>0){const g=w.target.files[0],S=await Vt(g);p(S),s("edit")}},v=w=>{h(w),l(w)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[e.jsx(Ht,{step:a,onBack:()=>s(a==="edit"?"upload":"main"),onClose:i}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[a==="main"&&e.jsx(Yt,{avatarUrl:c,onChangeClick:()=>s("upload"),onRemoveClick:()=>{h(null),l(null)}}),a==="upload"&&e.jsx(Gt,{onFileChange:y}),a==="edit"&&m&&e.jsx(Jt,{imageSrc:m,onSave:v,onCancel:()=>s("upload")})]})]})})}function Ht({step:t,onBack:l,onClose:i}){let a="头像设置";return t==="upload"&&(a="更换头像"),t==="edit"&&(a="裁剪与旋转"),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 shrink-0 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t!=="main"&&t!=="upload"&&e.jsx("button",{onClick:l,className:"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-pink-600 transition-colors",children:e.jsx(te,{size:20})}),t==="upload"&&l&&null,e.jsx("h2",{className:"text-lg font-cute text-pink-900",children:a})]}),e.jsx("button",{onClick:i,className:"p-2 -mr-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(W,{size:20})})]})}function Yt({avatarUrl:t,onChangeClick:l,onRemoveClick:i}){return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50/50",children:[e.jsxs("div",{className:"p-8 flex flex-col items-center text-center flex-1 justify-center",children:[e.jsx("div",{className:"relative group mb-8",children:e.jsx("div",{className:"w-48 h-48 rounded-full overflow-hidden ring-8 ring-white shadow-2xl bg-gray-200 flex items-center justify-center",children:t?e.jsx("img",{src:t,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-6xl font-medium text-gray-400",children:"?"})})}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"设置一个好看的头像，让角色更具吸引力"})]}),e.jsxs("div",{className:"flex items-stretch border-t border-gray-100 bg-white divide-x divide-gray-100",children:[e.jsxs("button",{onClick:l,className:"flex-1 py-4 flex items-center justify-center gap-2 text-pink-600 hover:bg-pink-50 transition-colors font-bold text-sm",children:[e.jsx(st,{size:16}),"更换头像"]}),e.jsxs("button",{onClick:i,className:"flex-1 py-4 flex items-center justify-center gap-2 text-gray-400 hover:bg-red-50 hover:text-red-500 transition-colors font-bold text-sm",children:[e.jsx(de,{size:16}),"移除头像"]})]})]})}function Gt({onFileChange:t}){const[l,i]=n.useState(!1),a=n.useRef(null),s=m=>{m.preventDefault(),i(!0)},c=m=>{m.preventDefault(),i(!1)},h=m=>{m.preventDefault(),i(!1),m.dataTransfer.files&&m.dataTransfer.files.length>0&&t({target:{files:m.dataTransfer.files}})};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-1 p-8 flex flex-col items-center justify-center",children:e.jsxs("div",{onDragOver:s,onDragLeave:c,onDrop:h,onClick:()=>a.current.click(),className:`w-full max-w-xs aspect-square rounded-3xl flex flex-col items-center justify-center transition-all duration-300 cursor-pointer border-2 border-dashed ${l?"bg-pink-50 border-pink-400 scale-105":"bg-gray-50 border-gray-200 hover:border-pink-300 hover:bg-pink-50/30"}`,children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white shadow-sm flex items-center justify-center mb-4 text-pink-500",children:e.jsx(Re,{size:32})}),e.jsx("p",{className:"text-gray-600 font-bold mb-1",children:"点击或拖拽上传"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"支持 JPG, PNG, GIF"})]})}),e.jsx("input",{type:"file",ref:a,onChange:t,className:"hidden",accept:"image/*"})]})}function Jt({imageSrc:t,onSave:l,onCancel:i}){const a=n.useRef(null),[s,c]=n.useState(null),[h,m]=n.useState(!1),[p,y]=n.useState(0),[v,w]=n.useState({x:0,y:0}),[g,S]=n.useState(!1),[x,u]=n.useState({x:0,y:0}),[d,A]=n.useState(1),[C,T]=n.useState(1),k=800,o=280;n.useEffect(()=>{(async()=>{try{const f=await Bt(t);c(f);const _=k/f.width,E=k/f.height,N=Math.max(_,E);A(N),T(1)}catch(f){console.error(f)}})()},[t]);const b=z=>{z.preventDefault();const f=z.deltaY*-.001;T(_=>Math.max(.5,Math.min(_+f,3)))},$=n.useCallback(()=>{if(!s||!a.current)return;const f=a.current.getContext("2d");f.clearRect(0,0,k,k),f.fillStyle="#18181b",f.fillRect(0,0,k,k),f.save(),f.translate(k/2,k/2),f.rotate(p*Math.PI/180),f.translate(-k/2,-k/2);let _=p*Math.PI/180,E=v.x*Math.cos(-_)-v.y*Math.sin(-_),N=v.x*Math.sin(-_)+v.y*Math.cos(-_);const P=d*C,D=s.width*P,V=s.height*P,H=k/2,Y=k/2;f.drawImage(s,H-D/2+E,Y-V/2+N,D,V),f.restore();const J=(k-o)/2;f.fillStyle="rgba(0, 0, 0, 0.6)",f.beginPath(),f.rect(0,0,k,k),f.rect(J+o,J,-o,o),f.fill("evenodd")},[s,p,v,d,C]);n.useEffect(()=>{$()},[$]);const F=z=>{S(!0);const f=a.current.getBoundingClientRect(),_=z.clientX||z.touches[0].clientX,E=z.clientY||z.touches[0].clientY;u({x:_-f.left,y:E-f.top})},R=z=>{if(!g)return;const f=a.current.getBoundingClientRect(),_=z.clientX||(z.touches?z.touches[0].clientX:0),E=z.clientY||(z.touches?z.touches[0].clientY:0),N=_-f.left,P=E-f.top,D=N-x.x,V=P-x.y;w(H=>({x:H.x+D,y:H.y+V})),u({x:N,y:P})},j=()=>{S(!1)},O=()=>{y(z=>(z+90)%360)},U=async()=>{if(!(!a.current||h)){m(!0);try{const z=document.createElement("canvas"),f=o;z.width=f,z.height=f;const _=z.getContext("2d"),E=(k-o)/2;_.drawImage(a.current,E,E,f,f,0,0,f,f);const N=await new Promise((V,H)=>{z.toBlob(Y=>Y?V(Y):H(new Error("blob_failed")),"image/jpeg",.92)}),P=new File([N],`avatar_${Date.now()}.jpg`,{type:"image/jpeg"}),D=await ye.avatar(P);l(D.url)}catch(z){console.error(z)}finally{m(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-1 relative flex items-center justify-center bg-gray-900 overflow-hidden",children:e.jsx("canvas",{ref:a,width:k,height:k,onMouseDown:F,onMouseMove:R,onMouseUp:j,onMouseLeave:j,onTouchStart:F,onTouchMove:R,onTouchEnd:j,onWheel:b,className:"cursor-move max-w-full max-h-full",style:{width:"100%",height:"auto",maxHeight:"400px"}})}),e.jsxs("div",{className:"p-4 bg-white flex items-center justify-between border-t border-gray-100 gap-4",children:[e.jsxs("button",{onClick:O,className:"flex flex-col itemscenter gap-1 text-pink-600 hover:text-pink-700 transition text-xs font-bold px-2 py-2 rounded-xl hover:bg-pink-50 shrink-0",children:[e.jsx(De,{size:20}),"旋转"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 max-w-[200px]",children:[e.jsx(Be,{size:16,className:"text-gray-400 shrink-0"}),e.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:C,onChange:z=>T(parseFloat(z.target.value)),className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-pink-500"}),e.jsx(Ve,{size:16,className:"text-gray-400 shrink-0"})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 rounded-xl text-gray-500 font-bold text-sm hover:bg-gray-100 transition-colors",children:"取消"}),e.jsx("button",{onClick:U,disabled:h,className:`px-5 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 transition-all ${h?"opacity-60 cursor-not-allowed":"hover:opacity-90"}`,children:h?"上传中...":"完成"})]})]})]})}const qt=({initialData:t,onCancel:l,mode:i="new",notify:a})=>{var Ne;const[s,c]=n.useState({name:"",gender:"男",identity:"",tagline:"",tags:[],plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",published:!1,generatedPrompt:"",personality:"",relationship:"陌生人",customRelationship:"",sceneDescription:"",sceneGeneratedPrompt:"",avatar:"",characterType:"原创角色",age:"",occupation:""}),h=["陌生人","暧昧","恋爱中","冷战","分手"],[m,p]=n.useState(!1),[y,v]=n.useState(!0);n.useEffect(()=>{if(t){const r=h.includes(t.relationship);c({name:t.name||"",gender:t.gender||"男",identity:t.identity||"",tagline:t.tagline||"",tags:t.tags||[],plotTheme:t.plotTheme||"",plotSummary:t.plotSummary||"",openingLine:t.openingLine||t.opening||"",styleExamples:t.styleExamples||["","",""],hobbies:t.hobbies||"",experiences:t.experiences||"",published:t.status==="published",generatedPrompt:t.systemPrompt||"",personality:t.personality||"",relationship:r?t.relationship||"陌生人":"",customRelationship:r?"":t.relationship||"",avatar:t.avatar||"",sceneDescription:t.sceneDescription||"",sceneGeneratedPrompt:t.systemPromptScene||"",templateIdScene:t.sceneTemplateId?String(t.sceneTemplateId):"",characterType:t.characterType||t.type||"原创角色",age:t.age||"",occupation:t.occupation||""}),p(!r&&!!t.relationship),z(t.promptModelId||""),N(typeof t.promptTemperature=="number"?t.promptTemperature:t.promptTemperature||.1),_(t.sceneModelId||""),D(typeof t.sceneTemperature=="number"?t.sceneTemperature:t.sceneTemperature||.1)}},[t]);const[w,g]=n.useState(!1),[S,x]=n.useState(!1),[u,d]=n.useState(!1),[A,C]=n.useState(""),[T,k]=n.useState(!1),o=n.useRef(null),[b,$]=n.useState(!1),[F,R]=n.useState(!1),j=n.useRef(null),O=n.useRef(null),[U,z]=n.useState(""),[f,_]=n.useState(""),[E,N]=n.useState(.1),[P,D]=n.useState(.1),[V,H]=n.useState([]),[Y,J]=n.useState(!1),[se,pe]=n.useState(""),[he,Ye]=n.useState([]),[Ge,je]=n.useState(!1),Je=["M/M","M/F","BL","BG","耽美","百合","责任感","偶像","占有欲","霸道","调戏","腹黑","温柔","年下","年上","感性","体贴","理性","反差","激情","校园","贴心","偏执","疯批","傲娇","职场","冷漠","忧郁","人夫","养胃","控制欲","黏人","可爱","成熟","性感"];n.useEffect(()=>{const r=L=>{T&&o.current&&!o.current.contains(L.target)&&k(!1),b&&j.current&&!j.current.contains(L.target)&&$(!1),F&&O.current&&!O.current.contains(L.target)&&R(!1)},M=L=>{L.key==="Escape"&&(k(!1),$(!1),R(!1))};return document.addEventListener("mousedown",r),document.addEventListener("keydown",M),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("keydown",M)}},[T,b,F]),n.useEffect(()=>{(async()=>{try{const r=await le.list(),M=L=>{const ke=(L.model_nickname||"").match(/^模型-([A-Z])$/i);return ke?ke[1].toUpperCase():L.model_name||L.model_id||""};H((r.items||[]).sort((L,G)=>M(L).localeCompare(M(G))))}catch{}})()},[]),n.useEffect(()=>{(async()=>{try{je(!0);const r=await Q.list();Ye(r.items||[])}catch{}finally{je(!1)}})()},[]);const ve=r=>{const M=V.find(L=>L.model_id===r);return M?M.model_nickname||M.model_name||M.model_id:"-- 请选择 --"},qe=s.templateIdScene?(Ne=he.find(r=>r.id===parseInt(s.templateIdScene)))==null?void 0:Ne.name:"-- 请选择 --",Xe=async()=>{k(!T)},We=async()=>{g(!0),c(r=>({...r,generatedPrompt:""}));try{const r={model:U||void 0,temperature:E===""?void 0:parseFloat(E),sourcePrompt:s.sceneGeneratedPrompt||""},M=await Me.generateNoScene(r);c(L=>({...L,generatedPrompt:M.prompt||""}))}catch{}finally{g(!1)}},we=r=>{c(M=>({...M,templateIdScene:r})),k(!1)},Ze=r=>{p(!1),c(M=>({...M,relationship:r,customRelationship:""}))},Ke=()=>{p(!0),c(r=>({...r,relationship:""}))},Qe=(r,M)=>{const L=[...s.styleExamples];L[r]=M,c(G=>({...G,styleExamples:L}))};return e.jsxs("div",{className:"animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:l,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(te,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:t?"编辑角色":"创建新角色"}),e.jsx("p",{className:"text-gray-400 text-xs",children:t?"修改角色设定与提示词":"填写设定并生成专属提示词"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:async()=>{if(!s.name||!s.name.trim()){a&&a("保存失败：请输入角色名称","error");return}const r={name:s.name.trim(),gender:s.gender,sceneTemplateId:s.templateIdScene?parseInt(s.templateIdScene):(t==null?void 0:t.sceneTemplateId)??null,identity:s.identity||null,tagline:s.tagline||null,personality:s.personality||null,relationship:m?s.customRelationship||null:s.relationship||null,plotTheme:s.plotTheme||null,plotSummary:s.plotSummary||null,openingLine:s.openingLine||null,systemPrompt:s.generatedPrompt||null,systemPromptScene:s.sceneGeneratedPrompt||null,promptModelId:U||null,promptTemperature:E===""?null:parseFloat(E),sceneModelId:f||null,sceneTemperature:P===""?null:parseFloat(P),hobbies:s.hobbies||null,experiences:s.experiences||null,status:s.published?"published":"draft",tags:s.tags||[],styleExamples:s.styleExamples||[],avatar:s.avatar||null,characterType:s.characterType||null,age:s.age===""?null:parseInt(s.age,10),occupation:s.occupation||null};try{i==="edit"&&(t!=null&&t.id)?(await ne.update(t.id,r),a&&a("保存成功：角色已更新")):(await ne.create(r),a&&a("保存成功：角色已保存")),l()}catch(M){console.error("[characters.save] failed",{mode:i,payload:r,error:M}),a&&a("保存失败：请稍后重试","error")}},className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(ee,{size:16})," 保存角色"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:[e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-4",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色类型设置"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:["原创角色","二次创作","其他"].map(r=>e.jsx("button",{onClick:()=>c({...s,characterType:r}),className:`px-6 py-3 rounded-2xl text-sm font-bold transition-all ${s.characterType===r?"bg-pink-500 text-white shadow-md":"bg-white text-gray-500 hover:text-pink-600"}`,children:r},r))})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 基础设定"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色名称"}),e.jsx("input",{value:s.name,onChange:r=>c({...s,name:r.target.value}),type:"text",className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"角色姓名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"性别"}),e.jsx("div",{className:"flex bg-gray-50 p-1 rounded-xl border border-gray-200",children:["男","女","其他"].map(r=>e.jsx("button",{onClick:()=>c({...s,gender:r}),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${s.gender===r?"bg-pink-500 text-white shadow-md":"text-gray-400 hover:text-pink-500"}`,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"年龄"}),e.jsx("input",{value:s.age,onChange:r=>c({...s,age:r.target.value}),type:"number",min:"0",max:"200",className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"年龄"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"职业"}),e.jsx("input",{value:s.occupation,onChange:r=>c({...s,occupation:r.target.value}),type:"text",className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"职业"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"身份背景 (Identity)"}),e.jsx("textarea",{value:s.identity,onChange:r=>c({...s,identity:r.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"角色的年龄、职业、过往经历..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"一句话人设 (Tagline)"}),e.jsx("input",{value:s.tagline,onChange:r=>c({...s,tagline:r.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例如：表面温柔克己实则腹黑"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"性格 (Personality)"}),e.jsx("textarea",{value:s.personality,onChange:r=>c({...s,personality:r.target.value}),rows:"2",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：占有欲强，容易吃醋..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色标签"}),e.jsxs("div",{onClick:()=>J(!0),className:"dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white transition rounded-2xl border border-pink-100",children:[s.tags.length===0&&e.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:"点击添加标签 (#傲娇 #高冷...)"}),s.tags.map(r=>e.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",r,e.jsx("button",{onClick:M=>{M.stopPropagation(),c(L=>({...L,tags:L.tags.filter(G=>G!==r)}))},className:"ml-1 opacity-60 hover:opacity-100",children:e.jsx(W,{size:12})})]},r)),e.jsx("span",{className:"ml-auto text-pink-300 text-xs",children:"›"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"当下的关系"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("button",{onClick:Ke,className:`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${m?"bg-pink-500 text-white shadow-md border-pink-500":"bg-white text-gray-500 border-gray-200 hover:border-pink-300"}`,children:"自定义"}),h.map(r=>e.jsx("button",{onClick:()=>Ze(r),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${!m&&s.relationship===r?"bg-pink-500 text-white shadow-md border-pink-500":"bg-white text-gray-500 border-gray-200 hover:border-pink-300"}`,children:r},r))]}),m&&e.jsx("div",{className:"animate-fade-in mt-2",children:e.jsx("input",{type:"text",value:s.customRelationship,onChange:r=>c({...s,customRelationship:r.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm",placeholder:"请输入自定义关系"})})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 第一情节"]}),e.jsxs("div",{className:"bg-pink-50 border border-pink-100 rounded-2xl p-4 flex gap-3 text-pink-700 text-sm leading-relaxed",children:[e.jsx(Le,{size:18,className:"flex-shrink-0 mt-0.5 text-pink-500"}),e.jsx("div",{children:"第一情节的内容将被应用于和角色的第一次聊天。此外，设定第一情节并选择公开角色后，情节内容将显示在角色资料页上。"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"主题"}),e.jsx("input",{value:s.plotTheme,onChange:r=>c({...s,plotTheme:r.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例：当温柔人夫终于爆发腹黑属性"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"情节梗概"}),e.jsx("textarea",{value:s.plotSummary,onChange:r=>c({...s,plotSummary:r.target.value}),rows:"4",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：在一起这么久了，他还是一如既往的温柔体贴，从来不干涉你的个人生活。今天晚上你去酒吧玩，故意装作喝醉和他打电话，却在他应了一声后开始软声叫着别人的名字......"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"开场白"}),e.jsx("input",{value:s.openingLine,onChange:r=>c({...s,openingLine:r.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例：“出来，我在酒吧门口”"})]})]}),e.jsxs("div",{className:"solid-card rounded-3xl overflow-hidden",children:[e.jsxs("div",{className:"p-8 pb-4 flex justify-between items-center cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>v(!y),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"}),e.jsx("h3",{className:"font-cute text-lg text-pink-900",children:"进阶设定"}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-pink-100 text-pink-600 rounded",children:"可选"})]}),e.jsx(Pe,{size:20,className:`text-gray-400 transition-transform duration-300 ${y?"rotate-180":""}`})]}),y&&e.jsxs("div",{className:"p-8 pt-0 space-y-6 animate-in slide-in-from-top-4 fade-in duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-3",children:"说话风格示例"}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(r=>e.jsxs("div",{className:"relative flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-bold text-pink-300 font-mono",children:["0",r+1]}),e.jsx("input",{type:"text",value:s.styleExamples[r]||"",onChange:M=>Qe(r,M.target.value),className:"dream-input flex-1 px-4 py-3 rounded-xl text-sm",placeholder:r===0?"例：哼，别以为我会感谢你。":r===1?"例：今晚月色真美，不一起走走吗？":"例：再靠近一步，我就不客气了。"})]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"爱好"}),e.jsx("textarea",{value:s.hobbies,onChange:r=>c({...s,hobbies:r.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：喜欢看书、收集古董怀表..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"经历"}),e.jsx("textarea",{value:s.experiences,onChange:r=>c({...s,experiences:r.target.value}),rows:"4",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"请填写角色个人经历或你们的共同经历"})]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl relative overflow-visible bg-gradient-to-r from-pink-50 to-pink-100 border-pink-100",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色提示词配置（带场景描述）"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色提示词AI模型（场景）"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative z-50 flex-1",ref:O,children:[e.jsxs("button",{onClick:()=>R(!F),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${F?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${f?"text-gray-700":"text-gray-400 font-normal"}`,children:ve(f)}),e.jsx("div",{className:`text-pink-400 transition-transform ${F?"rotate-180":""}`,children:"▼"})]}),F&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:V.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型"}):V.map(r=>e.jsx("li",{onClick:()=>{_(r.model_id),R(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${f===r.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:r.model_nickname||r.model_name||r.model_id},r.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-[140px] justify-end",children:[e.jsx("input",{type:"number",min:"0",max:"2",step:"0.05",value:P,onChange:r=>D(r.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.jsxs("div",{className:"relative group",children:[e.jsx(fe,{size:18,className:"text-pink-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center",children:"温度：高数值输出随机，低数值输出集中。"})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-end mt-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"选择基础模版"}),e.jsxs("div",{className:"relative z-20 flex-1",ref:o,children:[e.jsxs("button",{onClick:Xe,className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${T?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${s.templateIdScene?"text-gray-700":"text-gray-400 font-normal"}`,children:qe}),e.jsx("div",{className:`text-pink-400 transition-transform ${T?"rotate-180":""}`,children:"▼"})]}),T&&e.jsxs("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:[e.jsx("li",{onClick:()=>we(""),className:"px-4 py-3 text-sm text-gray-400 hover:bg-pink-50 cursor-pointer border-b border-pink-50",children:"-- 请选择 --"}),Ge?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"加载中..."}):he.map(r=>e.jsxs("li",{onClick:()=>we(r.id.toString()),className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${s.templateIdScene==r.id?"bg-pink-100 font-bold text-pink-700":""}`,children:[r.name," (",r.type,")"]},r.id))]})]})]}),e.jsxs("button",{onClick:async()=>{if(!s.templateIdScene)return alert("请先选择一个提示词模版");x(!0),c(r=>({...r,sceneGeneratedPrompt:""}));try{const r=he.find(G=>G.id===parseInt(s.templateIdScene)),M={templateContent:(r==null?void 0:r.content)||"",model:f||void 0,temperature:P===""?void 0:parseFloat(P),name:s.name,gender:s.gender,age:s.age,occupation:s.occupation,identity:s.identity,tagline:s.tagline,tags:s.tags,personality:s.personality,relationship:m?s.customRelationship:s.relationship,styleExamples:s.styleExamples,hobbies:s.hobbies,experiences:s.experiences},L=await Me.generate(M);c(G=>({...G,sceneGeneratedPrompt:L.prompt||""}))}catch{}finally{x(!1)}},disabled:S,className:"px-6 py-3 rounded-xl bg-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] justify-center z-0",children:[S?e.jsx("span",{className:"animate-spin",children:e.jsx(Se,{size:16})}):e.jsx(ue,{size:16,className:"text-yellow-300"}),S?"生成中...":"生成提示词"]})]}),e.jsx("p",{className:"text-xs text-pink-400 mt-2 ml-1",children:"* 将根据上方填写的设定，自动填充到模版占位符中"}),e.jsxs("div",{className:"mt-4 relative",children:[e.jsx("textarea",{rows:"12",value:s.sceneGeneratedPrompt,onChange:r=>c({...s,sceneGeneratedPrompt:r.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner",placeholder:"点击上方“生成提示词”按钮，或在此直接编写 Prompt..."}),!s.sceneGeneratedPrompt&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-30",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{size:48,className:"mx-auto mb-2 text-pink-300"}),e.jsx("p",{className:"text-sm font-bold text-pink-400",children:"等待生成..."})]})})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl relative overflow-visible bg-gradient-to-r from-pink-50 to-pink-100 border-pink-100",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色提示词配置"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色提示词AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative z-50 flex-1",ref:j,children:[e.jsxs("button",{onClick:()=>$(!b),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${b?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${U?"text-gray-700":"text-gray-400 font-normal"}`,children:ve(U)}),e.jsx("div",{className:`text-pink-400 transition-transform ${b?"rotate-180":""}`,children:"▼"})]}),b&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:V.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型"}):V.map(r=>e.jsx("li",{onClick:()=>{z(r.model_id),$(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${U===r.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:r.model_nickname||r.model_name||r.model_id},r.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-[140px] justify-end",children:[e.jsx("input",{type:"number",min:"0",max:"2",step:"0.05",value:E,onChange:r=>N(r.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.jsxs("div",{className:"relative group",children:[e.jsx(fe,{size:18,className:"text-pink-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center",children:"温度：高数值输出随机，低数值输出集中。"})]})]}),e.jsxs("button",{onClick:We,disabled:w,className:"px-6 py-3 rounded-xl bg-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] justify-center z-0",children:[w?e.jsx("span",{className:"animate-spin",children:e.jsx(Se,{size:16})}):e.jsx(ue,{size:16,className:"text-yellow-300"}),w?"生成中...":"生成提示词"]})]})]}),e.jsx("p",{className:"text-xs text-pink-400 mt-2 ml-1",children:"* 将根据上方输出的提示词，进行二次生成不带场景描述的提示词。"}),e.jsxs("div",{className:"mt-4 relative",children:[e.jsx("textarea",{rows:"12",value:s.generatedPrompt,onChange:r=>c({...s,generatedPrompt:r.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner",placeholder:"点击上方“生成提示词”按钮，或在此直接编写 Prompt..."}),!s.generatedPrompt&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-30",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{size:48,className:"mx-auto mb-2 text-pink-300"}),e.jsx("p",{className:"text-sm font-bold text-pink-400",children:"等待生成..."})]})})]})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:[e.jsxs("div",{className:"glass-card p-6 rounded-3xl flex flex-col items-center text-center",children:[e.jsx("h3",{className:"font-cute text-pink-900 mb-4 w-full text-left border-b border-pink-100 pb-2",children:"头像预览"}),e.jsxs("div",{onClick:()=>d(!0),className:"w-32 h-32 rounded-full bg-gray-100 border-4 border-white shadow-xl flex items-center justify-center mb-4 relative group cursor-pointer overflow-hidden",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-4xl text-gray-300 font-bold",children:s.name?s.name[0]:"?"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"更换头像"})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:"flex items-center justify-between p-4 bg-white/50 rounded-xl cursor-pointer hover:bg-white transition-colors border border-pink-50",children:[e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"发布到广场"}),e.jsx("div",{onClick:()=>c({...s,published:!s.published}),className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${s.published?"bg-pink-500":"bg-gray-300"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-sm transform transition-transform duration-300 ${s.published?"translate-x-6":""}`})})]}),e.jsx("p",{className:"text-xs text-left text-gray-400 mt-2 px-1",children:"开启后，该角色将出现在公共广场，所有用户可见。"})]})]}),e.jsxs("div",{className:"glass-card p-6 rounded-3xl bg-gradient-to-br from-pink-500 to-pink-600 text-white",children:[e.jsxs("h4",{className:"font-bold mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"inline-block",children:e.jsx(ue,{size:16,className:"text-yellow-300"})})," 提示"]}),e.jsx("p",{className:"text-xs opacity-90 leading-relaxed",children:"好的 Prompt 决定了角色的灵魂。建议生成后仔细检查，补充更多细节。"})]})]})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:()=>J(!1)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-4xl rounded-3xl bg-white p-6 shadow-2xl border border-pink-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>J(!1),className:"w-8 h-8 rounded-full bg-pink-50 text-pink-800 flex items-center justify-center",children:"‹"}),e.jsx("h3",{className:"text-lg font-bold font-cute text-pink-900",children:"添加 #标签"}),e.jsx("button",{onClick:()=>J(!1),className:"text-sm font-bold text-pink-600 bg-pink-50 px-3 py-1 rounded-full",children:"完成"})]}),e.jsxs("div",{className:"space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"选定的标签"}),e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-pink-50/50 p-3 rounded-xl border border-pink-100 border-dashed",children:s.tags.length===0?e.jsx("span",{className:"text-xs text-gray-400",children:"暂无标签"}):s.tags.map(r=>e.jsxs("button",{onClick:()=>c(M=>({...M,tags:M.tags.filter(L=>L!==r)})),className:"bg-pink-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1",children:["#",r," ",e.jsx("span",{className:"text-[10px] ml-1 opacity-80",children:"×"})]},r))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"直接添加 (自定义)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:se,onChange:r=>pe(r.target.value),onKeyDown:r=>{if(r.key==="Enter"){r.preventDefault();const M=se.trim();M&&c(L=>L.tags.includes(M)?L:{...L,tags:[...L.tags,M]}),pe("")}},type:"text",placeholder:"输入标签，不用加#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white rounded-xl"}),e.jsx("button",{onClick:()=>{const r=se.trim();r&&c(M=>M.tags.includes(r)?M:{...M,tags:[...M.tags,r]}),pe("")},className:"bg-gradient-to-r from-pink-400 to-pink-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition",children:"添加"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"标签选择"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Je.map(r=>e.jsxs("button",{onClick:()=>c(M=>({...M,tags:M.tags.includes(r)?M.tags.filter(L=>L!==r):[...M.tags,r]})),className:`tag-select-btn flex items-center justify-center ${s.tags.includes(r)?"active":""}`,children:["#",r]},r))})]})]})]})})]}),u&&e.jsx(ze,{initialImage:s.avatar||null,onSave:async r=>{try{const M=await ye.avatar(r);c(L=>({...L,avatar:M.url}))}catch{}d(!1)},onCancel:()=>d(!1)}),u&&e.jsx(ze,{initialImage:s.avatar,onSave:r=>{c(M=>({...M,avatar:r})),d(!1)},onCancel:()=>d(!1)})]})},Xt=({creatorRole:t})=>{const[l,i]=n.useState("list"),[a,s]=n.useState(null),[c,h]=n.useState([]),[m,p]=n.useState("new"),{showToast:y}=Z(),[v,w]=n.useState(null),g=300,S=async()=>{try{const o=t?{creator_role:t}:{},b=await ne.list(o);h(b.items||[])}catch{y("加载失败","error")}};n.useEffect(()=>{S()},[t]);const x=o=>{s(o),p("edit"),i("create")},u=()=>{s(null),p("new"),i("create")},d=o=>{const b={...o,id:void 0,name:`${o.name}_copy`,status:"draft"};s(b),p("copy"),i("create"),y("复制成功，已进入编辑")},A=async(o,b)=>{try{await ne.setStatus(o,b==="published"?"draft":"published"),await S()}catch{y("操作失败","error")}},C=o=>w(o),T=()=>w(null),k=async()=>{if(v)try{await ne.remove(v.id),y("删除成功"),await S()}catch{y("删除失败","error")}finally{T()}};return l==="create"?e.jsx(qt,{initialData:a,onCancel:()=>{i("list"),S()},mode:m,notify:y}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),t==="user_role"?"用户角色":"官方角色"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:t==="user_role"?"查看用户创建的角色":"管理官方发布的 AI 角色"})]}),t!=="user_role"&&e.jsxs("button",{onClick:u,className:"bg-gradient-to-r from-pink-500 to-pink-600 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:opacity-90 transition-all flex items-center gap-2 text-sm",children:[e.jsx(X,{size:16})," 创建角色"]})]}),e.jsx("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(auto-fit, minmax(320px, 360px))"},children:c.map(o=>e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"glass-card p-4 rounded-3xl hover:shadow-xl transition-all group relative overflow-hidden h-[220px] flex flex-col",children:[e.jsx("div",{className:`absolute top-4 right-4 text-xs px-2 py-0.5 rounded-md font-bold ${o.status==="published"?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"}`,children:o.status==="published"?"已发布":"草稿"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-pink-200 to-pink-300 flex items-center justify-center text-white text-xl font-bold shadow-inner border-2 border-white overflow-hidden flex-shrink-0",children:o.avatar?e.jsx("img",{src:o.avatar,alt:"avatar",className:"w-full h-full object-cover"}):e.jsx("span",{children:o.name?o.name[0]:"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 truncate",children:o.name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[o.age!=null&&o.age!==""?`${o.age}岁`:"",o.occupation?`${o.age!=null&&o.age!==""?" · ":""}${o.occupation}`:""]})]}),e.jsx("div",{className:"flex gap-1 mt-2 flex-nowrap whitespace-nowrap overflow-hidden",style:{maxWidth:g},children:o.tags.map(b=>e.jsxs("span",{className:"text-[10px] bg-pink-50 text-pink-600 px-1.5 py-0.5 rounded border border-pink-100",children:["#",b]},b))})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed break-words",children:o.tagline||"暂无一句话人设"})}),e.jsxs("div",{className:"mt-auto flex gap-2 pt-3 border-t border-white/50",children:[e.jsxs("button",{onClick:()=>x(o),className:"flex-1 py-2 text-xs font-bold text-pink-600 bg-pink-50 hover:bg-pink-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(xe,{size:12})," 编辑"]}),e.jsxs("button",{onClick:()=>d(o),className:"flex-1 py-2 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Ue,{size:12})," 复制"]}),o.status==="published"?e.jsxs("button",{onClick:()=>A(o.id,o.status),className:"flex-1 py-2 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Fe,{size:12})," 回收"]}):e.jsxs("button",{onClick:()=>A(o.id,o.status),className:"flex-1 py-2 text-xs font-bold text-green-600 bg-green-50 hover:bg-green-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Oe,{size:12})," 发布"]})]})]}),e.jsx("button",{onClick:()=>C(o),className:"absolute -top-2 -right-2 z-10 w-8 h-8 rounded-full bg-white/60 backdrop-blur-md shadow-lg border border-pink-100 flex items-center justify-center text-gray-400 hover:text-red-500 transition",children:e.jsx(W,{size:12})})]},o.id))}),v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:T}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除角色"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",v.name,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:T,className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:k,className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]})]})},Ie=({creatorRole:t})=>e.jsx(K,{children:e.jsx(Xt,{creatorRole:t})}),Wt=({user:t,onSaveLimit:l,onDelete:i,onChangePwd:a})=>{const[s,c]=n.useState(t.chatLimit),h=s!==t.chatLimit,m=()=>{l(t.id,s)};return e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-5 pl-8",children:e.jsx("img",{src:t.avatar||"/uploads/avatars/default_avatar.jpg",alt:t.username,className:"w-10 h-10 rounded-full object-cover shadow-sm"})}),e.jsx("td",{className:"p-5 font-mono text-gray-500",children:t.id.toString().padStart(4,"0")}),e.jsxs("td",{className:"p-5",children:[e.jsx("div",{className:"font-bold text-gray-700",children:t.username}),e.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),e.jsx("td",{className:"p-5",children:e.jsx("div",{className:"text-xs text-gray-700",children:t.nickname||"-"})}),e.jsxs("td",{className:"p-5",children:[e.jsx("span",{className:"font-mono text-pink-600 font-bold",children:t.used})," 次"]}),e.jsx("td",{className:"p-5",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"number",value:s,onChange:p=>c(parseInt(p.target.value)||0),className:"dream-input w-24 px-4 py-2 rounded-2xl text-sm text-center",min:"0"})})}),e.jsx("td",{className:"p-5 text-right pr-8",children:e.jsxs("div",{className:"space-x-2",children:[e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:m,disabled:!h,className:`p-1 rounded ${h?"text-green-600 hover:text-green-700":"text-gray-300 cursor-not-allowed"}`,"aria-label":"保存设置",children:e.jsx(Ae,{size:16})}),e.jsx("span",{className:`absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap transition-opacity ${h?"opacity-0 group-hover:opacity-100":"hidden"}`,children:"保存设置"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:a,className:"p-1 rounded text-pink-400 hover:text-pink-600","aria-label":"修改密码",children:e.jsx(xe,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"修改密码"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:i,className:"p-1 rounded text-red-400 hover:text-red-600","aria-label":"删除",children:e.jsx(de,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"删除"})]})]})})]})},Zt=({onCancel:t,onSave:l,notify:i})=>{const[a,s]=n.useState({username:"",nickname:"",email:"",password:"",chatLimit:0}),c=m=>{const{name:p,value:y}=m.target;s(v=>({...v,[p]:p==="chatLimit"?parseInt(y)||0:y}))},h=()=>{if(!a.username||!a.password){i&&i("创建失败：请填写用户名和密码","error");return}const m={username:a.username,nickname:a.nickname||null,email:a.email||`${a.username.toLowerCase()}@example.com`,password:a.password,chatLimit:a.chatLimit};l(m)};return e.jsxs("div",{className:"animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(te,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:"添加新用户"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"分配后台登录权限和聊天额度"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:t,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:h,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text白 font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(X,{size:16})," 创建用户"]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6 max-w-2xl mx-auto",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 用户基础信息"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"用户名"}),e.jsx("input",{type:"text",name:"username",value:a.username,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"为新用户设置一个用户名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"昵称"}),e.jsx("input",{type:"text",name:"nickname",value:a.nickname,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"显示名称（可选）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"邮箱"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"用于联系与通知（可选）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"密码 (初始密码)"}),e.jsx("input",{type:"password",name:"password",value:a.password,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"设置初始密码"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"聊天额度 (次数)"}),e.jsx("input",{type:"number",name:"chatLimit",value:a.chatLimit,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"0 表示默认无额度",min:"0"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"设置用户默认可用的聊天次数，0 次表示用户初始无额度。"})]})]})]})},Kt=()=>{const[t,l]=n.useState([]),[i,a]=n.useState("list"),[s,c]=n.useState(""),[h,m]=n.useState(null),[p,y]=n.useState(""),[v,w]=n.useState(""),[g,S]=n.useState(null),{showToast:x}=Z();n.useEffect(()=>{ae.list().then(l).catch(()=>{})},[]);const u=async o=>{try{const{id:b}=await ae.create(o);l($=>[...$,{...o,id:b,used:0}]),x(`用户 ${o.username} 创建成功`),a("list")}catch{x("创建失败","error")}},d=async(o,b)=>{try{await ae.update(o,{chatLimit:b}),l(F=>F.map(R=>R.id===o?{...R,chatLimit:b}:R));const $=t.find(F=>F.id===o);x(`用户 ${($==null?void 0:$.username)??o} 限额已更新`)}catch{x("保存失败","error")}},A=async o=>{try{await ae.remove(o),l(b=>b.filter($=>$.id!==o)),x("用户已删除")}catch{x("删除失败","error")}},C=g&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-80",children:[e.jsx("div",{className:"font-bold mb-3",children:"确认删除该用户？"}),e.jsx("p",{className:"text-sm text-gray-500 mb-5",children:"此操作不可恢复。"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>S(null),children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-red-500 text-white",onClick:()=>{const o=g.id;S(null),A(o)},children:"删除"})]})]})}),T=h&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-96",children:[e.jsxs("div",{className:"font-bold mb-3",children:["为用户 ",h.username," 修改密码"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"password",placeholder:"输入新密码",className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700",value:p,onChange:o=>y(o.target.value)}),e.jsx("input",{type:"password",placeholder:"再次输入新密码",className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700",value:v,onChange:o=>w(o.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-5",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{m(null),y(""),w("")},children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:async()=>{if(!p||p!==v){x("两次输入密码不一致","error");return}try{await ae.changePassword(h.id,p),x("密码已更新")}catch{x("更新失败","error")}m(null),y(""),w("")},children:"确认修改"})]})]})}),k=t.filter(o=>{var b,$;return((b=o.username)==null?void 0:b.toLowerCase().includes(s.toLowerCase()))||(o.nickname?o.nickname.toLowerCase().includes(s.toLowerCase()):!1)||(($=o.email)==null?void 0:$.toLowerCase().includes(s.toLowerCase()))});return i==="create"?e.jsx(Zt,{onCancel:()=>a("list"),onSave:u,notify:x}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[C,T,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"})," 用户管理"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"监控用户使用情况与限额"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"搜索用户名/邮箱...",className:"dream-input pl-10 pr-4 py-2 rounded-xl text-sm w-64",value:s,onChange:o=>c(o.target.value)}),e.jsx(ft,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-pink-300"})]}),e.jsxs("button",{onClick:()=>a("create"),className:"bg-pink-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(X,{size:16})," 添加用户"]})]})]}),e.jsx("div",{className:"glass-card rounded-3xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-pink-50/50 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-5 pl-8",children:"头像"}),e.jsx("th",{className:"p-5",children:"用户 ID"}),e.jsx("th",{className:"p-5",children:"用户名 / 邮箱"}),e.jsx("th",{className:"p-5",children:"昵称"}),e.jsx("th",{className:"p-5",children:"已用次数"}),e.jsx("th",{className:"p-5",children:"剩余额度"}),e.jsx("th",{className:"p-5 text-right pr-8",children:"操作"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-pink-50",children:k.length>0?k.map(o=>e.jsx(Wt,{user:o,onSaveLimit:d,onDelete:()=>S(o),onChangePwd:()=>m(o)},o.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-10 text-center text-gray-400",children:"未找到匹配的用户。"})})})]})})]})},Qt=()=>e.jsx(K,{children:e.jsx(Kt,{})}),ge=({value:t,onChange:l})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"2",step:"0.05",value:t,onChange:i=>l(i.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.jsxs("div",{className:"relative group",children:[e.jsx(fe,{size:18,className:"text-pink-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center",children:"温度：高数值输出随机，低数值输出集中。"})]})]}),es=()=>{const[t,l]=n.useState([]),[i,a]=n.useState(""),[s,c]=n.useState(!1),h=n.useRef(null),[m,p]=n.useState(""),[y,v]=n.useState(!1),w=n.useRef(null),[g,S]=n.useState(""),[x,u]=n.useState(!1),d=n.useRef(null),[A,C]=n.useState(.1),[T,k]=n.useState(.1),[o,b]=n.useState(.1),[$,F]=n.useState(null),{showToast:R}=Z(),j=N=>{const P=t.find(D=>D.model_id===N);return P?P.model_name||P.model_id:"-- 请选择 --"},O=async()=>{try{const N=await le.list();l(N.items||[])}catch{R("模型列表加载失败","error")}};n.useEffect(()=>{O(),(async()=>{try{const N=await _e.get();a(N.selected_model),p(N.selected_chat_model),S(N.selected_story_model),C(Number(N.model_temperature||.1)),k(Number(N.chat_temperature||.1)),b(Number(N.story_temperature||.1)),F(N.default_template_id||null)}catch{R("加载设置失败","error")}})()},[]),n.useEffect(()=>{const N=P=>{s&&h.current&&!h.current.contains(P.target)&&c(!1),y&&w.current&&!w.current.contains(P.target)&&v(!1),x&&d.current&&!d.current.contains(P.target)&&u(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[s,y,x]);const U=[...t].sort((N,P)=>(N.model_name||N.model_id).localeCompare(P.model_name||P.model_id)),z=j(i),f=j(m),_=j(g),E=async()=>{try{await _e.save({selected_model:i,selected_chat_model:m,selected_story_model:g,model_temperature:Number(A),chat_temperature:Number(T),story_temperature:Number(o),default_template_id:$}),R("设置已保存")}catch{R("保存失败","error")}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"模型设置"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"配置全局模型与温度参数"})]})}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"}),"模型配置"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色提示词AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-full max-w-md",ref:h,children:[e.jsxs("button",{onClick:()=>c(!s),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${s?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${i?"text-gray-700":"text-gray-400 font-normal"}`,children:z}),e.jsx("div",{className:`text-pink-400 transition-transform ${s?"rotate-180":""}`,children:"▼"})]}),s&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:U.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型，请先添加"}):U.map(N=>e.jsx("li",{onClick:()=>{a(N.model_id),c(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${i===N.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:N.model_name||N.model_id},N.id))})]}),e.jsx(ge,{value:A,onChange:C}),e.jsxs("button",{onClick:E,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2",children:[e.jsx(ee,{size:16})," 确认"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色聊天AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-full max-w-md",ref:w,children:[e.jsxs("button",{onClick:()=>v(!y),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${y?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${m?"text-gray-700":"text-gray-400 font-normal"}`,children:f}),e.jsx("div",{className:`text-pink-400 transition-transform ${y?"rotate-180":""}`,children:"▼"})]}),y&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:U.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型，请先添加"}):U.map(N=>e.jsx("li",{onClick:()=>{p(N.model_id),v(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${m===N.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:N.model_name||N.model_id},N.id))})]}),e.jsx(ge,{value:T,onChange:k}),e.jsxs("button",{onClick:E,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2",children:[e.jsx(ee,{size:16})," 确认"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"故事生成AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-full max-w-md",ref:d,children:[e.jsxs("button",{onClick:()=>u(!x),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${x?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${g?"text-gray-700":"text-gray-400 font-normal"}`,children:_}),e.jsx("div",{className:`text-pink-400 transition-transform ${x?"rotate-180":""}`,children:"▼"})]}),x&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:U.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型，请先添加"}):U.map(N=>e.jsx("li",{onClick:()=>{S(N.model_id),u(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${g===N.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:N.model_name||N.model_id},N.id))})]}),e.jsx(ge,{value:o,onChange:b}),e.jsxs("button",{onClick:E,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2",children:[e.jsx(ee,{size:16})," 确认"]})]})]})]})]})]})},ts=()=>e.jsx(K,{children:e.jsx(es,{})}),ss=()=>{const{showToast:t}=Z(),[l,i]=n.useState([]),[a,s]=n.useState(1),c=6,[h,m]=n.useState(!1),[p,y]=n.useState({model_id:"",model_name:"",model_nickname:""}),[v,w]=n.useState(null),g=async()=>{try{const C=await le.list();i(C.items||[])}catch{t("模型列表加载失败","error")}};n.useEffect(()=>{g()},[]);const S=C=>{if(!C)return"-";const T=new Date(C),k=T.getFullYear(),o=String(T.getMonth()+1).padStart(2,"0"),b=String(T.getDate()).padStart(2,"0"),$=String(T.getHours()).padStart(2,"0"),F=String(T.getMinutes()).padStart(2,"0");return`${k}/${o}/${b} ${$}:${F}`},x=Math.max(1,Math.ceil(l.length/c)),u=(a-1)*c,d=l.slice(u,u+c);n.useEffect(()=>{a>x&&s(x)},[l]);const A=async()=>{if(!p.model_id||!p.model_name){t("请填写完整信息","error");return}try{await le.create(p),t("模型添加成功"),m(!1),y({model_id:"",model_name:"",model_nickname:""}),g()}catch{t("添加失败","error")}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"模型管理"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"维护可用的模型列表"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"bg-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-xs",children:[e.jsx(X,{size:14})," 添加模型"]})]}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden border border-pink-100",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 pl-6 w-16",children:"序号"}),e.jsx("th",{className:"p-3",children:"模型名称"}),e.jsx("th",{className:"p-3",children:"模型ID"}),e.jsx("th",{className:"p-3",children:"盲测模型昵称"}),e.jsx("th",{className:"p-3",children:"添加时间"}),e.jsx("th",{className:"p-3 text-right pr-6",children:"操作"})]})}),e.jsxs("tbody",{className:"text-sm divide-y divide-pink-100",children:[d.map((C,T)=>e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-3 pl-6 text-gray-500 font-mono",children:u+T+1}),e.jsx("td",{className:"p-3 font-bold text-pink-700",children:C.model_name}),e.jsx("td",{className:"p-3 font-mono text-gray-600",children:C.model_id}),e.jsx("td",{className:"p-3 text-gray-600",children:C.model_nickname||"-"}),e.jsx("td",{className:"p-3 text-gray-500",children:S(C.created_at)}),e.jsx("td",{className:"p-3 text-right pr-6",children:e.jsx("button",{onClick:()=>w(C),className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(de,{size:16})})})]},C.id)),l.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-8 text-center text-gray-400 text-sm",children:"暂无模型数据"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["第 ",a," / ",x," 页"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:a===1,onClick:()=>s(C=>Math.max(1,C-1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${a===1?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"上一页"}),Array.from({length:x}).map((C,T)=>e.jsx("button",{onClick:()=>s(T+1),className:`w-8 h-8 rounded-lg text-xs font-bold ${a===T+1?"bg-pink-500 text-white":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:T+1},T)),e.jsx("button",{disabled:a===x,onClick:()=>s(C=>Math.min(x,C+1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${a===x?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"下一页"})]})]})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 z-50",onClick:()=>w(null)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg白 rounded-3xl border border-pink-100 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除模型"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",v.model_name,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>w(null),className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:async()=>{try{await le.remove(v.id),t("删除成功"),w(null),g()}catch{t("删除失败","error")}},className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg白 rounded-3xl border border-pink-100 shadow-2xl p-6 animate-fade-in w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-cute text-xl text-pink-900",children:"添加新模型"}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(W,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-pink-800 mb-1.5",children:["模型ID ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:p.model_id,onChange:C=>y({...p,model_id:C.target.value}),placeholder:"例如: gpt-4-turbo",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-pink-800 mb-1.5",children:["模型名称 ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:p.model_name,onChange:C=>y({...p,model_name:C.target.value}),placeholder:"例如: GPT-4 Turbo",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-1.5",children:"盲测模型昵称"}),e.jsx("input",{type:"text",value:p.model_nickname,onChange:C=>y({...p,model_nickname:C.target.value}),placeholder:"例如: 智慧之星",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-5 py-2.5 rounded-xl bg-gray-50 text-gray-600 font-bold text-sm hover:bg-gray-100 transition-colors",children:"取消"}),e.jsx("button",{onClick:A,className:"px-6 py-2.5 rounded-xl bg-pink-500 text白 font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-600 transition-all",children:"保存模型"})]})]})})]})]})},as=()=>e.jsx(K,{children:e.jsx(ss,{})}),ns=()=>{const{showToast:t}=Z(),[l,i]=n.useState([]),[a,s]=n.useState("list"),[c,h]=n.useState({username:"",email:"",password:""}),[m,p]=n.useState(null),[y,v]=n.useState(""),w=async()=>{try{const d=await q.list();i(d)}catch{t("加载失败","error")}};n.useEffect(()=>{w()},[]);const g=async()=>{if(!c.username||!c.password){t("请填写必填项","error");return}try{const{id:d}=await q.create(c);i(A=>[...A,{id:d,username:c.username,email:c.email||"",isActive:1}]),s("list"),h({username:"",email:"",password:""}),t("管理员添加成功")}catch{t("添加失败","error")}},S=async(d,A)=>{try{await q.update(d,{isActive:A}),i(C=>C.map(T=>T.id===d?{...T,isActive:A}:T)),t(A?"已启用":"已禁用")}catch{t("更新失败","error")}},x=async d=>{try{await q.remove(d),i(A=>A.filter(C=>C.id!==d)),t("删除成功")}catch{t("删除失败","error")}},u=async()=>{if(!y){t("请输入新密码","error");return}try{await q.changePassword(m.id,y),p(null),v(""),t("密码已更新")}catch{t("更新失败","error")}};return a==="create"?e.jsxs("div",{className:"animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>s("list"),className:"px-5 py-2.5 rounded-xl bg-white text-gray-600 font-bold text-sm shadow-sm hover:bg-gray-50",children:"返回"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:"添加管理员"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"创建新的后台管理员账号"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:()=>s("list"),className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:g,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(X,{size:16})," 创建管理员"]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6 max-w-2xl mx-auto",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 管理员信息"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"用户名"}),e.jsx("input",{type:"text",value:c.username,onChange:d=>h({...c,username:d.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"邮箱"}),e.jsx("input",{type:"email",value:c.email,onChange:d=>h({...c,email:d.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"初始密码"}),e.jsx("input",{type:"password",value:c.password,onChange:d=>h({...c,password:d.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]})]})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"管理员账号"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"管理后台管理员列表、禁用与密码修改"})]}),e.jsxs("button",{onClick:()=>s("create"),className:"bg-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-xs",children:[e.jsx(X,{size:14})," 添加管理员"]})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden border border-pink-100",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 pl-6 w-20",children:"头像"}),e.jsx("th",{className:"p-3 w-20",children:"ID"}),e.jsx("th",{className:"p-3",children:"用户名"}),e.jsx("th",{className:"p-3",children:"昵称"}),e.jsx("th",{className:"p-3",children:"邮箱"}),e.jsx("th",{className:"p-3",children:"状态"}),e.jsx("th",{className:"p-3 text-right pr-6",children:"操作"})]})}),e.jsxs("tbody",{className:"text-sm divide-y divide-pink-100",children:[l.map(d=>e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-3 pl-6",children:e.jsx("img",{src:d.avatar||"/uploads/avatars/default_admin.jpg",alt:d.username,className:"w-8 h-8 rounded-full object-cover shadow-sm"})}),e.jsx("td",{className:"p-3 text-gray-500 font-mono",children:d.id.toString().padStart(4,"0")}),e.jsx("td",{className:"p-3 font-bold text-pink-700",children:d.username}),e.jsx("td",{className:"p-3 text-gray-700",children:d.nickname||"-"}),e.jsx("td",{className:"p-3 text-gray-600",children:d.email||"-"}),e.jsx("td",{className:"p-3",children:d.isActive===1?"启用":"禁用"}),e.jsx("td",{className:"p-3 text-right pr-6",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{onClick:()=>p(d),className:"px-3 py-1 rounded bg-white border border-gray-200 text-gray-600 text-xs hover:bg-gray-50",children:"改密"}),e.jsx("button",{onClick:()=>S(d.id,d.isActive===1?0:1),className:`px-3 py-1 rounded text-xs font-bold ${d.isActive===1?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:d.isActive===1?"禁用":"启用"}),e.jsx("button",{onClick:()=>x(d.id),className:"px-3 py-1 rounded bg-red-500 text-white text-xs hover:bg-red-600",children:"删除"})]})})]},d.id)),l.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-8 text-center text-gray-400 text-sm",children:"暂无管理员"})})]})]})}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 z-50",onClick:()=>p(null)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-100 p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900",children:"修改密码"}),e.jsx("button",{onClick:()=>p(null),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(W,{size:20})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-1.5",children:"新密码"}),e.jsx("input",{type:"password",value:y,onChange:d=>v(d.target.value),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{onClick:()=>p(null),className:"px-5 py-2.5 rounded-xl bg-gray-50 text-gray-600 font-bold text-sm hover:bg-gray-100 transition-colors",children:"取消"}),e.jsx("button",{onClick:u,className:"px-6 py-2.5 rounded-xl bg-pink-500 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-600 transition-all",children:"确认修改"})]})]})})]})]})},ls=()=>e.jsx(K,{children:e.jsx(ns,{})}),rs=t=>new Promise(l=>{const i=new FileReader;i.addEventListener("load",()=>l(i.result),!1),i.readAsDataURL(t)}),os=t=>new Promise((l,i)=>{const a=new Image;a.addEventListener("load",()=>l(a)),a.addEventListener("error",s=>i(s)),a.setAttribute("crossOrigin","anonymous"),a.src=t});function is({initialImage:t,onSave:l,onCancel:i}){const[a,s]=n.useState(t?"edit":"upload"),[c,h]=n.useState(t||null),m=async p=>{if(p.target.files&&p.target.files.length>0){const y=p.target.files[0],v=await rs(y);h(v),s("edit")}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-2xl bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[e.jsx(cs,{step:a,onBack:()=>s("upload"),onClose:i}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[a==="upload"&&e.jsx(ds,{onFileChange:m}),a==="edit"&&c&&e.jsx(xs,{imageSrc:c,onSave:l,onCancel:()=>s("upload")})]})]})})}function cs({step:t,onBack:l,onClose:i}){const a=t==="upload"?"上传封面":"裁剪封面";return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t==="edit"&&e.jsx("button",{onClick:l,className:"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-pink-600 transition-colors",children:e.jsx(te,{size:20})}),e.jsx("h2",{className:"text-lg font-cute text-pink-900",children:a})]}),e.jsx("button",{onClick:i,className:"p-2 -mr-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(W,{size:20})})]})}function ds({onFileChange:t}){const[l,i]=n.useState(!1),a=n.useRef(null);return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-1 p-8 flex flex-col items-center justify-center",children:e.jsxs("div",{onDragOver:s=>{s.preventDefault(),i(!0)},onDragLeave:s=>{s.preventDefault(),i(!1)},onDrop:s=>{s.preventDefault(),i(!1),s.dataTransfer.files&&s.dataTransfer.files.length>0&&t({target:{files:s.dataTransfer.files}})},onClick:()=>a.current.click(),className:`w-full max-w-xl aspect-[2/1] rounded-3xl flex flex-col items-center justify-center transition-all duration-300 cursor-pointer border-2 border-dashed ${l?"bg-pink-50 border-pink-400 scale-105":"bg-gray-50 border-gray-200 hover:border-pink-300 hover:bg-pink-50/30"}`,children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white shadow-sm flex items-center justify-center mb-4 text-pink-500",children:e.jsx(Re,{size:32})}),e.jsx("p",{className:"text-gray-600 font-bold mb-1",children:"点击或拖拽上传封面"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"输出尺寸 800×400，比例 2:1"})]})}),e.jsx("input",{type:"file",ref:a,onChange:t,className:"hidden",accept:"image/*"})]})}function xs({imageSrc:t,onSave:l,onCancel:i}){const a=n.useRef(null),[s,c]=n.useState(null),[h,m]=n.useState(!1),[p,y]=n.useState(0),[v,w]=n.useState({x:0,y:0}),[g,S]=n.useState(!1),[x,u]=n.useState({x:0,y:0}),[d,A]=n.useState(1),[C,T]=n.useState(1),k=800,o=800,b=400;n.useEffect(()=>{(async()=>{try{const _=await os(t);c(_);const E=k/_.width,N=k/_.height,P=Math.max(E,N);A(P),T(1)}catch{}})()},[t]);const $=f=>{f.preventDefault();const _=f.deltaY*-.001;T(E=>Math.max(.5,Math.min(E+_,3)))},F=n.useCallback(()=>{if(!s||!a.current)return;const _=a.current.getContext("2d");_.clearRect(0,0,k,k),_.fillStyle="#18181b",_.fillRect(0,0,k,k),_.save(),_.translate(k/2,k/2),_.rotate(p*Math.PI/180),_.translate(-k/2,-k/2);const E=p*Math.PI/180,N=v.x*Math.cos(-E)-v.y*Math.sin(-E),P=v.x*Math.sin(-E)+v.y*Math.cos(-E),D=d*C,V=s.width*D,H=s.height*D,Y=k/2,J=k/2;_.drawImage(s,Y-V/2+N,J-H/2+P,V,H),_.restore();const se=(k-b)/2;_.fillStyle="rgba(0, 0, 0, 0.6)",_.beginPath(),_.rect(0,0,k,k),_.rect(0,se,o,b),_.fill("evenodd")},[s,p,v,d,C]);n.useEffect(()=>{F()},[F]);const R=f=>{var P,D,V,H;S(!0);const _=a.current.getBoundingClientRect(),E=f.clientX||((D=(P=f.touches)==null?void 0:P[0])==null?void 0:D.clientX),N=f.clientY||((H=(V=f.touches)==null?void 0:V[0])==null?void 0:H.clientY);u({x:E-_.left,y:N-_.top})},j=f=>{if(!g)return;const _=a.current.getBoundingClientRect(),E=f.clientX||(f.touches?f.touches[0].clientX:0),N=f.clientY||(f.touches?f.touches[0].clientY:0),P=E-_.left,D=N-_.top,V=P-x.x,H=D-x.y;w(Y=>({x:Y.x+V,y:Y.y+H})),u({x:P,y:D})},O=()=>S(!1),U=()=>y(f=>(f+90)%360),z=async()=>{if(!(!a.current||h)){m(!0);try{const f=document.createElement("canvas");f.width=o,f.height=b;const _=f.getContext("2d"),E=(k-b)/2;_.drawImage(a.current,0,E,o,b,0,0,o,b);const N=await new Promise((V,H)=>{f.toBlob(Y=>Y?V(Y):H(new Error("blob_failed")),"image/jpeg",.92)}),P=new File([N],`cover_${Date.now()}.jpg`,{type:"image/jpeg"}),D=await ye.cover(P);l(D.url)}catch{}finally{m(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-1 relative flex items-center justify-center bg-gray-900 overflow-hidden",children:e.jsx("canvas",{ref:a,width:k,height:k,onMouseDown:R,onMouseMove:j,onMouseUp:O,onMouseLeave:O,onTouchStart:R,onTouchMove:j,onTouchEnd:O,onWheel:$,className:"cursor-move max-w-full max-h-full",style:{width:"100%",height:"auto",maxHeight:"520px"}})}),e.jsxs("div",{className:"p-4 bg-white flex items-center justify-between border-t border-gray-100 gap-4",children:[e.jsx("button",{onClick:U,className:"px-2 py-2 rounded-xl text-pink-600 hover:text-pink-700 text-xs font-bold hover:bg-pink-50",children:e.jsx(De,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 max-w-[240px]",children:[e.jsx(Be,{size:16,className:"text-gray-400"}),e.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:C,onChange:f=>T(parseFloat(f.target.value)),className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-pink-500"}),e.jsx(Ve,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 rounded-xl text-gray-500 font-bold text-sm hover:bg-gray-100",children:"取消"}),e.jsx("button",{onClick:z,disabled:h,className:`px-5 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 ${h?"opacity-60 cursor-not-allowed":"hover:opacity-90"}`,children:h?"上传中...":"完成"})]})]})]})}const ms=({initialData:t,onCancel:l,notify:i})=>{const[a,s]=n.useState({title:"",description:"",image:"",tags:[],author:"",likes:"",content:"",publishDate:""});n.useEffect(()=>{t&&s({title:t.title||"",description:t.description||"",image:t.image||"",tags:Array.isArray(t.tags)?t.tags:[],author:t.author||"",likes:t.likes||"",content:t.content||"",publishDate:t.publish_date||""})},[t]);const[c,h]=n.useState(""),[m,p]=n.useState(!1),y=()=>{const g=c.trim();g&&(s(S=>({...S,tags:S.tags.includes(g)?S.tags:[...S.tags,g]})),h(""))},v=g=>s(S=>({...S,tags:S.tags.filter(x=>x!==g)})),w=async()=>{if(!a.title.trim()||!a.content.trim()){i&&i("请输入标题与内容","error");return}const g={title:a.title.trim(),description:a.description||null,image:a.image||null,author:a.author||null,likes:a.likes||null,content:a.content,publish_date:a.publishDate||null,tags:a.tags};try{t!=null&&t.id?(await re.update(t.id,g),i&&i("保存成功：故事已更新")):(await re.create(g),i&&i("保存成功：故事已创建")),l&&l()}catch{i&&i("保存失败","error")}};return e.jsxs("div",{className:"animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:l,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(te,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:t?"编辑故事":"创建故事"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"填写并保存故事内容"})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("button",{onClick:w,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(ee,{size:16})," 保存"]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"标题"}),e.jsx("input",{value:a.title,onChange:g=>s({...a,title:g.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"描述"}),e.jsx("textarea",{value:a.description,onChange:g=>s({...a,description:g.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"封面图片"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{onClick:()=>p(!0),className:"w-full aspect-[2/1] bg-gray-100 rounded-2xl overflow-hidden border-4 border-white shadow-xl cursor-pointer",children:a.image?e.jsx("img",{src:a.image,alt:"cover",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300 font-bold",children:"点击上传并裁剪 (800×400)"})}),e.jsx("input",{value:a.image,onChange:g=>s({...a,image:g.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"或直接粘贴图片 URL"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"作者"}),e.jsx("input",{value:a.author,onChange:g=>s({...a,author:g.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"点赞数（文本）"}),e.jsx("input",{value:a.likes,onChange:g=>s({...a,likes:g.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"标签"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:c,onChange:g=>h(g.target.value),onKeyDown:g=>{g.key==="Enter"&&(g.preventDefault(),y())},className:"dream-input flex-1 px-4 py-3 rounded-xl text-sm",placeholder:"输入标签并回车"}),e.jsx("button",{onClick:y,className:"px-4 rounded-xl bg-pink-500 text-white text-sm font-bold",children:"添加"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.tags.map(g=>e.jsxs("button",{onClick:()=>v(g),className:"bg-pink-50 text-pink-600 px-3 py-1.5 rounded-xl text-xs font-bold border border-pink-100",children:["#",g," ×"]},g))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"正文"}),e.jsx("textarea",{value:a.content,onChange:g=>s({...a,content:g.target.value}),rows:"14",className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"发布时间（可选）"}),e.jsx("input",{type:"datetime-local",value:a.publishDate,onChange:g=>s({...a,publishDate:g.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm"})]})]})}),e.jsx("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:e.jsx("div",{className:"glass-card p-6 rounded-3xl text-sm text-gray-500",children:"在右侧填写故事信息并点击保存。"})})]}),m&&e.jsx(is,{initialImage:a.image||null,onSave:async g=>{s(S=>({...S,image:g})),p(!1)},onCancel:()=>p(!1)})]})},ps=()=>{const[t,l]=n.useState("list"),[i,a]=n.useState(null),{showToast:s}=Z(),[c,h]=n.useState([]),[m,p]=n.useState(null),y=async()=>{try{const x=await re.list();h(x.items||[])}catch{s("加载失败","error")}};n.useEffect(()=>{y()},[]);const v=()=>{a(null),l("create")},w=x=>{a(x),l("create")},g=async x=>{try{await re.remove(x),s("删除成功"),y()}catch{s("删除失败","error")}},S=async(x,u)=>{try{await re.setStatus(x,u==="published"?"draft":"published"),s(u==="published"?"已回收为草稿":"已发布"),y()}catch{s("操作失败","error")}};return t==="create"?e.jsx(ms,{initialData:i,onCancel:()=>{l("list"),y()},notify:s}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"})," 故事管理"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"查看与编辑故事内容"})]}),e.jsxs("button",{onClick:v,className:"bg-gradient-to-r from-pink-500 to-pink-600 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:opacity-90 transition-all flex items-center gap-2 text-sm",children:[e.jsx(X,{size:16})," 创建故事"]})]}),e.jsx("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(auto-fit, minmax(320px, 360px))"},children:c.map(x=>e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"glass-card p-4 rounded-3xl hover:shadow-xl transition-all group relative overflow-hidden h-[220px] flex flex-col",children:[e.jsx("div",{className:`absolute top-4 right-4 text-xs px-2 py-0.5 rounded-md font-bold ${x.status==="published"?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"}`,children:x.status==="published"?"已发布":"草稿"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-pink-200 to-pink-300 flex items-center justify-center text-white text-xl font-bold shadow-inner border-2 border-white overflow-hidden flex-shrink-0",children:x.image?e.jsx("img",{src:x.image,alt:"cover",className:"w-full h-full object-cover"}):e.jsx("span",{children:x.title?x.title[0]:"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 truncate",children:x.title}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:x.author||""})]}),e.jsx("div",{className:"flex gap-1 mt-2 flex-nowrap whitespace-nowrap overflow-hidden",style:{maxWidth:300},children:(x.tags||[]).map(u=>e.jsxs("span",{className:"text-[10px] bg-pink-50 text-pink-600 px-1.5 py-0.5 rounded border border-pink-100",children:["#",u]},u))})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed break-words",children:x.description||"暂无描述"})}),e.jsxs("div",{className:"mt-auto flex gap-2 pt-3 border-t border-white/50",children:[e.jsxs("button",{onClick:()=>w(x),className:"flex-1 py-2 text-xs font-bold text-pink-600 bg-pink-50 hover:bg-pink-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(xe,{size:12})," 编辑"]}),x.status==="published"?e.jsxs("button",{onClick:()=>S(x.id,x.status),className:"flex-1 py-2 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Fe,{size:12})," 回收"]}):e.jsxs("button",{onClick:()=>S(x.id,x.status),className:"flex-1 py-2 text-xs font-bold text-green-600 bg-green-50 hover:bg-green-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Oe,{size:12})," 发布"]})]})]}),e.jsx("button",{onClick:()=>p(x),className:"absolute -top-2 -right-2 z-10 w-8 h-8 rounded-full bg-white/60 backdrop-blur-md shadow-lg border border-pink-100 flex items-center justify-center text-gray-400 hover:text-red-500 transition",children:e.jsx(W,{size:12})})]},x.id))}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:()=>p(null)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除故事"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",m.title,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(null),className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:()=>{g(m.id),p(null)},className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]})]})},hs=()=>e.jsx(K,{children:e.jsx(ps,{})}),fs=()=>{const[t,l]=n.useState(!1),[i,a]=n.useState("templates"),[s,c]=n.useState(""),[h,m]=n.useState(!1),[p,y]=n.useState(""),[v,w]=n.useState(""),[g,S]=n.useState(""),x=async()=>{const d={};if(p&&p.trim()&&(d.nickname=p.trim()),v){if(v!==g)return;d.password=v}try{await q.updateMe(d),m(!1),y(""),w(""),S("")}catch{}},u=d=>{window.history&&window.history.replaceState&&window.history.replaceState(null,"",d)};return n.useEffect(()=>{const d=localStorage.getItem("admin_access_token"),A=localStorage.getItem("admin_username"),C=window.location.pathname;d?(l(!0),A&&c(A),a("templates"),C!=="/super-admin/sysprompt"&&u("/super-admin/sysprompt")):(l(!1),C!=="/super-admin/login"&&u("/super-admin/login"))},[]),t?e.jsxs("div",{className:"flex min-h-screen bg-white",children:[e.jsx(Te,{}),e.jsx(Ot,{activeTab:i,setActiveTab:d=>{a(d),d==="templates"&&u("/super-admin/sysprompt")},onLogout:()=>{l(!1),localStorage.removeItem("admin_access_token"),localStorage.removeItem("admin_refresh_token"),localStorage.removeItem("admin_username"),u("/super-admin/login")},username:s,onEditProfile:()=>m(!0)}),e.jsxs("main",{className:"flex-1 ml-16 xl:ml-56 p-8 relative z-10 transition-all duration-300 h-screen overflow-y-auto",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 pointer-events-none opacity-20",children:e.jsx(me,{size:120,className:"text-pink-300"})}),i==="templates"&&e.jsx(Dt,{}),i==="stories"&&e.jsx(hs,{}),(i==="characters"||i==="official_characters")&&e.jsx(Ie,{creatorRole:"admin_role"}),i==="user_characters"&&e.jsx(Ie,{creatorRole:"user_role"}),i==="users"&&e.jsx(Qt,{}),i==="model_settings"&&e.jsx(ts,{}),i==="model_manage"&&s==="admin"&&e.jsx(as,{}),i==="admin_accounts"&&s==="admin"&&e.jsx(ls,{})]}),e.jsx("div",{className:"ambient-bg"}),h&&e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-96 shadow-2xl",children:[e.jsx("div",{className:"font-bold mb-4 text-pink-900",children:"修改资料"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:`昵称（当前：${s}）`,value:p,onChange:d=>y(d.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"新密码",value:v,onChange:d=>w(d.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"再次输入新密码",value:g,onChange:d=>S(d.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-5",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{m(!1),y(""),w(""),S("")},children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:x,disabled:!p.trim()&&!v,children:"保存"})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx(K,{children:e.jsx(At,{onLogin:()=>{l(!0);const d=localStorage.getItem("admin_username");d&&c(d),a("templates"),u("/super-admin/sysprompt")}})})]})};export{fs as default};
//# sourceMappingURL=AdminDashboard-QiWalP8G.js.map
