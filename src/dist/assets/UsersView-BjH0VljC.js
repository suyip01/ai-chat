import{r as i,j as e}from"./index-DiMvcmcb.js";import{C as z}from"./circle-check-big-IblmQXOf.js";import{P as D}from"./pen-line-BpKLzpbM.js";import{T}from"./trash-2-CCl4-mF6.js";import{C as I}from"./chevron-left-B3HkbiML.js";import{P as k}from"./plus-Bz3dnY0B.js";import{T as $,u as V,d as j}from"./AdminDashboard-D62DCIkd.js";import{c as E}from"./createLucideIcon-CiU7U1is.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],A=E("search",_),M=({user:a,onSaveLimit:p,onDelete:h,onChangePwd:s})=>{const[l,c]=i.useState(a.chatLimit),d=l!==a.chatLimit,o=()=>{p(a.id,l)};return e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-5 pl-8",children:e.jsx("img",{src:a.avatar||"/uploads/avatars/default_avatar.jpg",alt:a.username,className:"w-10 h-10 rounded-full object-cover shadow-sm"})}),e.jsx("td",{className:"p-5 font-mono text-gray-500",children:a.id.toString().padStart(4,"0")}),e.jsxs("td",{className:"p-5",children:[e.jsx("div",{className:"font-bold text-gray-700",children:a.username}),e.jsx("div",{className:"text-xs text-gray-400",children:a.email})]}),e.jsx("td",{className:"p-5",children:e.jsx("div",{className:"text-xs text-gray-700",children:a.nickname||"-"})}),e.jsxs("td",{className:"p-5",children:[e.jsx("span",{className:"font-mono text-pink-600 font-bold",children:a.used})," 次"]}),e.jsx("td",{className:"p-5",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"number",value:l,onChange:x=>c(parseInt(x.target.value)||0),className:"dream-input w-24 px-4 py-2 rounded-2xl text-sm text-center",min:"0"})})}),e.jsx("td",{className:"p-5 text-right pr-8",children:e.jsxs("div",{className:"space-x-2",children:[e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:o,disabled:!d,className:`p-1 rounded ${d?"text-green-600 hover:text-green-700":"text-gray-300 cursor-not-allowed"}`,"aria-label":"保存设置",children:e.jsx(z,{size:16})}),e.jsx("span",{className:`absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap transition-opacity ${d?"opacity-0 group-hover:opacity-100":"hidden"}`,children:"保存设置"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:s,className:"p-1 rounded text-pink-400 hover:text-pink-600","aria-label":"修改密码",children:e.jsx(D,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"修改密码"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:h,className:"p-1 rounded text-red-400 hover:text-red-600","aria-label":"删除",children:e.jsx(T,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"删除"})]})]})})]})},R=({onCancel:a,onSave:p,notify:h})=>{const[s,l]=i.useState({username:"",nickname:"",email:"",password:"",chatLimit:0}),c=o=>{const{name:x,value:u}=o.target;l(g=>({...g,[x]:x==="chatLimit"?parseInt(u)||0:u}))},d=()=>{if(!s.username||!s.password){h&&h("创建失败：请填写用户名和密码","error");return}const o={username:s.username,nickname:s.nickname||null,email:s.email||`${s.username.toLowerCase()}@example.com`,password:s.password,chatLimit:s.chatLimit};p(o)};return e.jsxs("div",{className:"animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:a,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(I,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:"添加新用户"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"分配后台登录权限和聊天额度"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:a,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:d,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text白 font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(k,{size:16})," 创建用户"]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6 max-w-2xl mx-auto",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 用户基础信息"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"用户名"}),e.jsx("input",{type:"text",name:"username",value:s.username,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"为新用户设置一个用户名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"昵称"}),e.jsx("input",{type:"text",name:"nickname",value:s.nickname,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"显示名称（可选）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"邮箱"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"用于联系与通知（可选）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"密码 (初始密码)"}),e.jsx("input",{type:"password",name:"password",value:s.password,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"设置初始密码"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"聊天额度 (次数)"}),e.jsx("input",{type:"number",name:"chatLimit",value:s.chatLimit,onChange:c,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"0 表示默认无额度",min:"0"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"设置用户默认可用的聊天次数，0 次表示用户初始无额度。"})]})]})]})},B=()=>{const[a,p]=i.useState([]),[h,s]=i.useState("list"),[l,c]=i.useState(""),[d,o]=i.useState(null),[x,u]=i.useState(""),[g,f]=i.useState(""),[w,b]=i.useState(null),{showToast:n}=V();i.useEffect(()=>{j.list().then(p).catch(()=>{})},[]);const C=async t=>{try{const{id:m}=await j.create(t);p(r=>[...r,{...t,id:m,used:0}]),n(`用户 ${t.username} 创建成功`),s("list")}catch{n("创建失败","error")}},L=async(t,m)=>{try{await j.update(t,{chatLimit:m}),p(y=>y.map(N=>N.id===t?{...N,chatLimit:m}:N));const r=a.find(y=>y.id===t);n(`用户 ${(r==null?void 0:r.username)??t} 限额已更新`)}catch{n("保存失败","error")}},S=async t=>{try{await j.remove(t),p(m=>m.filter(r=>r.id!==t)),n("用户已删除")}catch{n("删除失败","error")}},P=w&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-80",children:[e.jsx("div",{className:"font-bold mb-3",children:"确认删除该用户？"}),e.jsx("p",{className:"text-sm text-gray-500 mb-5",children:"此操作不可恢复。"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>b(null),children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-red-500 text-white",onClick:()=>{const t=w.id;b(null),S(t)},children:"删除"})]})]})}),U=d&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-96",children:[e.jsxs("div",{className:"font-bold mb-3",children:["为用户 ",d.username," 修改密码"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"password",placeholder:"输入新密码",className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700",value:x,onChange:t=>u(t.target.value)}),e.jsx("input",{type:"password",placeholder:"再次输入新密码",className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700",value:g,onChange:t=>f(t.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-5",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{o(null),u(""),f("")},children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:async()=>{if(!x||x!==g){n("两次输入密码不一致","error");return}try{await j.changePassword(d.id,x),n("密码已更新")}catch{n("更新失败","error")}o(null),u(""),f("")},children:"确认修改"})]})]})}),v=a.filter(t=>{var m,r;return((m=t.username)==null?void 0:m.toLowerCase().includes(l.toLowerCase()))||(t.nickname?t.nickname.toLowerCase().includes(l.toLowerCase()):!1)||((r=t.email)==null?void 0:r.toLowerCase().includes(l.toLowerCase()))});return h==="create"?e.jsx(R,{onCancel:()=>s("list"),onSave:C,notify:n}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[P,U,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"})," 用户管理"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"监控用户使用情况与限额"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"搜索用户名/邮箱...",className:"dream-input pl-10 pr-4 py-2 rounded-xl text-sm w-64",value:l,onChange:t=>c(t.target.value)}),e.jsx(A,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-pink-300"})]}),e.jsxs("button",{onClick:()=>s("create"),className:"bg-pink-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(k,{size:16})," 添加用户"]})]})]}),e.jsx("div",{className:"glass-card rounded-3xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-pink-50/50 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-5 pl-8",children:"头像"}),e.jsx("th",{className:"p-5",children:"用户 ID"}),e.jsx("th",{className:"p-5",children:"用户名 / 邮箱"}),e.jsx("th",{className:"p-5",children:"昵称"}),e.jsx("th",{className:"p-5",children:"已用次数"}),e.jsx("th",{className:"p-5",children:"剩余额度"}),e.jsx("th",{className:"p-5 text-right pr-8",children:"操作"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-pink-50",children:v.length>0?v.map(t=>e.jsx(M,{user:t,onSaveLimit:L,onDelete:()=>b(t),onChangePwd:()=>o(t)},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-10 text-center text-gray-400",children:"未找到匹配的用户。"})})})]})})]})},W=()=>e.jsx($,{children:e.jsx(B,{})});export{W as default};
//# sourceMappingURL=UsersView-BjH0VljC.js.map
