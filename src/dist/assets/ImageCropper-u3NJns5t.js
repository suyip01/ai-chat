import{r as a,j as s}from"./index-DiMvcmcb.js";import{X as G}from"./x-CKT7hpuC.js";import{C as J}from"./check-CIfsadPx.js";import{c as K}from"./createLucideIcon-CiU7U1is.js";import{P as Q}from"./plus-Bz3dnY0B.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M5 12h14",key:"1ays0h"}]],ee=K("minus",V),ae=({imageSrc:_,onCrop:E,onCancel:X,aspectRatio:b,outputWidth:v,outputHeight:y})=>{const[p,H]=a.useState(1),[h,z]=a.useState({x:0,y:0}),[C,M]=a.useState(!1),[R,L]=a.useState({x:0,y:0}),l=a.useRef(new Map),x=a.useRef(null),[U,P]=a.useState(!1),I=a.useRef(null),f=a.useRef(null),S=a.useRef(null),j=a.useRef(null),m=b&&b>0?b:1,[k,Y]=a.useState(Math.round(300*m)),[g,B]=a.useState(300);a.useEffect(()=>{const e=()=>{const r=f.current?f.current.clientWidth:window.innerWidth,t=f.current?f.current.clientHeight:window.innerHeight;let o=Math.min(Math.floor(r*.9),700),n=Math.round(o/m);const c=Math.max(180,Math.min(t-160,380));n>c&&(n=c,o=Math.round(n*m)),Y(o),B(n)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[m]);const O=(e,r,t)=>Math.min(t,Math.max(r,e)),D=(e,r,t)=>{const o=p,n=O(t,.5,3),c=(e-h.x)/o,i=(r-h.y)/o;H(n),z({x:e-n*c,y:r-n*i})},T=e=>{const r=e.nativeEvent;if(r&&r.cancelable&&e.preventDefault(),l.current.set(e.pointerId,{x:e.clientX,y:e.clientY}),e.currentTarget.setPointerCapture(e.pointerId),l.current.size===1)M(!0),L({x:e.clientX-h.x,y:e.clientY-h.y});else if(l.current.size===2){P(!0);const t=Array.from(l.current.values()),o=t[0].x-t[1].x,n=t[0].y-t[1].y,c=Math.hypot(o,n);x.current={distance:c,zoom:p}}},W=e=>{var t,o,n,c;const r=e.nativeEvent;if(r&&r.cancelable&&e.preventDefault(),!!l.current.has(e.pointerId)){if(l.current.set(e.pointerId,{x:e.clientX,y:e.clientY}),l.current.size===2&&x.current){const i=Array.from(l.current.values()),d=i[0].x-i[1].x,u=i[0].y-i[1].y,A=Math.hypot(d,u)/x.current.distance,Z=x.current.zoom*A,w=((o=(t=j.current)==null?void 0:t.getBoundingClientRect)==null?void 0:o.call(t))||((c=(n=f.current)==null?void 0:n.getBoundingClientRect)==null?void 0:c.call(n))||{left:0,top:0,width:0,height:0},F=w.left+w.width/2,q=w.top+w.height/2;D(F,q,Z);return}C&&z({x:e.clientX-R.x,y:e.clientY-R.y})}},N=e=>{l.current.delete(e.pointerId);try{e.currentTarget.releasePointerCapture(e.pointerId)}catch{}l.current.size<2&&(x.current=null,P(!1)),l.current.size===0&&M(!1)},$=()=>{const e=S.current,r=I.current;if(!e||!r)return;const t=e.getContext("2d");if(!t)return;const o=v&&v>0?v:400,n=y&&y>0?y:Math.round(o/m);e.width=o,e.height=n;const c=r.naturalWidth,i=r.naturalHeight,d=Math.min(k/c,g/i),u=n/g;t.fillStyle="#000",t.fillRect(0,0,o,n),t.translate(o/2,n/2),t.translate(h.x*u,h.y*u),t.scale(p*u,p*u),t.scale(d,d),t.drawImage(r,-c/2,-i/2),E(e.toDataURL("image/jpeg",.9))};return s.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center animate-in fade-in duration-300",children:[s.jsxs("div",{className:"absolute top-0 w-full p-4 flex justify-between items-center z-20 text-white",children:[s.jsx("button",{onClick:X,className:"p-2 bg-white/10 rounded-full backdrop-blur-md",children:s.jsx(G,{size:24})}),s.jsx("h3",{className:"font-bold text-lg tracking-wider",children:"调整图片"}),s.jsx("button",{onClick:$,className:"p-2 bg-purple-500 rounded-full text-white shadow-lg shadow-purple-500/30",children:s.jsx(J,{size:24})})]}),s.jsxs("div",{ref:f,className:"relative w-full h-full overflow-hidden bg-black flex items-center justify-center touch-none select-none",onPointerDown:T,onPointerMove:W,onPointerUp:N,onPointerCancel:N,onPointerLeave:N,children:[s.jsx("img",{ref:I,src:_,alt:"Crop target",className:`absolute max-w-none pointer-events-none ${C||U?"will-change-transform":"transition-transform duration-75 ease-linear"}`,style:{transform:`translate(${h.x}px, ${h.y}px) scale(${p})`,height:g,width:"auto"},draggable:!1}),s.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 flex items-center justify-center",children:s.jsx("div",{ref:j,className:"absolute border-2 border-white box-content shadow-[0_0_0_9999px_rgba(0,0,0,0.8)]",style:{width:k,height:g},children:s.jsxs("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 opacity-30",children:[s.jsx("div",{className:"border-r border-white"}),s.jsx("div",{className:"border-r border-white"}),s.jsx("div",{className:"border-b border-white col-span-3 row-start-1"}),s.jsx("div",{className:"border-b border-white col-span-3 row-start-2"})]})})})]}),s.jsx("div",{className:"absolute bottom-0 w-full bg-slate-900/80 backdrop-blur-md p-6 pb-10 flex flex-col gap-4 z-20",children:s.jsxs("div",{className:"flex items-center gap-4 text-white justify-center",children:[s.jsx(ee,{size:20,className:"text-slate-400"}),s.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.05",value:p,onChange:e=>{var c,i,d,u;const r=parseFloat(e.target.value),t=((i=(c=j.current)==null?void 0:c.getBoundingClientRect)==null?void 0:i.call(c))||((u=(d=f.current)==null?void 0:d.getBoundingClientRect)==null?void 0:u.call(d))||{left:0,top:0,width:0,height:0},o=t.left+t.width/2,n=t.top+t.height/2;D(o,n,r)},className:"w-64 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-purple-500"}),s.jsx(Q,{size:20,className:"text-slate-400"})]})}),s.jsx("canvas",{ref:S,className:"hidden"})]})};export{ae as I};
//# sourceMappingURL=ImageCropper-u3NJns5t.js.map
