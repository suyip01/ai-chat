const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/http-Dwii6HrH.js","assets/index-C1XDOG98.js","assets/index-Xa0po1AH.css","assets/x-CPFcBspV.js"])))=>i.map(i=>d[i]);
import{r as h,j as n,_ as ye,R as ao}from"./index-C1XDOG98.js";import{c as Oe,P as ht,U as cn,X as jt,b as bs,e as oo,d as lo,T as dn,A as ws,S as br,a as js,C as Kt,I as wr,f as Hs,L as Jn,g as co}from"./x-CPFcBspV.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],un=Oe("camera",uo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ho=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],jr=Oe("check",ho);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],hn=Oe("chevron-up",fo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],po=Oe("ellipsis-vertical",mo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],go=Oe("eye-off",xo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],vo=Oe("eye",yo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],wo=Oe("globe",bo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Nr=Oe("heart",jo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],So=Oe("house",No);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ko=Oe("lock",To);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],_o=Oe("mail",Co);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],fn=Oe("message-circle",Ao);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Eo=Oe("message-square",Po);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=[["path",{d:"M5 12h14",key:"1ays0h"}]],Mo=Oe("minus",Io);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Do=Oe("pen-tool",Ro);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ws=Oe("pen",Lo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vo=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],Fo=Oe("pin",Vo),mn=()=>typeof window<"u"&&typeof window.clarity=="function",tt=e=>{try{try{console.log("[analytics] identifyUser",String(e.userId??""),(e==null?void 0:e.name)??null)}catch{}if(!mn())return;const t=e.userId!==void 0&&e.userId!==null?String(e.userId):"",s=e.sessionId??null,i=e.pageId??null,r=e.name??null;window.clarity("identify",t,s,i,r)}catch{}},_e=(e,t)=>{try{if(!mn())return;window.clarity("set",e,t)}catch{}},Ze=(e,t)=>{try{if(!mn())return;window.clarity("event",e),t&&Object.entries(t).forEach(([s,i])=>{try{window.clarity("set",s,i)}catch{}})}catch{}},pn=h.createContext({});function xn(e){const t=h.useRef(null);return t.current===null&&(t.current=e()),t.current}const Ns=h.createContext(null),gn=h.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Oo extends h.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=s.offsetHeight||0,i.width=s.offsetWidth||0,i.top=s.offsetTop,i.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function $o({children:e,isPresent:t}){const s=h.useId(),i=h.useRef(null),r=h.useRef({width:0,height:0,top:0,left:0}),{nonce:l}=h.useContext(gn);return h.useInsertionEffect(()=>{const{width:o,height:a,top:c,left:d}=r.current;if(t||!i.current||!o||!a)return;i.current.dataset.motionPopId=s;const u=document.createElement("style");return l&&(u.nonce=l),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${a}px !important;
            top: ${c}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[t]),n.jsx(Oo,{isPresent:t,childRef:i,sizeRef:r,children:h.cloneElement(e,{ref:i})})}const zo=({children:e,initial:t,isPresent:s,onExitComplete:i,custom:r,presenceAffectsLayout:l,mode:o})=>{const a=xn(Bo),c=h.useId(),d=h.useCallback(f=>{a.set(f,!0);for(const m of a.values())if(!m)return;i&&i()},[a,i]),u=h.useMemo(()=>({id:c,initial:t,isPresent:s,custom:r,onExitComplete:d,register:f=>(a.set(f,!1),()=>a.delete(f))}),l?[Math.random(),d]:[s,d]);return h.useMemo(()=>{a.forEach((f,m)=>a.set(m,!1))},[s]),h.useEffect(()=>{!s&&!a.size&&i&&i()},[s]),o==="popLayout"&&(e=n.jsx($o,{isPresent:s,children:e})),n.jsx(Ns.Provider,{value:u,children:e})};function Bo(){return new Map}function Sr(e=!0){const t=h.useContext(Ns);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:i,register:r}=t,l=h.useId();h.useEffect(()=>{e&&r(l)},[e]);const o=h.useCallback(()=>e&&i&&i(l),[l,i,e]);return!s&&i?[!1,o]:[!0]}const ss=e=>e.key||"";function Zn(e){const t=[];return h.Children.forEach(e,s=>{h.isValidElement(s)&&t.push(s)}),t}const yn=typeof window<"u",Tr=yn?h.useLayoutEffect:h.useEffect,zt=({children:e,custom:t,initial:s=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:l="sync",propagate:o=!1})=>{const[a,c]=Sr(o),d=h.useMemo(()=>Zn(e),[e]),u=o&&!a?[]:d.map(ss),f=h.useRef(!0),m=h.useRef(d),y=xn(()=>new Map),[_,N]=h.useState(d),[E,b]=h.useState(d);Tr(()=>{f.current=!1,m.current=d;for(let $=0;$<E.length;$++){const S=ss(E[$]);u.includes(S)?y.delete(S):y.get(S)!==!0&&y.set(S,!1)}},[E,u.length,u.join("-")]);const k=[];if(d!==_){let $=[...d];for(let S=0;S<E.length;S++){const A=E[S],V=ss(A);u.includes(V)||($.splice(S,0,A),k.push(A))}l==="wait"&&k.length&&($=k),b(Zn($)),N(d);return}const{forceRender:T}=h.useContext(pn);return n.jsx(n.Fragment,{children:E.map($=>{const S=ss($),A=o&&!a?!1:d===E||u.includes(S),V=()=>{if(y.has(S))y.set(S,!0);else return;let R=!0;y.forEach(G=>{G||(R=!1)}),R&&(T==null||T(),b(m.current),o&&(c==null||c()),i&&i())};return n.jsx(zo,{isPresent:A,initial:!f.current||s?void 0:!1,custom:A?void 0:t,presenceAffectsLayout:r,mode:l,onExitComplete:A?void 0:V,children:$},S)})})},Ke=e=>e;let kr=Ke;function vn(e){let t;return()=>(t===void 0&&(t=e()),t)}const Et=(e,t,s)=>{const i=t-e;return i===0?1:(s-e)/i},ot=e=>e*1e3,lt=e=>e/1e3,Uo={useManualTiming:!1};function Ho(e){let t=new Set,s=new Set,i=!1,r=!1;const l=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(d){l.has(d)&&(c.schedule(d),e()),d(o)}const c={schedule:(d,u=!1,f=!1)=>{const y=f&&i?t:s;return u&&l.add(d),y.has(d)||y.add(d),d},cancel:d=>{s.delete(d),l.delete(d)},process:d=>{if(o=d,i){r=!0;return}i=!0,[t,s]=[s,t],t.forEach(a),t.clear(),i=!1,r&&(r=!1,c.process(d))}};return c}const ns=["read","resolveKeyframes","update","preRender","render","postRender"],Wo=40;function Cr(e,t){let s=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},l=()=>s=!0,o=ns.reduce((b,k)=>(b[k]=Ho(l),b),{}),{read:a,resolveKeyframes:c,update:d,preRender:u,render:f,postRender:m}=o,y=()=>{const b=performance.now();s=!1,r.delta=i?1e3/60:Math.max(Math.min(b-r.timestamp,Wo),1),r.timestamp=b,r.isProcessing=!0,a.process(r),c.process(r),d.process(r),u.process(r),f.process(r),m.process(r),r.isProcessing=!1,s&&t&&(i=!1,e(y))},_=()=>{s=!0,i=!0,r.isProcessing||e(y)};return{schedule:ns.reduce((b,k)=>{const T=o[k];return b[k]=($,S=!1,A=!1)=>(s||_(),T.schedule($,S,A)),b},{}),cancel:b=>{for(let k=0;k<ns.length;k++)o[ns[k]].cancel(b)},state:r,steps:o}}const{schedule:Se,cancel:ft,state:Fe,steps:Ps}=Cr(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ke,!0),_r=h.createContext({strict:!1}),Qn={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},It={};for(const e in Qn)It[e]={isEnabled:t=>Qn[e].some(s=>!!t[s])};function Ko(e){for(const t in e)It[t]={...It[t],...e[t]}}const Yo=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function hs(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Yo.has(e)}let Ar=e=>!hs(e);function Xo(e){e&&(Ar=t=>t.startsWith("on")?!hs(t):e(t))}try{Xo(require("@emotion/is-prop-valid").default)}catch{}function Go(e,t,s){const i={};for(const r in e)r==="values"&&typeof e.values=="object"||(Ar(r)||s===!0&&hs(r)||!t&&!hs(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}function qo(e){if(typeof Proxy>"u")return e;const t=new Map,s=(...i)=>e(...i);return new Proxy(s,{get:(i,r)=>r==="create"?e:(t.has(r)||t.set(r,e(r)),t.get(r))})}const Ss=h.createContext({});function Yt(e){return typeof e=="string"||Array.isArray(e)}function Ts(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const bn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],wn=["initial",...bn];function ks(e){return Ts(e.animate)||wn.some(t=>Yt(e[t]))}function Pr(e){return!!(ks(e)||e.variants)}function Jo(e,t){if(ks(e)){const{initial:s,animate:i}=e;return{initial:s===!1||Yt(s)?s:void 0,animate:Yt(i)?i:void 0}}return e.inherit!==!1?t:{}}function Zo(e){const{initial:t,animate:s}=Jo(e,h.useContext(Ss));return h.useMemo(()=>({initial:t,animate:s}),[ei(t),ei(s)])}function ei(e){return Array.isArray(e)?e.join(" "):e}const Qo=Symbol.for("motionComponentSymbol");function Tt(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function el(e,t,s){return h.useCallback(i=>{i&&e.onMount&&e.onMount(i),t&&(i?t.mount(i):t.unmount()),s&&(typeof s=="function"?s(i):Tt(s)&&(s.current=i))},[t])}const jn=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),tl="framerAppearId",Er="data-"+jn(tl),{schedule:Nn}=Cr(queueMicrotask,!1),Ir=h.createContext({});function sl(e,t,s,i,r){var l,o;const{visualElement:a}=h.useContext(Ss),c=h.useContext(_r),d=h.useContext(Ns),u=h.useContext(gn).reducedMotion,f=h.useRef(null);i=i||c.renderer,!f.current&&i&&(f.current=i(e,{visualState:t,parent:a,props:s,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:u}));const m=f.current,y=h.useContext(Ir);m&&!m.projection&&r&&(m.type==="html"||m.type==="svg")&&nl(f.current,s,r,y);const _=h.useRef(!1);h.useInsertionEffect(()=>{m&&_.current&&m.update(s,d)});const N=s[Er],E=h.useRef(!!N&&!(!((l=window.MotionHandoffIsComplete)===null||l===void 0)&&l.call(window,N))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,N)));return Tr(()=>{m&&(_.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),Nn.render(m.render),E.current&&m.animationState&&m.animationState.animateChanges())}),h.useEffect(()=>{m&&(!E.current&&m.animationState&&m.animationState.animateChanges(),E.current&&(queueMicrotask(()=>{var b;(b=window.MotionHandoffMarkAsComplete)===null||b===void 0||b.call(window,N)}),E.current=!1))}),m}function nl(e,t,s,i){const{layoutId:r,layout:l,drag:o,dragConstraints:a,layoutScroll:c,layoutRoot:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:Mr(e.parent)),e.projection.setOptions({layoutId:r,layout:l,alwaysMeasureLayout:!!o||a&&Tt(a),visualElement:e,animationType:typeof l=="string"?l:"both",initialPromotionConfig:i,layoutScroll:c,layoutRoot:d})}function Mr(e){if(e)return e.options.allowProjection!==!1?e.projection:Mr(e.parent)}function il({preloadedFeatures:e,createVisualElement:t,useRender:s,useVisualState:i,Component:r}){var l,o;e&&Ko(e);function a(d,u){let f;const m={...h.useContext(gn),...d,layoutId:rl(d)},{isStatic:y}=m,_=Zo(d),N=i(d,y);if(!y&&yn){al();const E=ol(m);f=E.MeasureLayout,_.visualElement=sl(r,N,m,t,E.ProjectionNode)}return n.jsxs(Ss.Provider,{value:_,children:[f&&_.visualElement?n.jsx(f,{visualElement:_.visualElement,...m}):null,s(r,d,el(N,_.visualElement,u),N,y,_.visualElement)]})}a.displayName=`motion.${typeof r=="string"?r:`create(${(o=(l=r.displayName)!==null&&l!==void 0?l:r.name)!==null&&o!==void 0?o:""})`}`;const c=h.forwardRef(a);return c[Qo]=r,c}function rl({layoutId:e}){const t=h.useContext(pn).id;return t&&e!==void 0?t+"-"+e:e}function al(e,t){h.useContext(_r).strict}function ol(e){const{drag:t,layout:s}=It;if(!t&&!s)return{};const i={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(e)||s!=null&&s.isEnabled(e)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const ll=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Sn(e){return typeof e!="string"||e.includes("-")?!1:!!(ll.indexOf(e)>-1||/[A-Z]/u.test(e))}function ti(e){const t=[{},{}];return e==null||e.values.forEach((s,i)=>{t[0][i]=s.get(),t[1][i]=s.getVelocity()}),t}function Tn(e,t,s,i){if(typeof t=="function"){const[r,l]=ti(i);t=t(s!==void 0?s:e.custom,r,l)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[r,l]=ti(i);t=t(s!==void 0?s:e.custom,r,l)}return t}const Ks=e=>Array.isArray(e),cl=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),dl=e=>Ks(e)?e[e.length-1]||0:e,ze=e=>!!(e&&e.getVelocity);function ls(e){const t=ze(e)?e.get():e;return cl(t)?t.toValue():t}function ul({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:s},i,r,l){const o={latestValues:hl(i,r,l,e),renderState:t()};return s&&(o.onMount=a=>s({props:i,current:a,...o}),o.onUpdate=a=>s(a)),o}const Rr=e=>(t,s)=>{const i=h.useContext(Ss),r=h.useContext(Ns),l=()=>ul(e,t,i,r);return s?l():xn(l)};function hl(e,t,s,i){const r={},l=i(e,{});for(const m in l)r[m]=ls(l[m]);let{initial:o,animate:a}=e;const c=ks(e),d=Pr(e);t&&d&&!c&&e.inherit!==!1&&(o===void 0&&(o=t.initial),a===void 0&&(a=t.animate));let u=s?s.initial===!1:!1;u=u||o===!1;const f=u?a:o;if(f&&typeof f!="boolean"&&!Ts(f)){const m=Array.isArray(f)?f:[f];for(let y=0;y<m.length;y++){const _=Tn(e,m[y]);if(_){const{transitionEnd:N,transition:E,...b}=_;for(const k in b){let T=b[k];if(Array.isArray(T)){const $=u?T.length-1:0;T=T[$]}T!==null&&(r[k]=T)}for(const k in N)r[k]=N[k]}}}return r}const Rt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],St=new Set(Rt),Dr=e=>t=>typeof t=="string"&&t.startsWith(e),Lr=Dr("--"),fl=Dr("var(--"),kn=e=>fl(e)?ml.test(e.split("/*")[0].trim()):!1,ml=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Vr=(e,t)=>t&&typeof e=="number"?t.transform(e):e,ct=(e,t,s)=>s>t?t:s<e?e:s,Dt={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Xt={...Dt,transform:e=>ct(0,1,e)},is={...Dt,default:1},Zt=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),ut=Zt("deg"),st=Zt("%"),Z=Zt("px"),pl=Zt("vh"),xl=Zt("vw"),si={...st,parse:e=>st.parse(e)/100,transform:e=>st.transform(e*100)},gl={borderWidth:Z,borderTopWidth:Z,borderRightWidth:Z,borderBottomWidth:Z,borderLeftWidth:Z,borderRadius:Z,radius:Z,borderTopLeftRadius:Z,borderTopRightRadius:Z,borderBottomRightRadius:Z,borderBottomLeftRadius:Z,width:Z,maxWidth:Z,height:Z,maxHeight:Z,top:Z,right:Z,bottom:Z,left:Z,padding:Z,paddingTop:Z,paddingRight:Z,paddingBottom:Z,paddingLeft:Z,margin:Z,marginTop:Z,marginRight:Z,marginBottom:Z,marginLeft:Z,backgroundPositionX:Z,backgroundPositionY:Z},yl={rotate:ut,rotateX:ut,rotateY:ut,rotateZ:ut,scale:is,scaleX:is,scaleY:is,scaleZ:is,skew:ut,skewX:ut,skewY:ut,distance:Z,translateX:Z,translateY:Z,translateZ:Z,x:Z,y:Z,z:Z,perspective:Z,transformPerspective:Z,opacity:Xt,originX:si,originY:si,originZ:Z},ni={...Dt,transform:Math.round},Cn={...gl,...yl,zIndex:ni,size:Z,fillOpacity:Xt,strokeOpacity:Xt,numOctaves:ni},vl={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},bl=Rt.length;function wl(e,t,s){let i="",r=!0;for(let l=0;l<bl;l++){const o=Rt[l],a=e[o];if(a===void 0)continue;let c=!0;if(typeof a=="number"?c=a===(o.startsWith("scale")?1:0):c=parseFloat(a)===0,!c||s){const d=Vr(a,Cn[o]);if(!c){r=!1;const u=vl[o]||o;i+=`${u}(${d}) `}s&&(t[o]=d)}}return i=i.trim(),s?i=s(t,r?"":i):r&&(i="none"),i}function _n(e,t,s){const{style:i,vars:r,transformOrigin:l}=e;let o=!1,a=!1;for(const c in t){const d=t[c];if(St.has(c)){o=!0;continue}else if(Lr(c)){r[c]=d;continue}else{const u=Vr(d,Cn[c]);c.startsWith("origin")?(a=!0,l[c]=u):i[c]=u}}if(t.transform||(o||s?i.transform=wl(t,e.transform,s):i.transform&&(i.transform="none")),a){const{originX:c="50%",originY:d="50%",originZ:u=0}=l;i.transformOrigin=`${c} ${d} ${u}`}}const jl={offset:"stroke-dashoffset",array:"stroke-dasharray"},Nl={offset:"strokeDashoffset",array:"strokeDasharray"};function Sl(e,t,s=1,i=0,r=!0){e.pathLength=1;const l=r?jl:Nl;e[l.offset]=Z.transform(-i);const o=Z.transform(t),a=Z.transform(s);e[l.array]=`${o} ${a}`}function ii(e,t,s){return typeof e=="string"?e:Z.transform(t+s*e)}function Tl(e,t,s){const i=ii(t,e.x,e.width),r=ii(s,e.y,e.height);return`${i} ${r}`}function An(e,{attrX:t,attrY:s,attrScale:i,originX:r,originY:l,pathLength:o,pathSpacing:a=1,pathOffset:c=0,...d},u,f){if(_n(e,d,f),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:m,style:y,dimensions:_}=e;m.transform&&(_&&(y.transform=m.transform),delete m.transform),_&&(r!==void 0||l!==void 0||y.transform)&&(y.transformOrigin=Tl(_,r!==void 0?r:.5,l!==void 0?l:.5)),t!==void 0&&(m.x=t),s!==void 0&&(m.y=s),i!==void 0&&(m.scale=i),o!==void 0&&Sl(m,o,a,c,!1)}const Pn=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Fr=()=>({...Pn(),attrs:{}}),En=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Or(e,{style:t,vars:s},i,r){Object.assign(e.style,t,r&&r.getProjectionStyles(i));for(const l in s)e.style.setProperty(l,s[l])}const $r=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function zr(e,t,s,i){Or(e,t,void 0,i);for(const r in t.attrs)e.setAttribute($r.has(r)?r:jn(r),t.attrs[r])}const fs={};function kl(e){Object.assign(fs,e)}function Br(e,{layout:t,layoutId:s}){return St.has(e)||e.startsWith("origin")||(t||s!==void 0)&&(!!fs[e]||e==="opacity")}function In(e,t,s){var i;const{style:r}=e,l={};for(const o in r)(ze(r[o])||t.style&&ze(t.style[o])||Br(o,e)||((i=s==null?void 0:s.getValue(o))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(l[o]=r[o]);return l}function Ur(e,t,s){const i=In(e,t,s);for(const r in e)if(ze(e[r])||ze(t[r])){const l=Rt.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[l]=e[r]}return i}function Cl(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const ri=["x","y","width","height","cx","cy","r"],_l={useVisualState:Rr({scrapeMotionValuesFromProps:Ur,createRenderState:Fr,onUpdate:({props:e,prevProps:t,current:s,renderState:i,latestValues:r})=>{if(!s)return;let l=!!e.drag;if(!l){for(const a in r)if(St.has(a)){l=!0;break}}if(!l)return;let o=!t;if(t)for(let a=0;a<ri.length;a++){const c=ri[a];e[c]!==t[c]&&(o=!0)}o&&Se.read(()=>{Cl(s,i),Se.render(()=>{An(i,r,En(s.tagName),e.transformTemplate),zr(s,i)})})}})},Al={useVisualState:Rr({scrapeMotionValuesFromProps:In,createRenderState:Pn})};function Hr(e,t,s){for(const i in t)!ze(t[i])&&!Br(i,s)&&(e[i]=t[i])}function Pl({transformTemplate:e},t){return h.useMemo(()=>{const s=Pn();return _n(s,t,e),Object.assign({},s.vars,s.style)},[t])}function El(e,t){const s=e.style||{},i={};return Hr(i,s,e),Object.assign(i,Pl(e,t)),i}function Il(e,t){const s={},i=El(e,t);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=i,s}function Ml(e,t,s,i){const r=h.useMemo(()=>{const l=Fr();return An(l,t,En(i),e.transformTemplate),{...l.attrs,style:{...l.style}}},[t]);if(e.style){const l={};Hr(l,e.style,e),r.style={...l,...r.style}}return r}function Rl(e=!1){return(s,i,r,{latestValues:l},o)=>{const c=(Sn(s)?Ml:Il)(i,l,o,s),d=Go(i,typeof s=="string",e),u=s!==h.Fragment?{...d,...c,ref:r}:{},{children:f}=i,m=h.useMemo(()=>ze(f)?f.get():f,[f]);return h.createElement(s,{...u,children:m})}}function Dl(e,t){return function(i,{forwardMotionProps:r}={forwardMotionProps:!1}){const o={...Sn(i)?_l:Al,preloadedFeatures:e,useRender:Rl(r),createVisualElement:t,Component:i};return il(o)}}function Wr(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}function Cs(e,t,s){const i=e.getProps();return Tn(i,t,s!==void 0?s:i.custom,e)}const Ll=vn(()=>window.ScrollTimeline!==void 0);class Vl{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let i=0;i<this.animations.length;i++)this.animations[i][t]=s}attachTimeline(t,s){const i=this.animations.map(r=>{if(Ll()&&r.attachTimeline)return r.attachTimeline(t);if(typeof s=="function")return s(r)});return()=>{i.forEach((r,l)=>{r&&r(),this.animations[l].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Fl extends Vl{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function Mn(e,t){return e?e[t]||e.default||e:void 0}const Ys=2e4;function Kr(e){let t=0;const s=50;let i=e.next(t);for(;!i.done&&t<Ys;)t+=s,i=e.next(t);return t>=Ys?1/0:t}function Rn(e){return typeof e=="function"}function ai(e,t){e.timeline=t,e.onfinish=null}const Dn=e=>Array.isArray(e)&&typeof e[0]=="number",Ol={linearEasing:void 0};function $l(e,t){const s=vn(e);return()=>{var i;return(i=Ol[t])!==null&&i!==void 0?i:s()}}const ms=$l(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Yr=(e,t,s=10)=>{let i="";const r=Math.max(Math.round(t/s),2);for(let l=0;l<r;l++)i+=e(Et(0,r-1,l))+", ";return`linear(${i.substring(0,i.length-2)})`};function Xr(e){return!!(typeof e=="function"&&ms()||!e||typeof e=="string"&&(e in Xs||ms())||Dn(e)||Array.isArray(e)&&e.every(Xr))}const Ft=([e,t,s,i])=>`cubic-bezier(${e}, ${t}, ${s}, ${i})`,Xs={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ft([0,.65,.55,1]),circOut:Ft([.55,0,1,.45]),backIn:Ft([.31,.01,.66,-.59]),backOut:Ft([.33,1.53,.69,.99])};function Gr(e,t){if(e)return typeof e=="function"&&ms()?Yr(e,t):Dn(e)?Ft(e):Array.isArray(e)?e.map(s=>Gr(s,t)||Xs.easeOut):Xs[e]}const Je={x:!1,y:!1};function qr(){return Je.x||Je.y}function zl(e,t,s){var i;if(e instanceof Element)return[e];if(typeof e=="string"){let r=document;const l=(i=void 0)!==null&&i!==void 0?i:r.querySelectorAll(e);return l?Array.from(l):[]}return Array.from(e)}function Jr(e,t){const s=zl(e),i=new AbortController,r={passive:!0,...t,signal:i.signal};return[s,r,()=>i.abort()]}function oi(e){return t=>{t.pointerType==="touch"||qr()||e(t)}}function Bl(e,t,s={}){const[i,r,l]=Jr(e,s),o=oi(a=>{const{target:c}=a,d=t(a);if(typeof d!="function"||!c)return;const u=oi(f=>{d(f),c.removeEventListener("pointerleave",u)});c.addEventListener("pointerleave",u,r)});return i.forEach(a=>{a.addEventListener("pointerenter",o,r)}),l}const Zr=(e,t)=>t?e===t?!0:Zr(e,t.parentElement):!1,Ln=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Ul=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Hl(e){return Ul.has(e.tagName)||e.tabIndex!==-1}const Ot=new WeakSet;function li(e){return t=>{t.key==="Enter"&&e(t)}}function Es(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Wl=(e,t)=>{const s=e.currentTarget;if(!s)return;const i=li(()=>{if(Ot.has(s))return;Es(s,"down");const r=li(()=>{Es(s,"up")}),l=()=>Es(s,"cancel");s.addEventListener("keyup",r,t),s.addEventListener("blur",l,t)});s.addEventListener("keydown",i,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",i),t)};function ci(e){return Ln(e)&&!qr()}function Kl(e,t,s={}){const[i,r,l]=Jr(e,s),o=a=>{const c=a.currentTarget;if(!ci(a)||Ot.has(c))return;Ot.add(c);const d=t(a),u=(y,_)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",m),!(!ci(y)||!Ot.has(c))&&(Ot.delete(c),typeof d=="function"&&d(y,{success:_}))},f=y=>{u(y,s.useGlobalTarget||Zr(c,y.target))},m=y=>{u(y,!1)};window.addEventListener("pointerup",f,r),window.addEventListener("pointercancel",m,r)};return i.forEach(a=>{!Hl(a)&&a.getAttribute("tabindex")===null&&(a.tabIndex=0),(s.useGlobalTarget?window:a).addEventListener("pointerdown",o,r),a.addEventListener("focus",d=>Wl(d,r),r)}),l}function Yl(e){return e==="x"||e==="y"?Je[e]?null:(Je[e]=!0,()=>{Je[e]=!1}):Je.x||Je.y?null:(Je.x=Je.y=!0,()=>{Je.x=Je.y=!1})}const Qr=new Set(["width","height","top","left","right","bottom",...Rt]);let cs;function Xl(){cs=void 0}const nt={now:()=>(cs===void 0&&nt.set(Fe.isProcessing||Uo.useManualTiming?Fe.timestamp:performance.now()),cs),set:e=>{cs=e,queueMicrotask(Xl)}};function Vn(e,t){e.indexOf(t)===-1&&e.push(t)}function Fn(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class On{constructor(){this.subscriptions=[]}add(t){return Vn(this.subscriptions,t),()=>Fn(this.subscriptions,t)}notify(t,s,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](t,s,i);else for(let l=0;l<r;l++){const o=this.subscriptions[l];o&&o(t,s,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function ea(e,t){return t?e*(1e3/t):0}const di=30,Gl=e=>!isNaN(parseFloat(e));class ql{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,r=!0)=>{const l=nt.now();this.updatedAt!==l&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=nt.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=Gl(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new On);const i=this.events[t].add(s);return t==="change"?()=>{i(),Se.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,i){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-i}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=nt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>di)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,di);return ea(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Gt(e,t){return new ql(e,t)}function Jl(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,Gt(s))}function Zl(e,t){const s=Cs(e,t);let{transitionEnd:i={},transition:r={},...l}=s||{};l={...l,...i};for(const o in l){const a=dl(l[o]);Jl(e,o,a)}}function Ql(e){return!!(ze(e)&&e.add)}function Gs(e,t){const s=e.getValue("willChange");if(Ql(s))return s.add(t)}function ta(e){return e.props[Er]}const sa=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e,ec=1e-7,tc=12;function sc(e,t,s,i,r){let l,o,a=0;do o=t+(s-t)/2,l=sa(o,i,r)-e,l>0?s=o:t=o;while(Math.abs(l)>ec&&++a<tc);return o}function Qt(e,t,s,i){if(e===t&&s===i)return Ke;const r=l=>sc(l,0,1,e,s);return l=>l===0||l===1?l:sa(r(l),t,i)}const na=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,ia=e=>t=>1-e(1-t),ra=Qt(.33,1.53,.69,.99),$n=ia(ra),aa=na($n),oa=e=>(e*=2)<1?.5*$n(e):.5*(2-Math.pow(2,-10*(e-1))),zn=e=>1-Math.sin(Math.acos(e)),la=ia(zn),ca=na(zn),da=e=>/^0[^.\s]+$/u.test(e);function nc(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||da(e):!0}const Bt=e=>Math.round(e*1e5)/1e5,Bn=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ic(e){return e==null}const rc=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Un=(e,t)=>s=>!!(typeof s=="string"&&rc.test(s)&&s.startsWith(e)||t&&!ic(s)&&Object.prototype.hasOwnProperty.call(s,t)),ua=(e,t,s)=>i=>{if(typeof i!="string")return i;const[r,l,o,a]=i.match(Bn);return{[e]:parseFloat(r),[t]:parseFloat(l),[s]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},ac=e=>ct(0,255,e),Is={...Dt,transform:e=>Math.round(ac(e))},wt={test:Un("rgb","red"),parse:ua("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:i=1})=>"rgba("+Is.transform(e)+", "+Is.transform(t)+", "+Is.transform(s)+", "+Bt(Xt.transform(i))+")"};function oc(e){let t="",s="",i="",r="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,s+=s,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const qs={test:Un("#"),parse:oc,transform:wt.transform},kt={test:Un("hsl","hue"),parse:ua("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:i=1})=>"hsla("+Math.round(e)+", "+st.transform(Bt(t))+", "+st.transform(Bt(s))+", "+Bt(Xt.transform(i))+")"},$e={test:e=>wt.test(e)||qs.test(e)||kt.test(e),parse:e=>wt.test(e)?wt.parse(e):kt.test(e)?kt.parse(e):qs.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?wt.transform(e):kt.transform(e)},lc=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function cc(e){var t,s;return isNaN(e)&&typeof e=="string"&&(((t=e.match(Bn))===null||t===void 0?void 0:t.length)||0)+(((s=e.match(lc))===null||s===void 0?void 0:s.length)||0)>0}const ha="number",fa="color",dc="var",uc="var(",ui="${}",hc=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function qt(e){const t=e.toString(),s=[],i={color:[],number:[],var:[]},r=[];let l=0;const a=t.replace(hc,c=>($e.test(c)?(i.color.push(l),r.push(fa),s.push($e.parse(c))):c.startsWith(uc)?(i.var.push(l),r.push(dc),s.push(c)):(i.number.push(l),r.push(ha),s.push(parseFloat(c))),++l,ui)).split(ui);return{values:s,split:a,indexes:i,types:r}}function ma(e){return qt(e).values}function pa(e){const{split:t,types:s}=qt(e),i=t.length;return r=>{let l="";for(let o=0;o<i;o++)if(l+=t[o],r[o]!==void 0){const a=s[o];a===ha?l+=Bt(r[o]):a===fa?l+=$e.transform(r[o]):l+=r[o]}return l}}const fc=e=>typeof e=="number"?0:e;function mc(e){const t=ma(e);return pa(e)(t.map(fc))}const mt={test:cc,parse:ma,createTransformer:pa,getAnimatableNone:mc},pc=new Set(["brightness","contrast","saturate","opacity"]);function xc(e){const[t,s]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[i]=s.match(Bn)||[];if(!i)return e;const r=s.replace(i,"");let l=pc.has(t)?1:0;return i!==s&&(l*=100),t+"("+l+r+")"}const gc=/\b([a-z-]*)\(.*?\)/gu,Js={...mt,getAnimatableNone:e=>{const t=e.match(gc);return t?t.map(xc).join(" "):e}},yc={...Cn,color:$e,backgroundColor:$e,outlineColor:$e,fill:$e,stroke:$e,borderColor:$e,borderTopColor:$e,borderRightColor:$e,borderBottomColor:$e,borderLeftColor:$e,filter:Js,WebkitFilter:Js},Hn=e=>yc[e];function xa(e,t){let s=Hn(e);return s!==Js&&(s=mt),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const vc=new Set(["auto","none","0"]);function bc(e,t,s){let i=0,r;for(;i<e.length&&!r;){const l=e[i];typeof l=="string"&&!vc.has(l)&&qt(l).values.length&&(r=e[i]),i++}if(r&&s)for(const l of t)e[l]=xa(s,r)}const hi=e=>e===Dt||e===Z,fi=(e,t)=>parseFloat(e.split(", ")[t]),mi=(e,t)=>(s,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return fi(r[1],t);{const l=i.match(/^matrix\((.+)\)$/u);return l?fi(l[1],e):0}},wc=new Set(["x","y","z"]),jc=Rt.filter(e=>!wc.has(e));function Nc(e){const t=[];return jc.forEach(s=>{const i=e.getValue(s);i!==void 0&&(t.push([s,i.get()]),i.set(s.startsWith("scale")?1:0))}),t}const Mt={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:mi(4,13),y:mi(5,14)};Mt.translateX=Mt.x;Mt.translateY=Mt.y;const Nt=new Set;let Zs=!1,Qs=!1;function ga(){if(Qs){const e=Array.from(Nt).filter(i=>i.needsMeasurement),t=new Set(e.map(i=>i.element)),s=new Map;t.forEach(i=>{const r=Nc(i);r.length&&(s.set(i,r),i.render())}),e.forEach(i=>i.measureInitialState()),t.forEach(i=>{i.render();const r=s.get(i);r&&r.forEach(([l,o])=>{var a;(a=i.getValue(l))===null||a===void 0||a.set(o)})}),e.forEach(i=>i.measureEndState()),e.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Qs=!1,Zs=!1,Nt.forEach(e=>e.complete()),Nt.clear()}function ya(){Nt.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Qs=!0)})}function Sc(){ya(),ga()}class Wn{constructor(t,s,i,r,l,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=i,this.motionValue=r,this.element=l,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Nt.add(this),Zs||(Zs=!0,Se.read(ya),Se.resolveKeyframes(ga))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:i,motionValue:r}=this;for(let l=0;l<t.length;l++)if(t[l]===null)if(l===0){const o=r==null?void 0:r.get(),a=t[t.length-1];if(o!==void 0)t[0]=o;else if(i&&s){const c=i.readValue(s,a);c!=null&&(t[0]=c)}t[0]===void 0&&(t[0]=a),r&&o===void 0&&r.set(t[0])}else t[l]=t[l-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Nt.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Nt.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const va=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Tc=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function kc(e){const t=Tc.exec(e);if(!t)return[,];const[,s,i,r]=t;return[`--${s??i}`,r]}function ba(e,t,s=1){const[i,r]=kc(e);if(!i)return;const l=window.getComputedStyle(t).getPropertyValue(i);if(l){const o=l.trim();return va(o)?parseFloat(o):o}return kn(r)?ba(r,t,s+1):r}const wa=e=>t=>t.test(e),Cc={test:e=>e==="auto",parse:e=>e},ja=[Dt,Z,st,ut,xl,pl,Cc],pi=e=>ja.find(wa(e));class Na extends Wn{constructor(t,s,i,r,l){super(t,s,i,r,l,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:i}=this;if(!s||!s.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),kn(d))){const u=ba(d,s.current);u!==void 0&&(t[c]=u),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!Qr.has(i)||t.length!==2)return;const[r,l]=t,o=pi(r),a=pi(l);if(o!==a)if(hi(o)&&hi(a))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,i=[];for(let r=0;r<t.length;r++)nc(t[r])&&i.push(r);i.length&&bc(t,i,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:i}=this;if(!t||!t.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Mt[i](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const r=s[s.length-1];r!==void 0&&t.getValue(i,r).jump(r,!1)}measureEndState(){var t;const{element:s,name:i,unresolvedKeyframes:r}=this;if(!s||!s.current)return;const l=s.getValue(i);l&&l.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=Mt[i](s.measureViewportBox(),window.getComputedStyle(s.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([c,d])=>{s.getValue(c).set(d)}),this.resolveNoneKeyframes()}}const xi=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(mt.test(e)||e==="0")&&!e.startsWith("url("));function _c(e){const t=e[0];if(e.length===1)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}function Ac(e,t,s,i){const r=e[0];if(r===null)return!1;if(t==="display"||t==="visibility")return!0;const l=e[e.length-1],o=xi(r,t),a=xi(l,t);return!o||!a?!1:_c(e)||(s==="spring"||Rn(s))&&i}const Pc=e=>e!==null;function _s(e,{repeat:t,repeatType:s="loop"},i){const r=e.filter(Pc),l=t&&s!=="loop"&&t%2===1?0:r.length-1;return!l||i===void 0?r[l]:i}const Ec=40;class Sa{constructor({autoplay:t=!0,delay:s=0,type:i="keyframes",repeat:r=0,repeatDelay:l=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=nt.now(),this.options={autoplay:t,delay:s,type:i,repeat:r,repeatDelay:l,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>Ec?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Sc(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=nt.now(),this.hasAttemptedResolve=!0;const{name:i,type:r,velocity:l,delay:o,onComplete:a,onUpdate:c,isGenerator:d}=this.options;if(!d&&!Ac(t,i,r,l))if(o)this.options.duration=0;else{c&&c(_s(t,this.options,s)),a&&a(),this.resolveFinishedPromise();return}const u=this.initPlayback(t,s);u!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...u},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const Te=(e,t,s)=>e+(t-e)*s;function Ms(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(t-e)*6*s:s<1/2?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function Ic({hue:e,saturation:t,lightness:s,alpha:i}){e/=360,t/=100,s/=100;let r=0,l=0,o=0;if(!t)r=l=o=s;else{const a=s<.5?s*(1+t):s+t-s*t,c=2*s-a;r=Ms(c,a,e+1/3),l=Ms(c,a,e),o=Ms(c,a,e-1/3)}return{red:Math.round(r*255),green:Math.round(l*255),blue:Math.round(o*255),alpha:i}}function ps(e,t){return s=>s>0?t:e}const Rs=(e,t,s)=>{const i=e*e,r=s*(t*t-i)+i;return r<0?0:Math.sqrt(r)},Mc=[qs,wt,kt],Rc=e=>Mc.find(t=>t.test(e));function gi(e){const t=Rc(e);if(!t)return!1;let s=t.parse(e);return t===kt&&(s=Ic(s)),s}const yi=(e,t)=>{const s=gi(e),i=gi(t);if(!s||!i)return ps(e,t);const r={...s};return l=>(r.red=Rs(s.red,i.red,l),r.green=Rs(s.green,i.green,l),r.blue=Rs(s.blue,i.blue,l),r.alpha=Te(s.alpha,i.alpha,l),wt.transform(r))},Dc=(e,t)=>s=>t(e(s)),es=(...e)=>e.reduce(Dc),en=new Set(["none","hidden"]);function Lc(e,t){return en.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}function Vc(e,t){return s=>Te(e,t,s)}function Kn(e){return typeof e=="number"?Vc:typeof e=="string"?kn(e)?ps:$e.test(e)?yi:$c:Array.isArray(e)?Ta:typeof e=="object"?$e.test(e)?yi:Fc:ps}function Ta(e,t){const s=[...e],i=s.length,r=e.map((l,o)=>Kn(l)(l,t[o]));return l=>{for(let o=0;o<i;o++)s[o]=r[o](l);return s}}function Fc(e,t){const s={...e,...t},i={};for(const r in s)e[r]!==void 0&&t[r]!==void 0&&(i[r]=Kn(e[r])(e[r],t[r]));return r=>{for(const l in i)s[l]=i[l](r);return s}}function Oc(e,t){var s;const i=[],r={color:0,var:0,number:0};for(let l=0;l<t.values.length;l++){const o=t.types[l],a=e.indexes[o][r[o]],c=(s=e.values[a])!==null&&s!==void 0?s:0;i[l]=c,r[o]++}return i}const $c=(e,t)=>{const s=mt.createTransformer(t),i=qt(e),r=qt(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?en.has(e)&&!r.values.length||en.has(t)&&!i.values.length?Lc(e,t):es(Ta(Oc(i,r),r.values),s):ps(e,t)};function ka(e,t,s){return typeof e=="number"&&typeof t=="number"&&typeof s=="number"?Te(e,t,s):Kn(e)(e,t)}const zc=5;function Ca(e,t,s){const i=Math.max(t-zc,0);return ea(s-e(i),t-i)}const Ce={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Ds=.001;function Bc({duration:e=Ce.duration,bounce:t=Ce.bounce,velocity:s=Ce.velocity,mass:i=Ce.mass}){let r,l,o=1-t;o=ct(Ce.minDamping,Ce.maxDamping,o),e=ct(Ce.minDuration,Ce.maxDuration,lt(e)),o<1?(r=d=>{const u=d*o,f=u*e,m=u-s,y=tn(d,o),_=Math.exp(-f);return Ds-m/y*_},l=d=>{const f=d*o*e,m=f*s+s,y=Math.pow(o,2)*Math.pow(d,2)*e,_=Math.exp(-f),N=tn(Math.pow(d,2),o);return(-r(d)+Ds>0?-1:1)*((m-y)*_)/N}):(r=d=>{const u=Math.exp(-d*e),f=(d-s)*e+1;return-Ds+u*f},l=d=>{const u=Math.exp(-d*e),f=(s-d)*(e*e);return u*f});const a=5/e,c=Hc(r,l,a);if(e=ot(e),isNaN(c))return{stiffness:Ce.stiffness,damping:Ce.damping,duration:e};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:o*2*Math.sqrt(i*d),duration:e}}}const Uc=12;function Hc(e,t,s){let i=s;for(let r=1;r<Uc;r++)i=i-e(i)/t(i);return i}function tn(e,t){return e*Math.sqrt(1-t*t)}const Wc=["duration","bounce"],Kc=["stiffness","damping","mass"];function vi(e,t){return t.some(s=>e[s]!==void 0)}function Yc(e){let t={velocity:Ce.velocity,stiffness:Ce.stiffness,damping:Ce.damping,mass:Ce.mass,isResolvedFromDuration:!1,...e};if(!vi(e,Kc)&&vi(e,Wc))if(e.visualDuration){const s=e.visualDuration,i=2*Math.PI/(s*1.2),r=i*i,l=2*ct(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Ce.mass,stiffness:r,damping:l}}else{const s=Bc(e);t={...t,...s,mass:Ce.mass},t.isResolvedFromDuration=!0}return t}function _a(e=Ce.visualDuration,t=Ce.bounce){const s=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=s;const l=s.keyframes[0],o=s.keyframes[s.keyframes.length-1],a={done:!1,value:l},{stiffness:c,damping:d,mass:u,duration:f,velocity:m,isResolvedFromDuration:y}=Yc({...s,velocity:-lt(s.velocity||0)}),_=m||0,N=d/(2*Math.sqrt(c*u)),E=o-l,b=lt(Math.sqrt(c/u)),k=Math.abs(E)<5;i||(i=k?Ce.restSpeed.granular:Ce.restSpeed.default),r||(r=k?Ce.restDelta.granular:Ce.restDelta.default);let T;if(N<1){const S=tn(b,N);T=A=>{const V=Math.exp(-N*b*A);return o-V*((_+N*b*E)/S*Math.sin(S*A)+E*Math.cos(S*A))}}else if(N===1)T=S=>o-Math.exp(-b*S)*(E+(_+b*E)*S);else{const S=b*Math.sqrt(N*N-1);T=A=>{const V=Math.exp(-N*b*A),R=Math.min(S*A,300);return o-V*((_+N*b*E)*Math.sinh(R)+S*E*Math.cosh(R))/S}}const $={calculatedDuration:y&&f||null,next:S=>{const A=T(S);if(y)a.done=S>=f;else{let V=0;N<1&&(V=S===0?ot(_):Ca(T,S,A));const R=Math.abs(V)<=i,G=Math.abs(o-A)<=r;a.done=R&&G}return a.value=a.done?o:A,a},toString:()=>{const S=Math.min(Kr($),Ys),A=Yr(V=>$.next(S*V).value,S,30);return S+"ms "+A}};return $}function bi({keyframes:e,velocity:t=0,power:s=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:l=500,modifyTarget:o,min:a,max:c,restDelta:d=.5,restSpeed:u}){const f=e[0],m={done:!1,value:f},y=R=>a!==void 0&&R<a||c!==void 0&&R>c,_=R=>a===void 0?c:c===void 0||Math.abs(a-R)<Math.abs(c-R)?a:c;let N=s*t;const E=f+N,b=o===void 0?E:o(E);b!==E&&(N=b-f);const k=R=>-N*Math.exp(-R/i),T=R=>b+k(R),$=R=>{const G=k(R),O=T(R);m.done=Math.abs(G)<=d,m.value=m.done?b:O};let S,A;const V=R=>{y(m.value)&&(S=R,A=_a({keyframes:[m.value,_(m.value)],velocity:Ca(T,R,m.value),damping:r,stiffness:l,restDelta:d,restSpeed:u}))};return V(0),{calculatedDuration:null,next:R=>{let G=!1;return!A&&S===void 0&&(G=!0,$(R),V(R)),S!==void 0&&R>=S?A.next(R-S):(!G&&$(R),m)}}}const Xc=Qt(.42,0,1,1),Gc=Qt(0,0,.58,1),Aa=Qt(.42,0,.58,1),qc=e=>Array.isArray(e)&&typeof e[0]!="number",Jc={linear:Ke,easeIn:Xc,easeInOut:Aa,easeOut:Gc,circIn:zn,circInOut:ca,circOut:la,backIn:$n,backInOut:aa,backOut:ra,anticipate:oa},wi=e=>{if(Dn(e)){kr(e.length===4);const[t,s,i,r]=e;return Qt(t,s,i,r)}else if(typeof e=="string")return Jc[e];return e};function Zc(e,t,s){const i=[],r=s||ka,l=e.length-1;for(let o=0;o<l;o++){let a=r(e[o],e[o+1]);if(t){const c=Array.isArray(t)?t[o]||Ke:t;a=es(c,a)}i.push(a)}return i}function Qc(e,t,{clamp:s=!0,ease:i,mixer:r}={}){const l=e.length;if(kr(l===t.length),l===1)return()=>t[0];if(l===2&&t[0]===t[1])return()=>t[1];const o=e[0]===e[1];e[0]>e[l-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=Zc(t,i,r),c=a.length,d=u=>{if(o&&u<e[0])return t[0];let f=0;if(c>1)for(;f<e.length-2&&!(u<e[f+1]);f++);const m=Et(e[f],e[f+1],u);return a[f](m)};return s?u=>d(ct(e[0],e[l-1],u)):d}function ed(e,t){const s=e[e.length-1];for(let i=1;i<=t;i++){const r=Et(0,t,i);e.push(Te(s,1,r))}}function td(e){const t=[0];return ed(t,e.length-1),t}function sd(e,t){return e.map(s=>s*t)}function nd(e,t){return e.map(()=>t||Aa).splice(0,e.length-1)}function xs({duration:e=300,keyframes:t,times:s,ease:i="easeInOut"}){const r=qc(i)?i.map(wi):wi(i),l={done:!1,value:t[0]},o=sd(s&&s.length===t.length?s:td(t),e),a=Qc(o,t,{ease:Array.isArray(r)?r:nd(t,r)});return{calculatedDuration:e,next:c=>(l.value=a(c),l.done=c>=e,l)}}const id=e=>{const t=({timestamp:s})=>e(s);return{start:()=>Se.update(t,!0),stop:()=>ft(t),now:()=>Fe.isProcessing?Fe.timestamp:nt.now()}},rd={decay:bi,inertia:bi,tween:xs,keyframes:xs,spring:_a},ad=e=>e/100;class Yn extends Sa{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:s,motionValue:i,element:r,keyframes:l}=this.options,o=(r==null?void 0:r.KeyframeResolver)||Wn,a=(c,d)=>this.onKeyframesResolved(c,d);this.resolver=new o(l,a,s,i,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:l,velocity:o=0}=this.options,a=Rn(s)?s:rd[s]||xs;let c,d;a!==xs&&typeof t[0]!="number"&&(c=es(ad,ka(t[0],t[1])),t=[0,100]);const u=a({...this.options,keyframes:t});l==="mirror"&&(d=a({...this.options,keyframes:[...t].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=Kr(u));const{calculatedDuration:f}=u,m=f+r,y=m*(i+1)-r;return{generator:u,mirroredGenerator:d,mapPercentToKeyframes:c,calculatedDuration:f,resolvedDuration:m,totalDuration:y}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:i}=this;if(!i){const{keyframes:R}=this.options;return{done:!0,value:R[R.length-1]}}const{finalKeyframe:r,generator:l,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:c,calculatedDuration:d,totalDuration:u,resolvedDuration:f}=i;if(this.startTime===null)return l.next(0);const{delay:m,repeat:y,repeatType:_,repeatDelay:N,onUpdate:E}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-u/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const b=this.currentTime-m*(this.speed>=0?1:-1),k=this.speed>=0?b<0:b>u;this.currentTime=Math.max(b,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let T=this.currentTime,$=l;if(y){const R=Math.min(this.currentTime,u)/f;let G=Math.floor(R),O=R%1;!O&&R>=1&&(O=1),O===1&&G--,G=Math.min(G,y+1),!!(G%2)&&(_==="reverse"?(O=1-O,N&&(O-=N/f)):_==="mirror"&&($=o)),T=ct(0,1,O)*f}const S=k?{done:!1,value:c[0]}:$.next(T);a&&(S.value=a(S.value));let{done:A}=S;!k&&d!==null&&(A=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const V=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&A);return V&&r!==void 0&&(S.value=_s(c,this.options,r)),E&&E(S.value),V&&this.finish(),S}get duration(){const{resolved:t}=this;return t?lt(t.calculatedDuration):0}get time(){return lt(this.currentTime)}set time(t){t=ot(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=lt(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=id,onPlay:s,startTime:i}=this.options;this.driver||(this.driver=t(l=>this.tick(l))),s&&s();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const od=new Set(["opacity","clipPath","filter","transform"]);function ld(e,t,s,{delay:i=0,duration:r=300,repeat:l=0,repeatType:o="loop",ease:a="easeInOut",times:c}={}){const d={[t]:s};c&&(d.offset=c);const u=Gr(a,r);return Array.isArray(u)&&(d.easing=u),e.animate(d,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:l+1,direction:o==="reverse"?"alternate":"normal"})}const cd=vn(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),gs=10,dd=2e4;function ud(e){return Rn(e.type)||e.type==="spring"||!Xr(e.ease)}function hd(e,t){const s=new Yn({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const r=[];let l=0;for(;!i.done&&l<dd;)i=s.sample(l),r.push(i.value),l+=gs;return{times:void 0,keyframes:r,duration:l-gs,ease:"linear"}}const Pa={anticipate:oa,backInOut:aa,circInOut:ca};function fd(e){return e in Pa}class ji extends Sa{constructor(t){super(t);const{name:s,motionValue:i,element:r,keyframes:l}=this.options;this.resolver=new Na(l,(o,a)=>this.onKeyframesResolved(o,a),s,i,r),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:i=300,times:r,ease:l,type:o,motionValue:a,name:c,startTime:d}=this.options;if(!a.owner||!a.owner.current)return!1;if(typeof l=="string"&&ms()&&fd(l)&&(l=Pa[l]),ud(this.options)){const{onComplete:f,onUpdate:m,motionValue:y,element:_,...N}=this.options,E=hd(t,N);t=E.keyframes,t.length===1&&(t[1]=t[0]),i=E.duration,r=E.times,l=E.ease,o="keyframes"}const u=ld(a.owner.current,c,t,{...this.options,duration:i,times:r,ease:l});return u.startTime=d??this.calcStartTime(),this.pendingTimeline?(ai(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:f}=this.options;a.set(_s(t,this.options,s)),f&&f(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:i,times:r,type:o,ease:l,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return lt(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return lt(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:i}=s;i.currentTime=ot(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:i}=s;i.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Ke;const{animation:i}=s;ai(i,t)}return Ke}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:i,duration:r,type:l,ease:o,times:a}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:u,onComplete:f,element:m,...y}=this.options,_=new Yn({...y,keyframes:i,duration:r,type:l,ease:o,times:a,isGenerator:!0}),N=ot(this.time);d.setWithVelocity(_.sample(N-gs).value,_.sample(N).value,gs)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:i,repeatDelay:r,repeatType:l,damping:o,type:a}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=s.owner.getProps();return cd()&&i&&od.has(i)&&!c&&!d&&!r&&l!=="mirror"&&o!==0&&a!=="inertia"}}const md={type:"spring",stiffness:500,damping:25,restSpeed:10},pd=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),xd={type:"keyframes",duration:.8},gd={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},yd=(e,{keyframes:t})=>t.length>2?xd:St.has(e)?e.startsWith("scale")?pd(t[1]):md:gd;function vd({when:e,delay:t,delayChildren:s,staggerChildren:i,staggerDirection:r,repeat:l,repeatType:o,repeatDelay:a,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Xn=(e,t,s,i={},r,l)=>o=>{const a=Mn(i,e)||{},c=a.delay||i.delay||0;let{elapsed:d=0}=i;d=d-ot(c);let u={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...a,delay:-d,onUpdate:m=>{t.set(m),a.onUpdate&&a.onUpdate(m)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:e,motionValue:t,element:l?void 0:r};vd(a)||(u={...u,...yd(e,u)}),u.duration&&(u.duration=ot(u.duration)),u.repeatDelay&&(u.repeatDelay=ot(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let f=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(f=!0)),f&&!l&&t.get()!==void 0){const m=_s(u.keyframes,a);if(m!==void 0)return Se.update(()=>{u.onUpdate(m),u.onComplete()}),new Fl([])}return!l&&ji.supports(u)?new ji(u):new Yn(u)};function bd({protectedKeys:e,needsAnimating:t},s){const i=e.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,i}function Ea(e,t,{delay:s=0,transitionOverride:i,type:r}={}){var l;let{transition:o=e.getDefaultTransition(),transitionEnd:a,...c}=t;i&&(o=i);const d=[],u=r&&e.animationState&&e.animationState.getState()[r];for(const f in c){const m=e.getValue(f,(l=e.latestValues[f])!==null&&l!==void 0?l:null),y=c[f];if(y===void 0||u&&bd(u,f))continue;const _={delay:s,...Mn(o||{},f)};let N=!1;if(window.MotionHandoffAnimation){const b=ta(e);if(b){const k=window.MotionHandoffAnimation(b,f,Se);k!==null&&(_.startTime=k,N=!0)}}Gs(e,f),m.start(Xn(f,m,y,e.shouldReduceMotion&&Qr.has(f)?{type:!1}:_,e,N));const E=m.animation;E&&d.push(E)}return a&&Promise.all(d).then(()=>{Se.update(()=>{a&&Zl(e,a)})}),d}function sn(e,t,s={}){var i;const r=Cs(e,t,s.type==="exit"?(i=e.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:l=e.getDefaultTransition()||{}}=r||{};s.transitionOverride&&(l=s.transitionOverride);const o=r?()=>Promise.all(Ea(e,r,s)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:f,staggerDirection:m}=l;return wd(e,t,u+d,f,m,s)}:()=>Promise.resolve(),{when:c}=l;if(c){const[d,u]=c==="beforeChildren"?[o,a]:[a,o];return d().then(()=>u())}else return Promise.all([o(),a(s.delay)])}function wd(e,t,s=0,i=0,r=1,l){const o=[],a=(e.variantChildren.size-1)*i,c=r===1?(d=0)=>d*i:(d=0)=>a-d*i;return Array.from(e.variantChildren).sort(jd).forEach((d,u)=>{d.notify("AnimationStart",t),o.push(sn(d,t,{...l,delay:s+c(u)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(o)}function jd(e,t){return e.sortNodePosition(t)}function Nd(e,t,s={}){e.notify("AnimationStart",t);let i;if(Array.isArray(t)){const r=t.map(l=>sn(e,l,s));i=Promise.all(r)}else if(typeof t=="string")i=sn(e,t,s);else{const r=typeof t=="function"?Cs(e,t,s.custom):t;i=Promise.all(Ea(e,r,s))}return i.then(()=>{e.notify("AnimationComplete",t)})}const Sd=wn.length;function Ia(e){if(!e)return;if(!e.isControllingVariants){const s=e.parent?Ia(e.parent)||{}:{};return e.props.initial!==void 0&&(s.initial=e.props.initial),s}const t={};for(let s=0;s<Sd;s++){const i=wn[s],r=e.props[i];(Yt(r)||r===!1)&&(t[i]=r)}return t}const Td=[...bn].reverse(),kd=bn.length;function Cd(e){return t=>Promise.all(t.map(({animation:s,options:i})=>Nd(e,s,i)))}function _d(e){let t=Cd(e),s=Ni(),i=!0;const r=c=>(d,u)=>{var f;const m=Cs(e,u,c==="exit"?(f=e.presenceContext)===null||f===void 0?void 0:f.custom:void 0);if(m){const{transition:y,transitionEnd:_,...N}=m;d={...d,...N,..._}}return d};function l(c){t=c(e)}function o(c){const{props:d}=e,u=Ia(e.parent)||{},f=[],m=new Set;let y={},_=1/0;for(let E=0;E<kd;E++){const b=Td[E],k=s[b],T=d[b]!==void 0?d[b]:u[b],$=Yt(T),S=b===c?k.isActive:null;S===!1&&(_=E);let A=T===u[b]&&T!==d[b]&&$;if(A&&i&&e.manuallyAnimateOnMount&&(A=!1),k.protectedKeys={...y},!k.isActive&&S===null||!T&&!k.prevProp||Ts(T)||typeof T=="boolean")continue;const V=Ad(k.prevProp,T);let R=V||b===c&&k.isActive&&!A&&$||E>_&&$,G=!1;const O=Array.isArray(T)?T:[T];let U=O.reduce(r(b),{});S===!1&&(U={});const{prevResolvedValues:le={}}=k,ne={...le,...U},C=Y=>{R=!0,m.has(Y)&&(G=!0,m.delete(Y)),k.needsAnimating[Y]=!0;const se=e.getValue(Y);se&&(se.liveStyle=!1)};for(const Y in ne){const se=U[Y],H=le[Y];if(y.hasOwnProperty(Y))continue;let ee=!1;Ks(se)&&Ks(H)?ee=!Wr(se,H):ee=se!==H,ee?se!=null?C(Y):m.add(Y):se!==void 0&&m.has(Y)?C(Y):k.protectedKeys[Y]=!0}k.prevProp=T,k.prevResolvedValues=U,k.isActive&&(y={...y,...U}),i&&e.blockInitialAnimation&&(R=!1),R&&(!(A&&V)||G)&&f.push(...O.map(Y=>({animation:Y,options:{type:b}})))}if(m.size){const E={};m.forEach(b=>{const k=e.getBaseTarget(b),T=e.getValue(b);T&&(T.liveStyle=!0),E[b]=k??null}),f.push({animation:E})}let N=!!f.length;return i&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(N=!1),i=!1,N?t(f):Promise.resolve()}function a(c,d){var u;if(s[c].isActive===d)return Promise.resolve();(u=e.variantChildren)===null||u===void 0||u.forEach(m=>{var y;return(y=m.animationState)===null||y===void 0?void 0:y.setActive(c,d)}),s[c].isActive=d;const f=o(c);for(const m in s)s[m].protectedKeys={};return f}return{animateChanges:o,setActive:a,setAnimateFunction:l,getState:()=>s,reset:()=>{s=Ni(),i=!0}}}function Ad(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!Wr(t,e):!1}function yt(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ni(){return{animate:yt(!0),whileInView:yt(),whileHover:yt(),whileTap:yt(),whileDrag:yt(),whileFocus:yt(),exit:yt()}}class pt{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Pd extends pt{constructor(t){super(t),t.animationState||(t.animationState=_d(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Ts(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let Ed=0;class Id extends pt{constructor(){super(...arguments),this.id=Ed++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const r=this.node.animationState.setActive("exit",!t);s&&!t&&r.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const Md={animation:{Feature:Pd},exit:{Feature:Id}};function Jt(e,t,s,i={passive:!0}){return e.addEventListener(t,s,i),()=>e.removeEventListener(t,s)}function ts(e){return{point:{x:e.pageX,y:e.pageY}}}const Rd=e=>t=>Ln(t)&&e(t,ts(t));function Ut(e,t,s,i){return Jt(e,t,Rd(s),i)}const Si=(e,t)=>Math.abs(e-t);function Dd(e,t){const s=Si(e.x,t.x),i=Si(e.y,t.y);return Math.sqrt(s**2+i**2)}class Ma{constructor(t,s,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:l=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=Vs(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,y=Dd(f.offset,{x:0,y:0})>=3;if(!m&&!y)return;const{point:_}=f,{timestamp:N}=Fe;this.history.push({..._,timestamp:N});const{onStart:E,onMove:b}=this.handlers;m||(E&&E(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=Ls(m,this.transformPagePoint),Se.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:y,onSessionEnd:_,resumeAnimation:N}=this.handlers;if(this.dragSnapToOrigin&&N&&N(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const E=Vs(f.type==="pointercancel"?this.lastMoveEventInfo:Ls(m,this.transformPagePoint),this.history);this.startEvent&&y&&y(f,E),_&&_(f,E)},!Ln(t))return;this.dragSnapToOrigin=l,this.handlers=s,this.transformPagePoint=i,this.contextWindow=r||window;const o=ts(t),a=Ls(o,this.transformPagePoint),{point:c}=a,{timestamp:d}=Fe;this.history=[{...c,timestamp:d}];const{onSessionStart:u}=s;u&&u(t,Vs(a,this.history)),this.removeListeners=es(Ut(this.contextWindow,"pointermove",this.handlePointerMove),Ut(this.contextWindow,"pointerup",this.handlePointerUp),Ut(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),ft(this.updatePoint)}}function Ls(e,t){return t?{point:t(e.point)}:e}function Ti(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Vs({point:e},t){return{point:e,delta:Ti(e,Ra(t)),offset:Ti(e,Ld(t)),velocity:Vd(t,.1)}}function Ld(e){return e[0]}function Ra(e){return e[e.length-1]}function Vd(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,i=null;const r=Ra(e);for(;s>=0&&(i=e[s],!(r.timestamp-i.timestamp>ot(t)));)s--;if(!i)return{x:0,y:0};const l=lt(r.timestamp-i.timestamp);if(l===0)return{x:0,y:0};const o={x:(r.x-i.x)/l,y:(r.y-i.y)/l};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const Da=1e-4,Fd=1-Da,Od=1+Da,La=.01,$d=0-La,zd=0+La;function Ye(e){return e.max-e.min}function Bd(e,t,s){return Math.abs(e-t)<=s}function ki(e,t,s,i=.5){e.origin=i,e.originPoint=Te(t.min,t.max,e.origin),e.scale=Ye(s)/Ye(t),e.translate=Te(s.min,s.max,e.origin)-e.originPoint,(e.scale>=Fd&&e.scale<=Od||isNaN(e.scale))&&(e.scale=1),(e.translate>=$d&&e.translate<=zd||isNaN(e.translate))&&(e.translate=0)}function Ht(e,t,s,i){ki(e.x,t.x,s.x,i?i.originX:void 0),ki(e.y,t.y,s.y,i?i.originY:void 0)}function Ci(e,t,s){e.min=s.min+t.min,e.max=e.min+Ye(t)}function Ud(e,t,s){Ci(e.x,t.x,s.x),Ci(e.y,t.y,s.y)}function _i(e,t,s){e.min=t.min-s.min,e.max=e.min+Ye(t)}function Wt(e,t,s){_i(e.x,t.x,s.x),_i(e.y,t.y,s.y)}function Hd(e,{min:t,max:s},i){return t!==void 0&&e<t?e=i?Te(t,e,i.min):Math.max(e,t):s!==void 0&&e>s&&(e=i?Te(s,e,i.max):Math.min(e,s)),e}function Ai(e,t,s){return{min:t!==void 0?e.min+t:void 0,max:s!==void 0?e.max+s-(e.max-e.min):void 0}}function Wd(e,{top:t,left:s,bottom:i,right:r}){return{x:Ai(e.x,s,r),y:Ai(e.y,t,i)}}function Pi(e,t){let s=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,i]=[i,s]),{min:s,max:i}}function Kd(e,t){return{x:Pi(e.x,t.x),y:Pi(e.y,t.y)}}function Yd(e,t){let s=.5;const i=Ye(e),r=Ye(t);return r>i?s=Et(t.min,t.max-i,e.min):i>r&&(s=Et(e.min,e.max-r,t.min)),ct(0,1,s)}function Xd(e,t){const s={};return t.min!==void 0&&(s.min=t.min-e.min),t.max!==void 0&&(s.max=t.max-e.min),s}const nn=.35;function Gd(e=nn){return e===!1?e=0:e===!0&&(e=nn),{x:Ei(e,"left","right"),y:Ei(e,"top","bottom")}}function Ei(e,t,s){return{min:Ii(e,t),max:Ii(e,s)}}function Ii(e,t){return typeof e=="number"?e:e[t]||0}const Mi=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ct=()=>({x:Mi(),y:Mi()}),Ri=()=>({min:0,max:0}),Ee=()=>({x:Ri(),y:Ri()});function Ge(e){return[e("x"),e("y")]}function Va({top:e,left:t,right:s,bottom:i}){return{x:{min:t,max:s},y:{min:e,max:i}}}function qd({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Jd(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:i.y,right:i.x}}function Fs(e){return e===void 0||e===1}function rn({scale:e,scaleX:t,scaleY:s}){return!Fs(e)||!Fs(t)||!Fs(s)}function vt(e){return rn(e)||Fa(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Fa(e){return Di(e.x)||Di(e.y)}function Di(e){return e&&e!=="0%"}function ys(e,t,s){const i=e-s,r=t*i;return s+r}function Li(e,t,s,i,r){return r!==void 0&&(e=ys(e,r,i)),ys(e,s,i)+t}function an(e,t=0,s=1,i,r){e.min=Li(e.min,t,s,i,r),e.max=Li(e.max,t,s,i,r)}function Oa(e,{x:t,y:s}){an(e.x,t.translate,t.scale,t.originPoint),an(e.y,s.translate,s.scale,s.originPoint)}const Vi=.999999999999,Fi=1.0000000000001;function Zd(e,t,s,i=!1){const r=s.length;if(!r)return;t.x=t.y=1;let l,o;for(let a=0;a<r;a++){l=s[a],o=l.projectionDelta;const{visualElement:c}=l.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&l.options.layoutScroll&&l.scroll&&l!==l.root&&At(e,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,Oa(e,o)),i&&vt(l.latestValues)&&At(e,l.latestValues))}t.x<Fi&&t.x>Vi&&(t.x=1),t.y<Fi&&t.y>Vi&&(t.y=1)}function _t(e,t){e.min=e.min+t,e.max=e.max+t}function Oi(e,t,s,i,r=.5){const l=Te(e.min,e.max,r);an(e,t,s,l,i)}function At(e,t){Oi(e.x,t.x,t.scaleX,t.scale,t.originX),Oi(e.y,t.y,t.scaleY,t.scale,t.originY)}function $a(e,t){return Va(Jd(e.getBoundingClientRect(),t))}function Qd(e,t,s){const i=$a(e,s),{scroll:r}=t;return r&&(_t(i.x,r.offset.x),_t(i.y,r.offset.y)),i}const za=({current:e})=>e?e.ownerDocument.defaultView:null,eu=new WeakMap;class tu{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ee(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(ts(u).point)},l=(u,f)=>{const{drag:m,dragPropagation:y,onDragStart:_}=this.getProps();if(m&&!y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Yl(m),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ge(E=>{let b=this.getAxisMotionValue(E).get()||0;if(st.test(b)){const{projection:k}=this.visualElement;if(k&&k.layout){const T=k.layout.layoutBox[E];T&&(b=Ye(T)*(parseFloat(b)/100))}}this.originPoint[E]=b}),_&&Se.postRender(()=>_(u,f)),Gs(this.visualElement,"transform");const{animationState:N}=this.visualElement;N&&N.setActive("whileDrag",!0)},o=(u,f)=>{const{dragPropagation:m,dragDirectionLock:y,onDirectionLock:_,onDrag:N}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:E}=f;if(y&&this.currentDirection===null){this.currentDirection=su(E),this.currentDirection!==null&&_&&_(this.currentDirection);return}this.updateAxis("x",f.point,E),this.updateAxis("y",f.point,E),this.visualElement.render(),N&&N(u,f)},a=(u,f)=>this.stop(u,f),c=()=>Ge(u=>{var f;return this.getAnimationState(u)==="paused"&&((f=this.getAxisMotionValue(u).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new Ma(t,{onSessionStart:r,onStart:l,onMove:o,onSessionEnd:a,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:za(this.visualElement)})}stop(t,s){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=s;this.startAnimation(r);const{onDragEnd:l}=this.getProps();l&&Se.postRender(()=>l(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,i){const{drag:r}=this.getProps();if(!i||!rs(t,r,this.currentDirection))return;const l=this.getAxisMotionValue(t);let o=this.originPoint[t]+i[t];this.constraints&&this.constraints[t]&&(o=Hd(o,this.constraints[t],this.elastic[t])),l.set(o)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,l=this.constraints;s&&Tt(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&r?this.constraints=Wd(r.layoutBox,s):this.constraints=!1,this.elastic=Gd(i),l!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Ge(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=Xd(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!Tt(t))return!1;const i=t.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const l=Qd(i,r.root,this.visualElement.getTransformPagePoint());let o=Kd(r.layout.layoutBox,l);if(s){const a=s(qd(o));this.hasMutatedConstraints=!!a,a&&(o=Va(a))}return o}startAnimation(t){const{drag:s,dragMomentum:i,dragElastic:r,dragTransition:l,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),c=this.constraints||{},d=Ge(u=>{if(!rs(u,s,this.currentDirection))return;let f=c&&c[u]||{};o&&(f={min:0,max:0});const m=r?200:1e6,y=r?40:1e7,_={type:"inertia",velocity:i?t[u]:0,bounceStiffness:m,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...l,...f};return this.startAxisValueAnimation(u,_)});return Promise.all(d).then(a)}startAxisValueAnimation(t,s){const i=this.getAxisMotionValue(t);return Gs(this.visualElement,t),i.start(Xn(t,i,0,s,this.visualElement,!1))}stopAnimation(){Ge(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Ge(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,i=this.visualElement.getProps(),r=i[s];return r||this.visualElement.getValue(t,(i.initial?i.initial[t]:void 0)||0)}snapToCursor(t){Ge(s=>{const{drag:i}=this.getProps();if(!rs(s,i,this.currentDirection))return;const{projection:r}=this.visualElement,l=this.getAxisMotionValue(s);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[s];l.set(t[s]-Te(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:i}=this.visualElement;if(!Tt(s)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Ge(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const c=a.get();r[o]=Yd({min:c,max:c},this.constraints[o])}});const{transformTemplate:l}=this.visualElement.getProps();this.visualElement.current.style.transform=l?l({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Ge(o=>{if(!rs(o,t,null))return;const a=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];a.set(Te(c,d,r[o]))})}addListeners(){if(!this.visualElement.current)return;eu.set(this.visualElement,this);const t=this.visualElement.current,s=Ut(t,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();Tt(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,l=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Se.read(i);const o=Jt(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Ge(u=>{const f=this.getAxisMotionValue(u);f&&(this.originPoint[u]+=c[u].translate,f.set(f.get()+c[u].translate))}),this.visualElement.render())}));return()=>{o(),s(),l(),a&&a()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:l=!1,dragElastic:o=nn,dragMomentum:a=!0}=t;return{...t,drag:s,dragDirectionLock:i,dragPropagation:r,dragConstraints:l,dragElastic:o,dragMomentum:a}}}function rs(e,t,s){return(t===!0||t===e)&&(s===null||s===e)}function su(e,t=10){let s=null;return Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x"),s}class nu extends pt{constructor(t){super(t),this.removeGroupControls=Ke,this.removeListeners=Ke,this.controls=new tu(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ke}unmount(){this.removeGroupControls(),this.removeListeners()}}const $i=e=>(t,s)=>{e&&Se.postRender(()=>e(t,s))};class iu extends pt{constructor(){super(...arguments),this.removePointerDownListener=Ke}onPointerDown(t){this.session=new Ma(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:za(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:$i(t),onStart:$i(s),onMove:i,onEnd:(l,o)=>{delete this.session,r&&Se.postRender(()=>r(l,o))}}}mount(){this.removePointerDownListener=Ut(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ds={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function zi(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Vt={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Z.test(e))e=parseFloat(e);else return e;const s=zi(e,t.target.x),i=zi(e,t.target.y);return`${s}% ${i}%`}},ru={correct:(e,{treeScale:t,projectionDelta:s})=>{const i=e,r=mt.parse(e);if(r.length>5)return i;const l=mt.createTransformer(e),o=typeof r[0]!="number"?1:0,a=s.x.scale*t.x,c=s.y.scale*t.y;r[0+o]/=a,r[1+o]/=c;const d=Te(a,c,.5);return typeof r[2+o]=="number"&&(r[2+o]/=d),typeof r[3+o]=="number"&&(r[3+o]/=d),l(r)}};class au extends h.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:i,layoutId:r}=this.props,{projection:l}=t;kl(ou),l&&(s.group&&s.group.add(l),i&&i.register&&r&&i.register(l),l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,onExitComplete:()=>this.safeToRemove()})),ds.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:i,drag:r,isPresent:l}=this.props,o=i.projection;return o&&(o.isPresent=l,r||t.layoutDependency!==s||s===void 0?o.willUpdate():this.safeToRemove(),t.isPresent!==l&&(l?o.promote():o.relegate()||Se.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Nn.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:i}=this.props,{projection:r}=t;r&&(r.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Ba(e){const[t,s]=Sr(),i=h.useContext(pn);return n.jsx(au,{...e,layoutGroup:i,switchLayoutGroup:h.useContext(Ir),isPresent:t,safeToRemove:s})}const ou={borderRadius:{...Vt,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Vt,borderTopRightRadius:Vt,borderBottomLeftRadius:Vt,borderBottomRightRadius:Vt,boxShadow:ru};function lu(e,t,s){const i=ze(e)?e:Gt(e);return i.start(Xn("",i,t,s)),i.animation}function cu(e){return e instanceof SVGElement&&e.tagName!=="svg"}const du=(e,t)=>e.depth-t.depth;class uu{constructor(){this.children=[],this.isDirty=!1}add(t){Vn(this.children,t),this.isDirty=!0}remove(t){Fn(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(du),this.isDirty=!1,this.children.forEach(t)}}function hu(e,t){const s=nt.now(),i=({timestamp:r})=>{const l=r-s;l>=t&&(ft(i),e(l-t))};return Se.read(i,!0),()=>ft(i)}const Ua=["TopLeft","TopRight","BottomLeft","BottomRight"],fu=Ua.length,Bi=e=>typeof e=="string"?parseFloat(e):e,Ui=e=>typeof e=="number"||Z.test(e);function mu(e,t,s,i,r,l){r?(e.opacity=Te(0,s.opacity!==void 0?s.opacity:1,pu(i)),e.opacityExit=Te(t.opacity!==void 0?t.opacity:1,0,xu(i))):l&&(e.opacity=Te(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,i));for(let o=0;o<fu;o++){const a=`border${Ua[o]}Radius`;let c=Hi(t,a),d=Hi(s,a);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||Ui(c)===Ui(d)?(e[a]=Math.max(Te(Bi(c),Bi(d),i),0),(st.test(d)||st.test(c))&&(e[a]+="%")):e[a]=d}(t.rotate||s.rotate)&&(e.rotate=Te(t.rotate||0,s.rotate||0,i))}function Hi(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const pu=Ha(0,.5,la),xu=Ha(.5,.95,Ke);function Ha(e,t,s){return i=>i<e?0:i>t?1:s(Et(e,t,i))}function Wi(e,t){e.min=t.min,e.max=t.max}function Xe(e,t){Wi(e.x,t.x),Wi(e.y,t.y)}function Ki(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Yi(e,t,s,i,r){return e-=t,e=ys(e,1/s,i),r!==void 0&&(e=ys(e,1/r,i)),e}function gu(e,t=0,s=1,i=.5,r,l=e,o=e){if(st.test(t)&&(t=parseFloat(t),t=Te(o.min,o.max,t/100)-o.min),typeof t!="number")return;let a=Te(l.min,l.max,i);e===l&&(a-=t),e.min=Yi(e.min,t,s,a,r),e.max=Yi(e.max,t,s,a,r)}function Xi(e,t,[s,i,r],l,o){gu(e,t[s],t[i],t[r],t.scale,l,o)}const yu=["x","scaleX","originX"],vu=["y","scaleY","originY"];function Gi(e,t,s,i){Xi(e.x,t,yu,s?s.x:void 0,i?i.x:void 0),Xi(e.y,t,vu,s?s.y:void 0,i?i.y:void 0)}function qi(e){return e.translate===0&&e.scale===1}function Wa(e){return qi(e.x)&&qi(e.y)}function Ji(e,t){return e.min===t.min&&e.max===t.max}function bu(e,t){return Ji(e.x,t.x)&&Ji(e.y,t.y)}function Zi(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Ka(e,t){return Zi(e.x,t.x)&&Zi(e.y,t.y)}function Qi(e){return Ye(e.x)/Ye(e.y)}function er(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class wu{constructor(){this.members=[]}add(t){Vn(this.members,t),t.scheduleRender()}remove(t){if(Fn(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(r=>t===r);if(s===0)return!1;let i;for(let r=s;r>=0;r--){const l=this.members[r];if(l.isPresent!==!1){i=l;break}}return i?(this.promote(i),!0):!1}promote(t,s){const i=this.lead;if(t!==i&&(this.prevLead=i,this.lead=t,t.show(),i)){i.instance&&i.scheduleRender(),t.scheduleRender(),t.resumeFrom=i,s&&(t.resumeFrom.preserveOpacity=!0),i.snapshot&&(t.snapshot=i.snapshot,t.snapshot.latestValues=i.animationValues||i.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:r}=t.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:i}=t;s.onExitComplete&&s.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function ju(e,t,s){let i="";const r=e.x.translate/t.x,l=e.y.translate/t.y,o=(s==null?void 0:s.z)||0;if((r||l||o)&&(i=`translate3d(${r}px, ${l}px, ${o}px) `),(t.x!==1||t.y!==1)&&(i+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:d,rotate:u,rotateX:f,rotateY:m,skewX:y,skewY:_}=s;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),f&&(i+=`rotateX(${f}deg) `),m&&(i+=`rotateY(${m}deg) `),y&&(i+=`skewX(${y}deg) `),_&&(i+=`skewY(${_}deg) `)}const a=e.x.scale*t.x,c=e.y.scale*t.y;return(a!==1||c!==1)&&(i+=`scale(${a}, ${c})`),i||"none"}const bt={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},$t=typeof window<"u"&&window.MotionDebug!==void 0,Os=["","X","Y","Z"],Nu={visibility:"hidden"},tr=1e3;let Su=0;function $s(e,t,s,i){const{latestValues:r}=t;r[e]&&(s[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function Ya(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=ta(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:r,layoutId:l}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Se,!(r||l))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&Ya(i)}function Xa({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},a=t==null?void 0:t()){this.id=Su++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,$t&&(bt.totalNodes=bt.resolvedTargetDeltas=bt.recalculatedProjection=0),this.nodes.forEach(Cu),this.nodes.forEach(Iu),this.nodes.forEach(Mu),this.nodes.forEach(_u),$t&&window.MotionDebug.record(bt)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new uu)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new On),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const c=this.eventHandlers.get(o);c&&c.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=cu(o),this.instance=o;const{layoutId:c,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const m=()=>this.root.updateBlockedByResize=!1;e(o,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=hu(m,250),ds.hasAnimatedSinceResize&&(ds.hasAnimatedSinceResize=!1,this.nodes.forEach(nr))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:m,hasRelativeTargetChanged:y,layout:_})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const N=this.options.transition||u.getDefaultTransition()||Fu,{onLayoutAnimationStart:E,onLayoutAnimationComplete:b}=u.getProps(),k=!this.targetLayout||!Ka(this.targetLayout,_)||y,T=!m&&y;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||T||m&&(k||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,T);const $={...Mn(N,"layout"),onPlay:E,onComplete:b};(u.shouldReduceMotion||this.options.layoutRoot)&&($.delay=0,$.type=!1),this.startAnimation($)}else m||nr(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=_})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,ft(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Ru),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Ya(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const f=this.path[u];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:a,layout:c}=this.options;if(a===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(sr);return}this.isUpdating||this.nodes.forEach(Pu),this.isUpdating=!1,this.nodes.forEach(Eu),this.nodes.forEach(Tu),this.nodes.forEach(ku),this.clearAllSnapshots();const a=nt.now();Fe.delta=ct(0,1e3/60,a-Fe.timestamp),Fe.timestamp=a,Fe.isProcessing=!0,Ps.update.process(Fe),Ps.preRender.process(Fe),Ps.render.process(Fe),Fe.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Nn.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Au),this.sharedNodes.forEach(Du)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Se.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Se.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ee(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!Wa(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;o&&(a||vt(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let c=this.removeElementScroll(a);return o&&(c=this.removeTransform(c)),Ou(c),{animationId:this.root.animationId,measuredBox:a,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return Ee();const c=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some($u))){const{scroll:u}=this.root;u&&(_t(c.x,u.offset.x),_t(c.y,u.offset.y))}return c}removeElementScroll(o){var a;const c=Ee();if(Xe(c,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return c;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:f,options:m}=u;u!==this.root&&f&&m.layoutScroll&&(f.wasRoot&&Xe(c,o),_t(c.x,f.offset.x),_t(c.y,f.offset.y))}return c}applyTransform(o,a=!1){const c=Ee();Xe(c,o);for(let d=0;d<this.path.length;d++){const u=this.path[d];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&At(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),vt(u.latestValues)&&At(c,u.latestValues)}return vt(this.latestValues)&&At(c,this.latestValues),c}removeTransform(o){const a=Ee();Xe(a,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!vt(d.latestValues))continue;rn(d.latestValues)&&d.updateSnapshot();const u=Ee(),f=d.measurePageBox();Xe(u,f),Gi(a,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return vt(this.latestValues)&&Gi(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Fe.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(o||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:m}=this.options;if(!(!this.layout||!(f||m))){if(this.resolvedRelativeTargetAt=Fe.timestamp,!this.targetDelta&&!this.relativeTarget){const y=this.getClosestProjectingParent();y&&y.layout&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ee(),this.relativeTargetOrigin=Ee(),Wt(this.relativeTargetOrigin,this.layout.layoutBox,y.layout.layoutBox),Xe(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ee(),this.targetWithTransforms=Ee()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Ud(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Xe(this.target,this.layout.layoutBox),Oa(this.target,this.targetDelta)):Xe(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const y=this.getClosestProjectingParent();y&&!!y.resumingFrom==!!this.resumingFrom&&!y.options.layoutScroll&&y.target&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ee(),this.relativeTargetOrigin=Ee(),Wt(this.relativeTargetOrigin,this.target,y.target),Xe(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}$t&&bt.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||rn(this.parent.latestValues)||Fa(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),c=!!this.resumingFrom||this!==a;let d=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Fe.timestamp&&(d=!1),d)return;const{layout:u,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||f))return;Xe(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,y=this.treeScale.y;Zd(this.layoutCorrected,this.treeScale,this.path,c),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Ee());const{target:_}=a;if(!_){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Ki(this.prevProjectionDelta.x,this.projectionDelta.x),Ki(this.prevProjectionDelta.y,this.projectionDelta.y)),Ht(this.projectionDelta,this.layoutCorrected,_,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==y||!er(this.projectionDelta.x,this.prevProjectionDelta.x)||!er(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",_)),$t&&bt.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ct(),this.projectionDelta=Ct(),this.projectionDeltaWithTransform=Ct()}setAnimationOrigin(o,a=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},f=Ct();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const m=Ee(),y=c?c.source:void 0,_=this.layout?this.layout.source:void 0,N=y!==_,E=this.getStack(),b=!E||E.members.length<=1,k=!!(N&&!b&&this.options.crossfade===!0&&!this.path.some(Vu));this.animationProgress=0;let T;this.mixTargetDelta=$=>{const S=$/1e3;ir(f.x,o.x,S),ir(f.y,o.y,S),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Wt(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Lu(this.relativeTarget,this.relativeTargetOrigin,m,S),T&&bu(this.relativeTarget,T)&&(this.isProjectionDirty=!1),T||(T=Ee()),Xe(T,this.relativeTarget)),N&&(this.animationValues=u,mu(u,d,this.latestValues,S,k,b)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=S},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(ft(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Se.update(()=>{ds.hasAnimatedSinceResize=!0,this.currentAnimation=lu(0,tr,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(tr),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:c,layout:d,latestValues:u}=o;if(!(!a||!c||!d)){if(this!==o&&this.layout&&d&&Ga(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Ee();const f=Ye(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+f;const m=Ye(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+m}Xe(a,c),At(a,u),Ht(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new wu),this.sharedNodes.get(o).add(a);const d=a.options.initialPromotionConfig;a.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(a=!0),!a)return;const d={};c.z&&$s("z",o,d,this.animationValues);for(let u=0;u<Os.length;u++)$s(`rotate${Os[u]}`,o,d,this.animationValues),$s(`skew${Os[u]}`,o,d,this.animationValues);o.render();for(const u in d)o.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);o.scheduleRender()}getProjectionStyles(o){var a,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Nu;const d={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=ls(o==null?void 0:o.pointerEvents)||"",d.transform=u?u(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const N={};return this.options.layoutId&&(N.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,N.pointerEvents=ls(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!vt(this.latestValues)&&(N.transform=u?u({},""):"none",this.hasProjected=!1),N}const m=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=ju(this.projectionDeltaWithTransform,this.treeScale,m),u&&(d.transform=u(m,d.transform));const{x:y,y:_}=this.projectionDelta;d.transformOrigin=`${y.origin*100}% ${_.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(a=m.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:d.opacity=f===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const N in fs){if(m[N]===void 0)continue;const{correct:E,applyTo:b}=fs[N],k=d.transform==="none"?m[N]:E(m[N],f);if(b){const T=b.length;for(let $=0;$<T;$++)d[b[$]]=k}else d[N]=k}return this.options.layoutId&&(d.pointerEvents=f===this?ls(o==null?void 0:o.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(sr),this.root.sharedNodes.clear()}}}function Tu(e){e.updateLayout()}function ku(e){var t;const s=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=e.layout,{animationType:l}=e.options,o=s.source!==e.layout.source;l==="size"?Ge(f=>{const m=o?s.measuredBox[f]:s.layoutBox[f],y=Ye(m);m.min=i[f].min,m.max=m.min+y}):Ga(l,s.layoutBox,i)&&Ge(f=>{const m=o?s.measuredBox[f]:s.layoutBox[f],y=Ye(i[f]);m.max=m.min+y,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+y)});const a=Ct();Ht(a,i,s.layoutBox);const c=Ct();o?Ht(c,e.applyTransform(r,!0),s.measuredBox):Ht(c,i,s.layoutBox);const d=!Wa(a);let u=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:m,layout:y}=f;if(m&&y){const _=Ee();Wt(_,s.layoutBox,m.layoutBox);const N=Ee();Wt(N,i,y.layoutBox),Ka(_,N)||(u=!0),f.options.layoutRoot&&(e.relativeTarget=N,e.relativeTargetOrigin=_,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:i,snapshot:s,delta:c,layoutDelta:a,hasLayoutChanged:d,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:i}=e.options;i&&i()}e.options.transition=void 0}function Cu(e){$t&&bt.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function _u(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Au(e){e.clearSnapshot()}function sr(e){e.clearMeasurements()}function Pu(e){e.isLayoutDirty=!1}function Eu(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function nr(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Iu(e){e.resolveTargetDelta()}function Mu(e){e.calcProjection()}function Ru(e){e.resetSkewAndRotation()}function Du(e){e.removeLeadSnapshot()}function ir(e,t,s){e.translate=Te(t.translate,0,s),e.scale=Te(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function rr(e,t,s,i){e.min=Te(t.min,s.min,i),e.max=Te(t.max,s.max,i)}function Lu(e,t,s,i){rr(e.x,t.x,s.x,i),rr(e.y,t.y,s.y,i)}function Vu(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Fu={duration:.45,ease:[.4,0,.1,1]},ar=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),or=ar("applewebkit/")&&!ar("chrome/")?Math.round:Ke;function lr(e){e.min=or(e.min),e.max=or(e.max)}function Ou(e){lr(e.x),lr(e.y)}function Ga(e,t,s){return e==="position"||e==="preserve-aspect"&&!Bd(Qi(t),Qi(s),.2)}function $u(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const zu=Xa({attachResizeListener:(e,t)=>Jt(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),zs={current:void 0},qa=Xa({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!zs.current){const e=new zu({});e.mount(window),e.setOptions({layoutScroll:!0}),zs.current=e}return zs.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Bu={pan:{Feature:iu},drag:{Feature:nu,ProjectionNode:qa,MeasureLayout:Ba}};function cr(e,t,s){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover",s==="Start");const r="onHover"+s,l=i[r];l&&Se.postRender(()=>l(t,ts(t)))}class Uu extends pt{mount(){const{current:t}=this.node;t&&(this.unmount=Bl(t,s=>(cr(this.node,s,"Start"),i=>cr(this.node,i,"End"))))}unmount(){}}class Hu extends pt{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=es(Jt(this.node.current,"focus",()=>this.onFocus()),Jt(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function dr(e,t,s){const{props:i}=e;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap",s==="Start");const r="onTap"+(s==="End"?"":s),l=i[r];l&&Se.postRender(()=>l(t,ts(t)))}class Wu extends pt{mount(){const{current:t}=this.node;t&&(this.unmount=Kl(t,s=>(dr(this.node,s,"Start"),(i,{success:r})=>dr(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const on=new WeakMap,Bs=new WeakMap,Ku=e=>{const t=on.get(e.target);t&&t(e)},Yu=e=>{e.forEach(Ku)};function Xu({root:e,...t}){const s=e||document;Bs.has(s)||Bs.set(s,{});const i=Bs.get(s),r=JSON.stringify(t);return i[r]||(i[r]=new IntersectionObserver(Yu,{root:e,...t})),i[r]}function Gu(e,t,s){const i=Xu(t);return on.set(e,s),i.observe(e),()=>{on.delete(e),i.unobserve(e)}}const qu={some:0,all:1};class Ju extends pt{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:i,amount:r="some",once:l}=t,o={root:s?s.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:qu[r]},a=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,l&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:f}=this.node.getProps(),m=d?u:f;m&&m(c)};return Gu(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(Zu(t,s))&&this.startObserver()}unmount(){}}function Zu({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}const Qu={inView:{Feature:Ju},tap:{Feature:Wu},focus:{Feature:Hu},hover:{Feature:Uu}},eh={layout:{ProjectionNode:qa,MeasureLayout:Ba}},ln={current:null},Ja={current:!1};function th(){if(Ja.current=!0,!!yn)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>ln.current=e.matches;e.addListener(t),t()}else ln.current=!1}const sh=[...ja,$e,mt],nh=e=>sh.find(wa(e)),ur=new WeakMap;function ih(e,t,s){for(const i in t){const r=t[i],l=s[i];if(ze(r))e.addValue(i,r);else if(ze(l))e.addValue(i,Gt(r,{owner:e}));else if(l!==r)if(e.hasValue(i)){const o=e.getValue(i);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=e.getStaticValue(i);e.addValue(i,Gt(o!==void 0?o:r,{owner:e}))}}for(const i in s)t[i]===void 0&&e.removeValue(i);return t}const hr=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class rh{scrapeMotionValuesFromProps(t,s,i){return{}}constructor({parent:t,props:s,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:l,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Wn,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const y=nt.now();this.renderScheduledAt<y&&(this.renderScheduledAt=y,Se.render(this.render,!1,!0))};const{latestValues:c,renderState:d,onUpdate:u}=o;this.onUpdate=u,this.latestValues=c,this.baseTarget={...c},this.initialValues=s.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=s,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!l,this.isControllingVariants=ks(s),this.isVariantNode=Pr(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:f,...m}=this.scrapeMotionValuesFromProps(s,{},this);for(const y in m){const _=m[y];c[y]!==void 0&&ze(_)&&_.set(c[y],!1)}}mount(t){this.current=t,ur.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,i)=>this.bindToMotionValue(i,s)),Ja.current||th(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:ln.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){ur.delete(this.current),this.projection&&this.projection.unmount(),ft(this.notifyUpdate),ft(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const i=St.has(t),r=s.on("change",a=>{this.latestValues[t]=a,this.props.onUpdate&&Se.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),l=s.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{r(),l(),o&&o(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in It){const s=It[t];if(!s)continue;const{isEnabled:i,Feature:r}=s;if(!this.features[t]&&r&&i(this.props)&&(this.features[t]=new r(this)),this.features[t]){const l=this.features[t];l.isMounted?l.update():(l.mount(),l.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ee()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let i=0;i<hr.length;i++){const r=hr[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const l="on"+r,o=t[l];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=ih(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const i=this.values.get(t);s!==i&&(i&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let i=this.values.get(t);return i===void 0&&s!==void 0&&(i=Gt(s===null?void 0:s,{owner:this}),this.addValue(t,i)),i}readValue(t,s){var i;let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(i=this.getBaseTargetFromProps(this.props,t))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(va(r)||da(r))?r=parseFloat(r):!nh(r)&&mt.test(s)&&(r=xa(t,s)),this.setBaseTarget(t,ze(r)?r.get():r)),ze(r)?r.get():r}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const o=Tn(this.props,i,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);o&&(r=o[t])}if(i&&r!==void 0)return r;const l=this.getBaseTargetFromProps(this.props,t);return l!==void 0&&!ze(l)?l:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new On),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class Za extends rh{constructor(){super(...arguments),this.KeyframeResolver=Na}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:i}){delete s[t],delete i[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ze(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function ah(e){return window.getComputedStyle(e)}class oh extends Za{constructor(){super(...arguments),this.type="html",this.renderInstance=Or}readValueFromInstance(t,s){if(St.has(s)){const i=Hn(s);return i&&i.default||0}else{const i=ah(t),r=(Lr(s)?i.getPropertyValue(s):i[s])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(t,{transformPagePoint:s}){return $a(t,s)}build(t,s,i){_n(t,s,i.transformTemplate)}scrapeMotionValuesFromProps(t,s,i){return In(t,s,i)}}class lh extends Za{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ee}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(St.has(s)){const i=Hn(s);return i&&i.default||0}return s=$r.has(s)?s:jn(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,i){return Ur(t,s,i)}build(t,s,i){An(t,s,this.isSVGTag,i.transformTemplate)}renderInstance(t,s,i,r){zr(t,s,i,r)}mount(t){this.isSVGTag=En(t.tagName),super.mount(t)}}const ch=(e,t)=>Sn(e)?new lh(t):new oh(t,{allowProjection:e!==h.Fragment}),dh=Dl({...Md,...Qu,...Bu,...eh},ch),it=qo(dh),uh=({title:e,onFilterClick:t,showAdd:s=!0,variant:i="default"})=>{const r=i==="overlay";return n.jsxs("div",{className:r?"fixed top-0 left-0 right-0 z-30 px-6 py-4 bg-gradient-to-b from-pink-200/60 via-purple-200/40 to-transparent backdrop-blur-sm flex justify-between items-center pointer-events-none":"sticky top-0 z-20 px-6 py-4 bg-primary-50/80 backdrop-blur-md flex justify-between items-center transition-all",children:[n.jsx("div",{className:r?"text-2xl font-bold text-slate-800 tracking-tight flex items-center opacity-0":"text-2xl font-bold text-slate-800 tracking-tight flex items-center",children:e}),n.jsx("div",{className:r?"flex gap-4 opacity-0":"flex gap-4",children:s&&n.jsx("button",{onClick:()=>{try{Ze(".",{:""})}catch{}t==null||t()},className:"p-2 rounded-full bg text-primary-500 shadow-sm hover:shadow-md transition-all active:scale-95","aria-label":"",children:n.jsx(ht,{size:20})})})]})};var qe=(e=>(e.ONLINE="",e.OFFLINE="",e.BUSY="",e))(qe||{}),at=(e=>(e.TEXT="text",e.SYSTEM="system",e))(at||{}),we=(e=>(e.HOME="home",e.CHAT="chat",e.ME="me",e))(we||{});const hh=({activeTab:e,onTabChange:t})=>{const s=i=>`flex flex-col items-center justify-center w-full h-full transition-all duration-300 ${e===i?"text-primary-600 scale-105":"text-slate-400 hover:text-primary-400"}`;return n.jsx("div",{className:"fixed bottom-0 inset-x-0 z-30",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-20 bg-white/90 backdrop-blur-lg border-t border-primary-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] flex justify-around items-center px-4 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[n.jsxs("button",{className:s(we.HOME),onClick:()=>{t(we.HOME);try{Ze("."),_e("","")}catch{}},children:[n.jsx(So,{size:24,strokeWidth:e===we.HOME?2.5:2}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]}),n.jsxs("button",{className:s(we.CHAT),onClick:()=>{t(we.CHAT);try{Ze("."),_e("","")}catch{}},children:[n.jsxs("div",{className:"relative",children:[n.jsx(fn,{size:24,strokeWidth:e===we.CHAT?2.5:2}),n.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-400 rounded-full border-2 border-white"})]}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]}),n.jsxs("button",{className:s(we.ME),onClick:()=>{t(we.ME);try{Ze("."),_e("","")}catch{}},children:[n.jsx(cn,{size:24,strokeWidth:e===we.ME?2.5:2}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]})]})})},fr=({chat:e,onClick:t,onTogglePin:s,roundedClass:i})=>{var c;const r=d=>d.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1}),[l,o]=h.useState(!1),a=d=>{d.stopPropagation(),s()};return n.jsxs("div",{onClick:t,className:`group relative flex items-center gap-4 p-4 bg-white ${i||"rounded-2xl"} shadow-sm border border-transparent hover:border-primary-100 hover:shadow-md active:scale-[0.98] transition-all duration-200 cursor-pointer`,children:[n.jsx("div",{className:"relative flex-shrink-0",children:n.jsx("div",{className:"w-14 h-14 rounded-full p-0.5 bg-gradient-to-tr from-primary-300 to-accent-pink",children:!l&&e.character.avatar?n.jsx("img",{src:e.character.avatar,alt:e.character.name,onError:()=>o(!0),className:"w-full h-full rounded-full object-cover border-2 border-white"}):n.jsx("div",{className:"w-full h-full rounded-full border-2 border-white bg-white flex items-center justify-center text-slate-500 font-bold",children:((c=e.character.name)==null?void 0:c[0])||"?"})})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("h3",{className:"font-bold text-slate-800 text-lg truncate",children:e.character.name})}),n.jsx("span",{className:"text-xs text-slate-400 font-medium whitespace-nowrap ml-2",children:r(e.lastMessage.timestamp)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("p",{className:"text-slate-500 text-sm truncate pr-4 leading-relaxed",children:[e.lastMessage.senderId==="user"&&n.jsx("span",{className:"text-slate-400",children:": "}),e.lastMessage.text]}),n.jsxs("div",{className:"flex gap-2 items-center flex-shrink-0",children:[n.jsx("button",{onClick:a,className:`w-6 h-6 flex items-center justify-center rounded-full transition-all ${e.character.isPinned?"bg-primary-50 text-primary-400":"text-slate-200 hover:text-primary-300"}`,children:n.jsx(Fo,{size:14,className:`transform rotate-45 ${e.character.isPinned?"fill-primary-400":""}`})}),e.unreadCount>0&&n.jsx("span",{className:"flex items-center justify-center min-w-[20px] h-5 px-1.5 bg-red-400 text-white text-[10px] font-bold rounded-full",children:e.unreadCount})]})]})]})]})},fh=({chats:e,onChatClick:t,onTogglePin:s,onDeleteChat:i,isDetailOpen:r=!1})=>{const l=(navigator==null?void 0:navigator.maxTouchPoints)>0,o=e.filter(A=>A.character.isPinned),a=e.filter(A=>!A.character.isPinned),[c,d]=h.useState({}),[u,f]=h.useState(null),m=h.useRef(0),y=h.useRef(0),_=h.useRef(null),[N,E]=h.useState({visible:!1,x:0,y:0,id:null});h.useEffect(()=>{try{const A=localStorage.getItem("user_id")||"0",V=localStorage.getItem("user_username")||A,R=localStorage.getItem("user_nickname")||"";tt({userId:V,pageId:"CHAT_LIST",name:R}),_e("","")}catch{}},[]);const b=(A,V)=>{m.current=A.touches[0].clientX,y.current=A.touches[0].clientY,_.current=V},k=(A,V)=>{if(_.current!==V)return;const R=A.touches[0].clientX-m.current,G=A.touches[0].clientY-y.current;if(Math.abs(G)>Math.abs(R))return;const O=Math.max(-96,Math.min(0,R));d(U=>({...U,[V]:O}))},T=A=>{if(_.current!==A)return;const R=(c[A]||0)<-60?-96:0;d(G=>({...G,[A]:R})),_.current=null},$=A=>d(V=>({...V,[A]:0})),S=(A,V)=>{if(A.preventDefault(),l)return;let R=A.clientX;const G=120;R+G>window.innerWidth&&(R=window.innerWidth-G-10),E({visible:!0,x:R,y:A.clientY,id:V})};return n.jsxs(it.div,{className:"px-6 pb-24 animate-in fade-in slide-in-from-bottom-4 duration-700",initial:{x:0},animate:r&&l?{x:"-100%"}:{x:0},transition:r&&l?{duration:.3,ease:"linear"}:{duration:0},children:[o.length>0&&n.jsxs("div",{className:"mb-6",children:[n.jsx("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 px-1",children:""}),o.map(A=>n.jsxs("div",{className:"relative overflow-hidden mb-3 rounded-2xl",children:[(()=>{const V=Math.min(96,Math.max(0,-(c[A.characterId]||0)));return n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${V}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>f(A.characterId),className:"text-white font-bold drop-shadow-sm",children:""})})})(),n.jsx("div",{onTouchStart:V=>b(V,A.characterId),onTouchMove:V=>k(V,A.characterId),onTouchEnd:()=>T(A.characterId),onContextMenu:V=>S(V,A.characterId),style:{transform:`translateX(${c[A.characterId]||0}px)`,transition:"transform 180ms ease"},children:n.jsx(fr,{chat:A,onClick:()=>t(A),onTogglePin:()=>s(A.characterId),roundedClass:(c[A.characterId]||0)<0?"rounded-l-2xl rounded-r-none":"rounded-2xl"})})]},A.characterId))]}),a.length>0&&n.jsxs("div",{children:[n.jsx("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 px-1",children:""}),a.map(A=>n.jsxs("div",{className:"relative overflow-hidden mb-3 rounded-2xl",children:[(()=>{const V=Math.min(96,Math.max(0,-(c[A.characterId]||0)));return n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${V}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>f(A.characterId),className:"text-white font-bold drop-shadow-sm",children:""})})})(),n.jsx("div",{onTouchStart:V=>b(V,A.characterId),onTouchMove:V=>k(V,A.characterId),onTouchEnd:()=>T(A.characterId),onContextMenu:V=>S(V,A.characterId),style:{transform:`translateX(${c[A.characterId]||0}px)`,transition:"transform 180ms ease"},children:n.jsx(fr,{chat:A,onClick:()=>t(A),onTogglePin:()=>s(A.characterId),roundedClass:(c[A.characterId]||0)<0?"rounded-l-2xl rounded-r-none":"rounded-2xl"})})]},A.characterId))]}),u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{$(u),f(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{const A=u;f(null),i(A)},children:""})]})]})}),n.jsx("style",{children:`
        @keyframes fadeCard { from { opacity: 0; transform: translateY(-6px) } to { opacity: 1; transform: translateY(0) } }
        @keyframes fadeBg { from { opacity: 0 } to { opacity: 1 } }
      `})]}),e.length===0&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[n.jsx("p",{className:"text-slate-500 font-medium",children:""}),n.jsx("p",{className:"text-slate-400 text-sm mt-1",children:""})]}),N.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>E(A=>({...A,visible:!1})),onContextMenu:A=>{A.preventDefault(),E(V=>({...V,visible:!1}))}}),n.jsx("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95 duration-100",style:{top:N.y,left:N.x},children:n.jsx("button",{onClick:()=>{N.id&&f(N.id),E(A=>({...A,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 transition-colors",children:""})})]})]})},mh={type:"tween",ease:"easeInOut",duration:.28},Qa={type:"tween",ease:"linear",duration:.28},Gn={duration:.18},eo="/api",ph={async login(e,t){const s=await fetch(`${eo}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});let i=null;try{i=await s.json()}catch{i=null}return{ok:s.ok,status:s.status,data:i}}},xh=()=>localStorage.getItem("user_access_token")||"",gh=()=>localStorage.getItem("user_refresh_token")||"",yh=async()=>{const e=gh();if(!e)return!1;try{const t=await fetch(`${eo}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!t.ok)return!1;const s=await t.json(),i=(s==null?void 0:s.access_token)||"";if(!i)return!1;try{localStorage.setItem("user_access_token",i)}catch{}return!0}catch{return!1}},qn=e=>e==="male"?"":e==="female"?"":"",vh=async e=>{const t={name:(e==null?void 0:e.name)||"",age:parseInt((e==null?void 0:e.age)||"0")||null,gender:qn(e==null?void 0:e.gender),profession:(e==null?void 0:e.profession)||null,basic_info:(e==null?void 0:e.basicInfo)||null,personality:(e==null?void 0:e.personality)||null,avatar:(e==null?void 0:e.avatar)||null},{authFetch:s}=await ye(async()=>{const{authFetch:l}=await import("./http-Dwii6HrH.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3])),i=await s("/user/chat-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error("create_role_failed");return(await i.json()).id},bh=async(e,t)=>{const s={name:(t==null?void 0:t.name)||"",age:parseInt((t==null?void 0:t.age)||"0")||null,gender:qn(t==null?void 0:t.gender),profession:(t==null?void 0:t.profession)||null,basic_info:(t==null?void 0:t.basicInfo)||null,personality:(t==null?void 0:t.personality)||null,avatar:(t==null?void 0:t.avatar)||null},{authFetch:i}=await ye(async()=>{const{authFetch:l}=await import("./http-Dwii6HrH.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3]));if(!(await i(`/user/chat-role/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("update_role_failed");return!0},wh=async()=>{const{authFetch:e}=await ye(async()=>{const{authFetch:i}=await import("./http-Dwii6HrH.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),t=await e("/user/chat-role",{method:"GET"});if(!t.ok)throw new Error("fetch_roles_failed");const s=await t.json();return Array.isArray(s)?s:[]},jh=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:i}=await import("./http-Dwii6HrH.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user/chat-role/${e}`,{method:"DELETE"})).ok)throw new Error("delete_role_failed");return!0},us=async(e,t)=>{const s={character_id:Number(e)};typeof t=="number"&&(s.user_chat_role_id=t);const{authFetch:i}=await ye(async()=>{const{authFetch:o}=await import("./http-Dwii6HrH.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),r=await i("/chat/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("create_session_failed");const l=await r.json();return typeof l=="string"?{sessionId:l}:{sessionId:l.sessionId,model:l.model,temperature:l.temperature}},as=(e,t,s)=>{const l=`${`${location.protocol==="https:"?"wss":"ws"}://${location.host}`}/ws/chat`;console.log("[ws] connecting",l);let o=null,a=!1,c=1e3;const d=1e4,u=[],f=()=>{const N=xh(),E=N?`${l}?token=${encodeURIComponent(N)}`:l;o=new WebSocket(E),o.onmessage=b=>{try{const k=JSON.parse(String(b.data));if(k&&k.type==="assistant_message"&&typeof k.content=="string")t(k.content,k.quote,{chunkIndex:k.chunkIndex,chunkTotal:k.chunkTotal});else if(k&&k.type==="force_logout"){try{s&&s(k)}catch{}a=!0;try{o==null||o.close(1008,"account_disabled")}catch{}}}catch{}},o.onerror=b=>{console.error("[ws] error",b)},o.onopen=()=>{for(console.log("[ws] open"),c=1e3;u.length;){const k=u.shift();try{o==null||o.send(JSON.stringify(k))}catch{}}const b={type:"typing",sessionId:e,typing:!1};try{o==null||o.send(JSON.stringify(b))}catch{}},o.onclose=async b=>{if(console.log("[ws] closed"),a)return;if(b&&(b.code===1008||String(b.reason||"").toLowerCase().includes("unauthorized"))){if(await yh()){c=1e3,f();return}try{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token")}catch{}try{window.location.reload()}catch{}return}setTimeout(f,c),c=Math.min(c*2,d)}};return f(),{ws:o,sendText:(N,E,b,k,T)=>{const $={sessionId:e,text:N,chatMode:E};b&&($.userRole={name:b.name,gender:qn(b.gender),age:b.age||"",profession:b.profession||"",basic_info:b.basicInfo||"",personality:b.personality||"",avatar:b.avatar||""}),k&&($.model_id=k),typeof T=="number"&&($.temperature=T),o&&o.readyState===WebSocket.OPEN?o.send(JSON.stringify($)):u.push($)},sendTyping:N=>{const E={type:"typing",sessionId:e,typing:N};o&&o.readyState===WebSocket.OPEN?o.send(JSON.stringify(E)):u.push(E)},close:()=>{a=!0;try{o==null||o.close()}catch{}}}},Nh=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:l}=await import("./http-Dwii6HrH.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3])),s=await t(`/chat/sessions/${e}`,{method:"GET"});if(!s.ok){if(s.status===404){const l=new Error("session_not_found");throw l.status=404,l}throw new Error("get_session_failed")}const i=await s.json(),r=(i==null?void 0:i.session)||{};return{model:r==null?void 0:r.model,temperature:r==null?void 0:r.temperature}},As=({imageSrc:e,onCrop:t,onCancel:s,aspectRatio:i,outputWidth:r,outputHeight:l})=>{const[o,a]=h.useState(1),[c,d]=h.useState({x:0,y:0}),[u,f]=h.useState(!1),[m,y]=h.useState({x:0,y:0}),[_,N]=h.useState(e),[E,b]=h.useState(!1),[k,T]=h.useState(!1),[$,S]=h.useState(!0),A=h.useRef(null),V=h.useRef(null),R=h.useRef(null),G=h.useRef(null),O=i&&i>0?i:1,[U,le]=h.useState(Math.round(300*O)),[ne,C]=h.useState(300);h.useEffect(()=>{const H=()=>{const ee=V.current?V.current.clientWidth:window.innerWidth,me=V.current?V.current.clientHeight:window.innerHeight;let oe=Math.min(Math.floor(ee*.9),700),xe=Math.round(oe/O);const ve=Math.max(180,Math.min(me-160,380));xe>ve&&(xe=ve,oe=Math.round(xe*O)),le(oe),C(xe)};return H(),window.addEventListener("resize",H),()=>window.removeEventListener("resize",H)},[O]),h.useEffect(()=>{const H=setTimeout(()=>b(!0),400);return()=>clearTimeout(H)},[]),h.useEffect(()=>{if(!E||!k){S(!0);return}const ee=setTimeout(()=>S(!1),200);return()=>clearTimeout(ee)},[E,k]),h.useEffect(()=>{let H=!1;const ee=new Image;return ee.onload=()=>{const me=document.createElement("canvas");me.width=ee.naturalWidth,me.height=ee.naturalHeight;const oe=me.getContext("2d");if(!oe){H||N(e);return}oe.drawImage(ee,0,0);try{const xe=me.toDataURL("image/jpeg",.92);H||N(xe)}catch{H||N(e)}},ee.onerror=()=>{H||N(e)},ee.src=e,()=>{H=!0}},[e]);const F=H=>{f(!0);const ee="touches"in H?H.touches[0].clientX:H.clientX,me="touches"in H?H.touches[0].clientY:H.clientY;y({x:ee-c.x,y:me-c.y})},J=H=>{if(!u)return;H.preventDefault();const ee="touches"in H?H.touches[0].clientX:H.clientX,me="touches"in H?H.touches[0].clientY:H.clientY;d({x:ee-m.x,y:me-m.y})},Y=()=>{f(!1)},se=()=>{const H=R.current,ee=A.current;if(!H||!ee)return;const me=H.getContext("2d");if(!me)return;const oe=r&&r>0?r:300,xe=l&&l>0?l:Math.round(oe/O);H.width=oe,H.height=xe;const ve=ee.naturalWidth,w=ee.naturalHeight,z=Math.max(U/ve,ne/w),L=oe/U,ie=xe/ne;me.fillStyle="#000",me.fillRect(0,0,oe,xe),me.translate(oe/2,xe/2),me.translate(c.x*L,c.y*ie),me.scale(o*L,o*ie),me.scale(z,z),me.drawImage(ee,-ve/2,-w/2);try{Ze(".")}catch{}t(H.toDataURL("image/jpeg",.9))};return n.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center animate-in fade-in duration-300",children:[n.jsxs("div",{className:"absolute top-0 w-full p-4 flex justify-between items-center z-20 text-white",children:[n.jsx("button",{onClick:()=>{try{Ze(".")}catch{}s()},className:"p-2 bg-white/10 rounded-full",children:n.jsx(jt,{size:24})}),n.jsx("h3",{className:"font-bold text-lg tracking-wider",children:""}),n.jsx("button",{onClick:se,className:"p-2 bg-purple-500 rounded-full text-white shadow-lg shadow-purple-500/30",children:n.jsx(jr,{size:24})})]}),n.jsxs("div",{ref:V,className:"relative w-full h-full overflow-hidden bg-black flex items-center justify-center touch-none select-none",style:{isolation:"isolate"},onMouseDown:F,onMouseMove:J,onMouseUp:Y,onMouseLeave:Y,onTouchStart:F,onTouchMove:J,onTouchEnd:Y,children:[n.jsx("img",{ref:A,src:_,alt:"Crop target",className:"absolute max-w-none transition-transform duration-75 ease-linear pointer-events-none",style:{transform:`translate(${c.x}px, ${c.y}px) scale(${o}) translateZ(0)`,height:"auto",width:U,willChange:"transform",backfaceVisibility:"hidden"},onLoad:()=>T(!0),draggable:!1}),n.jsxs("div",{className:"absolute inset-0 pointer-events-none z-10",children:[n.jsx("div",{className:"absolute top-0 left-0 right-0 bg-black/80",style:{height:`calc(50% - ${ne/2}px)`}}),n.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/80",style:{height:`calc(50% - ${ne/2}px)`}}),n.jsx("div",{className:"absolute left-0 bg-black/80",style:{top:`calc(50% - ${ne/2}px)`,bottom:`calc(50% - ${ne/2}px)`,width:`calc(50% - ${U/2}px)`}}),n.jsx("div",{className:"absolute right-0 bg-black/80",style:{top:`calc(50% - ${ne/2}px)`,bottom:`calc(50% - ${ne/2}px)`,width:`calc(50% - ${U/2}px)`}}),n.jsx("div",{ref:G,className:"absolute border-2 border-white box-content",style:{width:U,height:ne,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:n.jsxs("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 opacity-30",children:[n.jsx("div",{className:"border-r border-white"}),n.jsx("div",{className:"border-r border-white"}),n.jsx("div",{className:"border-b border-white col-span-3 row-start-1"}),n.jsx("div",{className:"border-b border-white col-span-3 row-start-2"})]})})]})]}),n.jsx("div",{className:"absolute bottom-0 w-full bg-slate-900/80 p-6 pb-10 flex flex-col gap-4 z-20",children:n.jsxs("div",{className:"flex items-center gap-4 text-white justify-center",children:[n.jsx(Mo,{size:20,className:"text-slate-400"}),n.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.05",value:o,onChange:H=>a(parseFloat(H.target.value)),className:"w-64 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-purple-500"}),n.jsx(ht,{size:20,className:"text-slate-400"})]})}),n.jsx("canvas",{ref:R,className:"hidden"}),$&&n.jsx("div",{className:`fixed inset-0 z-[120] bg-black flex items-center justify-center transition-opacity duration-300 ${!E||!k?"opacity-100":"opacity-0"}`,style:{pointerEvents:!E||!k?"auto":"none"},children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})})]})},to=({currentPersona:e,roleId:t,onBack:s,onSave:i,withinContainer:r=!1})=>{const[l,o]=h.useState((e==null?void 0:e.gender)||"female"),[a,c]=h.useState((e==null?void 0:e.name)||""),[d,u]=h.useState((e==null?void 0:e.age)||""),[f,m]=h.useState((e==null?void 0:e.profession)||""),[y,_]=h.useState((e==null?void 0:e.basicInfo)||""),[N,E]=h.useState((e==null?void 0:e.personality)||""),[b,k]=h.useState(e==null?void 0:e.avatar),[T,$]=h.useState(null),[S,A]=h.useState(!1),[V,R]=h.useState(!1),G=h.useRef(null),O=C=>{var ee;const F=C.split(","),J=((ee=F[0].match(/:(.*?);/))==null?void 0:ee[1])||"image/jpeg",Y=atob(F[1]);let se=Y.length;const H=new Uint8Array(se);for(;se--;)H[se]=Y.charCodeAt(se);return new Blob([H],{type:J})},U=async()=>{if(V)return;R(!0);const C=localStorage.getItem("user_access_token");let F=b;try{if(b&&b.startsWith("data:image")){const Y=O(b),se=new FormData,H=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;se.append("avatar",Y,"avatar.jpg"),se.append("filename",H),F=`/uploads/users/avatars/${H}`,fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:C?`Bearer ${C}`:""},body:se}).catch(()=>{})}const J={gender:l,name:a,age:d,profession:f,basicInfo:y,personality:N,avatar:F||void 0};typeof t=="number"?await bh(t,J):await vh(J)}catch{}i({gender:l,name:a,age:d,profession:f,basicInfo:y,personality:N,avatar:F});try{Ze(".",{:a})}catch{}R(!1),s()},le=()=>{var C;(C=G.current)==null||C.click()},ne=C=>{var J;const F=(J=C.target.files)==null?void 0:J[0];if(F){A(!0);const Y=new FileReader;Y.onloadend=()=>{$(Y.result),A(!1)},Y.readAsDataURL(F)}G.current&&(G.current.value="")};return n.jsxs("div",{className:`${r?"absolute":"fixed"} inset-0 z-[80]`,children:[n.jsx(it.div,{className:"absolute inset-0 bg-[#F8F9FA]",initial:{opacity:0},animate:{opacity:1},transition:Gn}),n.jsxs(it.div,{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)] flex flex-col h-[92vh] w-full overflow-y-auto no-scrollbar",initial:{y:"100%"},animate:{y:0},transition:Qa,children:[T&&n.jsx(As,{imageSrc:T,onCancel:()=>$(null),onCrop:C=>{k(C),$(null)}}),n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm border-b border-slate-100 rounded-none md:rounded-t-3xl",children:[n.jsx("button",{onClick:s,className:"p-2 -ml-2 text-slate-800 hover:bg-slate-50 rounded-full transition-colors",children:n.jsx(bs,{size:24})}),n.jsx("button",{onClick:U,disabled:V,className:`px-4 py-1.5 rounded-lg text-sm font-bold transition-transform ${V?"bg-purple-200 text-white cursor-not-allowed":"bg-purple-50 text-purple-600 active:scale-95"}`,children:""})]}),n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white p-4 space-y-3 pb-10 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[n.jsx("div",{className:"flex justify-center py-6",children:n.jsxs("div",{onClick:le,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-24 h-24 rounded-full bg-pink-200 flex items-center justify-center text-white shadow-sm border-4 border-white overflow-hidden",children:b?n.jsx("img",{src:b,alt:"User Avatar",className:"w-full h-full object-cover"}):n.jsx(cn,{size:48,fill:"currentColor"})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-white p-2 rounded-full shadow-md border border-slate-100",children:n.jsx(oo,{size:14,className:"text-slate-400"})}),n.jsx("input",{type:"file",ref:G,className:"hidden",accept:"image/*",onChange:ne})]})}),S&&n.jsx("div",{className:"fixed inset-0 z-[90] bg-black flex items-center justify-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-4",children:""}),n.jsxs("div",{className:"flex gap-6",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${l==="male"?"border-blue-500":"border-slate-300"}`,children:l==="male"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"male",checked:l==="male",onChange:()=>o("male"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${l==="female"?"border-blue-500":"border-slate-300"}`,children:l==="female"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"female",checked:l==="female",onChange:()=>o("female"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${l==="secret"?"border-blue-500":"border-slate-300"}`,children:l==="secret"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"secret",checked:l==="secret",onChange:()=>o("secret"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]})]})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:" ()"}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:a,onChange:C=>c(C.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:d,onChange:C=>u(C.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:f,onChange:C=>m(C.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("textarea",{placeholder:"...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:y,onChange:C=>_(C.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("textarea",{placeholder:"...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:N,onChange:C=>E(C.target.value)})]})]})]})]})},mr=e=>e===""?"male":e===""?"female":"secret",Sh=({isOpen:e,currentPersona:t,onClose:s,onAdd:i,onSelect:r,onEdit:l,characterId:o})=>{const[a,c]=h.useState([]),[d,u]=h.useState(null),[f,m]=h.useState({}),y=h.useRef(0),_=h.useRef(0),N=h.useRef(null),E=h.useRef(0),[b,k]=h.useState(null),T=(navigator==null?void 0:navigator.maxTouchPoints)>0,[$,S]=h.useState({visible:!1,x:0,y:0,id:null});h.useEffect(()=>{e&&((async()=>{try{const F=await wh();c(F)}catch{}})(),m({}))},[e]),h.useEffect(()=>{if(!a.length)return;let C;if(o!=null)try{const J=localStorage.getItem(`chat_config_${String(o)}`);if(J){const Y=JSON.parse(J);Y&&Y.persona&&(C=Y.persona)}}catch{}const F=C==null?void 0:C.name;if(F){const J=a.find(Y=>Y.name===F);if(J){u(J.id);return}}u(null)},[a,o]);const A=C=>{u(C.id);const F={name:C.name||"",gender:mr(C.gender),age:C.age?String(C.age):"",profession:C.profession||"",basicInfo:C.basic_info||"",personality:C.personality||"",avatar:C.avatar||void 0};try{localStorage.setItem("user_chat_role_id",String(C.id))}catch{}try{Ze(".",{:F.name,ID:C.id}),_e("",F.name)}catch{}r(F,C.id),s()},V=C=>{le(C.id);const F={name:C.name||"",gender:mr(C.gender),age:C.age?String(C.age):"",profession:C.profession||"",basicInfo:C.basic_info||"",personality:C.personality||"",avatar:C.avatar||void 0};try{Ze(".",{ID:C.id,:F.name})}catch{}l&&l(F,C.id),s()},R=(C,F)=>{if(C.preventDefault(),T)return;let J=C.clientX;const Y=140;J+Y>window.innerWidth&&(J=window.innerWidth-Y-10),S({visible:!0,x:J,y:C.clientY,id:F})},G=(C,F)=>{y.current=C.touches[0].clientX,_.current=C.touches[0].clientY,N.current=F,E.current=f[F]||0},O=(C,F)=>{if(N.current!==F)return;const J=C.touches[0].clientX-y.current,Y=C.touches[0].clientY-_.current;if(Math.abs(Y)>Math.abs(J))return;let se=0;E.current===0?se=Math.max(-96,Math.min(96,J)):E.current>0?se=Math.max(0,Math.min(96,E.current+J)):se=Math.min(0,Math.max(-96,E.current+J)),m(H=>({...H,[F]:se}))},U=C=>{if(N.current!==C)return;const F=f[C]||0;let J=0;E.current===0?J=F>60?96:F<-60?-96:0:E.current>0?J=F>60?96:0:J=F<-60?-96:0,m(Y=>({...Y,[C]:J})),N.current=null},le=C=>m(F=>({...F,[C]:0})),ne=async C=>{k(null);try{await jh(C),c(F=>F.filter(J=>J.id!==C))}catch{}};return n.jsxs("div",{className:`fixed inset-0 z-[90] ${e?"":"pointer-events-none"}`,children:[n.jsx(zt,{children:e&&n.jsxs(n.Fragment,{children:[n.jsx(it.div,{className:"absolute inset-0 bg-black/30 will-change-opacity",onClick:s,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:Gn},"backdrop"),n.jsx(it.div,{className:"absolute bottom-0 left-0 right-0 bg-transparent will-change-transform transform-gpu",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:Qa,children:n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)]",children:[n.jsxs("div",{className:"sticky top-0 bg-white/95 backdrop-blur-md p-3 border-b border-slate-100 flex justify-between items-center z-10",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-2",children:[n.jsx(bs,{className:"w-6 h-6"}),n.jsx("span",{className:"font-bold text-lg",children:""})]}),n.jsx("button",{onClick:i,className:"w-9 h-9 rounded-full bg-purple-50 text-[#A855F7] flex items-center justify-center active:scale-90 transition-transform",children:n.jsx(ht,{className:"w-6 h-6"})})]}),n.jsxs("div",{className:"p-4 flex flex-col gap-3 max-h-[70vh] overflow-y-auto",children:[a.map(C=>n.jsxs("div",{className:"relative overflow-hidden rounded-xl",children:[(()=>{const F=f[C.id]||0,J=Math.min(96,Math.max(0,-F)),Y=Math.min(96,Math.max(0,F));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-xl shadow-sm",style:{width:`${J}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>k(C.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-xl shadow-sm",style:{width:`${Y}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>V(C),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onClick:()=>{(f[C.id]||0)===0&&A(C)},onTouchStart:F=>G(F,C.id),onTouchMove:F=>O(F,C.id),onTouchEnd:()=>U(C.id),onContextMenu:F=>R(F,C.id),className:`${(f[C.id]||0)<0?"rounded-l-xl rounded-r-none":(f[C.id]||0)>0?"rounded-l-none rounded-r-xl":"rounded-xl"} p-4 bg-white shadow-sm border flex items-center gap-3 active:scale-[0.98] transition-transform ${d===C.id?"border-[#A855F7] shadow-[0_0_0_6px_rgba(168,85,247,0.18)]":"border-slate-100"}`,style:{transform:`translateX(${f[C.id]||0}px)`,transition:"transform 180ms ease"},children:[n.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-slate-200 flex items-center justify-center text-slate-600 font-bold",children:C.avatar?n.jsx("img",{src:C.avatar,alt:C.name,className:"w-full h-full object-cover"}):(C.name||"")[0]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-800 truncate",children:C.name}),n.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[C.profession||"",C.age?`  ${C.age}`:""]})]}),d===C.id&&n.jsx(lo,{className:"w-5 h-5 text-[#A855F7]"})]})]},C.id)),!a.length&&n.jsxs("div",{className:"p-6 text-center text-slate-500",children:[n.jsx("div",{className:"text-sm",children:""}),n.jsx("div",{className:"mt-3",children:n.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-[#A855F7] text-white rounded-lg text-sm font-bold",children:""})})]})]})]})},"sheet")]})}),b&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[95] bg-black/20"}),n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{b!=null&&le(b),k(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{ne(b)},children:""})]})]})})]}),$.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>S(C=>({...C,visible:!1})),onContextMenu:C=>{C.preventDefault(),S(F=>({...F,visible:!1}))}}),n.jsxs("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px]",style:{top:$.y,left:$.x},children:[n.jsxs("button",{onClick:()=>{const C=a.find(F=>F.id===$.id);C&&V(C),S(F=>({...F,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[n.jsx(Ws,{className:"w-4 h-4 text-indigo-500"}),""]}),n.jsx("div",{className:"h-[1px] bg-slate-100 w-full"}),n.jsxs("button",{onClick:()=>{k($.id),S(C=>({...C,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 flex items-center gap-2",children:[n.jsx(dn,{className:"w-4 h-4"}),""]})]})]})]})},Th=({character:e,initialMessages:t,userPersona:s,onBack:i,onUpdateLastMessage:r,onOpenUserSettings:l,onShowProfile:o,onUpdateUserPersona:a})=>{const[c,d]=h.useState(t),[u,f]=h.useState("scene"),[m,y]=h.useState(""),[_,N]=h.useState(!1),[E,b]=h.useState(!1),[k,T]=h.useState(!1),[$,S]=h.useState(void 0),[A,V]=h.useState(void 0),[R,G]=h.useState(!1),[O,U]=h.useState(!1),[le,ne]=h.useState(void 0),[C,F]=h.useState(.1),[J,Y]=h.useState(void 0),[se,H]=h.useState(!1),[ee,me]=h.useState(!1),[oe,xe]=h.useState(void 0),[ve,w]=h.useState(!1),[z,L]=h.useState(!1),[ie,te]=h.useState(!1),[Ae,he]=h.useState(!1),Re=h.useRef(null),ke=h.useRef(null),He=h.useRef(null),[I,B]=h.useState(null),X=h.useRef(null),ae=(()=>{try{return localStorage.getItem("user_id")||"0"}catch{return"0"}})(),fe=`chat_history_${ae}_${e.id}`,Pe=`chat_config_${e.id}`,De=`chat_model_${e.id}`,Ie=`chat_temp_${e.id}`,Me=`chat_model_name_${e.id}`,be=h.useMemo(()=>{if(oe)return oe;try{const v=localStorage.getItem("user_nickname")||"",D=localStorage.getItem("user_avatar")||"";if(v||D)return{name:v||"",gender:"secret",age:"",profession:"",basicInfo:"",personality:"",avatar:D||void 0}}catch{}},[oe]),Le=(v,D,W)=>{d(K=>{const q=[...K];for(let je=q.length-1;je>=0;je--)if(q[je].senderId==="user"&&!q[je].read){q[je]={...q[je],read:!0};break}const ge={id:(Date.now()+1).toString(),senderId:e.id,text:v,quote:D,timestamp:new Date,type:at.TEXT};q.push(ge);try{setTimeout(()=>r(ge),0)}catch{}return q}),W&&typeof W.chunkIndex=="number"&&typeof W.chunkTotal=="number"?N(W.chunkIndex<W.chunkTotal):N(!1)},Be=()=>{var v;ke.current?ke.current.scrollTop=ke.current.scrollHeight:(v=Re.current)==null||v.scrollIntoView({behavior:"smooth"})},Ue=()=>{const v=He.current;if(v)try{const D=window.getComputedStyle(v),W=parseFloat(D.lineHeight||"22")||22,K=parseFloat(D.maxHeight||"0")||W*4;v.style.height="auto";const q=v.scrollHeight,ge=Math.min(q,K);v.style.height=`${Math.max(ge,22)}px`}catch{v.style.height="auto";const D=v.scrollHeight;v.style.height=`${Math.max(Math.min(D,96),22)}px`}};h.useEffect(()=>{Be(),Ue()},[c,_]),h.useEffect(()=>{const v=requestAnimationFrame(()=>Ue());return()=>cancelAnimationFrame(v)},[m]);const[Qe,xt]=h.useState({height:"100%",top:0});h.useEffect(()=>{const v=()=>{window.visualViewport&&(xt({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`}),ke.current&&(ke.current.scrollTop=ke.current.scrollHeight))};window.visualViewport&&(window.visualViewport.addEventListener("resize",v),window.visualViewport.addEventListener("scroll",v),v());const D=()=>{window.visualViewport||(ke.current?ke.current.scrollTop=ke.current.scrollHeight:Be())};return window.addEventListener("resize",D),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",v),window.visualViewport.removeEventListener("scroll",v)),window.removeEventListener("resize",D)}},[]),h.useEffect(()=>{try{const v=`chat_history_${e.id}`,D=localStorage.getItem(fe)||(ae==="0"?localStorage.getItem(v):null);if(D){const K=JSON.parse(D).map(q=>({id:q.id,senderId:q.senderId,text:q.text,timestamp:new Date(q.ts),type:q.type,quote:q.quote,read:q.read}));K.length&&d(K)}}catch{}},[e.id]),h.useEffect(()=>{try{const v=c.map(D=>{var W,K;return{id:D.id,senderId:D.senderId,text:D.text,ts:(K=(W=D.timestamp)==null?void 0:W.getTime)!=null&&K.call(W)?D.timestamp.getTime():Date.now(),type:D.type,quote:D.quote,read:D.read}});localStorage.setItem(fe,JSON.stringify(v))}catch{}},[c]),h.useEffect(()=>{try{const v=localStorage.getItem(Pe);if(v){const ge=JSON.parse(v);((ge==null?void 0:ge.chatMode)==="daily"||(ge==null?void 0:ge.chatMode)==="scene")&&(f(ge.chatMode),y(ge.chatMode==="scene"?"":"")),ge!=null&&ge.persona&&xe(ge.persona)}const D=localStorage.getItem(De)||void 0,W=localStorage.getItem(Ie),K=W?parseFloat(W):void 0;D&&(ne(D),H(!0)),typeof K=="number"&&!isNaN(K)&&(F(K),me(!0));const q=localStorage.getItem(Me)||void 0;q&&Y(q)}catch{}},[e.id]),h.useEffect(()=>{const v=`chat_session_${ae}_${e.id}`,D=localStorage.getItem(v)||localStorage.getItem(`chat_session_${e.id}`);return(async()=>{var K;if(D){if(B(D),!localStorage.getItem(v))try{localStorage.setItem(v,D)}catch{}try{const q=await Nh(D);if((q==null?void 0:q.temperature)!==void 0){F(q.temperature);try{localStorage.setItem(Ie,String(q.temperature))}catch{}}const ge=as(D,(je,x,M)=>{Le(je,x,M)},je=>{he(!0)});X.current=ge;return}catch(q){if(String((q==null?void 0:q.message)||"")==="session_not_found"||(q==null?void 0:q.status)===404){te(!0);return}}}try{const q=localStorage.getItem("user_chat_role_id"),ge=q?parseInt(q):void 0,je=await us(e.id,typeof ge=="number"?ge:void 0),x=je.sessionId;if(localStorage.setItem(v,x),B(x),(K=je.model)!=null&&K.id){ne(je.model.id);try{localStorage.setItem(De,je.model.id)}catch{}}if(typeof je.temperature=="number"){F(je.temperature);try{localStorage.setItem(Ie,String(je.temperature))}catch{}}const M=as(x,(p,g,j)=>{Le(p,g,j)},p=>{he(!0)});X.current=M}catch{}})(),()=>{var K;(K=X.current)==null||K.close(),X.current=null}},[e.id]);const rt=v=>{f(v),v==="scene"?!m.includes("")&&!m.includes("(")?y(D=>`${D}`):m===""&&y(""):(m===""||m==="()")&&y("");try{let D=oe||s||void 0;if(!D)try{const W=localStorage.getItem(Pe);if(W){const K=JSON.parse(W);K&&K.persona&&(D=K.persona)}}catch{}localStorage.setItem(Pe,JSON.stringify({chatMode:v,persona:D})),Ze(".",{:v==="scene"?"":""}),_e("",v==="scene"?"":"")}catch{}},dt=async()=>{var D,W;if(!m.trim()||m.trim()===""||m.trim()==="()")return;const v={id:Date.now().toString(),senderId:"user",text:m,timestamp:new Date,type:at.TEXT,read:!1};d(K=>[...K,v]);try{setTimeout(()=>r(v),0)}catch{}y(u==="scene"?"":""),N(!0);try{Ze(".",{:m.length,:u==="scene"?"":""})}catch{}try{if(!I){const K=localStorage.getItem("user_chat_role_id"),q=K?parseInt(K):void 0,je=(await us(e.id,typeof q=="number"?q:void 0)).sessionId;localStorage.setItem(`chat_session_${ae}_${e.id}`,je),B(je);const x=as(je,(M,p,g)=>{Le(M,p,g)});X.current=x}(D=X.current)==null||D.sendText(v.text,u,be,se?le:void 0,ee?C:void 0),(W=X.current)==null||W.sendTyping(!1)}catch(K){console.error(K),N(!1)}},P=v=>v.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1});return n.jsx(it.div,{className:"fixed inset-0 bg-primary-50 z-50",style:{...Qe,overscrollBehavior:"none",position:"fixed"},initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col relative bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden",children:[n.jsx("div",{className:"bg-primary-50/95 backdrop-blur-md pt-[env(safe-area-inset-top)] shadow-none z-10 border-b border-white/50 flex-shrink-0",children:n.jsxs("div",{className:"px-4 h-12 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:i,className:"p-2 -ml-2 text-slate-800 hover:bg-black/5 rounded-full transition-colors",children:n.jsx(ws,{size:24})}),n.jsx("div",{className:"flex items-center cursor-pointer active:opacity-70 transition-opacity",children:n.jsx("h2",{className:"font-bold text-slate-800 text-lg",children:_?"...":e.name})})]}),n.jsx("button",{onClick:()=>b(!0),className:"p-2 text-slate-800 hover:text-primary-600 rounded-full hover:bg-black/5 transition-all",children:n.jsx(po,{size:24})})]})}),n.jsxs("div",{ref:ke,className:"flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar bg-primary-50",style:{overflowAnchor:"none"},children:[n.jsx("div",{className:"flex justify-center my-4",children:n.jsx("span",{className:"bg-black/10 text-white text-[10px] px-3 py-1 rounded-full font-medium",children:""})}),c.map((v,D)=>{const W=v.senderId==="user";return n.jsxs("div",{className:`flex w-full ${W?"justify-end":"justify-start"} mb-4 group`,children:[!W&&n.jsx("div",{className:"flex-shrink-0 mr-3 flex flex-col items-center gap-1",children:n.jsx("div",{onClick:o,className:"w-10 h-10 rounded-full overflow-hidden bg-blue-100 flex items-center justify-center text-blue-500 font-bold border border-white cursor-pointer active:scale-95 transition-transform",children:!ve&&e.avatar?n.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full object-cover",onError:()=>w(!0)}):e.name[0]})}),n.jsxs("div",{className:`flex flex-col ${W?"items-end":"items-start"} max-w-[75%]`,children:[n.jsx("div",{className:`
                      px-4 py-3 text-[15px] shadow-sm leading-relaxed relative
                      ${W?"bg-[#A855F7] text-white rounded-[20px] rounded-tr-sm":"bg-white text-slate-800 rounded-[20px] rounded-tl-sm border border-slate-100"}
                    `,children:v.text}),!W&&v.quote&&n.jsx("div",{className:"mt-1 max-w-full",children:n.jsx("div",{className:"inline-block bg-slate-100 text-slate-500 text-xs leading-tight rounded-[12px] px-2 py-1 border border-slate-200",children:v.quote})}),n.jsxs("div",{className:`flex items-center gap-2 mt-1 ${W?"mr-1":"ml-1"}`,children:[W&&v.read&&n.jsx("span",{className:"text-[10px] text-slate-400",children:""}),n.jsx("span",{className:"text-[10px] text-slate-400",children:P(v.timestamp)})]})]}),W&&n.jsx("div",{className:"flex-shrink-0 ml-3",children:n.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-pink-200 flex items-center justify-center text-pink-600 font-bold border border-white shadow-sm",children:!z&&(be!=null&&be.avatar)?n.jsx("img",{src:be.avatar,alt:(be==null?void 0:be.name)||"",className:"w-full h-full object-cover",onError:()=>L(!0)}):be!=null&&be.name?be.name[0]:""})})]},v.id)}),n.jsx("div",{ref:Re})]}),n.jsx("div",{className:"bg-white p-3 pb-3 border-t border-slate-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] pb-[env(safe-area-inset-bottom)] mb-3 flex-shrink-0",children:n.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-[24px] px-3 py-2 border border-slate-100 shadow-[0_12px_28px_rgba(0,0,0,0.12)] transition-shadow focus-within:shadow-[0_16px_40px_rgba(0,0,0,0.16)]",children:[n.jsx("div",{className:"flex-1 flex items-center pl-2",children:n.jsx("textarea",{ref:He,value:m,onChange:v=>{var D;y(v.target.value),(D=X.current)==null||D.sendTyping(!0)},onKeyDown:v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),dt())},onFocus:()=>{Be(),setTimeout(Be,150),setTimeout(Be,300),Ue(),setTimeout(Ue,0)},onBlur:()=>{var v;return(v=X.current)==null?void 0:v.sendTyping(!1)},placeholder:"",className:"w-full bg-transparent border-none outline-none focus:ring-0 text-slate-700 text-sm p-0 resize-none max-h-24 overflow-y-auto no-scrollbar leading-5 placeholder:text-slate-400",rows:1,style:{minHeight:"22px"}})}),n.jsx("button",{onClick:dt,disabled:!m.trim()||m.trim()==="",className:`p-2 rounded-full transition-all duration-300 flex-shrink-0 flex items-center justify-center ${m.trim()&&m.trim()!==""?"bg-[#A855F7] text-white shadow-md active:scale-95":"bg-transparent text-[#A855F7]"}`,children:n.jsx(br,{size:20,className:m.trim()&&m.trim()!==""?"ml-0.5":""})})]})}),n.jsx(zt,{initial:!1,children:E&&n.jsxs(n.Fragment,{children:[n.jsx(it.div,{className:"absolute inset-0 bg-black/20 z-[60] will-change-opacity",onClick:()=>b(!1),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:Gn}),n.jsxs(it.div,{className:"absolute top-0 right-0 h-full w-3/4 bg-white z-[70] shadow-2xl will-change-transform transform-gpu",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:mh,children:[n.jsxs("div",{className:"p-5 border-b border-slate-100 flex justify-between items-center",children:[n.jsx("h3",{className:"font-bold text-lg text-slate-800",children:""}),n.jsx("button",{onClick:()=>b(!1),className:"text-slate-400 hover:text-slate-600",children:n.jsx(jt,{size:24})})]}),n.jsxs("div",{className:"p-2",children:[n.jsxs("button",{onClick:()=>{b(!1),G(!0)},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(cn,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsx(js,{size:16,className:"text-slate-300"})]}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsxs("div",{className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(Eo,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[n.jsx("button",{onClick:()=>rt("daily"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${u==="daily"?"bg-white text-slate-800 shadow-sm":"text-slate-400"}`,children:""}),n.jsx("button",{onClick:()=>rt("scene"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${u==="scene"?"bg-white text-purple-600 shadow-sm":"text-slate-400"}`,children:""})]})]})]})]})]})}),k&&n.jsx(to,{currentPersona:$,roleId:A,onBack:()=>T(!1),onSave:v=>{T(!1),G(!0)},withinContainer:!0}),n.jsx(Sh,{isOpen:R,currentPersona:oe||s,characterId:e.id,onClose:()=>G(!1),onAdd:()=>{G(!1),S(void 0),V(void 0),T(!0)},onSelect:v=>{xe(v);try{localStorage.setItem(Pe,JSON.stringify({chatMode:u,persona:v}))}catch{}},onEdit:(v,D)=>{G(!1),S(v),V(D),T(!0)}}),ie&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-3 text-slate-600 active:opacity-70",onClick:()=>{te(!1),i()},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-3 text-primary-600 font-bold active:opacity-70",onClick:async()=>{var v;try{const D=localStorage.getItem("user_chat_role_id"),W=D?parseInt(D):void 0,K=await us(e.id,typeof W=="number"?W:void 0),q=K.sessionId,je=`chat_session_${localStorage.getItem("user_id")||"0"}_${e.id}`;try{localStorage.removeItem(je)}catch{}localStorage.setItem(je,q);try{localStorage.removeItem(fe)}catch{}{const M=e.openingLine||e.oneLinePersona||"",p=`msg_${Date.now()}`,g={id:p,senderId:e.id,text:M,ts:Date.now(),type:at.TEXT};try{localStorage.setItem(fe,JSON.stringify([g]))}catch{}const j={id:p,senderId:e.id,text:M,timestamp:new Date,type:at.TEXT};d([j]);try{setTimeout(()=>r(j),0)}catch{}}if(B(q),te(!1),(v=K.model)!=null&&v.id){ne(K.model.id);try{localStorage.setItem(De,K.model.id)}catch{}}if(typeof K.temperature=="number"){F(K.temperature);try{localStorage.setItem(Ie,String(K.temperature))}catch{}}const x=as(q,(M,p,g)=>{Le(M,p,g)},M=>{he(!0)});X.current=x}catch{}},children:""})]})]})})]}),Ae&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/30"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm",children:[n.jsx("div",{className:"px-6 py-5 text-center font-bold text-red-600",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsx("div",{className:"flex",children:n.jsx("button",{className:"flex-1 py-3 text-primary-600 font-bold active:opacity-70",onClick:async()=>{try{const v=localStorage.getItem("user_refresh_token")||"";if(v&&!(await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:v})})).ok)try{await fetch("/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:v})})}catch{}}catch{}try{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token")}catch{}he(!1);try{window.location.reload()}catch{}},children:""})})]})})]})]})})},so=h.createContext({showToast:()=>{},showCenter:()=>{}}),pr=({children:e})=>{const[t,s]=h.useState([]),i=h.useRef(new Map),r=(a,c)=>{const d=i.current.get(a);d&&clearTimeout(d);const u=window.setTimeout(()=>{s(f=>f.filter(m=>m.id!==a)),i.current.delete(a)},c);i.current.set(a,u)},l=(a,c="info")=>{const d=Date.now(),u=2e3;s(f=>[...f,{id:d,text:a,type:c,position:"bottom",duration:u}]),r(d,u)},o=(a,c="info")=>{s(u=>{const f=u.find(y=>y.position==="center"&&y.text===a);if(f)return r(f.id,3e3),u;const m=Date.now();return r(m,2e3),[...u,{id:m,text:a,type:c,position:"center",duration:2e3}]})};return n.jsxs(so.Provider,{value:{showToast:l,showCenter:o},children:[e,n.jsx("div",{className:"fixed bottom-6 left-0 right-0 z-[100] flex justify-center pointer-events-none",children:n.jsx("div",{className:"space-y-2",children:t.filter(a=>a.position==="bottom").map(a=>n.jsx("div",{className:`${a.type==="role"?"bg-white text-pink-600 border border-pink-200 shadow-md":a.type==="error"?"bg-red-500 text-white":a.type==="success"?"bg-green-500 text-white":"bg-slate-800 text-white"} px-4 py-2 rounded-2xl shadow-lg inline-block`,children:a.text},a.id))})}),n.jsx("div",{className:"fixed top-[25%] left-1/2 -translate-x-1/2 z-[100] pointer-events-none",children:n.jsx("div",{className:"space-y-2 flex flex-col items-center",children:t.filter(a=>a.position==="center").map(a=>n.jsx("div",{className:`${a.type==="error"?"bg-white text-red-500 border-red-200":"bg-white text-slate-800 border-slate-200"} px-6 py-3 rounded-2xl shadow-2xl border whitespace-nowrap`,children:a.text},a.id))})}),n.jsx("style",{children:`
        @keyframes toastFade {
          0% { opacity: 0; transform: translateY(-6px); }
          10% { opacity: 1; transform: translateY(0); }
          90% { opacity: 1; transform: translateY(0); }
          100% { opacity: 0; transform: translateY(-6px); }
        }
      `})]})},no=()=>h.useContext(so),kh=({character:e,onBack:t,onStartChat:s,isFromChat:i=!1,isExistingChat:r=!1})=>{var y;const[l,o]=h.useState(!1),{showToast:a,showCenter:c}=no(),[d,u]=h.useState(!1);h.useEffect(()=>{try{const _=localStorage.getItem("user_id")||"0",N=localStorage.getItem("user_username")||_,E=localStorage.getItem("user_nickname")||"";tt({userId:N,pageId:"CHAR_DETAIL",name:E}),_e("",""),_e("ID",String((e==null?void 0:e.id)??"")),_e("",(e==null?void 0:e.name)??"")}catch{}},[e]);const f=l?e.tags:e.tags.slice(0,4),m=e.tags.length>4;return n.jsx(it.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[n.jsx("button",{onClick:t,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(ws,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[n.jsxs("div",{className:"relative w-full h-[55vh]",children:[!d&&(e.profileImage||e.avatar)?n.jsx("img",{src:e.profileImage||e.avatar,alt:e.name,className:"w-full h-full object-cover",onError:()=>u(!0)}):n.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:n.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((y=e.name)==null?void 0:y[0])||"?"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),n.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:e.name}),n.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[n.jsx("span",{className:"text-green-400",children:""})," ",e.character_type||e.roleType||""]})]}),n.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[n.jsx("span",{children:e.profession}),n.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),n.jsx("span",{children:e.age})]}),n.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",e.creator]})]})]}),n.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:f.map((_,N)=>n.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",_]},N))}),m&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>o(!l),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[l?"":""," ",l?n.jsx(hn,{size:14}):n.jsx(Kt,{size:14})]})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsxs("div",{className:"relative pl-4 py-1",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),n.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["",e.oneLinePersona,""]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:e.personality})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{children:n.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[n.jsx(Nr,{size:12,fill:"currentColor"})," ",e.currentRelationship]})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:""}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),n.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:e.plotTheme})]}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:e.plotDescription}),e.openingLine&&n.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[n.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:""}),n.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),n.jsx("span",{className:"text-slate-700 font-bold text-sm",children:e.openingLine})]})]})]})]}),n.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:n.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:n.jsx("button",{onClick:()=>{if(i){s();return}if(r){c("");return}s()},className:"w-full font-bold text-lg py-4 rounded-2xl shadow-lg active:scale-[0.98] transition-all flex items-center justify-center gap-2 bg-purple-200 text-purple-900 shadow-purple-100",children:i?n.jsxs(n.Fragment,{children:[n.jsx(fn,{size:20}),""]}):""})})})]})})},Ch=async()=>{const{authFetch:e}=await ye(async()=>{const{authFetch:i}=await import("./http-Dwii6HrH.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),t=await e("/user-characters");if(!t.ok)throw new Error("failed");const s=await t.json();return Array.isArray(s.items)?s.items:[]},Pt=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:i}=await import("./http-Dwii6HrH.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),s=await t(`/user-characters/${e}`);if(!s.ok)throw new Error("failed");return await s.json()},_h=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:r}=await import("./http-Dwii6HrH.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t("/user-characters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("create_character_failed");return(await s.json()).id},Ah=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:r}=await import("./http-Dwii6HrH.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t("/user-characters/draft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("create_draft_failed");return(await s.json()).id},Ph=async(e,t)=>{const{authFetch:s}=await ye(async()=>{const{authFetch:r}=await import("./http-Dwii6HrH.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await s(`/user-characters/${e}/draft`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("update_draft_failed");return!0},Eh=async(e,t)=>{const{authFetch:s}=await ye(async()=>{const{authFetch:r}=await import("./http-Dwii6HrH.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await s(`/user-characters/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("update_failed");return!0},Ih=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:i}=await import("./http-Dwii6HrH.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user-characters/${e}`,{method:"DELETE"})).ok)throw new Error("delete_failed");return!0},xr=({character:e,createdId:t,onBack:s,onStartChat:i})=>{var E;const[r,l]=h.useState(!1),[o,a]=h.useState(!0),[c,d]=h.useState(e),[u,f]=h.useState(!1),[m,y]=h.useState(!1);h.useEffect(()=>{try{const b=localStorage.getItem("user_id")||"0",k=localStorage.getItem("user_username")||b,T=localStorage.getItem("user_nickname")||"";tt({userId:k,pageId:"CHAR_AWAIT",name:T}),_e("","()"),_e("ID",String(t)),_e("",(c==null?void 0:c.name)||"")}catch{}},[t,c==null?void 0:c.name]),h.useEffect(()=>{let b=!0,k;const T=async()=>{try{const S=await Pt(t);if(!b)return;const A=typeof(S==null?void 0:S.status)=="string"?S.status.trim():"",V=!!(S!=null&&S.hasSystemPrompt);if(A==="draft"){f(!0),a(!1),k&&clearInterval(k);return}if(A==="publishing"||!V){f(!1),a(!1);return}if(S&&(A==="published"||V)){a(!0),f(!1),d(R=>({...R,id:String(S.id||R.id),name:S.name||R.name,avatar:S.avatar||R.avatar,profileImage:R.profileImage,character_type:String(S.character_type||R.character_type||""),oneLinePersona:S.tagline||R.oneLinePersona,personality:S.personality||R.personality,profession:String(S.occupation||R.profession||""),age:String(S.age||R.age||""),currentRelationship:String(S.relationship||R.currentRelationship||""),plotTheme:String(S.plot_theme||R.plotTheme||""),plotDescription:String(S.plot_summary||R.plotDescription||""),openingLine:String(S.opening_line||R.openingLine||"")})),k&&clearInterval(k);return}}catch{}};return(async()=>{try{const S=await Pt(t);if(!b)return;if(S){d(R=>({...R,id:String(S.id||R.id),name:S.name||R.name,avatar:S.avatar||R.avatar,character_type:String(S.character_type||R.character_type||""),oneLinePersona:S.tagline||R.oneLinePersona,personality:S.personality||R.personality,profession:String(S.occupation||R.profession||""),age:String(S.age||R.age||""),currentRelationship:String(S.relationship||R.currentRelationship||""),plotTheme:String(S.plot_theme||R.plotTheme||""),plotDescription:String(S.plot_summary||R.plotDescription||""),openingLine:String(S.opening_line||R.openingLine||"")}));const A=!!S.hasSystemPrompt,V=typeof S.status=="string"?S.status.trim():"";if(V==="draft"){f(!0),a(!1);return}if(V==="publishing"){f(!1),a(!1),k=setInterval(T,3e3),T();return}if(!A){f(!1),a(!1),k=setInterval(T,3e3),T();return}f(!1),a(!0);return}f(!1),a(!0)}catch{f(!1),a(!0)}})(),()=>{b=!1,clearInterval(k)}},[t]);const _=r?c.tags:c.tags.slice(0,4),N=c.tags.length>4;return n.jsx(it.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[n.jsx("button",{onClick:s,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(ws,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[n.jsxs("div",{className:"relative w-full h-[55vh]",children:[!m&&(c.profileImage||c.avatar)?n.jsx("img",{src:c.profileImage||c.avatar,alt:c.name,className:"w-full h-full object-cover",onError:()=>y(!0)}):n.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:n.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((E=c.name)==null?void 0:E[0])||"?"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),n.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:c.name}),n.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[n.jsx("span",{className:"text-green-400",children:""})," ",c.character_type||c.roleType||""]})]}),n.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[n.jsx("span",{children:c.profession}),n.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),n.jsx("span",{children:c.age})]}),n.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",c.creator]})]})]}),n.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:_.map((b,k)=>n.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",b]},k))}),N&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>l(!r),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[r?"":""," ",r?n.jsx(hn,{size:14}):n.jsx(Kt,{size:14})]})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsxs("div",{className:"relative pl-4 py-1",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),n.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["",c.oneLinePersona,""]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:c.personality})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{children:n.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[n.jsx(Nr,{size:12,fill:"currentColor"})," ",c.currentRelationship]})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:""}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),n.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:c.plotTheme})]}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:c.plotDescription}),c.openingLine&&n.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[n.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:""}),n.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),n.jsx("span",{className:"text-slate-700 font-bold text-sm",children:c.openingLine})]})]})]})]}),n.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:n.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:n.jsx("button",{disabled:!o||u,onClick:()=>i(c),className:`w-full font-bold text-lg py-4 rounded-2xl shadow-lg transition-all flex items-center justify-center gap-2 ${o&&!u?"bg-purple-200 text-purple-900 shadow-purple-100 active:scale-[0.98]":"bg-slate-200 text-slate-500 cursor-not-allowed"}`,children:o&&!u?n.jsxs(n.Fragment,{children:[n.jsx(fn,{size:20}),""]}):u?"":""})})})]})})},Mh=({onBack:e,onCreate:t,isEdit:s=!1,characterId:i,initial:r,onUpdated:l,onSaveDraft:o})=>{const[a,c]=h.useState({type:"",avatar:"",profileImage:"",name:"",gender:"",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0}),[d,u]=h.useState(!1),[f,m]=h.useState(!0),[y,_]=h.useState(!1),[N,E]=h.useState(""),[b,k]=h.useState(!1),[T,$]=h.useState({}),[S,A]=h.useState(!1),[V,R]=h.useState(null),[G,O]=h.useState(!1),U=h.useRef(null),le=w=>{var he;const z=w.split(","),L=((he=z[0].match(/:(.*?);/))==null?void 0:he[1])||"image/jpeg",ie=atob(z[1]);let te=ie.length;const Ae=new Uint8Array(te);for(;te--;)Ae[te]=ie.charCodeAt(te);return new Blob([Ae],{type:L})};h.useEffect(()=>{try{const w=localStorage.getItem("user_id")||"0",z=localStorage.getItem("user_username")||w,L=localStorage.getItem("user_nickname")||"";tt({userId:z,pageId:"CREATE_CHAR",name:L}),_e("",s?"":""),i!=null&&_e("ID",String(i))}catch{}},[s,i]),h.useEffect(()=>{r&&c(w=>({...w,type:r.roleType||w.type,avatar:r.avatar||w.avatar,profileImage:r.profileImage||w.profileImage,name:r.name||w.name,gender:r.gender||w.gender,age:r.age||w.age,profession:r.profession||w.profession,tagline:r.oneLinePersona||w.tagline,personality:r.personality||w.personality,relationship:r.currentRelationship||w.relationship,plotTheme:r.plotTheme||w.plotTheme,plotSummary:r.plotDescription||w.plotSummary,openingLine:r.openingLine||w.openingLine,styleExamples:Array.isArray(r.styleExamples)&&r.styleExamples.length?r.styleExamples:w.styleExamples,hobbies:r.hobbies||w.hobbies,experiences:r.experiences||w.experiences,searchTags:Array.isArray(r.tags)?r.tags:w.searchTags,isPublic:typeof r.isPublic=="boolean"?r.isPublic:w.isPublic}))},[r,s]),h.useEffect(()=>{if(!s||!i)return;const w=!(r&&Array.isArray(r.tags)&&r.tags.length),z=!(r&&Array.isArray(r.styleExamples)&&r.styleExamples.length);!w&&!z||(async()=>{try{const L=await Pt(i),ie=Array.isArray(L==null?void 0:L.styleExamples)?L.styleExamples.slice(0,3):[];for(;ie.length<3;)ie.push("");c(te=>({...te,name:(L==null?void 0:L.name)??te.name,gender:(L==null?void 0:L.gender)??te.gender,avatar:(L==null?void 0:L.avatar)??te.avatar,tagline:(L==null?void 0:L.tagline)??te.tagline,personality:(L==null?void 0:L.personality)??te.personality,relationship:(L==null?void 0:L.relationship)??te.relationship,plotTheme:(L==null?void 0:L.plot_theme)??te.plotTheme,plotSummary:(L==null?void 0:L.plot_summary)??te.plotSummary,openingLine:(L==null?void 0:L.opening_line)??te.openingLine,hobbies:(L==null?void 0:L.hobbies)??te.hobbies,experiences:(L==null?void 0:L.experiences)??te.experiences,age:(L==null?void 0:L.age)!=null?String(L.age):te.age,profession:(L==null?void 0:L.occupation)??te.profession,searchTags:Array.isArray(L==null?void 0:L.tags)?L.tags:te.searchTags,styleExamples:ie,isPublic:L!=null&&L.visibility?L.visibility==="public":te.isPublic}))}catch{}})()},[s,i,r]);const ne=["","",""],C=["","","","",""],F=["M/M","M/F","BL","BG","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],J=()=>{var w;(w=U.current)==null||w.click()},Y=w=>{var L;const z=(L=w.target.files)==null?void 0:L[0];if(z){O(!0);const ie=new FileReader;ie.onloadend=()=>{R(ie.result),O(!1)},ie.readAsDataURL(z)}U.current&&(U.current.value="")},se=w=>{a.searchTags.includes(w)?c(z=>({...z,searchTags:z.searchTags.filter(L=>L!==w)})):c(z=>({...z,searchTags:[...z.searchTags,w]}))},H=()=>{const w=N.trim();w&&!a.searchTags.includes(w)&&(c(z=>({...z,searchTags:[...z.searchTags,w]})),E(""))},ee=async w=>{if(w){try{const z=localStorage.getItem("user_access_token");let L=a.avatar||null;if(L&&L.startsWith("data:image")){const he=le(L),Re=new FormData,ke=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;Re.append("avatar",he,"avatar.jpg"),Re.append("filename",ke),L=`/uploads/users/avatars/${ke}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:z?`Bearer ${z}`:""},body:Re})}catch{}}const ie={name:a.name||"",gender:a.gender,avatar:L,identity:null,tagline:a.tagline,personality:a.personality,relationship:a.relationship,plotTheme:a.plotTheme,plotSummary:a.plotSummary,openingLine:a.openingLine,hobbies:a.hobbies,experiences:a.experiences,age:a.age&&parseInt(a.age,10)||null,occupation:a.profession,character_type:a.type,visibility:a.isPublic?"public":"private",tags:a.searchTags,styleExamples:a.styleExamples.filter(Boolean)};let te=null;s&&i?(await Ph(i,ie),te=typeof i=="number"?i:parseInt(String(i))||null):te=await Ah(ie);const Ae={id:te?String(te):i?String(i):`c_${Date.now()}`,name:a.name||"",avatar:a.avatar||"",profileImage:a.profileImage||a.avatar||"",status:qe.ONLINE,bio:a.tagline||"",tags:a.searchTags,creator:"",oneLinePersona:a.tagline,personality:a.personality,profession:a.profession,age:a.age,roleType:a.type,currentRelationship:a.relationship,plotTheme:a.plotTheme,plotDescription:a.plotSummary,openingLine:a.openingLine,styleExamples:a.styleExamples.filter(Boolean),hobbies:a.hobbies,experiences:a.experiences,isPublic:a.isPublic};o&&o(Ae)}catch{}try{localStorage.removeItem("create_character_draft")}catch{}}else localStorage.removeItem("create_character_draft"),c({type:"",avatar:"",profileImage:"",name:"",gender:"",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0});k(!1)},me=()=>{const w={};return a.name.trim()||(w.name=!0),a.age.trim()||(w.age=!0),a.profession.trim()||(w.profession=!0),a.tagline.trim()||(w.tagline=!0),a.personality.trim()||(w.personality=!0),a.searchTags.length===0&&(w.searchTags=!0),a.relationship.trim()||(w.relationship=!0),a.plotTheme.trim()||(w.plotTheme=!0),a.plotSummary.trim()||(w.plotSummary=!0),a.openingLine.trim()||(w.openingLine=!0),$(w),Object.keys(w).length===0},oe=async()=>{if(!me()){A(!0);return}let w=null;try{const L=localStorage.getItem("user_access_token");let ie=a.avatar||null;if(ie&&ie.startsWith("data:image")){const Ae=le(ie),he=new FormData,Re=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;he.append("avatar",Ae,"avatar.jpg"),he.append("filename",Re),ie=`/uploads/users/avatars/${Re}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:L?`Bearer ${L}`:""},body:he})}catch{}}const te={name:a.name,gender:a.gender,avatar:ie,identity:null,tagline:a.tagline,personality:a.personality,relationship:a.relationship,plotTheme:a.plotTheme,plotSummary:a.plotSummary,openingLine:a.openingLine,hobbies:a.hobbies,experiences:a.experiences,age:a.age&&parseInt(a.age,10)||null,occupation:a.profession,character_type:a.type,visibility:a.isPublic?"public":"private",tags:a.searchTags,styleExamples:a.styleExamples.filter(Boolean)};s&&i?(await Eh(i,te),w=typeof i=="number"?i:parseInt(String(i))||null):w=await _h(te)}catch{}const z={id:w?String(w):`c_${Date.now()}`,name:a.name,avatar:a.avatar||"https://image.pollinations.ai/prompt/anime%20silhouette%20purple?width=400&height=400&nologo=true",profileImage:a.profileImage||a.avatar,status:qe.ONLINE,bio:`${a.age} ${a.profession}`,tags:a.searchTags,isPinned:!1,relationshipLevel:0,creator:"",playCount:"0",age:a.age||"",profession:a.profession||"",gender:a.gender,roleType:a.type,isOriginal:a.type==="",oneLinePersona:a.tagline,personality:a.personality,currentRelationship:a.relationship,plotTheme:a.plotTheme,plotDescription:a.plotSummary,openingLine:a.openingLine,styleExamples:a.styleExamples.filter(L=>L),hobbies:a.hobbies,experiences:a.experiences,isPublic:a.isPublic};localStorage.removeItem("create_character_draft"),s&&l?l(z):t(z)},xe=w=>["","",""][w],ve="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return n.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-3xl shadow-2xl bg font-kosugi",children:[V&&n.jsx(As,{imageSrc:V,aspectRatio:1,outputWidth:800,outputHeight:800,onCancel:()=>{R(null),U.current&&(U.current.value="")},onCrop:w=>{c(z=>({...z,avatar:w,profileImage:V})),R(null)}}),n.jsx("div",{className:"ambient-bg hidden"}),n.jsxs("div",{className:"hidden",children:[n.jsx("div",{className:"star",style:{left:"10%",width:"4px",height:"4px"}}),n.jsx("div",{className:"star",style:{left:"80%",animationDelay:"2s",width:"6px",height:"6px"}})]}),n.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-3xl relative",children:[n.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:n.jsx(bs,{size:20})}),n.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:s?"":""}),!s&&n.jsx("button",{onClick:()=>k(!0),className:"ml-auto text-sm font-bold text-purple-600 font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",children:[n.jsxs("section",{className:"mt-4",children:[n.jsx("div",{className:"text-[#2E1065] font-bold text-[0.9rem] mb-2 ml-1 font-kosugi",children:""}),n.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-1 mt-2",children:ne.map(w=>n.jsx("button",{onClick:()=>c(z=>({...z,type:w})),className:`
                                flex-shrink-0 px-5 py-2.5 rounded-2xl text-sm font-bold transition-all whitespace-nowrap tracking-wide font-kosugi
                                ${a.type===w?"bg-purple-500 text-white shadow-purple-200 shadow-md":"bg-white/70 text-slate-500 border-transparent"}
                            `,children:w},w))})]}),n.jsxs("section",{className:"flex flex-col items-center py-2",children:[n.jsxs("div",{onClick:J,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-24 h-24 rounded-full bg-white border-[3px] border-white shadow-xl flex items-center justify-center overflow-hidden relative",children:a.avatar?n.jsx("img",{src:a.avatar,className:"w-full h-full object-cover",alt:"avatar"}):n.jsx("div",{className:"text-purple-200 text-3xl",children:n.jsx(un,{size:32})})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center border-[3px] border-white shadow-md",children:n.jsx(ht,{size:14})})]}),n.jsx("input",{type:"file",ref:U,className:"hidden",accept:"image/*",onChange:Y}),n.jsx("p",{className:"mt-2 text-xs text-purple-400 font-bold tracking-wide font-kosugi",children:""})]}),G&&n.jsx("div",{className:"fixed inset-0 z-[90] bg-black flex items-center justify-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})}),n.jsxs("section",{className:"glass-card p-6 space-y-6",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:""}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ve} flex items-center gap-1`,children:["",T.name&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("div",{className:"relative",children:n.jsx("input",{value:a.name,onChange:w=>c(z=>({...z,name:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold ${T.name?"border-red-300 bg-red-50":""}`})})]}),n.jsxs("div",{children:[n.jsx("label",{className:ve,children:""}),n.jsx("div",{className:"flex gap-3",children:["","",""].map(w=>n.jsx("button",{onClick:()=>c(z=>({...z,gender:w})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition font-kosugi ${a.gender===w?w===""?"bg-blue-100 text-blue-600 ring-2 ring-blue-200":w===""?"bg-pink-100 text-pink-600 ring-2 ring-pink-200":"bg-purple-100 text-purple-600 ring-2 ring-purple-200":"bg-white/50 text-slate-400"}`,children:w},w))})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"w-full",children:[n.jsxs("label",{className:`${ve} flex items-center gap-1`,children:["",T.age&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.age,onChange:w=>c(z=>({...z,age:w.target.value})),type:"text",placeholder:"28",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${T.age?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"w-full",children:[n.jsxs("label",{className:`${ve} flex items-center gap-1`,children:["",T.profession&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.profession,onChange:w=>c(z=>({...z,profession:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${T.profession?"border-red-300 bg-red-50":""}`})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ve} flex items-center gap-1`,children:["",T.tagline&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.tagline,onChange:w=>c(z=>({...z,tagline:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm ${T.tagline?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ve} flex items-center gap-1`,children:["",T.personality&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("textarea",{value:a.personality,onChange:w=>c(z=>({...z,personality:w.target.value})),rows:3,placeholder:"...",className:`dream-input w-full px-4 py-3 text-sm resize-none ${T.personality?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ve} flex items-center gap-1`,children:["",T.searchTags&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsxs("div",{onClick:()=>_(!0),className:`dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition ${T.searchTags?"border-red-300 bg-red-50":""}`,children:[a.searchTags.length===0&&n.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:" (# #...)"}),a.searchTags.map(w=>n.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",w,n.jsx(jt,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:z=>{z.stopPropagation(),se(w)}})]},w)),n.jsx(js,{className:"ml-auto text-purple-300",size:16})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ve} flex items-center gap-1`,children:["",T.relationship&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[n.jsx("button",{onClick:()=>{u(!0),c(w=>({...w,relationship:""}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${d?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:""}),C.map(w=>n.jsx("button",{onClick:()=>{u(!1),c(z=>({...z,relationship:w}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${a.relationship===w&&!d?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:w},w))]}),d&&n.jsx("div",{className:"relative animate-in fade-in",children:n.jsx("input",{value:a.relationship,onChange:w=>c(z=>({...z,relationship:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-2 text-sm ${T.relationship?"border-red-300 bg-red-50":""}`})})]})]}),n.jsxs("section",{className:"glass-card p-6 space-y-5",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-4",children:""}),n.jsxs("p",{className:"text-xs text-slate-500 leading-relaxed bg-purple-50/50 p-3 rounded-xl border border-purple-100 flex gap-1",children:[n.jsx(wr,{size:14,className:"text-purple-400 mt-0.5 flex-shrink-0"}),n.jsx("span",{children:""})]}),n.jsxs("div",{className:"bg-white/40 p-4 rounded-3xl border border-purple-100/50 space-y-4",children:[n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",T.plotTheme&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("input",{value:a.plotTheme,onChange:w=>c(z=>({...z,plotTheme:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 ${T.plotTheme?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",T.plotSummary&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:a.plotSummary,onChange:w=>c(z=>({...z,plotSummary:w.target.value})),rows:5,placeholder:"......",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none leading-relaxed ${T.plotSummary?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",T.openingLine&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:a.openingLine,onChange:w=>c(z=>({...z,openingLine:w.target.value})),rows:2,placeholder:"",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none ${T.openingLine?"border-red-300 bg-red-50":""}`})]})]})]}),n.jsxs("section",{className:"glass-card p-0 overflow-hidden transition-all",children:[n.jsxs("button",{onClick:()=>m(!f),className:"w-full flex items-center justify-between p-6 bg-transparent transition",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:""}),n.jsx("span",{className:"text-[10px] bg-purple-100 text-purple-500 px-1.5 py-0.5 rounded font-bold border border-purple-200 self-center font-kosugi",children:""})]}),f?n.jsx(hn,{className:"text-purple-400"}):n.jsx(Kt,{className:"text-purple-400"})]}),f&&n.jsxs("div",{className:"p-6 pt-0 space-y-5 animate-in slide-in-from-top-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:ve,children:""}),n.jsx("div",{className:"space-y-3",children:[0,1,2].map(w=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs font-bold text-purple-300 w-4 font-mono",children:["0",w+1]}),n.jsx("input",{value:a.styleExamples[w],onChange:z=>{const L=[...a.styleExamples];L[w]=z.target.value,c(ie=>({...ie,styleExamples:L}))},type:"text",placeholder:xe(w),className:"dream-input flex-1 px-3 py-2.5 rounded-xl text-sm"})]},w))})]}),n.jsxs("div",{children:[n.jsx("label",{className:ve,children:""}),n.jsx("textarea",{value:a.hobbies,onChange:w=>c(z=>({...z,hobbies:w.target.value})),rows:2,placeholder:"...",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:ve,children:""}),n.jsx("textarea",{value:a.experiences,onChange:w=>c(z=>({...z,experiences:w.target.value})),rows:2,placeholder:"",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),n.jsxs("div",{className:"pt-2 border-t border-purple-100",children:[n.jsx("label",{className:`${ve} mb-1`,children:""}),n.jsx("p",{className:"text-[10px] text-slate-500 leading-tight mb-3",children:""}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:()=>c(w=>({...w,isPublic:!0})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${a.isPublic?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:[n.jsx(wo,{size:14})," "]}),n.jsxs("button",{onClick:()=>c(w=>({...w,isPublic:!1})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${a.isPublic?"bg-white text-slate-500 border border-purple-100":"bg-purple-500 text-white shadow-md"}`,children:[n.jsx(ko,{size:14})," "]})]})]})]})]})]}),n.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-b-3xl shadow-2xl",children:n.jsx("button",{onClick:oe,className:"w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition-transform flex items-center justify-center tracking-widest text-lg font-kosugi",children:s?"":""})}),y&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>_(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 w-full bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[80vh] animate-in slide-in-from-bottom duration-300",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[n.jsx("button",{onClick:()=>_(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:n.jsx(Kt,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:" #"}),n.jsx("button",{onClick:()=>_(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:""}),n.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[a.searchTags.length===0&&n.jsx("span",{className:"text-xs text-slate-400 self-center",children:""}),a.searchTags.map(w=>n.jsxs("button",{onClick:()=>se(w),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1 font-kosugi",children:["#",w," ",n.jsx(jt,{size:10,className:"opacity-80"})]},w))]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:" ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:N,onChange:w=>E(w.target.value),onKeyDown:w=>w.key==="Enter"&&H(),type:"text",placeholder:"#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),n.jsx("button",{onClick:H,className:"bg-gradient-to-r from-purple-400 to-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition font-kosugi",children:""})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:""}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:F.map(w=>n.jsxs("button",{onClick:()=>se(w),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis font-kosugi
                                            ${a.searchTags.includes(w)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",w]},w))})]})]})]})]}),b&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-4 font-kosugi",children:s?"":""}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>ee(!1),className:"flex-1 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors font-kosugi",children:s?"":""}),n.jsx("button",{onClick:()=>ee(!0),className:"flex-1 py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:s?"":""})]})]})}),S&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:n.jsx(Hs,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:""}),n.jsx("button",{onClick:()=>A(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:""})]})})]})})},vs=({src:e,alt:t,className:s,root:i,placeholderChar:r})=>{const l=h.useRef(null),[o,a]=h.useState(""),[c,d]=h.useState(!1);return h.useEffect(()=>{if(!l.current||!e)return;const u=new IntersectionObserver(f=>{if(f.some(m=>m.isIntersecting)){a(e||"");try{u.disconnect()}catch{}}},{root:i||void 0,rootMargin:"0px 0px 240px 0px",threshold:0});return u.observe(l.current),()=>{try{u.disconnect()}catch{}}},[e,i]),n.jsx("div",{ref:l,className:s,children:!c&&o?n.jsx("img",{src:o,alt:t,decoding:"async",loading:"lazy",className:"w-full h-full object-cover",onError:()=>d(!0)}):r?n.jsx("span",{className:"text-2xl font-bold text-slate-500",children:r}):null})},Rh=({onBack:e,onPublish:t,onSaveDraft:s,availableCharacters:i,myUserCharacters:r=[],initialStory:l,importableRoles:o=[]})=>{const{showCenter:a}=no(),[c,d]=h.useState(()=>l?{title:l.title,description:l.description,image:l.image,content:l.content,tags:l.tags,roles:l.availableRoles||[]}:{title:"",description:"",image:"",content:"",tags:[],roles:[]}),[u,f]=h.useState(!1),[m,y]=h.useState(!1),[_,N]=h.useState(!1),[E,b]=h.useState({}),[k,T]=h.useState(""),[$,S]=h.useState(null),[A,V]=h.useState(!1),[R,G]=h.useState(!1),O=h.useRef(null),[U,le]=h.useState(o),ne=h.useRef(!1);h.useEffect(()=>{try{const I=localStorage.getItem("user_id")||"0",B=localStorage.getItem("user_username")||I,X=localStorage.getItem("user_nickname")||"";tt({userId:B,pageId:"CREATE_STORY",name:X}),_e("",l?"":"")}catch{}},[l]),h.useEffect(()=>{le(o||[])},[o]),h.useEffect(()=>{ne.current||U&&U.length||(ne.current=!0,(async()=>{try{const{authFetch:I}=await ye(async()=>{const{authFetch:X}=await import("./http-Dwii6HrH.js");return{authFetch:X}},__vite__mapDeps([0,1,2,3])),B=await I("/stories/combine");if(B&&B.ok){const X=await B.json(),ae=Array.isArray(X==null?void 0:X.items)?X.items:[];le(ae.map(fe=>({id:String(fe.character_id),name:fe.character_name,avatar:fe.character_avatar||"",desc:fe.desc||"",isPrivate:!!fe.isPrivate,isMine:!!fe.isMine})))}}catch{}})())},[]),ao.useMemo(()=>(Array.isArray(r)?r:[]).filter(B=>B.isPublished===!0&&B.isPublic===!1).map(B=>({id:String(B.id),name:B.name,avatar:B.avatar,desc:B.oneLinePersona||B.bio||"",isPrivate:!0,isMine:!0})),[r]);const C=h.useRef(!1);h.useEffect(()=>{if(C.current)return;const I=Array.isArray(l==null?void 0:l.characterIds)?l.characterIds:[];if(!I.length||!U||!U.length)return;const B=new Set(I.map(ae=>String(ae))),X=U.filter(ae=>B.has(String(ae.id))).map(ae=>({name:ae.name,avatar:ae.avatar,description:ae.desc||""}));X.length&&(C.current=!0,d(ae=>({...ae,roles:X})))},[l,U]),h.useEffect(()=>{if(!l)return;const I=l.availableRoles||[];I.length&&(d(B=>({...B,roles:I})),C.current=!0)},[l]),h.useEffect(()=>{l&&d(I=>({...I,title:l.title||I.title,description:l.description||I.description,image:l.image||I.image,content:l.content||I.content,tags:Array.isArray(l.tags)?l.tags:I.tags}))},[l]),h.useEffect(()=>{if(!R)return;const I=setTimeout(()=>G(!1),6e3);return()=>clearTimeout(I)},[R]),h.useEffect(()=>{if(!R)return;const I=B=>{const X=O.current;if(!X){G(!1);return}const ae=B.target;X.contains(ae)||G(!1)};return window.addEventListener("click",I,!0),()=>window.removeEventListener("click",I,!0)},[R]);const F=h.useRef(null),J=h.useRef(null),Y=h.useRef(null),se=I=>{var De;const B=I.split(","),X=((De=B[0].match(/:(.*?);/))==null?void 0:De[1])||"image/jpeg",ae=atob(B[1]);let fe=ae.length;const Pe=new Uint8Array(fe);for(;fe--;)Pe[fe]=ae.charCodeAt(fe);return new Blob([Pe],{type:X})},H=["BG","BL","GL","","","","","","","","","","","HE","BE","","","","",""],ee=()=>{var I;(I=F.current)==null||I.click()},me=I=>{var X;const B=(X=I.target.files)==null?void 0:X[0];if(B){V(!0);const ae=new FileReader;ae.onloadend=()=>{S(ae.result),V(!1)},ae.readAsDataURL(B)}F.current&&(F.current.value="")},oe=I=>{c.tags.includes(I)?d(B=>({...B,tags:B.tags.filter(X=>X!==I)})):d(B=>({...B,tags:[...B.tags,I]}))},xe=()=>{const I=k.trim();I&&!c.tags.includes(I)&&(d(B=>({...B,tags:[...B.tags,I]})),T(""))},ve=I=>{if(c.roles.some(X=>X.name===I.name))return;const B={name:I.name,avatar:I.avatar,description:I.oneLinePersona||I.bio||""};d(X=>({...X,roles:[...X.roles,B]})),y(!1)},w=I=>{d(B=>({...B,roles:B.roles.filter(X=>X.name!==I)}))},z=()=>{const I=c.roles.map(X=>X.name),B={};return o.forEach(X=>{B[X.name]=X.id}),I.map(X=>B[X]).filter(Boolean)},[L,ie]=h.useState("none"),te=async I=>{try{ie(I==="published"?"publish":"draft");let B=c.image||"";try{const Me=localStorage.getItem("user_access_token");if(c.image&&c.image.startsWith("data:image")){const be=se(c.image),Le=new FormData,Be=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;B=`/uploads/covers/${Be}`,Le.append("cover",be,"cover.jpg"),Le.append("filename",Be);const Ue=await fetch("/api/uploads/cover",{method:"POST",headers:{Authorization:Me?`Bearer ${Me}`:""},body:Le});if(Ue&&Ue.ok){const Qe=await Ue.json();Qe&&Qe.url&&(B=Qe.url)}}}catch{}const X={title:c.title,description:c.description,image:B,status:I,content:c.content,tags:c.tags,characterIds:z()},{authFetch:ae}=await ye(async()=>{const{authFetch:Me}=await import("./http-Dwii6HrH.js");return{authFetch:Me}},__vite__mapDeps([0,1,2,3])),fe=!!l,Pe=fe?`/user/stories/${l==null?void 0:l.id}`:"/user/stories",Ie=await ae(Pe,{method:fe?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)});if(Ie&&Ie.ok){let Me;try{const Le=await Ie.json();Me=Le==null?void 0:Le.id}catch{Me=l==null?void 0:l.id}const be={id:typeof Me=="number"?Me:l?l.id:Date.now(),title:c.title,description:c.description,image:B||c.image,content:c.content,tags:c.tags,author:localStorage.getItem("user_nickname")||"",likes:"0",availableRoles:c.roles,status:I};I==="published"?t(be):s(be);return}a("","error")}catch{a("","error")}finally{ie("none")}},Ae=async()=>{try{ie("draft");let I=c.image||"";try{const fe=localStorage.getItem("user_access_token");if(c.image&&c.image.startsWith("data:image")){const Pe=se(c.image),De=new FormData,Ie=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;I=`/uploads/covers/${Ie}`,De.append("cover",Pe,"cover.jpg"),De.append("filename",Ie);const Me=await fetch("/api/uploads/cover",{method:"POST",headers:{Authorization:fe?`Bearer ${fe}`:""},body:De});if(Me&&Me.ok){const be=await Me.json();be&&be.url&&(I=be.url)}}}catch{}const B={title:c.title,description:c.description,image:I,content:c.content,tags:c.tags,characterIds:z()},{authFetch:X}=await ye(async()=>{const{authFetch:fe}=await import("./http-Dwii6HrH.js");return{authFetch:fe}},__vite__mapDeps([0,1,2,3])),ae=await X(`/user/stories/${l==null?void 0:l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(ae&&ae.ok){const fe={id:typeof(l==null?void 0:l.id)=="number"?l.id:Date.now(),title:c.title,description:c.description,image:I||c.image,content:c.content,tags:c.tags,author:localStorage.getItem("user_nickname")||"",likes:"0",availableRoles:c.roles,status:l==null?void 0:l.status};s(fe);return}a("","error")}catch{a("","error")}finally{ie("none")}},he=()=>{const I={};return c.title.trim()||(I.title=!0),c.content.trim()||(I.content=!0),b(I),Object.keys(I).length===0},Re=()=>{if(!he()){N(!0);return}te("published")},ke=()=>{if(!he()){N(!0);return}if(l){Ae();return}te("draft")},He="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return n.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-none md:rounded-3xl shadow-2xl bg font-kosugi",children:[$&&n.jsx(As,{imageSrc:$,aspectRatio:2,outputWidth:800,outputHeight:400,onCancel:()=>{S(null),F.current&&(F.current.value="")},onCrop:I=>{d(B=>({...B,image:I})),S(null)}}),n.jsx("div",{className:"ambient-bg hidden"}),n.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-none md:rounded-t-3xl relative",children:[l&&n.jsx("button",{onClick:ke,disabled:L!=="none",className:`absolute right-4 text-sm font-bold font-kosugi ${L!=="none"?"text-slate-400 cursor-not-allowed":"text-purple-600"}`,children:""}),n.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:n.jsx(bs,{size:20})}),n.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:l?"":""}),!l&&n.jsx("button",{onClick:ke,disabled:L!=="none",className:`ml-auto text-sm font-bold font-kosugi ${L!=="none"?"text-slate-400 cursor-not-allowed":"text-purple-600"}`,children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",ref:J,children:[n.jsxs("section",{className:"flex flex-col items-center py-2",children:[n.jsxs("div",{onClick:ee,className:"relative group cursor-pointer active:scale-95 transition-transform w-full h-40 rounded-3xl overflow-hidden shadow-lg border-4 border-white bg-white/50",children:[c.image?n.jsx("img",{src:c.image,className:"w-full h-full object-cover",alt:"cover"}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-purple-300",children:[n.jsx(un,{size:32}),n.jsx("span",{className:"text-xs font-bold mt-2",children:""})]}),n.jsx("div",{className:"absolute bottom-2 right-2 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-md",children:n.jsx(ht,{size:14})})]}),n.jsx("input",{type:"file",ref:F,className:"hidden",accept:"image/*",onChange:me})]}),A&&n.jsx("div",{className:"fixed inset-0 z-[90] bg-black flex items-center justify-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})}),n.jsxs("section",{className:"glass-card p-6 space-y-4",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:""}),n.jsxs("div",{children:[n.jsxs("label",{className:`${He} flex items-center gap-1`,children:["",E.title&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:c.title,onChange:I=>d(B=>({...B,title:I.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold ${E.title?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsx("label",{className:He,children:""}),n.jsx("input",{value:c.description,onChange:I=>d(B=>({...B,description:I.target.value})),type:"text",placeholder:"",className:"dream-input w-full px-4 py-3 text-sm"})]}),n.jsxs("div",{children:[n.jsx("label",{className:He,children:""}),n.jsxs("div",{onClick:()=>f(!0),className:"dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition",children:[c.tags.length===0&&n.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:""}),c.tags.map(I=>n.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",I,n.jsx(jt,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:B=>{B.stopPropagation(),oe(I)}})]},I)),n.jsx(js,{className:"ml-auto text-purple-300",size:16})]})]})]}),n.jsxs("section",{className:"glass-card p-6 space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2 relative",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:""}),n.jsx("button",{onClick:()=>G(!0),className:"w-5 h-5 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center border border-purple-100",children:n.jsx(Hs,{size:12})})]}),n.jsx("button",{onClick:()=>y(!0),className:"text-xs bg-purple-100 text-purple-600 px-3 py-1.5 rounded-full font-bold hover:bg-purple-200 transition",children:"+ "}),R&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[60]",onClick:()=>G(!1)}),n.jsxs("div",{ref:O,className:"absolute left-0 top-8 z-[61] bg-white rounded-2xl shadow-xl border border-slate-100 p-3 w-[88%]",children:[n.jsx("div",{className:"text-xs text-slate-700 font-kosugi",children:""}),n.jsx("div",{className:"text-[10px] text-slate-400 mt-1 font-kosugi",children:""})]})]})]}),c.roles.length===0?n.jsx("div",{className:"text-center py-6 text-slate-400 text-xs border border-dashed border-purple-200 rounded-xl",children:""}):n.jsx("div",{className:"flex flex-col divide-y divide-slate-200",children:c.roles.map(I=>n.jsxs("div",{className:"flex items-center gap-3 bg/60 py-3",children:[n.jsx(vs,{src:I.avatar,alt:I.name,root:J.current,placeholderChar:(I.name||"?")[0],className:"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-700 text-sm",children:I.name}),n.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:I.description})]}),n.jsx("button",{onClick:()=>w(I.name),className:"text-slate-400 hover:text-red-400 p-2",children:n.jsx(dn,{size:16})})]},I.name))})]}),n.jsxs("section",{className:"glass-card p-6 h-auto min-h-[300px] flex flex-col",children:[n.jsxs("div",{className:"section-title !font-kosugi !text-purple-900 mb-4 flex items-center gap-1",children:["",E.content&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:c.content,onChange:I=>d(B=>({...B,content:I.target.value})),placeholder:"...",className:`flex-1 w-full bg-transparent border-none outline-none resize-none text-slate-700 leading-relaxed text-base min-h-[200px] placeholder:text-slate-300 ${E.content?"border-red-300 bg-red-50":""}`})]})]}),n.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-none md:rounded-b-3xl shadow-2xl",children:n.jsxs("button",{onClick:Re,disabled:L!=="none",className:`w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition flex items-center justify-center gap-2 ${L!=="none"?"opacity-70 cursor-not-allowed":""}`,children:[n.jsx(br,{size:18})," ",L==="publish"?"...":""]})}),u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>f(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[70vh] animate-in slide-in-from-bottom duration-300",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[n.jsx("button",{onClick:()=>f(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:n.jsx(Kt,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:""}),n.jsx("button",{onClick:()=>f(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[c.tags.length===0&&n.jsx("span",{className:"text-xs text-slate-400 self-center",children:""}),c.tags.map(I=>n.jsxs("button",{onClick:()=>oe(I),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1",children:["#",I," ",n.jsx(jt,{size:10,className:"opacity-80"})]},I))]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:k,onChange:I=>T(I.target.value),onKeyDown:I=>I.key==="Enter"&&xe(),type:"text",placeholder:"",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),n.jsx("button",{onClick:xe,className:"bg-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition",children:""})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:H.map(I=>n.jsxs("button",{onClick:()=>oe(I),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis
                                            ${c.tags.includes(I)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",I]},I))})]})]})]})]}),m&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>y(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-[30px] overflow-hidden z-[62] flex flex-col h-[70vh] animate-in slide-in-from-bottom duration-300 shadow-[0_-10px_40px_rgba(0,0,0,0.1)]",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50",children:[n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:""}),n.jsx("button",{onClick:()=>y(!1),className:"p-2 bg-slate-100 rounded-full",children:n.jsx(jt,{size:16})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",ref:Y,children:(U||[]).filter(I=>!c.roles.some(B=>B.name===I.name)).sort((I,B)=>{const X=Pe=>Pe.isPrivate&&Pe.isMine?0:!Pe.isPrivate&&Pe.isMine?1:2,ae=X(I),fe=X(B);return ae===fe?0:ae<fe?-1:1}).map(I=>n.jsxs("div",{onClick:()=>ve({name:I.name,avatar:I.avatar,oneLinePersona:I.desc,bio:I.desc}),className:"flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-2xl shadow-sm active:scale-[0.98] transition cursor-pointer hover:border-purple-200",children:[n.jsx(vs,{src:I.avatar,alt:I.name,root:Y.current,placeholderChar:(I.name||"?")[0],className:"w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-800",children:I.name}),n.jsx("div",{className:"text-xs text-slate-400 truncate w-48",children:I.desc})]}),I.isMine&&I.isPrivate&&n.jsx("span",{className:"text-pink-500 text-[10px] font-bold mr-2",children:""}),n.jsx("div",{className:"ml-auto bg-purple-50 text-purple-600 p-2 rounded-full",children:n.jsx(ht,{size:16})})]},`imp_${I.id||I.name}`))})]})]}),_&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:n.jsx(Hs,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:""}),n.jsx("button",{onClick:()=>N(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:""})]})})]})})},Dh=({onLogin:e})=>{const[t,s]=h.useState(""),[i,r]=h.useState(""),[l,o]=h.useState(!1),[a,c]=h.useState(!1),[d,u]=h.useState(null),[f,m]=h.useState({height:"100%",top:0}),y=h.useRef(null),_=h.useRef(null),N=h.useRef(null);h.useEffect(()=>{const b=()=>{window.visualViewport&&m({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`})};return window.visualViewport&&(window.visualViewport.addEventListener("resize",b),window.visualViewport.addEventListener("scroll",b),b()),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",b),window.visualViewport.removeEventListener("scroll",b))}},[]),h.useEffect(()=>{try{const b=localStorage.getItem("user_id")||"0",k=localStorage.getItem("user_username")||b,T=localStorage.getItem("user_nickname")||null;tt({userId:k,pageId:"LOGIN",name:T}),_e("","")}catch{}},[]),h.useEffect(()=>{var b;try{(b=_.current)==null||b.focus()}catch{}},[]);const E=async b=>{if(b.preventDefault(),u(null),!t.trim()||!i.trim()){u("");return}c(!0);try{const k=await ph.login(t.trim(),i.trim());if(k&&k.ok&&k.data){const T=k.data;if(T!=null&&T.access_token)try{localStorage.setItem("user_access_token",T.access_token)}catch{}if(T!=null&&T.refresh_token)try{localStorage.setItem("user_refresh_token",T.refresh_token)}catch{}try{localStorage.setItem("user_username",t.trim())}catch{}e()}else{const T=k&&k.data?k.data:{};T&&T.exists===!1?u(""):T&&T.is_active===0?u(""):u("")}}catch{u("")}finally{c(!1)}};return n.jsx("div",{ref:y,className:"fixed left-0 w-full bg-primary-50 overflow-y-auto no-scrollbar scroll-smooth font-sans animate-in fade-in duration-700",style:{...f,overscrollBehavior:"none"},children:n.jsx("div",{className:"h-full w-full max-w-md mx-auto bg-white rounded-none md:rounded-3xl shadow-2xl border border-slate-200 overflow-hidden",children:n.jsx("div",{className:"min-h-full w-full flex flex-col px-8 py-10",children:n.jsxs("div",{className:"w-full flex flex-col items-center z-10 max-w-sm m-auto",children:[n.jsx("div",{className:"text-center mb-12",children:n.jsx("h1",{className:"text-[40px] font-extrabold text-[#A855F7] mb-0 tracking-tight font-sans",children:"YumeCrush"})}),n.jsxs("form",{onSubmit:E,className:"w-full space-y-5",children:[n.jsx("input",{type:"text",placeholder:"",value:t,onChange:b=>s(b.target.value),ref:_,className:"w-full h-[60px] px-6 rounded-2xl bg-white border border-[#F3F4F6] text-[#374151] placeholder:text-[#D1D5DB] outline-none focus:border-[#C084FC] focus:bg focus:ring-4 focus:ring-[#F3E8FF] transition-all text-[15px] font-medium shadow-sm"}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:l?"text":"password",placeholder:"",value:i,onChange:b=>r(b.target.value),ref:N,className:"w-full h-[60px] px-6 rounded-2xl bg border border-[#F3F4F6] text-[#374151] placeholder:text-[#D1D5DB] outline-none focus:border-[#C084FC] focus:bg focus:ring-4 focus:ring-[#F3E8FF] transition-all text-[15px] font-medium shadow-sm"}),n.jsx("button",{type:"button",onClick:()=>o(!l),className:"absolute right-5 top-1/2 -translate-y-1/2 text-[#9CA3AF] hover:text-[#C084FC] transition-colors",children:l?n.jsx(go,{size:20}):n.jsx(vo,{size:20})})]}),d&&n.jsx("div",{className:"text-red-500 text-xs font-bold",children:d}),n.jsx("button",{type:"submit",disabled:a,className:`w-full h-[60px] ${a?"bg-[#A855F7]/70":"bg-[#A855F7] hover:bg-[#9333EA]"} text-white font-bold text-[16px] rounded-2xl shadow-[0_10px_30px_rgba(168,85,247,0.3)] active:scale-[0.98] transition-all mt-4`,children:a?"...":""})]})]})})})})},Lh=e=>({id:typeof(e==null?void 0:e.mypage_id)=="number"?e.mypage_id:(e==null?void 0:e.id)??Date.now(),title:(e==null?void 0:e.mypage_title)??(e==null?void 0:e.title)??"",description:(e==null?void 0:e.mypage_description)??(e==null?void 0:e.description)??"",image:(e==null?void 0:e.mypage_image)??(e==null?void 0:e.image)??"",status:(e==null?void 0:e.mypage_status)??(e==null?void 0:e.status)??void 0,tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[]}),Vh=async e=>{const t=new URLSearchParams;e&&t.set("includeDrafts",String(e.includeDrafts));const{authFetch:s}=await ye(async()=>{const{authFetch:o}=await import("./http-Dwii6HrH.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),i=await s(`/user/stories?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return(Array.isArray(r==null?void 0:r.items)?r.items:[]).map(Lh)},gr=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:r}=await import("./http-Dwii6HrH.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/user/stories/${e}`);if(!s.ok)throw new Error("failed");const i=await s.json();return{id:(i==null?void 0:i.id)??e,title:(i==null?void 0:i.title)??"",description:(i==null?void 0:i.description)??"",image:(i==null?void 0:i.image)??"",user_avatar:(i==null?void 0:i.user_avatar)??"",status:(i==null?void 0:i.status)??void 0,content:(i==null?void 0:i.content)??"",publishDate:(i==null?void 0:i.publish_date)??void 0,tags:Array.isArray(i==null?void 0:i.tags)?i.tags:[],characterIds:Array.isArray(i==null?void 0:i.characterIds)?i.characterIds:[]}},Fh=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:i}=await import("./http-Dwii6HrH.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user/stories/${e}`,{method:"DELETE"})).ok)throw new Error("failed");return!0},Oh=({avatar:e,name:t})=>{const[s,i]=h.useState(!1);return n.jsx("div",{className:"w-14 h-14 rounded-full bg-slate-100 flex-shrink-0 overflow-hidden border border-slate-50 flex items-center justify-center",children:!s&&e?n.jsx("img",{src:e,className:"w-full h-full object-cover",alt:t,onError:()=>i(!0)}):n.jsx("span",{className:"text-base font-bold text-slate-500",children:(t==null?void 0:t[0])||"?"})})},$h=({userProfile:e,myCharacters:t,myUserCharacters:s,myStories:i,onUpdateProfile:r,onCharacterClick:l,onLogout:o,onEditStory:a,onDeleteStory:c,onEditCharacter:d,onDeleteCharacter:u,onReadStory:f,onAddStory:m,onAddCharacter:y})=>{var dt;const[_,N]=h.useState(!1),[E,b]=h.useState(e.nickname),[k,T]=h.useState(!1),[$,S]=h.useState(null),[A,V]=h.useState(!1),[R,G]=h.useState(!1),O=(navigator==null?void 0:navigator.maxTouchPoints)>0,[U,le]=h.useState(i||[]),[ne,C]=h.useState({}),[F,J]=h.useState(null),Y=h.useRef(0),se=h.useRef(0),H=h.useRef(null),ee=h.useRef(0),[me,oe]=h.useState(s||[]),[xe,ve]=h.useState({}),[w,z]=h.useState(null),L=h.useRef(0),ie=h.useRef(0),te=h.useRef(null),Ae=h.useRef(0),[he,Re]=h.useState({visible:!1,x:0,y:0,id:null,type:null}),ke=(P,v,D)=>{if(P.preventDefault(),O)return;let W=P.clientX;const K=140;W+K>window.innerWidth&&(W=window.innerWidth-K-10),Re({visible:!0,x:W,y:P.clientY,id:v,type:D})},He=h.useRef(null),I=P=>{var ge;const v=P.split(","),D=((ge=v[0].match(/:(.*?);/))==null?void 0:ge[1])||"image/jpeg",W=atob(v[1]);let K=W.length;const q=new Uint8Array(K);for(;K--;)q[K]=W.charCodeAt(K);return new Blob([q],{type:D})},B=()=>{var P;(P=He.current)==null||P.click()},X=P=>{var D;const v=(D=P.target.files)==null?void 0:D[0];if(v){V(!0);const W=new FileReader;W.onloadend=()=>{S(W.result),V(!1)},W.readAsDataURL(v)}He.current&&(He.current.value="")},ae=async()=>{const P=E.trim();if(!P){b(e.nickname),N(!1);return}try{const{authFetch:v}=await ye(async()=>{const{authFetch:D}=await import("./http-Dwii6HrH.js");return{authFetch:D}},__vite__mapDeps([0,1,2,3]));await v("/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:P})}),r({...e,nickname:P})}catch{b(e.nickname)}N(!1)};h.useEffect(()=>{le(i||[])},[e.usedCount]),h.useEffect(()=>{le(i||[])},[i]),h.useEffect(()=>{oe(s||[])},[s]);const fe=(P,v)=>{Y.current=P.touches[0].clientX,se.current=P.touches[0].clientY,H.current=v,ee.current=ne[v]||0},Pe=(P,v)=>{if(H.current!==v)return;const D=P.touches[0].clientX-Y.current,W=P.touches[0].clientY-se.current;if(Math.abs(W)>Math.abs(D))return;let K=0;ee.current===0?K=Math.max(-96,Math.min(96,D)):ee.current>0?K=Math.max(0,Math.min(96,ee.current+D)):K=Math.min(0,Math.max(-96,ee.current+D)),C(q=>({...q,[v]:K}))},De=P=>{if(H.current!==P)return;const v=ne[P]||0;let D=0;ee.current===0?D=v>60?96:v<-60?-96:0:ee.current>0?D=v>60?96:0:D=v<-60?-96:0,C(W=>({...W,[P]:D})),H.current=null},Ie=P=>C(v=>({...v,[P]:0})),Me=(P,v)=>{L.current=P.touches[0].clientX,ie.current=P.touches[0].clientY,te.current=v,Ae.current=xe[v]||0},be=(P,v)=>{if(te.current!==v)return;const D=P.touches[0].clientX-L.current,W=P.touches[0].clientY-ie.current;if(Math.abs(W)>Math.abs(D))return;let K=0;Ae.current===0?K=Math.max(-96,Math.min(96,D)):Ae.current>0?K=Math.max(0,Math.min(96,Ae.current+D)):K=Math.min(0,Math.max(-96,Ae.current+D)),ve(q=>({...q,[v]:K}))},Le=P=>{if(te.current!==P)return;const v=xe[P]||0;let D=0;Ae.current===0?D=v>60?96:v<-60?-96:0:Ae.current>0?D=v>60?96:0:D=v<-60?-96:0,ve(W=>({...W,[P]:D})),te.current=null},Be=P=>ve(v=>({...v,[P]:0})),Ue=P=>{Ie(P.id),a&&a(P)},Qe=async P=>{const v=U.find(D=>D.id===P);if(J(null),c&&v){c(v);return}try{await Fh(P),le(D=>D.filter(W=>W.id!==P))}catch{}},xt=P=>{Be(P.id),d&&d(P)},rt=async P=>{const v=me.find(D=>D.id===P);z(null),u&&v&&u(v);try{await Ih(P),oe(D=>D.filter(W=>W.id!==P)),u&&v&&u(v)}catch{}};return n.jsxs("div",{className:"h-full w-full bg-[#F8F9FB] flex flex-col font-kosugi relative",children:[$&&n.jsx(As,{imageSrc:$,onCancel:()=>S(null),onCrop:async P=>{const v=localStorage.getItem("user_access_token");let D=P;try{if(P&&P.startsWith("data:image")){const W=I(P),K=new FormData,q=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;K.append("avatar",W,"avatar.jpg"),K.append("filename",q),D=`/uploads/users/avatars/${q}`,await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:v?`Bearer ${v}`:""},body:K}).catch(()=>{})}}catch{}try{const{authFetch:W}=await ye(async()=>{const{authFetch:K}=await import("./http-Dwii6HrH.js");return{authFetch:K}},__vite__mapDeps([0,1,2,3]));await W("/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:D})})}catch{}r({...e,avatar:D||e.avatar}),S(null)}}),n.jsxs("div",{className:"relative pb-4",children:[n.jsxs("div",{className:"h-40 bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 rounded-b-[40px] relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-[-20px] left-[-20px] w-40 h-40 bg-white/20 rounded-full blur-xl"}),n.jsx("div",{className:"absolute bottom-[-10px] right-[-10px] w-32 h-32 bg-purple-400/20 rounded-full blur-xl"})]}),n.jsxs("div",{className:"absolute top-16 left-4 right-4 bg-white rounded-3xl shadow-lg p-4 flex flex-col items-center animate-in slide-in-from-bottom-4 duration-500",children:[n.jsxs("div",{className:"relative -mt-12 mb-2 group cursor-pointer",onClick:B,children:[n.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white shadow-md overflow-hidden bg-slate-100 flex items-center justify-center",children:!R&&(e.avatar||!0)?n.jsx("img",{src:e.avatar||"/uploads/avatars/default_avatar.jpg",alt:"Me",className:"w-full h-full object-cover",onError:()=>G(!0)}):n.jsx("span",{className:"text-xl font-bold text-slate-500",children:((dt=e.nickname)==null?void 0:dt[0])||"?"})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-primary-500 p-1.5 rounded-full text-white border-2 border-white shadow-sm",children:n.jsx(un,{size:10})}),n.jsx("input",{type:"file",ref:He,className:"hidden",accept:"image/*",onChange:X})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[_?n.jsx("input",{value:E,onChange:P=>b(P.target.value),onBlur:ae,onKeyDown:P=>P.key==="Enter"&&ae(),autoFocus:!0,className:"text-lg font-bold text-center text-slate-800 border-b-2 border-primary-300 outline-none bg-transparent min-w-[100px]"}):n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:e.nickname}),!_&&n.jsx("button",{onClick:()=>N(!0),className:"text-slate-400 hover:text-primary-500",children:n.jsx(Ws,{size:12})})]}),n.jsx("div",{className:"flex flex-col items-center gap-1 mb-1",children:n.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-[10px] font-bold bg-slate-50 px-3 py-0.5 rounded-full",children:[n.jsx(_o,{size:10}),n.jsx("span",{className:"tracking-wide",children:e.email})]})})]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-24 space-y-6 no-scrollbar mt-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-1 h-4 bg-indigo-400 rounded-full"}),n.jsx("h3",{className:"font-bold text-slate-700",children:""})]}),n.jsx("button",{onClick:m,className:"w-6 h-6 flex items-center justify-center rounded-full bg-white text-purple-500 border border-purple-100 shadow-sm hover:bg-purple-50 active:scale-95",children:n.jsx(ht,{size:14})})]}),U&&U.length>0?n.jsx("div",{className:"flex flex-col gap-3",children:U.map(P=>n.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[(()=>{const v=ne[P.id]||0,D=Math.min(96,Math.max(0,-v)),W=Math.min(96,Math.max(0,v));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${D}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>J(P.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-2xl shadow-sm",style:{width:`${W}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>Ue(P),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onTouchStart:v=>fe(v,P.id),onTouchMove:v=>Pe(v,P.id),onTouchEnd:()=>De(P.id),onContextMenu:v=>ke(v,P.id,"story"),onClick:()=>{(ne[P.id]||0)===0&&f&&f(P)},style:{transform:`translateX(${ne[P.id]||0}px)`,transition:"transform 180ms ease"},className:`${(ne[P.id]||0)<0?"rounded-l-2xl rounded-r-none":(ne[P.id]||0)>0?"rounded-l-none rounded-r-2xl":"rounded-2xl"} bg-white p-3 shadow-sm flex gap-4 border border-transparent hover:border-indigo-100 group relative overflow-hidden`,children:[n.jsx("div",{className:"w-16 h-20 rounded-xl bg-slate-100 flex-shrink-0 overflow-hidden relative",children:n.jsx("img",{src:P.image||"/uploads/covers/default_storyimg.jpg",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:P.title})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:"font-bold text-slate-800 text-base",children:P.title}),n.jsx("div",{className:"flex flex-col items-end gap-0.5",children:n.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${P.status==="published"?"bg-green-100 text-green-600":"bg-slate-100 text-slate-400"}`,children:P.status==="published"?"":""})})]}),n.jsx("p",{className:"text-xs text-slate-400 line-clamp-1",children:P.description}),n.jsx("div",{className:"flex gap-2 mt-2",children:(P.tags||[]).slice(0,2).map(v=>n.jsx("span",{className:"text-[10px] bg-slate-50 text-slate-400 px-1.5 py-0.5 rounded",children:v},v))})]}),n.jsx("div",{className:"self-center",children:n.jsx(Do,{size:16,className:"text-slate-300"})})]})]},P.id))}):n.jsx("div",{className:"bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-50 border-dashed",children:n.jsx("p",{className:"text-xs text-slate-400",children:""})})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-1 h-4 bg-purple-400 rounded-full"}),n.jsx("h3",{className:"font-bold text-slate-700",children:""})]}),n.jsx("button",{onClick:y,className:"w-6 h-6 flex items-center justify-center rounded-full bg-white text-purple-500 border border-purple-100 shadow-sm hover:bg-purple-50 active:scale-95",children:n.jsx(ht,{size:14})})]}),me.length>0?n.jsx("div",{className:"flex flex-col gap-3",children:me.map(P=>n.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[(()=>{const v=xe[P.id]||0,D=Math.min(96,Math.max(0,-v)),W=Math.min(96,Math.max(0,v));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${D}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>z(P.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-2xl shadow-sm",style:{width:`${W}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>xt(P),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onClick:()=>l(P),onTouchStart:v=>Me(v,P.id),onTouchMove:v=>be(v,P.id),onTouchEnd:()=>Le(P.id),onContextMenu:v=>ke(v,P.id,"character"),style:{transform:`translateX(${xe[P.id]||0}px)`,transition:"transform 180ms ease"},className:`${(xe[P.id]||0)<0?"rounded-l-2xl rounded-r-none":(xe[P.id]||0)>0?"rounded-l-none rounded-r-2xl":"rounded-2xl"} bg-white p-3 shadow-sm flex items-center gap-4 active:scale-[0.98] transition-all cursor-pointer border border-transparent hover:border-purple-100 group relative overflow-hidden`,children:[n.jsx(Oh,{avatar:P.avatar,name:P.name}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:"font-bold text-slate-800",children:P.name}),n.jsx("div",{className:"flex flex-col items-end gap-0.5",children:n.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${P.isPublished?P.isPublic?"bg-green-100 text-green-600":"bg-pink-100 text-pink-600":"bg-slate-100 text-slate-400"}`,children:P.isPublished?P.isPublic?"":"":""})})]}),n.jsx("p",{className:"text-xs text-slate-400 truncate mt-1",children:P.oneLinePersona||P.bio})]}),n.jsx(js,{size:16,className:"text-slate-300"})]})]},P.id))}):n.jsx("div",{className:"bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-50 border-dashed",children:n.jsx("p",{className:"text-xs text-slate-400",children:""})})]}),n.jsx("div",{className:"bg-white rounded-3xl shadow-sm p-2",children:n.jsxs("button",{onClick:()=>T(!0),className:"w-full flex items-center justify-center gap-3 p-2 hover:bg-red-50 active:bg-red-100 active:scale-95 rounded-2xl transition-all group",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-red-50 text-red-400 flex items-center justify-center group-hover:bg-red-100 group-hover:text-red-500 transition-colors",children:n.jsx(Jn,{size:16})}),n.jsx("span",{className:"text-center font-bold text-slate-700 text-sm group-hover:text-red-500",children:""})]})})]}),k&&n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-[32px] p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-50 text-red-400 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Jn,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:""}),n.jsx("p",{className:"text-xs text-slate-400 mb-6 px-4 leading-relaxed"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>T(!1),className:"flex-1 py-3 rounded-2xl bg-slate-100 text-slate-600 font-bold hover:bg-slate-200 transition-colors text-sm",children:""}),n.jsx("button",{onClick:o,className:"flex-1 py-3 rounded-2xl bg-red-500 text-white font-bold shadow-lg shadow-red-200 hover:bg-red-600 transition-colors text-sm",children:""})]})]})}),F&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{F!=null&&Ie(F),J(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{Qe(F)},children:""})]})]})}),n.jsx("style",{children:`
            @keyframes fadeCard { from { opacity: 0; transform: translateY(-6px) } to { opacity: 1; transform: translateY(0) } }
            @keyframes fadeBg { from { opacity: 0 } to { opacity: 1 } }
          `})]}),w&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{w!=null&&Be(w),z(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{rt(w)},children:""})]})]})})]}),A&&n.jsx("div",{className:"fixed inset-0 z-[90] bg-black flex items-center justify-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})}),he.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>Re(P=>({...P,visible:!1})),onContextMenu:P=>{P.preventDefault(),Re(v=>({...v,visible:!1}))}}),n.jsxs("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95 duration-100",style:{top:he.y,left:he.x},children:[n.jsxs("button",{onClick:()=>{if(he.type==="story"){const P=U.find(v=>v.id===he.id);P&&Ue(P)}else if(he.type==="character"){const P=me.find(v=>v.id===he.id);P&&xt(P)}Re(P=>({...P,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50 flex items-center gap-2 transition-colors",children:[n.jsx(Ws,{size:16,className:"text-indigo-500"}),""]}),n.jsx("div",{className:"h-[1px] bg-slate-100 w-full"}),n.jsxs("button",{onClick:()=>{he.type==="story"?J(he.id):he.type==="character"&&z(he.id),Re(P=>({...P,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 flex items-center gap-2 transition-colors",children:[n.jsx(dn,{size:16}),""]})]})]})]})},yr=async e=>{const t=new URLSearchParams;e!=null&&e.limit&&t.set("limit",String(e.limit)),typeof(e==null?void 0:e.offset)=="number"&&t.set("offset",String(e.offset));const{authFetch:s}=await ye(async()=>{const{authFetch:o}=await import("./http-Dwii6HrH.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),i=await s(`/stories/?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return Array.isArray(r==null?void 0:r.items)?r.items:[]},zh=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:r}=await import("./http-Dwii6HrH.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/stories/${e}`);if(!s.ok)throw new Error("failed");return await s.json()},Bh=({story:e,onBack:t,onStartRoleplay:s,connectedRoleNames:i=[],validRoleNames:r=[]})=>{const l=h.useRef(null),o=h.useRef(null),[a,c]=h.useState(20),[d,u]=h.useState(0),[f,m]=h.useState(!1),[y,_]=h.useState(!1),[N,E]=h.useState(null),[b,k]=h.useState(!1),T=h.useRef(0),$=h.useRef(0),S=h.useCallback(()=>{if(!l.current||!o.current)return;const{scrollTop:O,scrollHeight:U,clientHeight:le}=l.current,ne=o.current.clientHeight;if(U<=le){c(ne),u(0);return}const C=le/U,F=Math.max(C*ne,30);c(F);const J=U-le,Y=ne-F,se=O/J;u(se*Y)},[]);h.useEffect(()=>{try{const O=localStorage.getItem("user_id")||"0",U=localStorage.getItem("user_username")||O,le=localStorage.getItem("user_nickname")||"";tt({userId:U,pageId:"READ_STORY",name:le}),_e("",""),_e("",(e==null?void 0:e.title)||"")}catch{}},[e==null?void 0:e.title]),h.useEffect(()=>{const O=new ResizeObserver(()=>{S()});l.current&&O.observe(l.current),o.current&&O.observe(o.current);const U=setTimeout(S,100);return()=>{O.disconnect(),clearTimeout(U)}},[S]);const A=O=>{O.preventDefault(),O.stopPropagation(),m(!0);const U="touches"in O?O.touches[0].clientX:O.clientY;T.current=U,$.current=d};h.useEffect(()=>{const O=le=>{if(!f||!l.current||!o.current)return;le.preventDefault();const C=("touches"in le?le.touches[0].clientY:le.clientY)-T.current,J=o.current.clientHeight-a,Y=l.current.scrollHeight-l.current.clientHeight;if(J<=0)return;let se=$.current+C;se=Math.max(0,Math.min(se,J));const H=se/J;l.current.scrollTop=H*Y},U=()=>{m(!1)};return f&&(document.addEventListener("mousemove",O),document.addEventListener("mouseup",U),document.addEventListener("touchmove",O,{passive:!1}),document.addEventListener("touchend",U)),()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",U),document.removeEventListener("touchmove",O),document.removeEventListener("touchend",U)}},[f,a]);const V=()=>{if(N){if(i.includes(N)){k(!0);return}const O=(e.availableRoles||[]).find(U=>U.name===N);O&&s(O)}},R=e.content.split(`
`).filter(O=>O.trim()!==""),G=(e.availableRoles||[]).filter(O=>r&&r.length?r.includes(O.name):!0);return n.jsxs("div",{className:"fixed inset-0 bg-white z-[60] flex flex-col h-full w-full animate-in slide-in-from-right duration-300",children:[n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col relative bg-white rounded-none md:rounded-3xl md:overflow-hidden shadow-2xl",children:[n.jsx("button",{onClick:t,className:"absolute top-4 left-4 z-[100] w-10 h-10 bg-black/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(ws,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar bg-[#FAFAFA]",onScroll:S,ref:l,children:[n.jsxs("div",{className:"w-full h-64 relative",children:[n.jsx("img",{src:e.image||"/uploads/covers/default_storyimg.jpg",alt:e.title,className:"w-full h-full object-cover"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#FAFAFA] to-transparent"})]}),n.jsxs("div",{className:"px-6 -mt-12 relative z-10 pb-20",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4 leading-tight",children:e.title}),n.jsxs("div",{className:"flex items-center mt-2",children:[n.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-200 overflow-hidden border border-white shadow-sm mr-3",children:n.jsx("img",{src:e.user_avatar||`https://api.dicebear.com/7.x/miniavs/svg?seed=${e.author}`,alt:"author",className:"w-full h-full object-cover"})}),n.jsx("span",{className:"text-sm font-bold text-slate-700",children:e.author})]})]}),n.jsx("article",{className:"prose prose-slate max-w-none",children:R.map((O,U)=>n.jsx("p",{className:"mb-6 text-justify tracking-wide text-[16px]",style:{lineHeight:1.8,color:"#334155"},children:O},U))}),n.jsx("div",{className:"flex items-center justify-center my-10",children:n.jsx("span",{className:"text-slate-400/80 text-sm font-medium tracking-widest",children:"  "})}),n.jsx("div",{className:"mb-12 flex flex-wrap gap-4 pl-1",children:e.tags.map(O=>n.jsxs("span",{className:"text-sm text-slate-400",children:["#",O]},O))}),G.length>0&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-6 py-3 bg-purple-100 rounded-full shadow-lg shadow-purple-200/50 hover:bg-purple-200 transition-all active:scale-95 cursor-pointer",children:[n.jsx("span",{className:"text-lg font-bold text-purple-600 tracking-widest",children:""}),n.jsx(co,{size:18,className:"text-purple-600"})]})})]})]}),n.jsx("div",{ref:o,className:"absolute right-1 top-4 bottom-4 w-1.5 z-[70]",children:n.jsx("div",{className:"w-full rounded-full cursor-pointer transition-colors duration-200 bg-slate-400/40 hover:bg-slate-400/60",style:{height:`${a}px`,transform:`translateY(${d}px)`,touchAction:"none"},onMouseDown:A,onTouchStart:A})})]}),y&&n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:n.jsxs("div",{className:"bg-white w-[85%] max-w-sm rounded-[32px] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300",children:[n.jsxs("div",{className:"p-6 pb-2",children:[n.jsx("h3",{className:"text-xl font-bold text-slate-900 text-center mb-6 font-kosugi",children:""}),n.jsx("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto no-scrollbar py-2 px-1",children:G.length>0?G.map(O=>{const U=N===O.name,le=i.includes(O.name);return n.jsxs("div",{onClick:()=>E(O.name),className:`
                                            relative p-4 rounded-2xl flex items-center justify-between cursor-pointer transition-all border-2
                                            ${U?"bg-purple-50 border-purple-500 shadow-md scale-[1.02]":"bg-slate-50 border-transparent hover:bg-slate-100"}
                                        `,children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:`font-bold text-base ${U?"text-purple-700":"text-slate-800"}`,children:O.name}),le&&n.jsx("span",{className:"text-[10px] text-green-500 font-bold mt-1",children:" "})]}),U&&n.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center text-white shadow-sm",children:n.jsx(jr,{size:12,strokeWidth:3})})]},O.name)}):n.jsx("p",{className:"text-center text-slate-400 py-4 text-sm",children:""})})]}),n.jsx("div",{className:"p-6 pt-2 bg-gradient-to-t from-white via-white to-transparent",children:n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>_(!1),className:"flex-1 py-3.5 rounded-2xl border border-slate-200 font-bold text-slate-500 hover:bg-slate-50 text-sm",children:""}),n.jsx("button",{onClick:V,disabled:!N,className:`
                                   flex-1 py-3.5 rounded-2xl font-bold text-white text-sm shadow-lg transition-all flex items-center justify-center gap-2
                                   ${N?"bg-purple-600 shadow-purple-200 hover:bg-purple-700 active:scale-95":"bg-slate-300 shadow-none cursor-not-allowed"}
                               `,children:""})]})})]})}),b&&n.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center text-center",children:[n.jsx("div",{className:"w-12 h-12 bg-purple-100 text-purple-500 rounded-full flex items-center justify-center mb-4",children:n.jsx(wr,{size:24})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 mb-6 font-kosugi",children:""}),n.jsx("button",{onClick:()=>k(!1),className:"w-full py-3 rounded-2xl bg-purple-600 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-700 transition-colors text-sm font-kosugi",children:""})]})})]})},io=e=>({id:(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.character_id)??String(Date.now()),name:(e==null?void 0:e.name)??(e==null?void 0:e.title)??"",avatar:(e==null?void 0:e.avatar)??(e==null?void 0:e.cover)??(e==null?void 0:e.image)??"",profileImage:(e==null?void 0:e.profileImage)??(e==null?void 0:e.banner)??(e==null?void 0:e.image)??"",bio:(e==null?void 0:e.bio)??(e==null?void 0:e.tagline)??(e==null?void 0:e.description)??"",tags:(e==null?void 0:e.tags)??(e==null?void 0:e.keywords)??[],creator:(e==null?void 0:e.creator)??(e==null?void 0:e.author)??"",oneLinePersona:(e==null?void 0:e.oneLinePersona)??(e==null?void 0:e.tagline)??"",personality:(e==null?void 0:e.personality)??(e==null?void 0:e.personality)??"",profession:(e==null?void 0:e.profession)??(e==null?void 0:e.occupation)??"",age:(e==null?void 0:e.age)??"",roleType:(e==null?void 0:e.roleType)??(e==null?void 0:e.character_type)??"",currentRelationship:(e==null?void 0:e.currentRelationship)??(e==null?void 0:e.relationship)??"",plotTheme:(e==null?void 0:e.plotTheme)??(e==null?void 0:e.plot_theme)??"",plotDescription:(e==null?void 0:e.plotDescription)??(e==null?void 0:e.plot_summary)??"",openingLine:(e==null?void 0:e.openingLine)??(e==null?void 0:e.opening_line)??""}),vr=async e=>{const t=new URLSearchParams;e!=null&&e.tag&&t.set("tag",e.tag),e!=null&&e.limit&&t.set("limit",String(e.limit)),typeof(e==null?void 0:e.offset)=="number"&&t.set("offset",String(e.offset));const{authFetch:s}=await ye(async()=>{const{authFetch:o}=await import("./http-Dwii6HrH.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),i=await s(`/characters/?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return(Array.isArray(r==null?void 0:r.items)?r.items:[]).map(io)},Us=async e=>{const{authFetch:t}=await ye(async()=>{const{authFetch:r}=await import("./http-Dwii6HrH.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/characters/${e}`);if(!s.ok)throw new Error("failed");const i=await s.json();return io(i)},Uh=[],Hh=({char:e,root:t})=>{var s;return n.jsx(vs,{src:e.avatar,alt:e.name,root:t,placeholderChar:((s=e.name)==null?void 0:s[0])||"?",className:"w-20 h-28 flex-shrink-0 rounded-xl overflow-hidden bg-slate-100 relative group flex items-center justify-center"})},Wh=()=>{const[e,t]=h.useState(we.HOME),[s,i]=h.useState(Uh),[r,l]=h.useState([]),[o,a]=h.useState(!1),[c,d]=h.useState(null),[u,f]=h.useState(null),[m,y]=h.useState("stories"),[_,N]=h.useState(!1),[E,b]=h.useState(void 0),[k,T]=h.useState(!1),[$,S]=h.useState(!1),[A,V]=h.useState(null),[R,G]=h.useState(null),[O,U]=h.useState([]),[le,ne]=h.useState(null),[C,F]=h.useState([]),[J,Y]=h.useState(null),[se,H]=h.useState([]),[ee,me]=h.useState(!!localStorage.getItem("user_access_token")),[oe,xe]=h.useState(()=>{const x=localStorage.getItem("user_nickname")||"",M=localStorage.getItem("user_email")||"me@example.com",p=localStorage.getItem("user_avatar")||"";return{nickname:x,email:M,avatar:p}}),[ve,w]=h.useState(!1),[z,L]=h.useState(!1),[ie,te]=h.useState([]),[Ae,he]=h.useState(!1),[Re,ke]=h.useState({height:"100%",top:0}),[He,I]=h.useState(0),[B,X]=h.useState(!0),[ae,fe]=h.useState(!1),Pe=h.useRef(null),De=h.useRef(null),Ie=h.useRef(null),[Me,be]=h.useState(0),[Le,Be]=h.useState(!0),[Ue,Qe]=h.useState(!1),xt=h.useRef(null),rt=h.useRef(null),dt=h.useRef(!1),P=()=>{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token"),localStorage.removeItem("user_nickname"),localStorage.removeItem("user_email"),localStorage.removeItem("user_avatar"),b(void 0),d(null),f(null),t(we.HOME),me(!1)};if(h.useEffect(()=>{if(c)try{const x=localStorage.getItem(`chat_config_${c.character.id}`),M=x?JSON.parse(x):null,p=localStorage.getItem("user_id")||"0",g=localStorage.getItem("user_username")||p,j=localStorage.getItem("user_nickname")||"";tt({userId:g,sessionId:localStorage.getItem(`chat_session_${p}_${c.character.id}`)||void 0,pageId:"CHAT",name:j}),_e("",""),_e("ID",String(c.character.id)),M!=null&&M.chatMode&&_e("",M.chatMode==="scene"?"":"")}catch{}},[c]),h.useEffect(()=>{ee&&((async()=>{try{const{authFetch:x}=await ye(async()=>{const{authFetch:p}=await import("./http-Dwii6HrH.js");return{authFetch:p}},__vite__mapDeps([0,1,2,3])),M=await x("/user/profile");if(M&&M.ok){const p=await M.json(),g=(p==null?void 0:p.nickname)||"",j=(p==null?void 0:p.email)||"me@example.com",re=(p==null?void 0:p.avatar)||"",Q=typeof(p==null?void 0:p.used_count)=="number"?p.used_count:0;xe({nickname:g,email:j,avatar:re,usedCount:Q});try{localStorage.setItem("user_nickname",g),localStorage.setItem("user_email",j),re&&localStorage.setItem("user_avatar",re);const Ne=(p==null?void 0:p.id)??(p==null?void 0:p.user_id)??(p==null?void 0:p.uid);Ne!=null&&localStorage.setItem("user_id",String(Ne));const ce=localStorage.getItem("user_username")||String((p==null?void 0:p.username)||"");tt({userId:ce||localStorage.getItem("user_id")||String(Ne||""),name:g})}catch{}}}catch{}})(),(async()=>{try{const x=await yr({limit:10,offset:0});U(x),be(x.length),Be(x.length===10)}catch{U([]),be(0),Be(!1)}})(),a(!0),vr({limit:10,offset:0}).then(x=>{const M=x.map(p=>({id:String(p.id),name:p.name||"",avatar:p.avatar||"",profileImage:p.profileImage||"",status:qe.ONLINE,bio:p.bio||"",tags:Array.isArray(p.tags)?p.tags:[],creator:p.creator||"",oneLinePersona:p.oneLinePersona||"",personality:p.personality||"",profession:p.profession||"",age:p.age||"",roleType:p.roleType||"",currentRelationship:p.currentRelationship||"",plotTheme:p.plotTheme||"",plotDescription:p.plotDescription||"",openingLine:p.openingLine||""}));l(M),I(x.length),X(x.length===10);try{const p=new Map,g=localStorage.getItem("user_id")||"0",re=Object.keys(localStorage).filter(ce=>ce.startsWith(`chat_history_${g}_`)),Q=ce=>JSON.parse(ce);re.forEach(ce=>{try{const ue=ce.replace(`chat_history_${g}_`,""),pe=localStorage.getItem(ce);if(!pe)return;const Ve=Q(pe);if(!Ve.length)return;const de=M.find(gt=>String(gt.id)===String(ue));if(!de)return;const We=Ve[Ve.length-1],et={id:We.id,senderId:We.senderId,text:We.text,timestamp:new Date(We.ts),type:We.type};p.set(String(ue),{characterId:String(ue),character:de,lastMessage:et,unreadCount:0})}catch{}});const Ne=Array.from(p.values());Ne.length&&i(Ne)}catch{}}).catch(()=>l([])).finally(()=>a(!1)),(async()=>{try{const x=await Ch(),p=(Array.isArray(x)?x.filter(g=>typeof(g==null?void 0:g.mypage_id)<"u"&&typeof(g==null?void 0:g.mypage_name)=="string"&&typeof(g==null?void 0:g.mypage_visibility)=="string"&&typeof(g==null?void 0:g.mypage_status)=="string"):[]).map(g=>({id:String(g.mypage_id),name:g.mypage_name||"",avatar:g.mypage_avatar||"",profileImage:"",status:qe.ONLINE,bio:"",tags:[],creator:oe.nickname||"",oneLinePersona:g.mypage_tagline||"",personality:"",profession:"",age:"",roleType:"",gender:"",currentRelationship:"",plotTheme:"",plotDescription:"",openingLine:"",styleExamples:[],hobbies:"",experiences:"",isPublic:g.mypage_visibility?g.mypage_visibility==="public":!1,isPublished:g.mypage_status==="published"}));te(p)}catch{te([])}})(),(async()=>{try{const M=(await Vh({includeDrafts:!0})).map(p=>({id:typeof p.id=="number"?p.id:Number(Date.now()),title:p.title||"",description:p.description||"",image:p.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(p.tags)?p.tags:[],author:oe.nickname||"",likes:"0",content:"",status:p.status}));F(M)}catch{F([])}})())},[ee]),h.useEffect(()=>{if(!ee||dt.current)return;(async()=>{try{const M=localStorage.getItem("user_id")||"0",g=Object.keys(localStorage).filter(ue=>ue.startsWith(`chat_history_${M}_`)),j=ue=>JSON.parse(ue),re=new Map,Q=ue=>{const pe=String(ue);return r.find(Ve=>String(Ve.id)===pe)||ie.find(Ve=>String(Ve.id)===pe)},Ne=[];if(g.forEach(ue=>{try{const pe=ue.replace(`chat_history_${M}_`,""),Ve=localStorage.getItem(ue);if(!Ve)return;const de=j(Ve);if(!de.length)return;const We=Q(pe);if(!We){Ne.push(pe);return}const et=de[de.length-1],gt={id:et.id,senderId:et.senderId,text:et.text,timestamp:new Date(et.ts),type:et.type};re.set(String(pe),{characterId:String(pe),character:We,lastMessage:gt,unreadCount:0})}catch{}}),Ne.length){const ue=Ne.slice(0,20);(await Promise.all(ue.map(async Ve=>{try{const de=await Us(Ve);if(de&&de.id)return{id:String(de.id),name:de.name||"",avatar:de.avatar||"",profileImage:de.profileImage||"",status:qe.ONLINE,bio:de.bio||"",tags:Array.isArray(de.tags)?de.tags:[],creator:de.creator||"",oneLinePersona:de.oneLinePersona||"",personality:de.personality||"",profession:de.occupation||"",age:de.age||""}}catch{}try{const de=await Pt(Ve);if(de&&de.id)return{id:String(Ve),name:de.name||"",avatar:de.avatar||"",profileImage:"",status:qe.ONLINE,bio:de.tagline||"",tags:Array.isArray(de.tags)?de.tags:[],creator:oe.nickname||"",oneLinePersona:de.tagline||"",personality:de.personality||"",profession:de.occupation||"",age:de.age?String(de.age):""}}catch{}}))).forEach((Ve,de)=>{const We=ue[de];if(!Ve)return;const et=localStorage.getItem(`chat_history_${M}_${We}`);if(et)try{const gt=j(et);if(!gt.length)return;const Lt=gt[gt.length-1],ro={id:Lt.id,senderId:Lt.senderId,text:Lt.text,timestamp:new Date(Lt.ts),type:Lt.type};re.set(String(We),{characterId:String(We),character:Ve,lastMessage:ro,unreadCount:0})}catch{}})}const ce=Array.from(re.values());ce.length&&i(ce)}catch{}})(),dt.current=!0},[ee]),h.useEffect(()=>{if(e!==we.HOME||m!=="stories"||!Le||Ue)return;rt.current&&(rt.current.disconnect(),rt.current=null);const x=xt.current;if(!x||O.length<7)return;const M=new IntersectionObserver(p=>{p.some(j=>j.isIntersecting)&&(Ue||(Qe(!0),(async()=>{try{const j=await yr({limit:10,offset:Me});j.length&&U(re=>[...re,...j]),be(re=>re+j.length),Be(j.length===10)}catch{}finally{Qe(!1)}})()))},{threshold:.1,root:Ie.current||void 0});return rt.current=M,M.observe(x),()=>{try{M.disconnect()}catch{}}},[O,Le,Ue,Me,e,m]),h.useEffect(()=>{if(e!==we.HOME||m!=="characters"||!B||ae)return;De.current&&(De.current.disconnect(),De.current=null);const x=Pe.current;if(!x||r.length<7)return;const M=new IntersectionObserver(p=>{p.some(j=>j.isIntersecting)&&(ae||(fe(!0),(async()=>{try{const re=(await vr({limit:10,offset:He})).map(Q=>({id:String(Q.id),name:Q.name||"",avatar:Q.avatar||"",profileImage:Q.profileImage||"",status:qe.ONLINE,bio:Q.bio||"",tags:Array.isArray(Q.tags)?Q.tags:[],creator:Q.creator||"",oneLinePersona:Q.oneLinePersona||"",personality:Q.personality||"",profession:Q.profession||"",age:Q.age||"",roleType:Q.roleType||"",currentRelationship:Q.currentRelationship||"",plotTheme:Q.plotTheme||"",plotDescription:Q.plotDescription||"",openingLine:Q.openingLine||""}));re.length&&l(Q=>[...Q,...re]),I(Q=>Q+re.length),X(re.length===10)}catch{}finally{fe(!1)}})()))},{threshold:.1,root:Ie.current||void 0});return De.current=M,M.observe(x),()=>{try{M.disconnect()}catch{}}},[r,B,ae,He,e,m]),h.useEffect(()=>{if(e===we.ME)try{const x=localStorage.getItem("user_id")||"0",M=localStorage.getItem("user_username")||x,p=localStorage.getItem("user_nickname")||"";tt({userId:M,pageId:"ME",name:p}),_e("","")}catch{}},[e]),h.useEffect(()=>{if(!((navigator==null?void 0:navigator.maxTouchPoints)>0))return;const M=document.querySelector('meta[name="viewport"]'),p=(M==null?void 0:M.getAttribute("content"))||"";M&&M.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no");let j=0;const re=Q=>{const Ne=Date.now();Ne-j<=300&&Q.preventDefault(),j=Ne};return document.addEventListener("touchend",re,{passive:!1}),document.body.style.touchAction="manipulation",()=>{M&&M.setAttribute("content",p),document.removeEventListener("touchend",re),document.body.style.touchAction=""}},[]),h.useEffect(()=>{const x=()=>{window.visualViewport&&ke({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`})};window.visualViewport&&(window.visualViewport.addEventListener("resize",x),window.visualViewport.addEventListener("scroll",x),x());const M=()=>{window.visualViewport||ke({height:window.innerHeight,top:0})};return window.addEventListener("resize",M),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",x),window.visualViewport.removeEventListener("scroll",x)),window.removeEventListener("resize",M)}},[]),h.useEffect(()=>{const x=()=>{const p=window.visualViewport&&window.visualViewport.height?window.visualViewport.height:window.innerHeight;document.documentElement.style.setProperty("--vh",`${p*.01}px`)};x();const M=()=>x();return window.addEventListener("resize",M),window.visualViewport&&window.visualViewport.addEventListener("resize",M),()=>{window.removeEventListener("resize",M),window.visualViewport&&window.visualViewport.removeEventListener("resize",M)}},[]),!ee)return n.jsx(pr,{children:n.jsx("div",{className:"fixed inset-0 w-full bg-primary-50 overflow-hidden",style:{height:"calc(var(--vh) * 100)",overscrollBehavior:"none"},children:n.jsx("div",{className:"h-full w-full max-w-md mx-auto bg relative shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden flex",children:n.jsx(Dh,{onLogin:()=>me(!0)})})})});const v=x=>{try{const p=`chat_history_${localStorage.getItem("user_id")||"0"}_${x.characterId}`,g=localStorage.getItem(p);if(g){const re=JSON.parse(g).map(Q=>({id:Q.id,senderId:Q.senderId,text:Q.text,timestamp:new Date(Q.ts),type:Q.type,quote:Q.quote,read:Q.read}));if(re.length)return re}}catch{}return[]},D=x=>{c&&i(M=>M.map(p=>p.characterId===c.characterId?{...p,lastMessage:x,unreadCount:0}:p))},W=x=>{i(M=>M.map(p=>p.characterId===x?{...p,character:{...p.character,isPinned:!p.character.isPinned}}:p))},K=async x=>{const M=s.find(p=>p.characterId===x.id);if(M){f(null),he(!1),d(M),t(we.CHAT);return}try{const p=localStorage.getItem("user_id")||"0",g=`chat_session_${p}_${x.id}`;let j=localStorage.getItem(g)||"";j||(j=(await us(x.id)).sessionId,localStorage.setItem(g,j));const re=x.openingLine||x.oneLinePersona||"",Q=`msg_${Date.now()}`,Ne={id:Q,senderId:x.id,text:re,timestamp:new Date,type:at.TEXT};try{const ue=`chat_history_${p}_${x.id}`,pe={id:Q,senderId:x.id,text:re,ts:Date.now(),type:at.TEXT};localStorage.setItem(ue,JSON.stringify([pe]))}catch{}const ce={characterId:x.id,character:x,lastMessage:Ne,unreadCount:0};i(ue=>[ce,...ue]),f(null),he(!1),d(ce),t(we.CHAT)}catch{const p=x.openingLine||x.oneLinePersona||"",g=`msg_${Date.now()}`,j={id:g,senderId:x.id,text:p,ts:Date.now(),type:at.TEXT};try{const Ne=`chat_history_${localStorage.getItem("user_id")||"0"}_${x.id}`;localStorage.setItem(Ne,JSON.stringify([j]))}catch{}const re={characterId:x.id,character:x,lastMessage:{id:g,senderId:x.id,text:p,timestamp:new Date,type:at.TEXT},unreadCount:0};i(Q=>[re,...Q]),f(null),he(!1),d(re),t(we.CHAT)}},q=x=>{T(!1),G({character:x,id:String(x.id)})},ge=()=>n.jsxs("div",{className:"flex items-center gap-5",children:[n.jsxs("button",{onClick:()=>y("stories"),className:`relative transition-all duration-300 ${m==="stories"?"text-slate-800 font-extrabold text-2xl scale-105":"text-slate-400 font-semibold text-lg hover:text-slate-600"}`,children:["",m==="stories"&&n.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-1 bg-primary-500 rounded-full"})]}),n.jsx("div",{className:"h-5 w-[1px] bg-slate-300/50 rounded-full"}),n.jsxs("button",{onClick:()=>y("characters"),className:`relative transition-all duration-300 ${m==="characters"?"text-slate-800 font-extrabold text-2xl scale-105":"text-slate-400 font-semibold text-lg hover:text-slate-600"}`,children:["",m==="characters"&&n.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-1 bg-primary-500 rounded-full"})]})]}),je=()=>{switch(e){case we.HOME:return n.jsx("div",{className:"px-6 pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:m==="stories"?n.jsxs("div",{className:"space-y-6 mt-2",children:[O.map((x,M)=>n.jsxs("div",{ref:M===O.length-3?p=>{xt.current=p}:void 0,className:"group relative bg-white rounded-3xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer border border-transparent hover:border-primary-100 hover:-translate-y-0.5 duration-200",onClick:async()=>{try{const p=x;if(typeof(p==null?void 0:p.content)=="string"&&p.content.length){const g={id:typeof x.id=="number"?x.id:Number(Date.now()),title:x.title,description:x.description||"",image:x.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(x.tags)?x.tags:[],author:x.author||oe.nickname||"",likes:"0",content:p.content,publishDate:p.publishDate||void 0,status:p.status,availableRoles:Array.isArray(p.availableRoles)?p.availableRoles:[]};ne(g)}else{const g=await zh(x.id),j={id:Number(g.id),title:g.title,description:g.description||"",image:g.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(g.tags)?g.tags:[],author:g.author||"",user_avatar:(g==null?void 0:g.user_avatar)||"",likes:"",content:g.content||"",publishDate:g.publish_date||void 0,availableRoles:Array.isArray(g==null?void 0:g.roles)?g.roles.map(re=>({id:re.id,name:re.name,avatar:"",description:""})):[]};ne(j)}}catch{}},children:[n.jsxs("div",{className:"h-40 overflow-hidden relative",children:[n.jsx(vs,{src:x.image||"/uploads/covers/default_storyimg.jpg",alt:x.title,root:Ie.current,className:"w-full h-full"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent"}),n.jsx("div",{className:"absolute bottom-4 left-4",children:n.jsx("h3",{className:"text-xl font-bold text-white",children:x.title})})]}),n.jsxs("div",{className:"p-5",children:[n.jsx("p",{className:"text-slate-500 text-sm leading-relaxed mb-4 line-clamp-2",children:x.description}),n.jsx("div",{className:"flex justify-between items-center",children:n.jsx("div",{className:"flex gap-2 flex-wrap",children:(x.tags||[]).map(p=>n.jsxs("span",{className:"text-[10px] font-bold text-primary-600 bg-primary-50 px-2 py-1 rounded-full",children:["#",p]},p))})})]})]},x.id)),!O.length&&n.jsx("div",{className:"text-center text-xs text-slate-400",children:""})]}):n.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[o&&n.jsx("div",{className:"text-center text-xs text-slate-400",children:"..."}),!o&&r.map((x,M)=>{var p;return n.jsxs("div",{ref:M===r.length-3?g=>{Pe.current=g}:void 0,className:"bg rounded-2xl p-4 shadow-sm flex gap-4 hover:shadow-md transition-all cursor-pointer border border-transparent hover:border-primary-100",onClick:()=>{w(!1),L(!1),f(x)},children:[n.jsx(Hh,{char:x,root:Ie.current}),n.jsxs("div",{className:"flex-1 flex flex-col justify-between py-1 min-w-0",children:[n.jsxs("div",{children:[n.jsx("div",{className:"flex justify-between items-start",children:n.jsx("h3",{className:"font-bold text-slate-800 text-lg leading-tight",children:x.name})}),n.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2 mb-2",children:(p=x.tags)==null?void 0:p.slice(0,4).map(g=>n.jsx("span",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded-md bg-pink-50 text-pink-500",children:g},g))}),n.jsx("p",{className:"text-xs text-slate-500 line-clamp-2 leading-relaxed mb-2",children:x.oneLinePersona||x.bio})]}),n.jsx("div",{className:"flex items-center justify-end mt-1 border-t border-slate-50 pt-2",children:n.jsxs("div",{className:"text-[10px] text-slate-400",children:["by ",x.creator||""]})})]})]},x.id)}),!o&&r.length===0&&n.jsx("div",{className:"mt-2 text-center",children:n.jsx("p",{className:"text-xs text-slate-300",children:" ~"})})]})});case we.ME:return n.jsx($h,{userProfile:oe,myCharacters:r,myUserCharacters:ie,myStories:C,onUpdateProfile:x=>{xe(x);try{localStorage.setItem("user_nickname",x.nickname||""),localStorage.setItem("user_email",x.email||"me@example.com"),x.avatar&&localStorage.setItem("user_avatar",x.avatar)}catch{}},onCharacterClick:x=>{w(!1),L(!0),f(x)},onReadStory:async x=>{try{const M=x;if(typeof(M==null?void 0:M.content)=="string"&&M.content.length){const p={id:typeof x.id=="number"?x.id:Number(Date.now()),title:x.title,description:x.description||"",image:x.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(x.tags)?x.tags:[],author:oe.nickname||"",likes:"0",content:M.content,publishDate:M.publishDate||void 0,status:M.status};ne(p)}else{const p=await gr(x.id),g=Array.isArray(p==null?void 0:p.characterIds)?p.characterIds:[];let j=[];if(g.length){const Q=Ne=>r.find(ce=>String(ce.id)===String(Ne))||ie.find(ce=>String(ce.id)===String(Ne));j=g.map(Ne=>{const ce=Q(Ne);return ce?{id:Ne,name:ce.name,avatar:ce.avatar,description:ce.oneLinePersona||ce.bio||""}:null}).filter(Boolean)}const re={id:Number(p.id),title:p.title,description:p.description||"",image:p.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(p.tags)?p.tags:[],author:oe.nickname||"",user_avatar:(p==null?void 0:p.user_avatar)||"",likes:"0",content:p.content||"",publishDate:(p==null?void 0:p.publishDate)??void 0,status:x.status||void 0,availableRoles:j};ne(re)}}catch{}},onEditStory:x=>{const M={id:typeof x.id=="number"?x.id:Number(Date.now()),title:x.title,description:x.description||"",image:x.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(x.tags)?x.tags:[],author:oe.nickname||"",likes:"0",content:"",status:x.status||void 0,availableRoles:[]};Y(M),S(!0),(async()=>{try{const p=await gr(x.id),g=Array.isArray(p==null?void 0:p.characterIds)?p.characterIds:[];let j=[];try{const{authFetch:ce}=await ye(async()=>{const{authFetch:pe}=await import("./http-Dwii6HrH.js");return{authFetch:pe}},__vite__mapDeps([0,1,2,3])),ue=await ce("/stories/combine");if(ue&&ue.ok){const pe=await ue.json();j=Array.isArray(pe==null?void 0:pe.items)?pe.items:[]}}catch{}H(j.map(ce=>({id:String(ce.character_id),name:ce.character_name,avatar:ce.character_avatar||"",desc:ce.desc||"",isPrivate:!!ce.isPrivate,isMine:!!ce.isMine})));const re=ce=>{const ue=j.find(pe=>String(pe.character_id)===String(ce));return ue?{id:ce,name:ue.character_name,avatar:ue.character_avatar||"",description:ue.desc||""}:null};let Q=g.map(re).filter(Boolean);if(!Q.length){const ce=ue=>r.find(pe=>String(pe.id)===String(ue))||ie.find(pe=>String(pe.id)===String(ue));Q=g.map(ue=>{const pe=ce(ue);return pe?{id:ue,name:pe.name,avatar:pe.avatar,description:pe.oneLinePersona||pe.bio||""}:null}).filter(Boolean)}const Ne={id:Number(p.id),title:p.title,description:p.description||"",image:p.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(p.tags)?p.tags:[],author:oe.nickname||"",likes:"0",content:p.content||"",publishDate:(p==null?void 0:p.publishDate)??void 0,status:x.status||void 0,availableRoles:Q,...g&&{characterIds:g}};Y(Ne)}catch{}})()},onEditCharacter:x=>{V({initial:x,id:x.id,isEdit:!0}),T(!0)},onDeleteCharacter:x=>{te(M=>M.filter(p=>p.id!==x.id)),l(M=>M.filter(p=>p.id!==x.id))},onAddCharacter:()=>{V(null),T(!0)},onAddStory:()=>{Y(null),S(!0),(async()=>{try{const{authFetch:x}=await ye(async()=>{const{authFetch:p}=await import("./http-Dwii6HrH.js");return{authFetch:p}},__vite__mapDeps([0,1,2,3])),M=await x("/stories/combine");if(M&&M.ok){const p=await M.json(),g=Array.isArray(p==null?void 0:p.items)?p.items:[];H(g.map(j=>({id:String(j.character_id),name:j.character_name,avatar:j.character_avatar||"",desc:j.desc||"",isPrivate:!!j.isPrivate,isMine:!!j.isMine})))}else H([])}catch{H([])}})()},onLogout:P});case we.CHAT:default:return n.jsx(n.Fragment,{children:(!c||Ae)&&n.jsx(fh,{chats:s,onChatClick:x=>{he(!0),d(x)},onTogglePin:W,onDeleteChat:x=>{i(p=>p.filter(g=>g.characterId!==x));const M=localStorage.getItem("user_id")||"0";localStorage.removeItem(`chat_session_${M}_${x}`),localStorage.removeItem(`chat_history_${M}_${x}`),localStorage.removeItem(`chat_config_${x}`),localStorage.removeItem(`chat_model_${x}`),localStorage.removeItem(`chat_temp_${x}`),localStorage.removeItem(`chat_model_name_${x}`),localStorage.removeItem(`chat_history_${x}`),localStorage.removeItem(`chat_session_${x}`),(c==null?void 0:c.characterId)===x&&d(null)},isDetailOpen:Ae&&!!c})})}};return n.jsx(pr,{children:n.jsx("div",{className:"fixed inset-0 w-full bg-primary-50 overflow-hidden",style:{...Re,overscrollBehavior:"none",position:"fixed"},children:n.jsxs("div",{className:"h-full w-full max-w-md mx-auto bg relative shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden flex flex-col",children:[k&&n.jsx(Mh,{onBack:()=>{T(!1),V(null)},onCreate:q,isEdit:!!(A!=null&&A.isEdit),characterId:A==null?void 0:A.id,initial:A==null?void 0:A.initial,onUpdated:x=>{T(!1),V(null),f(x)},onSaveDraft:x=>{T(!1),V(null),te(M=>os(M,x)),t(we.ME)}}),_&&n.jsx(to,{currentPersona:E,onBack:()=>N(!1),onSave:x=>b(x)}),$&&n.jsx(Rh,{onBack:()=>{S(!1),Y(null)},onPublish:x=>{U(M=>os(M,x)),F(M=>os(M,x)),S(!1),Y(null)},onSaveDraft:x=>{F(M=>os(M,x)),S(!1),Y(null)},availableCharacters:r,myUserCharacters:ie,initialStory:J||void 0,importableRoles:se}),n.jsx(zt,{initial:!1,children:c&&!_&&!k&&n.jsx(Th,{character:c.character,initialMessages:v(c),userPersona:E,onBack:()=>{d(null),he(!1)},onUpdateLastMessage:D,onOpenUserSettings:()=>N(!0),onUpdateUserPersona:x=>b(x),onShowProfile:()=>{w(!0),L(!1),G(null),f(c.character)}})}),n.jsx(zt,{initial:!1,children:u&&!_&&!k&&!R&&(z?n.jsx(xr,{character:u,createdId:u.id,onBack:()=>f(null),onStartChat:x=>K(x)}):n.jsx(kh,{character:u,onBack:()=>f(null),onStartChat:()=>K(u),isFromChat:ve,isExistingChat:!!s.find(x=>x.characterId===u.id)}))}),R&&!_&&!k&&n.jsx(xr,{character:R.character,createdId:R.id,onBack:()=>G(null),onStartChat:x=>{G(null),K(x)}}),le&&n.jsx(Bh,{story:le,onBack:()=>ne(null),connectedRoleNames:s.map(x=>x.character.name),validRoleNames:(le.availableRoles||[]).map(x=>x.name),onStartRoleplay:x=>{ne(null);const M=x==null?void 0:x.id;let p;if(M!=null&&(p=r.find(g=>String(g.id)===String(M))||ie.find(g=>String(g.id)===String(M))),!p){const g=(x==null?void 0:x.name)||"";p=r.find(j=>j.name===g)||ie.find(j=>j.name===g)}p&&(f(p),w(!1),L(!1),(async()=>{try{if(!!ie.find(j=>String(j.id)===String(p.id))){const j=await Pt(p.id),re={id:String(p.id),name:(j==null?void 0:j.name)||p.name,avatar:(j==null?void 0:j.avatar)||p.avatar||"",profileImage:p.profileImage||"",status:qe.ONLINE,bio:(j==null?void 0:j.tagline)||"",tags:Array.isArray(j==null?void 0:j.tags)?j.tags:[],creator:oe.nickname||"",oneLinePersona:(j==null?void 0:j.tagline)||"",personality:(j==null?void 0:j.personality)||"",profession:(j==null?void 0:j.occupation)||"",age:j!=null&&j.age?String(j.age):"",roleType:"",gender:(j==null?void 0:j.gender)||"",currentRelationship:(j==null?void 0:j.relationship)||"",plotTheme:(j==null?void 0:j.plot_theme)||"",plotDescription:(j==null?void 0:j.plot_summary)||"",openingLine:(j==null?void 0:j.opening_line)||"",styleExamples:Array.isArray(j==null?void 0:j.styleExamples)?j.styleExamples:[],hobbies:(j==null?void 0:j.hobbies)||"",experiences:(j==null?void 0:j.experiences)||"",isPublic:String((j==null?void 0:j.visibility)||"")==="public",isPublished:String((j==null?void 0:j.status)||"")==="published"};f(re)}else{const j=await Us(p.id),re={id:String(j.id),name:j.name||p.name,avatar:j.avatar||p.avatar||"",profileImage:j.profileImage||p.profileImage||"",status:qe.ONLINE,bio:j.bio||"",tags:Array.isArray(j.tags)?j.tags:[],creator:j.creator||"",oneLinePersona:j.oneLinePersona||"",personality:j.personality||"",profession:j.profession||j.occupation||"",age:j.age||"",roleType:j.roleType||"",currentRelationship:j.currentRelationship||j.relationship||"",plotTheme:j.plotTheme||j.plot_theme||"",plotDescription:j.plotDescription||j.plot_summary||"",openingLine:j.openingLine||""};f(re)}}catch{}})()),!p&&M!=null&&(async()=>{try{const g=await Us(M),j={id:String(g.id),name:g.name||"",avatar:g.avatar||"",profileImage:g.profileImage||"",status:qe.ONLINE,bio:g.bio||"",tags:Array.isArray(g.tags)?g.tags:[],creator:g.creator||"",oneLinePersona:g.oneLinePersona||"",personality:g.personality||"",profession:g.profession||g.occupation||"",age:g.age||"",roleType:g.roleType||"",currentRelationship:g.currentRelationship||g.relationship||"",plotTheme:g.plotTheme||g.plot_theme||"",plotDescription:g.plotDescription||g.plot_summary||"",openingLine:g.openingLine||""};f(j),w(!1),L(!1);return}catch{}try{const g=await Pt(M),j={id:String(M),name:(g==null?void 0:g.name)||"",avatar:(g==null?void 0:g.avatar)||"",profileImage:"",status:qe.ONLINE,bio:(g==null?void 0:g.tagline)||"",tags:Array.isArray(g==null?void 0:g.tags)?g.tags:[],creator:oe.nickname||"",oneLinePersona:(g==null?void 0:g.tagline)||"",personality:(g==null?void 0:g.personality)||"",profession:(g==null?void 0:g.occupation)||"",age:g!=null&&g.age?String(g.age):"",roleType:"",gender:(g==null?void 0:g.gender)||"",currentRelationship:(g==null?void 0:g.relationship)||"",plotTheme:(g==null?void 0:g.plot_theme)||"",plotDescription:(g==null?void 0:g.plot_summary)||"",openingLine:(g==null?void 0:g.opening_line)||"",styleExamples:Array.isArray(g==null?void 0:g.styleExamples)?g.styleExamples:[],hobbies:(g==null?void 0:g.hobbies)||"",experiences:(g==null?void 0:g.experiences)||"",isPublic:String((g==null?void 0:g.visibility)||"")==="public",isPublished:String((g==null?void 0:g.status)||"")==="published"};f(j),w(!1),L(!1)}catch{}})()}}),!_&&!k&&n.jsxs(n.Fragment,{children:[n.jsx(uh,{title:e===we.HOME?ge():e===we.CHAT?"":"",variant:e===we.ME?"overlay":"default",onFilterClick:()=>{e===we.HOME&&(m==="characters"?T(!0):m==="stories"&&(Y(null),H([]),S(!0),(async()=>{try{const{authFetch:x}=await ye(async()=>{const{authFetch:p}=await import("./http-Dwii6HrH.js");return{authFetch:p}},__vite__mapDeps([0,1,2,3])),M=await x("/stories/combine");if(M&&M.ok){const p=await M.json(),g=Array.isArray(p==null?void 0:p.items)?p.items:[];H(g.map(j=>({id:String(j.character_id),name:j.character_name,avatar:j.character_avatar||"",desc:j.desc||"",isPrivate:!!j.isPrivate,isMine:!!j.isMine})))}}catch{}})()))},showAdd:e===we.HOME}),n.jsx(zt,{initial:!1,children:n.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar scroll-smooth min-h-0",ref:Ie,children:je()})}),n.jsx(hh,{activeTab:e,onTabChange:t})]})]})})})},os=(e,t)=>[t,...e.filter(s=>String(s.id)!==String(t.id))];(function(){const e=()=>{const t=localStorage.getItem("user_id")||"0",s=Object.keys(localStorage),i=s.filter(f=>f.startsWith(`chat_history_${t}_`)),r=s.filter(f=>f.startsWith(`chat_session_${t}_`)),l=s.filter(f=>/^chat_history_\d+$/.test(f)),o=s.filter(f=>/^chat_session_\d+$/.test(f)),a=s.filter(f=>/^chat_config_\d+$/.test(f)),c=s.filter(f=>/^chat_model_\d+$/.test(f)),d=s.filter(f=>/^chat_temp_\d+$/.test(f)),u=s.filter(f=>/^chat_model_name_\d+$/.test(f));return{uid:t,historiesUid:i,sessionsUid:r,legacyHistories:l,legacySessions:o,cfg:a,models:c,temps:d,names:u}};try{window.__listLocalChatKeys=e}catch{}})();const Gh=Object.freeze(Object.defineProperty({__proto__:null,default:Wh},Symbol.toStringTag,{value:"Module"}));export{Gh as A,eo as B};
//# sourceMappingURL=App-B9W_d9-p.js.map
