import{r as l,j as e}from"./index-DiMvcmcb.js";import{b as ie,m as ye,t as ve,c as V,s as ne,T as we,u as Ne}from"./AdminDashboard-D62DCIkd.js";import{C as ce}from"./chevron-left-B3HkbiML.js";import{X as J}from"./x-CKT7hpuC.js";import{P as ke}from"./pencil-DPfzMC3o.js";import{T as Ce}from"./trash-2-CCl4-mF6.js";import{C as Se,R as Ie,Z as Te,a as Me,A as Pe}from"./zoom-out-1jEnNmIA.js";import{S as ze}from"./save-DC2LZN-i.js";import{I as Ee}from"./info-Bu7G037R.js";import{C as Le}from"./chevron-down-C8dX3bVB.js";import{C as le}from"./circle-question-mark-C7ouqtkr.js";import{c as de}from"./createLucideIcon-CiU7U1is.js";import{F as ae}from"./file-text-CyCg3Fb5.js";import{P as Re}from"./plus-Bz3dnY0B.js";import{P as _e}from"./pen-line-BpKLzpbM.js";import{C as $e}from"./copy-SCIkRcbw.js";import{S as Ae}from"./send-BX7jbBow.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],re=de("refresh-cw",Ge);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],K=de("wand-sparkles",Fe),Oe=n=>new Promise(h=>{const m=new FileReader;m.addEventListener("load",()=>h(m.result),!1),m.readAsDataURL(n)}),Xe=n=>new Promise((h,m)=>{const c=new Image;c.addEventListener("load",()=>h(c)),c.addEventListener("error",s=>m(s)),c.setAttribute("crossOrigin","anonymous"),c.src=n});function oe({initialImage:n,onSave:h,onCancel:m}){const[c,s]=l.useState(n?"main":"upload"),[o,y]=l.useState(n||null),[u,k]=l.useState(null),v=async j=>{if(j.target.files&&j.target.files.length>0){const L=j.target.files[0],C=await Oe(L);k(C),s("edit")}},w=j=>{y(j),h(j)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[e.jsx(Ye,{step:c,onBack:()=>s(c==="edit"?"upload":"main"),onClose:m}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[c==="main"&&e.jsx(Be,{avatarUrl:o,onChangeClick:()=>s("upload"),onRemoveClick:()=>{y(null),h(null)}}),c==="upload"&&e.jsx(He,{onFileChange:v}),c==="edit"&&u&&e.jsx(Ue,{imageSrc:u,onSave:w,onCancel:()=>s("upload")})]})]})})}function Ye({step:n,onBack:h,onClose:m}){let c="头像设置";return n==="upload"&&(c="更换头像"),n==="edit"&&(c="裁剪与旋转"),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 shrink-0 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n!=="main"&&n!=="upload"&&e.jsx("button",{onClick:h,className:"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-pink-600 transition-colors",children:e.jsx(ce,{size:20})}),n==="upload"&&h&&null,e.jsx("h2",{className:"text-lg font-cute text-pink-900",children:c})]}),e.jsx("button",{onClick:m,className:"p-2 -mr-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(J,{size:20})})]})}function Be({avatarUrl:n,onChangeClick:h,onRemoveClick:m}){return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50/50",children:[e.jsxs("div",{className:"p-8 flex flex-col items-center text-center flex-1 justify-center",children:[e.jsx("div",{className:"relative group mb-8",children:e.jsx("div",{className:"w-48 h-48 rounded-full overflow-hidden ring-8 ring-white shadow-2xl bg-gray-200 flex items-center justify-center",children:n?e.jsx("img",{src:n,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-6xl font-medium text-gray-400",children:"?"})})}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"设置一个好看的头像，让角色更具吸引力"})]}),e.jsxs("div",{className:"flex items-stretch border-t border-gray-100 bg-white divide-x divide-gray-100",children:[e.jsxs("button",{onClick:h,className:"flex-1 py-4 flex items-center justify-center gap-2 text-pink-600 hover:bg-pink-50 transition-colors font-bold text-sm",children:[e.jsx(ke,{size:16}),"更换头像"]}),e.jsxs("button",{onClick:m,className:"flex-1 py-4 flex items-center justify-center gap-2 text-gray-400 hover:bg-red-50 hover:text-red-500 transition-colors font-bold text-sm",children:[e.jsx(Ce,{size:16}),"移除头像"]})]})]})}function He({onFileChange:n}){const[h,m]=l.useState(!1),c=l.useRef(null),s=u=>{u.preventDefault(),m(!0)},o=u=>{u.preventDefault(),m(!1)},y=u=>{u.preventDefault(),m(!1),u.dataTransfer.files&&u.dataTransfer.files.length>0&&n({target:{files:u.dataTransfer.files}})};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-1 p-8 flex flex-col items-center justify-center",children:e.jsxs("div",{onDragOver:s,onDragLeave:o,onDrop:y,onClick:()=>c.current.click(),className:`w-full max-w-xs aspect-square rounded-3xl flex flex-col items-center justify-center transition-all duration-300 cursor-pointer border-2 border-dashed ${h?"bg-pink-50 border-pink-400 scale-105":"bg-gray-50 border-gray-200 hover:border-pink-300 hover:bg-pink-50/30"}`,children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white shadow-sm flex items-center justify-center mb-4 text-pink-500",children:e.jsx(Se,{size:32})}),e.jsx("p",{className:"text-gray-600 font-bold mb-1",children:"点击或拖拽上传"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"支持 JPG, PNG, GIF"})]})}),e.jsx("input",{type:"file",ref:c,onChange:n,className:"hidden",accept:"image/*"})]})}function Ue({imageSrc:n,onSave:h,onCancel:m}){const c=l.useRef(null),[s,o]=l.useState(null),[y,u]=l.useState(!1),[k,v]=l.useState(0),[w,j]=l.useState({x:0,y:0}),[L,C]=l.useState(!1),[_,$]=l.useState({x:0,y:0}),[M,H]=l.useState(1),[Y,N]=l.useState(1),p=800,a=600;l.useEffect(()=>{(async()=>{try{const i=await Xe(n);o(i);const g=p/i.width,b=p/i.height,T=Math.max(g,b);H(T),N(1)}catch(i){console.error(i)}})()},[n]);const f=x=>{x.preventDefault();const i=x.deltaY*-.001;N(g=>Math.max(.5,Math.min(g+i,3)))},A=l.useCallback(()=>{if(!s||!c.current)return;const i=c.current.getContext("2d");i.clearRect(0,0,p,p),i.fillStyle="#18181b",i.fillRect(0,0,p,p),i.save(),i.translate(p/2,p/2),i.rotate(k*Math.PI/180),i.translate(-p/2,-p/2);let g=k*Math.PI/180,b=w.x*Math.cos(-g)-w.y*Math.sin(-g),T=w.x*Math.sin(-g)+w.y*Math.cos(-g);const S=M*Y,E=s.width*S,I=s.height*S,R=p/2,B=p/2;i.drawImage(s,R-E/2+b,B-I/2+T,E,I),i.restore();const X=(p-a)/2;i.fillStyle="rgba(0, 0, 0, 0.6)",i.beginPath(),i.rect(0,0,p,p),i.rect(X+a,X,-a,a),i.fill("evenodd")},[s,k,w,M,Y]);l.useEffect(()=>{A()},[A]);const z=x=>{C(!0);const i=c.current.getBoundingClientRect(),g=x.clientX||x.touches[0].clientX,b=x.clientY||x.touches[0].clientY;$({x:g-i.left,y:b-i.top})},G=x=>{if(!L)return;const i=c.current.getBoundingClientRect(),g=x.clientX||(x.touches?x.touches[0].clientX:0),b=x.clientY||(x.touches?x.touches[0].clientY:0),T=g-i.left,S=b-i.top,E=T-_.x,I=S-_.y;j(R=>({x:R.x+E,y:R.y+I})),$({x:T,y:S})},F=()=>{C(!1)},U=()=>{v(x=>(x+90)%360)},O=async()=>{if(!(!c.current||y)){u(!0);try{const x=document.createElement("canvas"),i=a;x.width=i,x.height=i;const g=x.getContext("2d"),b=(p-a)/2;g.drawImage(c.current,b,b,i,i,0,0,i,i);const T=await new Promise((I,R)=>{x.toBlob(B=>B?I(B):R(new Error("blob_failed")),"image/jpeg",.92)}),S=new File([T],`avatar_${Date.now()}.jpg`,{type:"image/jpeg"}),E=await ie.avatar(S);h(E.url)}catch(x){console.error(x)}finally{u(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-1 relative flex items-center justify-center bg-gray-900 overflow-hidden",children:e.jsx("canvas",{ref:c,width:p,height:p,onMouseDown:z,onMouseMove:G,onMouseUp:F,onMouseLeave:F,onTouchStart:z,onTouchMove:G,onTouchEnd:F,onWheel:f,className:"cursor-move max-w-full max-h-full",style:{width:"100%",height:"auto",maxHeight:"520px"}})}),e.jsxs("div",{className:"p-4 bg-white flex items-center justify-between border-t border-gray-100 gap-4",children:[e.jsxs("button",{onClick:U,className:"flex flex-col itemscenter gap-1 text-pink-600 hover:text-pink-700 transition text-xs font-bold px-2 py-2 rounded-xl hover:bg-pink-50 shrink-0",children:[e.jsx(Ie,{size:20}),"旋转"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 max-w-[200px]",children:[e.jsx(Te,{size:16,className:"text-gray-400 shrink-0"}),e.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:Y,onChange:x=>N(parseFloat(x.target.value)),className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-pink-500"}),e.jsx(Me,{size:16,className:"text-gray-400 shrink-0"})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 rounded-xl text-gray-500 font-bold text-sm hover:bg-gray-100 transition-colors",children:"取消"}),e.jsx("button",{onClick:O,disabled:y,className:`px-5 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 transition-all ${y?"opacity-60 cursor-not-allowed":"hover:opacity-90"}`,children:y?"上传中...":"完成"})]})]})]})}const Ve=({initialData:n,onCancel:h,mode:m="new",notify:c})=>{var te;const[s,o]=l.useState({name:"",gender:"男",identity:"",tagline:"",tags:[],plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",published:!1,generatedPrompt:"",personality:"",relationship:"陌生人",customRelationship:"",sceneDescription:"",sceneGeneratedPrompt:"",avatar:"",characterType:"原创角色",age:"",occupation:""}),y=["陌生人","暧昧","恋爱中","冷战","分手"],[u,k]=l.useState(!1),[v,w]=l.useState(!0);l.useEffect(()=>{if(n){const t=y.includes(n.relationship);o({name:n.name||"",gender:n.gender||"男",identity:n.identity||"",tagline:n.tagline||"",tags:n.tags||[],plotTheme:n.plotTheme||"",plotSummary:n.plotSummary||"",openingLine:n.openingLine||n.opening||"",styleExamples:n.styleExamples||["","",""],hobbies:n.hobbies||"",experiences:n.experiences||"",published:n.status==="published",generatedPrompt:n.systemPrompt||"",personality:n.personality||"",relationship:t?n.relationship||"陌生人":"",customRelationship:t?"":n.relationship||"",avatar:n.avatar||"",sceneDescription:n.sceneDescription||"",sceneGeneratedPrompt:n.systemPromptScene||"",templateIdScene:n.sceneTemplateId?String(n.sceneTemplateId):"",characterType:n.characterType||n.type||"原创角色",age:n.age||"",occupation:n.occupation||""}),k(!t&&!!n.relationship),x(n.promptModelId||""),T(typeof n.promptTemperature=="number"?n.promptTemperature:n.promptTemperature||.1),g(n.sceneModelId||""),E(typeof n.sceneTemperature=="number"?n.sceneTemperature:n.sceneTemperature||.1)}},[n]);const[j,L]=l.useState(!1),[C,_]=l.useState(!1),[$,M]=l.useState(!1),[H,Y]=l.useState(""),[N,p]=l.useState(!1),a=l.useRef(null),[f,A]=l.useState(!1),[z,G]=l.useState(!1),F=l.useRef(null),U=l.useRef(null),[O,x]=l.useState(""),[i,g]=l.useState(""),[b,T]=l.useState(.1),[S,E]=l.useState(.1),[I,R]=l.useState([]),[B,X]=l.useState(!1),[W,Z]=l.useState(""),[q,xe]=l.useState([]),[me,Q]=l.useState(!1),pe=["M/M","M/F","BL","BG","耽美","百合","责任感","偶像","占有欲","霸道","调戏","腹黑","温柔","年下","年上","感性","体贴","理性","反差","激情","校园","贴心","偏执","疯批","傲娇","职场","冷漠","忧郁","人夫","养胃","控制欲","黏人","可爱","成熟","性感"];l.useEffect(()=>{const t=d=>{N&&a.current&&!a.current.contains(d.target)&&p(!1),f&&F.current&&!F.current.contains(d.target)&&A(!1),z&&U.current&&!U.current.contains(d.target)&&G(!1)},r=d=>{d.key==="Escape"&&(p(!1),A(!1),G(!1))};return document.addEventListener("mousedown",t),document.addEventListener("keydown",r),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",r)}},[N,f,z]),l.useEffect(()=>{(async()=>{try{const t=await ye.list(),r=d=>{const se=(d.model_nickname||"").match(/^模型-([A-Z])$/i);return se?se[1].toUpperCase():d.model_name||d.model_id||""};R((t.items||[]).sort((d,P)=>r(d).localeCompare(r(P))))}catch{}})()},[]),l.useEffect(()=>{(async()=>{try{Q(!0);const t=await ve.list();xe(t.items||[])}catch{}finally{Q(!1)}})()},[]);const D=t=>{const r=I.find(d=>d.model_id===t);return r?r.model_nickname||r.model_name||r.model_id:"-- 请选择 --"},ue=s.templateIdScene?(te=q.find(t=>t.id===parseInt(s.templateIdScene)))==null?void 0:te.name:"-- 请选择 --",he=async()=>{p(!N)},fe=async()=>{L(!0),o(t=>({...t,generatedPrompt:""}));try{const t={model:O||void 0,temperature:b===""?void 0:parseFloat(b),sourcePrompt:s.sceneGeneratedPrompt||""},r=await ne.generateNoScene(t);o(d=>({...d,generatedPrompt:r.prompt||""}))}catch{}finally{L(!1)}},ee=t=>{o(r=>({...r,templateIdScene:t})),p(!1)},ge=t=>{k(!1),o(r=>({...r,relationship:t,customRelationship:""}))},be=()=>{k(!0),o(t=>({...t,relationship:""}))},je=(t,r)=>{const d=[...s.styleExamples];d[t]=r,o(P=>({...P,styleExamples:d}))};return e.jsxs("div",{className:"animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:h,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(ce,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:n?"编辑角色":"创建新角色"}),e.jsx("p",{className:"text-gray-400 text-xs",children:n?"修改角色设定与提示词":"填写设定并生成专属提示词"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:h,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:async()=>{if(!s.name||!s.name.trim()){c&&c("保存失败：请输入角色名称","error");return}const t={name:s.name.trim(),gender:s.gender,sceneTemplateId:s.templateIdScene?parseInt(s.templateIdScene):(n==null?void 0:n.sceneTemplateId)??null,identity:s.identity||null,tagline:s.tagline||null,personality:s.personality||null,relationship:u?s.customRelationship||null:s.relationship||null,plotTheme:s.plotTheme||null,plotSummary:s.plotSummary||null,openingLine:s.openingLine||null,systemPrompt:s.generatedPrompt||null,systemPromptScene:s.sceneGeneratedPrompt||null,promptModelId:O||null,promptTemperature:b===""?null:parseFloat(b),sceneModelId:i||null,sceneTemperature:S===""?null:parseFloat(S),hobbies:s.hobbies||null,experiences:s.experiences||null,status:s.published?"published":"draft",tags:s.tags||[],styleExamples:s.styleExamples||[],avatar:s.avatar||null,characterType:s.characterType||null,age:s.age===""?null:parseInt(s.age,10),occupation:s.occupation||null};try{m==="edit"&&(n!=null&&n.id)?(await V.update(n.id,t),c&&c("保存成功：角色已更新")):(await V.create(t),c&&c("保存成功：角色已保存")),h()}catch(r){console.error("[characters.save] failed",{mode:m,payload:t,error:r}),c&&c("保存失败：请稍后重试","error")}},className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(ze,{size:16})," 保存角色"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:[e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-4",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色类型设置"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:["原创角色","二次创作","其他"].map(t=>e.jsx("button",{onClick:()=>o({...s,characterType:t}),className:`px-6 py-3 rounded-2xl text-sm font-bold transition-all ${s.characterType===t?"bg-pink-500 text-white shadow-md":"bg-white text-gray-500 hover:text-pink-600"}`,children:t},t))})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 基础设定"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色名称"}),e.jsx("input",{value:s.name,onChange:t=>o({...s,name:t.target.value}),type:"text",className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"角色姓名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"性别"}),e.jsx("div",{className:"flex bg-gray-50 p-1 rounded-xl border border-gray-200",children:["男","女","其他"].map(t=>e.jsx("button",{onClick:()=>o({...s,gender:t}),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${s.gender===t?"bg-pink-500 text-white shadow-md":"text-gray-400 hover:text-pink-500"}`,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"年龄"}),e.jsx("input",{value:s.age,onChange:t=>o({...s,age:t.target.value}),type:"number",min:"0",max:"200",className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"年龄"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"职业"}),e.jsx("input",{value:s.occupation,onChange:t=>o({...s,occupation:t.target.value}),type:"text",className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"职业"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"身份背景 (Identity)"}),e.jsx("textarea",{value:s.identity,onChange:t=>o({...s,identity:t.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"角色的年龄、职业、过往经历..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"一句话人设 (Tagline)"}),e.jsx("input",{value:s.tagline,onChange:t=>o({...s,tagline:t.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例如：表面温柔克己实则腹黑"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"性格 (Personality)"}),e.jsx("textarea",{value:s.personality,onChange:t=>o({...s,personality:t.target.value}),rows:"2",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：占有欲强，容易吃醋..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色标签"}),e.jsxs("div",{onClick:()=>X(!0),className:"dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white transition rounded-2xl border border-pink-100",children:[s.tags.length===0&&e.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:"点击添加标签 (#傲娇 #高冷...)"}),s.tags.map(t=>e.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",t,e.jsx("button",{onClick:r=>{r.stopPropagation(),o(d=>({...d,tags:d.tags.filter(P=>P!==t)}))},className:"ml-1 opacity-60 hover:opacity-100",children:e.jsx(J,{size:12})})]},t)),e.jsx("span",{className:"ml-auto text-pink-300 text-xs",children:"›"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"当下的关系"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("button",{onClick:be,className:`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${u?"bg-pink-500 text-white shadow-md border-pink-500":"bg-white text-gray-500 border-gray-200 hover:border-pink-300"}`,children:"自定义"}),y.map(t=>e.jsx("button",{onClick:()=>ge(t),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${!u&&s.relationship===t?"bg-pink-500 text-white shadow-md border-pink-500":"bg-white text-gray-500 border-gray-200 hover:border-pink-300"}`,children:t},t))]}),u&&e.jsx("div",{className:"animate-fade-in mt-2",children:e.jsx("input",{type:"text",value:s.customRelationship,onChange:t=>o({...s,customRelationship:t.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm",placeholder:"请输入自定义关系"})})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 第一情节"]}),e.jsxs("div",{className:"bg-pink-50 border border-pink-100 rounded-2xl p-4 flex gap-3 text-pink-700 text-sm leading-relaxed",children:[e.jsx(Ee,{size:18,className:"flex-shrink-0 mt-0.5 text-pink-500"}),e.jsx("div",{children:"第一情节的内容将被应用于和角色的第一次聊天。此外，设定第一情节并选择公开角色后，情节内容将显示在角色资料页上。"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"主题"}),e.jsx("input",{value:s.plotTheme,onChange:t=>o({...s,plotTheme:t.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例：当温柔人夫终于爆发腹黑属性"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"情节梗概"}),e.jsx("textarea",{value:s.plotSummary,onChange:t=>o({...s,plotSummary:t.target.value}),rows:"4",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：在一起这么久了，他还是一如既往的温柔体贴，从来不干涉你的个人生活。今天晚上你去酒吧玩，故意装作喝醉和他打电话，却在他应了一声后开始软声叫着别人的名字......"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"开场白"}),e.jsx("input",{value:s.openingLine,onChange:t=>o({...s,openingLine:t.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例：“出来，我在酒吧门口”"})]})]}),e.jsxs("div",{className:"solid-card rounded-3xl overflow-hidden",children:[e.jsxs("div",{className:"p-8 pb-4 flex justify-between items-center cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>w(!v),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"}),e.jsx("h3",{className:"font-cute text-lg text-pink-900",children:"进阶设定"}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-pink-100 text-pink-600 rounded",children:"可选"})]}),e.jsx(Le,{size:20,className:`text-gray-400 transition-transform duration-300 ${v?"rotate-180":""}`})]}),v&&e.jsxs("div",{className:"p-8 pt-0 space-y-6 animate-in slide-in-from-top-4 fade-in duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-3",children:"说话风格示例"}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(t=>e.jsxs("div",{className:"relative flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-bold text-pink-300 font-mono",children:["0",t+1]}),e.jsx("input",{type:"text",value:s.styleExamples[t]||"",onChange:r=>je(t,r.target.value),className:"dream-input flex-1 px-4 py-3 rounded-xl text-sm",placeholder:t===0?"例：哼，别以为我会感谢你。":t===1?"例：今晚月色真美，不一起走走吗？":"例：再靠近一步，我就不客气了。"})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"爱好"}),e.jsx("textarea",{value:s.hobbies,onChange:t=>o({...s,hobbies:t.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：喜欢看书、收集古董怀表..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"经历"}),e.jsx("textarea",{value:s.experiences,onChange:t=>o({...s,experiences:t.target.value}),rows:"4",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"请填写角色个人经历或你们的共同经历"})]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl relative overflow-visible bg-gradient-to-r from-pink-50 to-pink-100 border-pink-100",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色提示词配置（带场景描述）"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色提示词AI模型（场景）"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative z-50 flex-1",ref:U,children:[e.jsxs("button",{onClick:()=>G(!z),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${z?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${i?"text-gray-700":"text-gray-400 font-normal"}`,children:D(i)}),e.jsx("div",{className:`text-pink-400 transition-transform ${z?"rotate-180":""}`,children:"▼"})]}),z&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:I.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型"}):I.map(t=>e.jsx("li",{onClick:()=>{g(t.model_id),G(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${i===t.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:t.model_nickname||t.model_name||t.model_id},t.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-[140px] justify-end",children:[e.jsx("input",{type:"number",min:"0",max:"2",step:"0.05",value:S,onChange:t=>E(t.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.jsxs("div",{className:"relative group",children:[e.jsx(le,{size:18,className:"text-pink-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center",children:"温度：高数值输出随机，低数值输出集中。"})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-end mt-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"选择基础模版"}),e.jsxs("div",{className:"relative z-20 flex-1",ref:a,children:[e.jsxs("button",{onClick:he,className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${N?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${s.templateIdScene?"text-gray-700":"text-gray-400 font-normal"}`,children:ue}),e.jsx("div",{className:`text-pink-400 transition-transform ${N?"rotate-180":""}`,children:"▼"})]}),N&&e.jsxs("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:[e.jsx("li",{onClick:()=>ee(""),className:"px-4 py-3 text-sm text-gray-400 hover:bg-pink-50 cursor-pointer border-b border-pink-50",children:"-- 请选择 --"}),me?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"加载中..."}):q.map(t=>e.jsxs("li",{onClick:()=>ee(t.id.toString()),className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${s.templateIdScene==t.id?"bg-pink-100 font-bold text-pink-700":""}`,children:[t.name," (",t.type,")"]},t.id))]})]})]}),e.jsxs("button",{onClick:async()=>{if(!s.templateIdScene)return alert("请先选择一个提示词模版");_(!0),o(t=>({...t,sceneGeneratedPrompt:""}));try{const t=q.find(P=>P.id===parseInt(s.templateIdScene)),r={templateContent:(t==null?void 0:t.content)||"",model:i||void 0,temperature:S===""?void 0:parseFloat(S),name:s.name,gender:s.gender,age:s.age,occupation:s.occupation,identity:s.identity,tagline:s.tagline,tags:s.tags,personality:s.personality,relationship:u?s.customRelationship:s.relationship,styleExamples:s.styleExamples,hobbies:s.hobbies,experiences:s.experiences},d=await ne.generate(r);o(P=>({...P,sceneGeneratedPrompt:d.prompt||""}))}catch{}finally{_(!1)}},disabled:C,className:"px-6 py-3 rounded-xl bg-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] justify-center z-0",children:[C?e.jsx("span",{className:"animate-spin",children:e.jsx(re,{size:16})}):e.jsx(K,{size:16,className:"text-yellow-300"}),C?"生成中...":"生成提示词"]})]}),e.jsx("p",{className:"text-xs text-pink-400 mt-2 ml-1",children:"* 将根据上方填写的设定，自动填充到模版占位符中"}),e.jsxs("div",{className:"mt-4 relative",children:[e.jsx("textarea",{rows:"12",value:s.sceneGeneratedPrompt,onChange:t=>o({...s,sceneGeneratedPrompt:t.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner",placeholder:"点击上方“生成提示词”按钮，或在此直接编写 Prompt..."}),!s.sceneGeneratedPrompt&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-30",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{size:48,className:"mx-auto mb-2 text-pink-300"}),e.jsx("p",{className:"text-sm font-bold text-pink-400",children:"等待生成..."})]})})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl relative overflow-visible bg-gradient-to-r from-pink-50 to-pink-100 border-pink-100",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色提示词配置"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色提示词AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative z-50 flex-1",ref:F,children:[e.jsxs("button",{onClick:()=>A(!f),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${f?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${O?"text-gray-700":"text-gray-400 font-normal"}`,children:D(O)}),e.jsx("div",{className:`text-pink-400 transition-transform ${f?"rotate-180":""}`,children:"▼"})]}),f&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:I.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型"}):I.map(t=>e.jsx("li",{onClick:()=>{x(t.model_id),A(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${O===t.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:t.model_nickname||t.model_name||t.model_id},t.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-[140px] justify-end",children:[e.jsx("input",{type:"number",min:"0",max:"2",step:"0.05",value:b,onChange:t=>T(t.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.jsxs("div",{className:"relative group",children:[e.jsx(le,{size:18,className:"text-pink-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center",children:"温度：高数值输出随机，低数值输出集中。"})]})]}),e.jsxs("button",{onClick:fe,disabled:j,className:"px-6 py-3 rounded-xl bg-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] justify-center z-0",children:[j?e.jsx("span",{className:"animate-spin",children:e.jsx(re,{size:16})}):e.jsx(K,{size:16,className:"text-yellow-300"}),j?"生成中...":"生成提示词"]})]})]}),e.jsx("p",{className:"text-xs text-pink-400 mt-2 ml-1",children:"* 将根据上方输出的提示词，进行二次生成不带场景描述的提示词。"}),e.jsxs("div",{className:"mt-4 relative",children:[e.jsx("textarea",{rows:"12",value:s.generatedPrompt,onChange:t=>o({...s,generatedPrompt:t.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner",placeholder:"点击上方“生成提示词”按钮，或在此直接编写 Prompt..."}),!s.generatedPrompt&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-30",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{size:48,className:"mx-auto mb-2 text-pink-300"}),e.jsx("p",{className:"text-sm font-bold text-pink-400",children:"等待生成..."})]})})]})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:[e.jsxs("div",{className:"glass-card p-6 rounded-3xl flex flex-col items-center text-center",children:[e.jsx("h3",{className:"font-cute text-pink-900 mb-4 w-full text-left border-b border-pink-100 pb-2",children:"头像预览"}),e.jsxs("div",{onClick:()=>M(!0),className:"w-32 h-32 rounded-full bg-gray-100 border-4 border-white shadow-xl flex items-center justify-center mb-4 relative group cursor-pointer overflow-hidden",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-4xl text-gray-300 font-bold",children:s.name?s.name[0]:"?"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"更换头像"})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:"flex items-center justify-between p-4 bg-white/50 rounded-xl cursor-pointer hover:bg-white transition-colors border border-pink-50",children:[e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"发布到广场"}),e.jsx("div",{onClick:()=>o({...s,published:!s.published}),className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${s.published?"bg-pink-500":"bg-gray-300"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-sm transform transition-transform duration-300 ${s.published?"translate-x-6":""}`})})]}),e.jsx("p",{className:"text-xs text-left text-gray-400 mt-2 px-1",children:"开启后，该角色将出现在公共广场，所有用户可见。"})]})]}),e.jsxs("div",{className:"glass-card p-6 rounded-3xl bg-gradient-to-br from-pink-500 to-pink-600 text-white",children:[e.jsxs("h4",{className:"font-bold mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"inline-block",children:e.jsx(K,{size:16,className:"text-yellow-300"})})," 提示"]}),e.jsx("p",{className:"text-xs opacity-90 leading-relaxed",children:"好的 Prompt 决定了角色的灵魂。建议生成后仔细检查，补充更多细节。"})]})]})]}),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:()=>X(!1)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-4xl rounded-3xl bg-white p-6 shadow-2xl border border-pink-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>X(!1),className:"w-8 h-8 rounded-full bg-pink-50 text-pink-800 flex items-center justify-center",children:"‹"}),e.jsx("h3",{className:"text-lg font-bold font-cute text-pink-900",children:"添加 #标签"}),e.jsx("button",{onClick:()=>X(!1),className:"text-sm font-bold text-pink-600 bg-pink-50 px-3 py-1 rounded-full",children:"完成"})]}),e.jsxs("div",{className:"space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"选定的标签"}),e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-pink-50/50 p-3 rounded-xl border border-pink-100 border-dashed",children:s.tags.length===0?e.jsx("span",{className:"text-xs text-gray-400",children:"暂无标签"}):s.tags.map(t=>e.jsxs("button",{onClick:()=>o(r=>({...r,tags:r.tags.filter(d=>d!==t)})),className:"bg-pink-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1",children:["#",t," ",e.jsx("span",{className:"text-[10px] ml-1 opacity-80",children:"×"})]},t))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"直接添加 (自定义)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:W,onChange:t=>Z(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){t.preventDefault();const r=W.trim();r&&o(d=>d.tags.includes(r)?d:{...d,tags:[...d.tags,r]}),Z("")}},type:"text",placeholder:"输入标签，不用加#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white rounded-xl"}),e.jsx("button",{onClick:()=>{const t=W.trim();t&&o(r=>r.tags.includes(t)?r:{...r,tags:[...r.tags,t]}),Z("")},className:"bg-gradient-to-r from-pink-400 to-pink-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition",children:"添加"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"标签选择"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:pe.map(t=>e.jsxs("button",{onClick:()=>o(r=>({...r,tags:r.tags.includes(t)?r.tags.filter(d=>d!==t):[...r.tags,t]})),className:`tag-select-btn flex items-center justify-center ${s.tags.includes(t)?"active":""}`,children:["#",t]},t))})]})]})]})})]}),$&&e.jsx(oe,{initialImage:s.avatar||null,onSave:async t=>{try{const r=await ie.avatar(t);o(d=>({...d,avatar:r.url}))}catch{}M(!1)},onCancel:()=>M(!1)}),$&&e.jsx(oe,{initialImage:s.avatar,onSave:t=>{o(r=>({...r,avatar:t})),M(!1)},onCancel:()=>M(!1)})]})},We=({creatorRole:n})=>{const[h,m]=l.useState("list"),[c,s]=l.useState(null),[o,y]=l.useState([]),[u,k]=l.useState("new"),{showToast:v}=Ne(),[w,j]=l.useState(null),L=300,C=async()=>{try{const a=n?{creator_role:n}:{},f=await V.list(a);y(f.items||[])}catch{v("加载失败","error")}};l.useEffect(()=>{C()},[n]);const _=a=>{s(a),k("edit"),m("create")},$=()=>{s(null),k("new"),m("create")},M=a=>{const f={...a,id:void 0,name:`${a.name}_copy`,status:"draft"};s(f),k("copy"),m("create"),v("复制成功，已进入编辑")},H=async(a,f)=>{try{await V.setStatus(a,f==="published"?"draft":"published"),await C()}catch{v("操作失败","error")}},Y=a=>j(a),N=()=>j(null),p=async()=>{if(w)try{await V.remove(w.id),v("删除成功"),await C()}catch{v("删除失败","error")}finally{N()}};return h==="create"?e.jsx(Ve,{initialData:c,onCancel:()=>{m("list"),C()},mode:u,notify:v}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),n==="user_role"?"用户角色":"官方角色"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:n==="user_role"?"查看用户创建的角色":"管理官方发布的 AI 角色"})]}),n!=="user_role"&&e.jsxs("button",{onClick:$,className:"bg-gradient-to-r from-pink-500 to-pink-600 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:opacity-90 transition-all flex items-center gap-2 text-sm",children:[e.jsx(Re,{size:16})," 创建角色"]})]}),e.jsx("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(auto-fit, minmax(320px, 360px))"},children:o.map(a=>e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"glass-card p-4 rounded-3xl hover:shadow-xl transition-all group relative overflow-hidden h-[220px] flex flex-col",children:[e.jsx("div",{className:`absolute top-4 right-4 text-xs px-2 py-0.5 rounded-md font-bold ${a.status==="published"?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"}`,children:a.status==="published"?"已发布":"草稿"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-pink-200 to-pink-300 flex items-center justify-center text-white text-xl font-bold shadow-inner border-2 border-white overflow-hidden flex-shrink-0",children:a.avatar?e.jsx("img",{src:a.avatar,alt:"avatar",className:"w-full h-full object-cover"}):e.jsx("span",{children:a.name?a.name[0]:"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 truncate",children:a.name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[a.age!=null&&a.age!==""?`${a.age}岁`:"",a.occupation?`${a.age!=null&&a.age!==""?" · ":""}${a.occupation}`:""]})]}),e.jsx("div",{className:"flex gap-1 mt-2 flex-nowrap whitespace-nowrap overflow-hidden",style:{maxWidth:L},children:a.tags.map(f=>e.jsxs("span",{className:"text-[10px] bg-pink-50 text-pink-600 px-1.5 py-0.5 rounded border border-pink-100",children:["#",f]},f))})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed break-words",children:a.tagline||"暂无一句话人设"})}),e.jsxs("div",{className:"mt-auto flex gap-2 pt-3 border-t border-white/50",children:[e.jsxs("button",{onClick:()=>_(a),className:"flex-1 py-2 text-xs font-bold text-pink-600 bg-pink-50 hover:bg-pink-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(_e,{size:12})," 编辑"]}),e.jsxs("button",{onClick:()=>M(a),className:"flex-1 py-2 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx($e,{size:12})," 复制"]}),a.status==="published"?e.jsxs("button",{onClick:()=>H(a.id,a.status),className:"flex-1 py-2 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Pe,{size:12})," 回收"]}):e.jsxs("button",{onClick:()=>H(a.id,a.status),className:"flex-1 py-2 text-xs font-bold text-green-600 bg-green-50 hover:bg-green-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Ae,{size:12})," 发布"]})]})]}),e.jsx("button",{onClick:()=>Y(a),className:"absolute -top-2 -right-2 z-10 w-8 h-8 rounded-full bg-white/60 backdrop-blur-md shadow-lg border border-pink-100 flex items-center justify-center text-gray-400 hover:text-red-500 transition",children:e.jsx(J,{size:12})})]},a.id))}),w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:N}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除角色"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",w.name,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:N,className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:p,className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]})]})},xt=({creatorRole:n})=>e.jsx(we,{children:e.jsx(We,{creatorRole:n})});export{xt as default};
//# sourceMappingURL=CharacterManagement-5X-DgjnY.js.map
