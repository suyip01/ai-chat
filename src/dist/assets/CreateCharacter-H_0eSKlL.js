import{r as x,j as e}from"./index-DiMvcmcb.js";import{d as Q,i as Y,j as Z,C as ee,k as se,n as te}from"./App-Bl6Z-21V.js";import{I as ae}from"./ImageCropper-u3NJns5t.js";import{C as le}from"./chevron-left-B3HkbiML.js";import{C as re}from"./camera-wGCI_KHa.js";import{P as ne}from"./plus-Bz3dnY0B.js";import{X as E}from"./x-CKT7hpuC.js";import{C as oe}from"./chevron-right-jr0esStd.js";import{I as ie}from"./info-Bu7G037R.js";import{C as ce}from"./chevron-up-DfIGDTSU.js";import{C as I}from"./chevron-down-C8dX3bVB.js";import{c as D}from"./createLucideIcon-CiU7U1is.js";import{C as pe}from"./circle-alert-_OBbJmYg.js";import"./user-DjmimaIa.js";import"./check-CIfsadPx.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],xe=D("globe",de);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ue=D("lock",me),Le=({onBack:M,onCreate:v,isEdit:p=!1,characterId:m,initial:r,onUpdated:k})=>{const[t,n]=x.useState({type:"原创角色",avatar:"",profileImage:"",name:"",gender:"男",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"陌生人",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0}),[b,C]=x.useState(!1),[y,F]=x.useState(!0),[B,f]=x.useState(!1),[T,S]=x.useState(""),[R,$]=x.useState(!1),[c,U]=x.useState({}),[O,z]=x.useState(!1),[j,w]=x.useState(null),g=x.useRef(null),L=s=>{var u;const a=s.split(","),l=((u=a[0].match(/:(.*?);/))==null?void 0:u[1])||"image/jpeg",i=atob(a[1]);let o=i.length;const h=new Uint8Array(o);for(;o--;)h[o]=i.charCodeAt(o);return new Blob([h],{type:l})};x.useEffect(()=>{r&&n(a=>({...a,type:r.roleType||a.type,avatar:r.avatar||a.avatar,profileImage:r.profileImage||a.profileImage,name:r.name||a.name,gender:r.gender||a.gender,age:r.age||a.age,profession:r.profession||a.profession,tagline:r.oneLinePersona||a.tagline,personality:r.personality||a.personality,relationship:r.currentRelationship||a.relationship,plotTheme:r.plotTheme||a.plotTheme,plotSummary:r.plotDescription||a.plotSummary,openingLine:r.openingLine||a.openingLine,styleExamples:Array.isArray(r.styleExamples)&&r.styleExamples.length?r.styleExamples:a.styleExamples,hobbies:r.hobbies||a.hobbies,experiences:r.experiences||a.experiences,searchTags:Array.isArray(r.tags)?r.tags:a.searchTags,isPublic:typeof r.isPublic=="boolean"?r.isPublic:a.isPublic}));const s=localStorage.getItem("create_character_draft");if(s&&!p)try{const a=JSON.parse(s);n(l=>({...l,...a}))}catch(a){console.error("Failed to load draft",a)}},[r,p]),x.useEffect(()=>{if(!p||!m)return;const s=!(r&&Array.isArray(r.tags)&&r.tags.length),a=!(r&&Array.isArray(r.styleExamples)&&r.styleExamples.length);!s&&!a||(async()=>{try{const l=await Q(m),i=Array.isArray(l==null?void 0:l.styleExamples)?l.styleExamples.slice(0,3):[];for(;i.length<3;)i.push("");n(o=>({...o,name:(l==null?void 0:l.name)??o.name,gender:(l==null?void 0:l.gender)??o.gender,avatar:(l==null?void 0:l.avatar)??o.avatar,tagline:(l==null?void 0:l.tagline)??o.tagline,personality:(l==null?void 0:l.personality)??o.personality,relationship:(l==null?void 0:l.relationship)??o.relationship,plotTheme:(l==null?void 0:l.plot_theme)??o.plotTheme,plotSummary:(l==null?void 0:l.plot_summary)??o.plotSummary,openingLine:(l==null?void 0:l.opening_line)??o.openingLine,hobbies:(l==null?void 0:l.hobbies)??o.hobbies,experiences:(l==null?void 0:l.experiences)??o.experiences,age:(l==null?void 0:l.age)!=null?String(l.age):o.age,profession:(l==null?void 0:l.occupation)??o.profession,searchTags:Array.isArray(l==null?void 0:l.tags)?l.tags:o.searchTags,styleExamples:i,isPublic:l!=null&&l.visibility?l.visibility==="public":o.isPublic}))}catch{}})()},[p,m,r]);const W=["原创角色","二次创作","其他"],G=["陌生人","暧昧","恋爱中","冷战","分手"],J=["M/M","M/F","BL","BG","耽美","百合","责任感","偶像","占有欲","霸道","调戏","腹黑","温柔","年下","年上","感性","体贴","理性","反差","激情","校园","贴心","偏执","疯批","傲娇","职场","冷漠","忧郁","人夫","养胃","控制欲","黏人","可爱","成熟","性感","四爱"],H=()=>{var s;(s=g.current)==null||s.click()},K=s=>{var l;const a=(l=s.target.files)==null?void 0:l[0];if(a){const i=new FileReader;i.onloadend=()=>{w(i.result)},i.readAsDataURL(a)}g.current&&(g.current.value="")},N=s=>{t.searchTags.includes(s)?n(a=>({...a,searchTags:a.searchTags.filter(l=>l!==s)})):n(a=>({...a,searchTags:[...a.searchTags,s]}))},_=()=>{const s=T.trim();s&&!t.searchTags.includes(s)&&(n(a=>({...a,searchTags:[...a.searchTags,s]})),S(""))},A=async s=>{if(s){try{const a=localStorage.getItem("user_access_token");let l=t.avatar||null;if(l&&l.startsWith("data:image")){const o=L(l),h=new FormData,u=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;h.append("avatar",o,"avatar.jpg"),h.append("filename",u),l=`/uploads/users/avatars/${u}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:a?`Bearer ${a}`:""},body:h})}catch{}}const i={name:t.name||"未命名",gender:t.gender,avatar:l,identity:null,tagline:t.tagline,personality:t.personality,relationship:t.relationship,plotTheme:t.plotTheme,plotSummary:t.plotSummary,openingLine:t.openingLine,hobbies:t.hobbies,experiences:t.experiences,age:t.age&&parseInt(t.age,10)||null,occupation:t.profession,character_type:t.type,visibility:t.isPublic?"public":"private",tags:t.searchTags,styleExamples:t.styleExamples.filter(Boolean)};p&&m?await se(m,i):await te(i)}catch{}localStorage.setItem("create_character_draft",JSON.stringify(t))}else localStorage.removeItem("create_character_draft"),n({type:"原创角色",avatar:"",profileImage:"",name:"",gender:"男",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"陌生人",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0});$(!1)},V=()=>{const s={};return t.name.trim()||(s.name=!0),t.age.trim()||(s.age=!0),t.profession.trim()||(s.profession=!0),t.tagline.trim()||(s.tagline=!0),t.personality.trim()||(s.personality=!0),t.searchTags.length===0&&(s.searchTags=!0),t.relationship.trim()||(s.relationship=!0),t.plotTheme.trim()||(s.plotTheme=!0),t.plotSummary.trim()||(s.plotSummary=!0),t.openingLine.trim()||(s.openingLine=!0),U(s),Object.keys(s).length===0},X=async()=>{if(!V()){z(!0);return}let s=null;try{const l=localStorage.getItem("user_access_token");let i=t.avatar||null;if(i&&i.startsWith("data:image")){const h=L(i),u=new FormData,P=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;u.append("avatar",h,"avatar.jpg"),u.append("filename",P),i=`/uploads/users/avatars/${P}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:l?`Bearer ${l}`:""},body:u})}catch{}}const o={name:t.name,gender:t.gender,avatar:i,identity:null,tagline:t.tagline,personality:t.personality,relationship:t.relationship,plotTheme:t.plotTheme,plotSummary:t.plotSummary,openingLine:t.openingLine,hobbies:t.hobbies,experiences:t.experiences,age:t.age&&parseInt(t.age,10)||null,occupation:t.profession,character_type:t.type,visibility:t.isPublic?"public":"private",tags:t.searchTags,styleExamples:t.styleExamples.filter(Boolean)};p&&m?(await Y(m,o),s=typeof m=="number"?m:parseInt(String(m))||null):s=await Z(o)}catch{}const a={id:s?String(s):`c_${Date.now()}`,name:t.name,avatar:t.avatar||"https://image.pollinations.ai/prompt/anime%20silhouette%20purple?width=400&height=400&nologo=true",profileImage:t.profileImage||t.avatar,status:ee.ONLINE,bio:`${t.age} ${t.profession}`,tags:t.searchTags,isPinned:!1,relationshipLevel:0,creator:"我",playCount:"0",age:t.age||"未知",profession:t.profession||"未知",gender:t.gender,roleType:t.type,isOriginal:t.type==="原创角色",oneLinePersona:t.tagline,personality:t.personality,currentRelationship:t.relationship,plotTheme:t.plotTheme,plotDescription:t.plotSummary,openingLine:t.openingLine,styleExamples:t.styleExamples.filter(l=>l),hobbies:t.hobbies,experiences:t.experiences,isPublic:t.isPublic};localStorage.removeItem("create_character_draft"),p&&k?k(a):v(a)},q=s=>["例：哼，别以为我会感谢你。","例：今晚月色真美，不一起走走吗？","例：再靠近一步，我就不客气了。"][s],d="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return e.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-3xl shadow-2xl bg白 font-kosugi",children:[j&&e.jsx(ae,{imageSrc:j,aspectRatio:1,outputWidth:800,outputHeight:800,onCancel:()=>{w(null),g.current&&(g.current.value="")},onCrop:s=>{n(a=>({...a,avatar:s,profileImage:j})),w(null)}}),e.jsx("div",{className:"ambient-bg hidden"}),e.jsxs("div",{className:"hidden",children:[e.jsx("div",{className:"star",style:{left:"10%",width:"4px",height:"4px"}}),e.jsx("div",{className:"star",style:{left:"80%",animationDelay:"2s",width:"6px",height:"6px"}})]}),e.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-3xl relative",children:[e.jsx("button",{onClick:M,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:e.jsx(le,{size:20})}),e.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:p?"编辑角色":"创建角色"}),!p&&e.jsx("button",{onClick:()=>$(!0),className:"ml-auto text-sm font-bold text-purple-600 font-kosugi",children:"存草稿"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",children:[e.jsxs("section",{className:"mt-4",children:[e.jsx("div",{className:"text-[#2E1065] font-bold text-[0.9rem] mb-2 ml-1 font-kosugi",children:"角色类型设置"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-1 mt-2",children:W.map(s=>e.jsx("button",{onClick:()=>n(a=>({...a,type:s})),className:`
                                flex-shrink-0 px-5 py-2.5 rounded-2xl text-sm font-bold transition-all whitespace-nowrap tracking-wide font-kosugi
                                ${t.type===s?"bg-purple-500 text-white shadow-purple-200 shadow-md":"bg-white/70 text-slate-500 border-transparent"}
                            `,children:s},s))})]}),e.jsxs("section",{className:"flex flex-col items-center py-2",children:[e.jsxs("div",{onClick:H,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white border-[3px] border-white shadow-xl flex items-center justify-center overflow-hidden relative",children:t.avatar?e.jsx("img",{src:t.avatar,className:"w-full h-full object-cover",alt:"avatar"}):e.jsx("div",{className:"text-purple-200 text-3xl",children:e.jsx(re,{size:32})})}),e.jsx("div",{className:"absolute bottom-0 right-0 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center border-[3px] border-white shadow-md",children:e.jsx(ne,{size:14})})]}),e.jsx("input",{type:"file",ref:g,className:"hidden",accept:"image/*",onChange:K}),e.jsx("p",{className:"mt-2 text-xs text-purple-400 font-bold tracking-wide font-kosugi",children:"上传头像"})]}),e.jsxs("section",{className:"glass-card p-6 space-y-6",children:[e.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:"基础设定"}),e.jsxs("div",{children:[e.jsxs("label",{className:`${d} flex items-center gap-1`,children:["姓名",c.name&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:"必填"})]}),e.jsx("div",{className:"relative",children:e.jsx("input",{value:t.name,onChange:s=>n(a=>({...a,name:s.target.value})),type:"text",placeholder:"例：祁云",className:`dream-input w-full px-4 py-3 text-sm font-bold ${c.name?"border-red-300 bg-red-50":""}`})})]}),e.jsxs("div",{children:[e.jsx("label",{className:d,children:"性别"}),e.jsx("div",{className:"flex gap-3",children:["男","女","其他"].map(s=>e.jsx("button",{onClick:()=>n(a=>({...a,gender:s})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition font-kosugi ${t.gender===s?s==="男"?"bg-blue-100 text-blue-600 ring-2 ring-blue-200":s==="女"?"bg-pink-100 text-pink-600 ring-2 ring-pink-200":"bg-purple-100 text-purple-600 ring-2 ring-purple-200":"bg-white/50 text-slate-400"}`,children:s},s))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:`${d} flex items-center gap-1`,children:["年龄",c.age&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:"必填"})]}),e.jsx("input",{value:t.age,onChange:s=>n(a=>({...a,age:s.target.value})),type:"text",placeholder:"例：28岁",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${c.age?"border-red-300 bg-red-50":""}`})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:`${d} flex items-center gap-1`,children:["职业",c.profession&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:"必填"})]}),e.jsx("input",{value:t.profession,onChange:s=>n(a=>({...a,profession:s.target.value})),type:"text",placeholder:"例：骨科医生",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${c.profession?"border-red-300 bg-red-50":""}`})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`${d} flex items-center gap-1`,children:["一句话人设",c.tagline&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:"必填"})]}),e.jsx("input",{value:t.tagline,onChange:s=>n(a=>({...a,tagline:s.target.value})),type:"text",placeholder:"例：表面温柔克己实则腹黑",className:`dream-input w-full px-4 py-3 text-sm ${c.tagline?"border-red-300 bg-red-50":""}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`${d} flex items-center gap-1`,children:["性格",c.personality&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:"必填"})]}),e.jsx("textarea",{value:t.personality,onChange:s=>n(a=>({...a,personality:s.target.value})),rows:3,placeholder:"例：占有欲强，容易吃醋...",className:`dream-input w-full px-4 py-3 text-sm resize-none ${c.personality?"border-red-300 bg-red-50":""}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`${d} flex items-center gap-1`,children:["角色标签",c.searchTags&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:"必填"})]}),e.jsxs("div",{onClick:()=>f(!0),className:`dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition ${c.searchTags?"border-red-300 bg-red-50":""}`,children:[t.searchTags.length===0&&e.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:"点击添加标签 (#傲娇 #高冷...)"}),t.searchTags.map(s=>e.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",s,e.jsx(E,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:a=>{a.stopPropagation(),N(s)}})]},s)),e.jsx(oe,{className:"ml-auto text-purple-300",size:16})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`${d} flex items-center gap-1`,children:["当下的关系",c.relationship&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:"必填"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("button",{onClick:()=>{C(!0),n(s=>({...s,relationship:""}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${b?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:"自定义"}),G.map(s=>e.jsx("button",{onClick:()=>{C(!1),n(a=>({...a,relationship:s}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${t.relationship===s&&!b?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:s},s))]}),b&&e.jsx("div",{className:"relative animate-in fade-in",children:e.jsx("input",{value:t.relationship,onChange:s=>n(a=>({...a,relationship:s.target.value})),type:"text",placeholder:"请输入自定义关系",className:`dream-input w-full px-4 py-2 text-sm ${c.relationship?"border-red-300 bg-red-50":""}`})})]})]}),e.jsxs("section",{className:"glass-card p-6 space-y-5",children:[e.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-4",children:"第一情节"}),e.jsxs("p",{className:"text-xs text-slate-500 leading-relaxed bg-purple-50/50 p-3 rounded-xl border border-purple-100 flex gap-1",children:[e.jsx(ie,{size:14,className:"text-purple-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"第一情节的内容将被应用于和角色的第一次聊天。此外，设定第一情节并选择公开角色后，情节内容将显示在角色资料页上。"})]}),e.jsxs("div",{className:"bg-white/40 p-4 rounded-3xl border border-purple-100/50 space-y-4",children:[e.jsxs("div",{className:"relative group/input",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["主题",c.plotTheme&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:"必填"})]}),e.jsx("input",{value:t.plotTheme,onChange:s=>n(a=>({...a,plotTheme:s.target.value})),type:"text",placeholder:"例：当温柔人夫终于爆发腹黑属性",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 ${c.plotTheme?"border-red-300 bg-red-50":""}`})]}),e.jsxs("div",{className:"relative group/input",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["情节梗概",c.plotSummary&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:"必填"})]}),e.jsx("textarea",{value:t.plotSummary,onChange:s=>n(a=>({...a,plotSummary:s.target.value})),rows:5,placeholder:"例：在一起这么久了，他还是一如既往的温柔体贴，从来不干涉你的个人生活。今天晚上你去酒吧玩，故意装作喝醉和他打电话，却在他应了一声后开始软声叫着别人的名字......",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none leading-relaxed ${c.plotSummary?"border-red-300 bg-red-50":""}`})]}),e.jsxs("div",{className:"relative group/input",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["开场白",c.openingLine&&e.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:"必填"})]}),e.jsx("textarea",{value:t.openingLine,onChange:s=>n(a=>({...a,openingLine:s.target.value})),rows:2,placeholder:"例：“出来，我在酒吧门口”",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none ${c.openingLine?"border-red-300 bg-red-50":""}`})]})]})]}),e.jsxs("section",{className:"glass-card p-0 overflow-hidden transition-all",children:[e.jsxs("button",{onClick:()=>F(!y),className:"w-full flex items-center justify-between p-6 bg-transparent transition",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:"进阶设定"}),e.jsx("span",{className:"text-[10px] bg-purple-100 text-purple-500 px-1.5 py-0.5 rounded font-bold border border-purple-200 self-center font-kosugi",children:"可选"})]}),y?e.jsx(ce,{className:"text-purple-400"}):e.jsx(I,{className:"text-purple-400"})]}),y&&e.jsxs("div",{className:"p-6 pt-0 space-y-5 animate-in slide-in-from-top-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:d,children:"说话风格示例"}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-bold text-purple-300 w-4 font-mono",children:["0",s+1]}),e.jsx("input",{value:t.styleExamples[s],onChange:a=>{const l=[...t.styleExamples];l[s]=a.target.value,n(i=>({...i,styleExamples:l}))},type:"text",placeholder:q(s),className:"dream-input flex-1 px-3 py-2.5 rounded-xl text-sm"})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:d,children:"爱好"}),e.jsx("textarea",{value:t.hobbies,onChange:s=>n(a=>({...a,hobbies:s.target.value})),rows:2,placeholder:"例：喜欢看书、收集古董怀表...",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:d,children:"经历"}),e.jsx("textarea",{value:t.experiences,onChange:s=>n(a=>({...a,experiences:s.target.value})),rows:2,placeholder:"请填写角色个人经历或你们的共同经历",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),e.jsxs("div",{className:"pt-2 border-t border-purple-100",children:[e.jsx("label",{className:`${d} mb-1`,children:"是否公开"}),e.jsx("p",{className:"text-[10px] text-slate-500 leading-tight mb-3",children:"选择公开，角色将被发布到广场供其他用户选择和使用。不公开角色则仅供个人使用。"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>n(s=>({...s,isPublic:!0})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${t.isPublic?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:[e.jsx(xe,{size:14})," 公开"]}),e.jsxs("button",{onClick:()=>n(s=>({...s,isPublic:!1})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${t.isPublic?"bg-white text-slate-500 border border-purple-100":"bg-purple-500 text-white shadow-md"}`,children:[e.jsx(ue,{size:14})," 不公开"]})]})]})]})]})]}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-b-3xl shadow-2xl",children:e.jsx("button",{onClick:X,className:"w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition-transform flex items-center justify-center tracking-widest text-lg font-kosugi",children:p?"更新角色卡":"生成角色卡"})}),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>f(!1)}),e.jsxs("div",{className:"fixed bottom-0 left-0 w-full bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[80vh] animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[e.jsx("button",{onClick:()=>f(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:e.jsx(I,{size:20})}),e.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:"添加 #标签"}),e.jsx("button",{onClick:()=>f(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:"完成"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:"选定的标签"}),e.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[t.searchTags.length===0&&e.jsx("span",{className:"text-xs text-slate-400 self-center",children:"暂无标签"}),t.searchTags.map(s=>e.jsxs("button",{onClick:()=>N(s),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1 font-kosugi",children:["#",s," ",e.jsx(E,{size:10,className:"opacity-80"})]},s))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:"直接添加 (自定义)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:T,onChange:s=>S(s.target.value),onKeyDown:s=>s.key==="Enter"&&_(),type:"text",placeholder:"输入标签，不用加#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),e.jsx("button",{onClick:_,className:"bg-gradient-to-r from-purple-400 to-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition font-kosugi",children:"添加"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:"标签选择"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:J.map(s=>e.jsxs("button",{onClick:()=>N(s),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis font-kosugi
                                            ${t.searchTags.includes(s)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",s]},s))})]})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-4 font-kosugi",children:p?"是否只更新内容？":"是否保存草稿？"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>A(!1),className:"flex-1 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors font-kosugi",children:p?"取消":"否"}),e.jsx("button",{onClick:()=>A(!0),className:"flex-1 py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:p?"确认更新":"是"})]})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:e.jsx(pe,{size:28})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:"有内容没填写完哦～"}),e.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:"请完善所有必填项后继续"}),e.jsx("button",{onClick:()=>z(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:"我知道了"})]})})]})})};export{Le as CreateCharacter};
//# sourceMappingURL=CreateCharacter-H_0eSKlL.js.map
