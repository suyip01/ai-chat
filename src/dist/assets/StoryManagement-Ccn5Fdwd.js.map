{"version":3,"file":"StoryManagement-Ccn5Fdwd.js","sources":["../../admin/components/CoverEditor.jsx","../../admin/story/StoryCreateView.jsx","../../admin/story/StoryManagement.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { uploadAPI } from '../api.js';\nimport { ChevronLeft, X, RotateCw, ZoomIn, ZoomOut, UploadCloud } from 'lucide-react';\n\nconst readFile = (file) => new Promise((resolve) => {\n  const reader = new FileReader();\n  reader.addEventListener('load', () => resolve(reader.result), false);\n  reader.readAsDataURL(file);\n});\n\nconst createImage = (url) => new Promise((resolve, reject) => {\n  const image = new Image();\n  image.addEventListener('load', () => resolve(image));\n  image.addEventListener('error', (error) => reject(error));\n  image.setAttribute('crossOrigin', 'anonymous');\n  image.src = url;\n});\n\nexport default function CoverEditor({ initialImage, onSave, onCancel }) {\n  const [step, setStep] = useState(initialImage ? 'edit' : 'upload');\n  const [tempImage, setTempImage] = useState(initialImage || null);\n\n  const handleFileChange = async (e) => {\n    if (e.target.files && e.target.files.length > 0) {\n      const file = e.target.files[0];\n      const dataUrl = await readFile(file);\n      setTempImage(dataUrl);\n      setStep('edit');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200\">\n      <div className=\"relative w-full max-w-2xl bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200\">\n        <Header step={step} onBack={() => setStep('upload')} onClose={onCancel} />\n        <div className=\"flex-1 overflow-y-auto\">\n          {step === 'upload' && (\n            <UploadView onFileChange={handleFileChange} />\n          )}\n          {step === 'edit' && tempImage && (\n            <EditView imageSrc={tempImage} onSave={onSave} onCancel={() => setStep('upload')} />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction Header({ step, onBack, onClose }) {\n  const title = step === 'upload' ? '上传封面' : '裁剪封面';\n  return (\n    <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-white\">\n      <div className=\"flex items-center gap-2\">\n        {step === 'edit' && (\n          <button onClick={onBack} className=\"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-pink-600 transition-colors\">\n            <ChevronLeft size={20} />\n          </button>\n        )}\n        <h2 className=\"text-lg font-cute text-pink-900\">{title}</h2>\n      </div>\n      <button onClick={onClose} className=\"p-2 -mr-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-red-500 transition-colors\">\n        <X size={20} />\n      </button>\n    </div>\n  );\n}\n\nfunction UploadView({ onFileChange }) {\n  const [isDragging, setIsDragging] = useState(false);\n  const fileInputRef = useRef(null);\n  return (\n    <div className=\"flex flex-col h-full bg-white\">\n      <div className=\"flex-1 p-8 flex flex-col items-center justify-center\">\n        <div\n          onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}\n          onDragLeave={(e) => { e.preventDefault(); setIsDragging(false); }}\n          onDrop={(e) => { e.preventDefault(); setIsDragging(false); if (e.dataTransfer.files && e.dataTransfer.files.length > 0) onFileChange({ target: { files: e.dataTransfer.files } }); }}\n          onClick={() => fileInputRef.current.click()}\n          className={`w-full max-w-xl aspect-[2/1] rounded-3xl flex flex-col items-center justify-center transition-all duration-300 cursor-pointer border-2 border-dashed ${isDragging ? 'bg-pink-50 border-pink-400 scale-105' : 'bg-gray-50 border-gray-200 hover:border-pink-300 hover:bg-pink-50/30'}`}\n        >\n          <div className=\"w-20 h-20 rounded-full bg-white shadow-sm flex items-center justify-center mb-4 text-pink-500\">\n            <UploadCloud size={32} />\n          </div>\n          <p className=\"text-gray-600 font-bold mb-1\">点击或拖拽上传封面</p>\n          <p className=\"text-gray-400 text-xs\">输出尺寸 800×400，比例 2:1</p>\n        </div>\n      </div>\n      <input type=\"file\" ref={fileInputRef} onChange={onFileChange} className=\"hidden\" accept=\"image/*\" />\n    </div>\n  );\n}\n\nfunction EditView({ imageSrc, onSave, onCancel }) {\n  const canvasRef = useRef(null);\n  const [imageObj, setImageObj] = useState(null);\n  const [saving, setSaving] = useState(false);\n  const [rotation, setRotation] = useState(0);\n  const [offset, setOffset] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [baseScale, setBaseScale] = useState(1);\n  const [zoom, setZoom] = useState(1);\n\n  const CANVAS_SIZE = 800; // square working area\n  const VIEWPORT_W = 800;\n  const VIEWPORT_H = 400; // 2:1\n\n  useEffect(() => {\n    const init = async () => {\n      try {\n        const img = await createImage(imageSrc);\n        setImageObj(img);\n        const scaleX = CANVAS_SIZE / img.width;\n        const scaleY = CANVAS_SIZE / img.height;\n        const initScale = Math.max(scaleX, scaleY);\n        setBaseScale(initScale);\n        setZoom(1);\n      } catch {}\n    };\n    init();\n  }, [imageSrc]);\n\n  const handleWheel = (e) => { e.preventDefault(); const delta = e.deltaY * -0.001; setZoom(prev => Math.max(0.5, Math.min(prev + delta, 3))); };\n\n  const draw = useCallback(() => {\n    if (!imageObj || !canvasRef.current) return;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n\n    ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\n    ctx.fillStyle = '#18181b';\n    ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\n\n    ctx.save();\n    ctx.translate(CANVAS_SIZE / 2, CANVAS_SIZE / 2);\n    ctx.rotate((rotation * Math.PI) / 180);\n    ctx.translate(-CANVAS_SIZE / 2, -CANVAS_SIZE / 2);\n\n    const rad = (rotation * Math.PI) / 180;\n    const localX = offset.x * Math.cos(-rad) - offset.y * Math.sin(-rad);\n    const localY = offset.x * Math.sin(-rad) + offset.y * Math.cos(-rad);\n\n    const currentScale = baseScale * zoom;\n    const imgWidth = imageObj.width * currentScale;\n    const imgHeight = imageObj.height * currentScale;\n\n    const centerX = CANVAS_SIZE / 2;\n    const centerY = CANVAS_SIZE / 2;\n\n    ctx.drawImage(imageObj, centerX - imgWidth / 2 + localX, centerY - imgHeight / 2 + localY, imgWidth, imgHeight);\n    ctx.restore();\n\n    // Overlay with 2:1 hole (full width)\n    const topOffset = (CANVAS_SIZE - VIEWPORT_H) / 2;\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';\n    ctx.beginPath();\n    ctx.rect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\n    ctx.rect(0, topOffset, VIEWPORT_W, VIEWPORT_H);\n    ctx.fill('evenodd');\n  }, [imageObj, rotation, offset, baseScale, zoom]);\n\n  useEffect(() => { draw(); }, [draw]);\n\n  const handleMouseDown = (e) => {\n    setIsDragging(true);\n    const rect = canvasRef.current.getBoundingClientRect();\n    const x = e.clientX || e.touches?.[0]?.clientX;\n    const y = e.clientY || e.touches?.[0]?.clientY;\n    setDragStart({ x: x - rect.left, y: y - rect.top });\n  };\n  const handleMouseMove = (e) => {\n    if (!isDragging) return;\n    const rect = canvasRef.current.getBoundingClientRect();\n    const clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);\n    const clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);\n    const x = clientX - rect.left;\n    const y = clientY - rect.top;\n    const dx = x - dragStart.x;\n    const dy = y - dragStart.y;\n    setOffset(prev => ({ x: prev.x + dx, y: prev.y + dy }));\n    setDragStart({ x, y });\n  };\n  const handleMouseUp = () => setIsDragging(false);\n  const handleRotate = () => setRotation(prev => (prev + 90) % 360);\n\n  const handleFinalSave = async () => {\n    if (!canvasRef.current || saving) return;\n    setSaving(true);\n    try {\n      const tempCanvas = document.createElement('canvas');\n      tempCanvas.width = VIEWPORT_W;\n      tempCanvas.height = VIEWPORT_H;\n      const tCtx = tempCanvas.getContext('2d');\n      const topOffset = (CANVAS_SIZE - VIEWPORT_H) / 2;\n      tCtx.drawImage(canvasRef.current, 0, topOffset, VIEWPORT_W, VIEWPORT_H, 0, 0, VIEWPORT_W, VIEWPORT_H);\n      const blob = await new Promise((resolve, reject) => {\n        tempCanvas.toBlob((b) => b ? resolve(b) : reject(new Error('blob_failed')), 'image/jpeg', 0.92);\n      });\n      const file = new File([blob], `cover_${Date.now()}.jpg`, { type: 'image/jpeg' });\n      const result = await uploadAPI.cover(file);\n      onSave(result.url);\n    } catch (e) {\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col h-full bg-white\">\n      <div className=\"flex-1 relative flex items-center justify-center bg-gray-900 overflow-hidden\">\n        <canvas\n          ref={canvasRef}\n          width={CANVAS_SIZE}\n          height={CANVAS_SIZE}\n          onMouseDown={handleMouseDown}\n          onMouseMove={handleMouseMove}\n          onMouseUp={handleMouseUp}\n          onMouseLeave={handleMouseUp}\n          onTouchStart={handleMouseDown}\n          onTouchMove={handleMouseMove}\n          onTouchEnd={handleMouseUp}\n          onWheel={handleWheel}\n          className=\"cursor-move max-w-full max-h-full\"\n          style={{ width: '100%', height: 'auto', maxHeight: '520px' }}\n        />\n      </div>\n      <div className=\"p-4 bg-white flex items-center justify-between border-t border-gray-100 gap-4\">\n        <button onClick={handleRotate} className=\"px-2 py-2 rounded-xl text-pink-600 hover:text-pink-700 text-xs font-bold hover:bg-pink-50\">\n          <RotateCw size={20} />\n        </button>\n        <div className=\"flex items-center gap-2 flex-1 max-w-[240px]\">\n          <ZoomOut size={16} className=\"text-gray-400\" />\n          <input type=\"range\" min=\"0.5\" max=\"3\" step=\"0.1\" value={zoom} onChange={(e) => setZoom(parseFloat(e.target.value))} className=\"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-pink-500\" />\n          <ZoomIn size={16} className=\"text-gray-400\" />\n        </div>\n        <div className=\"flex gap-2\">\n          <button onClick={onCancel} className=\"px-4 py-2 rounded-xl text-gray-500 font-bold text-sm hover:bg-gray-100\">取消</button>\n          <button onClick={handleFinalSave} disabled={saving} className={`px-5 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 ${saving ? 'opacity-60 cursor-not-allowed' : 'hover:opacity-90'}`}>{saving ? '上传中...' : '完成'}</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n","import React, { useEffect, useState } from 'react'\nimport { ChevronLeft, Save } from 'lucide-react'\nimport { storiesAPI, charactersAPI } from '../api.js'\nimport CoverEditor from '../components/CoverEditor.jsx'\n\nconst StoryCreateView = ({ initialData, onCancel, notify }) => {\n  const [form, setForm] = useState({\n    title: '', description: '', image: '', tags: [], author: '', likes: '', content: '', publishDate: ''\n  })\n  const [selectedChars, setSelectedChars] = useState([])\n  const [charOptions, setCharOptions] = useState([])\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false)\n  const ddRef = React.useRef(null)\n  useEffect(() => {\n    if (initialData) {\n      setForm({\n        title: initialData.title || '',\n        description: initialData.description || '',\n        image: initialData.image || '',\n        tags: Array.isArray(initialData.tags) ? initialData.tags : [],\n        author: initialData.author || '',\n        likes: initialData.likes || '',\n        content: initialData.content || '',\n        publishDate: initialData.publish_date || ''\n      })\n      if (Array.isArray(initialData.character_ids)) setSelectedChars(initialData.character_ids.map(id => Number(id)))\n    }\n  }, [initialData])\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await charactersAPI.list({ creator_role: 'admin_role' })\n        const items = Array.isArray(res?.items) ? res.items : []\n        const published = items.filter(it => it.status === 'published')\n        setCharOptions(published.map(it => ({ id: Number(it.id), name: it.name })))\n      } catch {}\n    })()\n  }, [])\n  useEffect(() => {\n    const onDoc = (e) => { if (isDropdownOpen && ddRef.current && !ddRef.current.contains(e.target)) setIsDropdownOpen(false) }\n    document.addEventListener('mousedown', onDoc)\n    return () => document.removeEventListener('mousedown', onDoc)\n  }, [isDropdownOpen])\n  const [tagInput, setTagInput] = useState('')\n  const [showCoverEditor, setShowCoverEditor] = useState(false)\n  const addTag = () => { const v = tagInput.trim(); if (!v) return; setForm(p => ({ ...p, tags: p.tags.includes(v) ? p.tags : [...p.tags, v] })); setTagInput('') }\n  const removeTag = (t) => setForm(p => ({ ...p, tags: p.tags.filter(x => x !== t) }))\n  const save = async () => {\n    if (!form.title.trim() || !form.content.trim()) { notify && notify('请输入标题与内容', 'error'); return }\n    const payload = {\n      title: form.title.trim(), description: form.description || null, image: form.image || null,\n      author: form.author || null, likes: form.likes || null, content: form.content,\n      tags: form.tags, character_ids: selectedChars\n    }\n    try {\n      if (initialData?.id) { await storiesAPI.update(initialData.id, payload); notify && notify('保存成功：故事已更新') }\n      else { await storiesAPI.create(payload); notify && notify('保存成功：故事已创建') }\n      onCancel && onCancel()\n    } catch { notify && notify('保存失败', 'error') }\n  }\n  return (\n    <div className=\"animate-fade-in pb-20\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <button onClick={onCancel} className=\"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors\"><ChevronLeft size={20} /></button>\n        <div>\n          <h2 className=\"text-2xl font-cute text-pink-900\">{initialData ? '编辑故事' : '创建故事'}</h2>\n          <p className=\"text-gray-400 text-xs\">填写并保存故事内容</p>\n        </div>\n      <div className=\"ml-auto\">\n        <button onClick={save} className=\"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2\"><Save size={16} /> 保存</button>\n      </div>\n      </div>\n      <div className=\"grid grid-cols-12 gap-6\">\n        <div className=\"col-span-12 lg:col-span-8 space-y-6\">\n          <div className=\"solid-card p-8 rounded-3xl space-y-6\">\n            \n            <div>\n              <label className=\"block text-xs font-bold text-pink-800 mb-2\">标题</label>\n              <input value={form.title} onChange={e=>setForm({...form, title:e.target.value})} className=\"dream-input w-full px-4 py-3 rounded-xl text-sm\"/>\n            </div>\n            <div>\n              <label className=\"block text-xs font-bold text-pink-800 mb-2\">描述</label>\n              <textarea value={form.description} onChange={e=>setForm({...form, description:e.target.value})} rows=\"3\" className=\"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none\"/>\n            </div>\n            <div>\n              <label className=\"block text-xs font-bold text-pink-800 mb-2\">封面图片</label>\n              <div className=\"space-y-3\">\n                <div onClick={() => setShowCoverEditor(true)} className=\"w-full aspect-[2/1] bg-gray-100 rounded-2xl overflow-hidden border-4 border-white shadow-xl cursor-pointer\">\n                  {form.image ? (\n                    <img src={form.image} alt=\"cover\" className=\"w-full h-full object-cover\" />\n                  ) : (\n                    <div className=\"w-full h-full flex items-center justify-center text-gray-300 font-bold\">点击上传并裁剪 (800×400)</div>\n                  )}\n                </div>\n                <input value={form.image} onChange={e=>setForm({...form, image:e.target.value})} className=\"dream-input w-full px-4 py-3 rounded-xl text-sm\" placeholder=\"或直接粘贴图片 URL\"/>\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-xs font-bold text-pink-800 mb-2\">作者</label>\n                <input value={form.author} onChange={e=>setForm({...form, author:e.target.value})} className=\"dream-input w-full px-4 py-3 rounded-xl text-sm\"/>\n              </div>\n              <div>\n                <label className=\"block text-xs font-bold text-pink-800 mb-2\">点赞数（文本）</label>\n                <input value={form.likes} onChange={e=>setForm({...form, likes:e.target.value})} className=\"dream-input w-full px-4 py-3 rounded-xl text-sm\"/>\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-xs font-bold text-pink-800 mb-2\">标签</label>\n              <div className=\"flex gap-2\">\n                <input value={tagInput} onChange={e=>setTagInput(e.target.value)} onKeyDown={e=>{if(e.key==='Enter'){e.preventDefault();addTag();}}} className=\"dream-input flex-1 px-4 py-3 rounded-xl text-sm\" placeholder=\"输入标签并回车\"/>\n                <button onClick={addTag} className=\"px-4 rounded-xl bg-pink-500 text-white text-sm font-bold\">添加</button>\n              </div>\n              <div className=\"flex flex-wrap gap-2 mt-2\">\n                {form.tags.map(t=> (\n                  <button key={t} onClick={()=>removeTag(t)} className=\"bg-pink-50 text-pink-600 px-3 py-1.5 rounded-xl text-xs font-bold border border-pink-100\">#{t} ×</button>\n                ))}\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-xs font-bold text-pink-800 mb-2\">正文</label>\n              <textarea value={form.content} onChange={e=>setForm({...form, content:e.target.value})} rows=\"14\" className=\"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner\"/>\n            </div>\n            \n          </div>\n        </div>\n        <div className=\"col-span-12 lg:col-span-4 space-y-6\">\n          <div className=\"glass-card p-6 rounded-3xl text-sm text-gray-500\">在右侧填写故事信息并点击保存。</div>\n          <div className=\"solid-card p-6 rounded-3xl space-y-4\">\n            <div className=\"text-xs font-bold text-pink-800\">登场角色（管理员且已发布）</div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"relative w-full max-w-md\" ref={ddRef}>\n                <button onClick={() => setIsDropdownOpen(!isDropdownOpen)} className={`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${isDropdownOpen ? 'border-pink-500 ring-4 ring-pink-100/50' : ''}`}>\n                  <span className={`text-gray-700`}>选择角色</span>\n                  <div className={`text-pink-400 transition-transform ${isDropdownOpen ? 'rotate-180' : ''}`}>▼</div>\n                </button>\n                {isDropdownOpen && (\n                  <ul className=\"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50\">\n                    {charOptions.filter(opt => !selectedChars.includes(opt.id)).length === 0 ? (\n                      <li className=\"px-4 py-3 text-sm text-gray-400\">暂无可选角色</li>\n                    ) : (\n                      charOptions.filter(opt => !selectedChars.includes(opt.id)).map(opt => (\n                        <li key={opt.id} onClick={() => { setSelectedChars(prev => prev.includes(opt.id) ? prev : [...prev, opt.id]); setIsDropdownOpen(false); }} className={`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors`}>{opt.name}</li>\n                      ))\n                    )}\n                  </ul>\n                )}\n              </div>\n              <button className=\"px-3 py-2 bg-pink-500 text-white rounded-xl text-xs font-bold\" onClick={() => setIsDropdownOpen(true)}>添加</button>\n            </div>\n            <div className=\"flex flex-wrap gap-2\">\n              {selectedChars.map(cid => {\n                const nm = charOptions.find(o => o.id === cid)?.name || cid\n                return (\n                  <span key={cid} className=\"bg-pink-50 text-pink-600 px-3 py-1.5 rounded-xl text-xs font-bold border border-pink-100\">\n                    {nm}\n                    <button className=\"ml-2 text-pink-500\" onClick={() => setSelectedChars(prev => prev.filter(x => x !== cid))}>×</button>\n                  </span>\n                )\n              })}\n            </div>\n          </div>\n        </div>\n      </div>\n      {showCoverEditor && (\n        <CoverEditor\n          initialImage={form.image || null}\n          onSave={async (url) => { setForm(p => ({ ...p, image: url })); setShowCoverEditor(false); }}\n          onCancel={() => setShowCoverEditor(false)}\n        />\n      )}\n    </div>\n  )\n}\n\nexport default StoryCreateView\n","import React, { useEffect, useState } from 'react'\nimport { Plus, Edit3, X, Archive, Send } from 'lucide-react'\nimport { ToastProvider, useToast } from '../Toast.jsx'\nimport { storiesAPI } from '../api.js'\nimport StoryCreateView from './StoryCreateView.jsx'\n\nconst StoryManagementInner = () => {\n  const [view, setView] = useState('list')\n  const [editing, setEditing] = useState(null)\n  const { showToast } = useToast()\n  const [list, setList] = useState([])\n  const [deleteTarget, setDeleteTarget] = useState(null)\n  const reload = async () => { try { const d = await storiesAPI.list(); setList(d.items || []) } catch { showToast('加载失败', 'error') } }\n  useEffect(() => { reload() }, [])\n  const onCreate = () => { setEditing(null); setView('create') }\n  const onEdit = (item) => { setEditing(item); setView('create') }\n  const onDelete = async (id) => { try { await storiesAPI.remove(id); showToast('删除成功'); reload() } catch { showToast('删除失败', 'error') } }\n  const handleToggleStatus = async (id, current) => {\n    try {\n      await storiesAPI.setStatus(id, current === 'published' ? 'draft' : 'published')\n      showToast(current === 'published' ? '已回收为草稿' : '已发布')\n      reload()\n    } catch { showToast('操作失败', 'error') }\n  }\n  if (view === 'create') return <StoryCreateView initialData={editing} onCancel={() => { setView('list'); reload() }} notify={showToast} />\n  return (\n    <div className=\"space-y-6 animate-fade-in\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-cute text-pink-900 flex items-center gap-2\"><span className=\"w-1.5 h-6 bg-yellow-400 rounded-full inline-block\"></span> 故事管理</h2>\n          <p className=\"text-gray-400 text-xs mt-1 ml-4\">查看与编辑故事内容</p>\n        </div>\n        <button onClick={onCreate} className=\"bg-gradient-to-r from-pink-500 to-pink-600 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:opacity-90 transition-all flex items-center gap-2 text-sm\"><Plus size={16}/> 创建故事</button>\n      </div>\n      <div className=\"grid gap-6\" style={{ gridTemplateColumns: 'repeat(auto-fit, minmax(320px, 360px))' }}>\n        {list.map(st => (\n          <div key={st.id} className=\"relative w-full\">\n            <div className=\"glass-card p-4 rounded-3xl hover:shadow-xl transition-all group relative overflow-hidden h-[220px] flex flex-col\">\n              <div className={`absolute top-4 right-4 text-xs px-2 py-0.5 rounded-md font-bold ${st.status === 'published' ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-500'}`}>{st.status === 'published' ? '已发布' : '草稿'}</div>\n              <div className=\"flex items-start gap-4\">\n                <div className=\"w-20 h-20 rounded-2xl bg-gradient-to-br from-pink-200 to-pink-300 flex items-center justify-center text-white text-xl font-bold shadow-inner border-2 border-white overflow-hidden flex-shrink-0\">\n                  {st.image ? (<img src={st.image} alt=\"cover\" className=\"w-full h-full object-cover\" />) : (<span>{st.title ? st.title[0] : '?'}</span>)}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-baseline gap-2\">\n                    <h3 className=\"font-bold text-lg text-gray-800 truncate\">{st.title}</h3>\n                    <div className=\"text-xs text-gray-400 truncate\">{st.author || ''}</div>\n                  </div>\n                  <div className=\"flex gap-1 mt-2 flex-nowrap whitespace-nowrap overflow-hidden\" style={{ maxWidth: 300 }}>\n                    {(st.tags || []).map(t => (<span key={t} className=\"text-[10px] bg-pink-50 text-pink-600 px-1.5 py-0.5 rounded border border-pink-100\">#{t}</span>))}\n                  </div>\n                </div>\n              </div>\n              <div className=\"mt-3\"><p className=\"text-gray-600 text-sm leading-relaxed break-words\">{st.description || '暂无描述'}</p></div>\n              <div className=\"mt-auto flex gap-2 pt-3 border-t border-white/50\">\n                <button onClick={() => onEdit(st)} className=\"flex-1 py-2 text-xs font-bold text-pink-600 bg-pink-50 hover:bg-pink-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1\"><Edit3 size={12}/> 编辑</button>\n                {st.status === 'published' ? (\n                  <button onClick={() => handleToggleStatus(st.id, st.status)} className=\"flex-1 py-2 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1\"><Archive size={12}/> 回收</button>\n                ) : (\n                  <button onClick={() => handleToggleStatus(st.id, st.status)} className=\"flex-1 py-2 text-xs font-bold text-green-600 bg-green-50 hover:bg-green-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1\"><Send size={12}/> 发布</button>\n                )}\n              </div>\n            </div>\n            <button onClick={() => setDeleteTarget(st)} className=\"absolute -top-2 -right-2 z-10 w-8 h-8 rounded-full bg-white/60 backdrop-blur-md shadow-lg border border-pink-100 flex items-center justify-center text-gray-400 hover:text-red-500 transition\"><X size={12}/></button>\n          </div>\n        ))}\n      </div>\n      {deleteTarget && (\n        <>\n          <div className=\"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50\" onClick={() => setDeleteTarget(null)}></div>\n          <div className=\"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl\">\n              <h3 className=\"font-cute text-lg text-pink-900 mb-2\">删除故事</h3>\n              <p className=\"text-sm text-gray-500 mb-4\">确定删除“{deleteTarget.title}”吗？此操作不可撤回。</p>\n              <div className=\"flex justify-end gap-3\">\n                <button onClick={() => setDeleteTarget(null)} className=\"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50\">取消</button>\n                <button onClick={() => { onDelete(deleteTarget.id); setDeleteTarget(null) }} className=\"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600\">确认删除</button>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  )\n}\n\nconst StoryManagement = () => (\n  <ToastProvider>\n    <StoryManagementInner />\n  </ToastProvider>\n)\n\nexport default StoryManagement\n"],"names":["readFile","file","resolve","reader","createImage","url","reject","image","error","CoverEditor","initialImage","onSave","onCancel","step","setStep","useState","tempImage","setTempImage","handleFileChange","e","dataUrl","jsxs","jsx","Header","UploadView","EditView","onBack","onClose","title","ChevronLeft","X","onFileChange","isDragging","setIsDragging","fileInputRef","useRef","UploadCloud","imageSrc","canvasRef","imageObj","setImageObj","saving","setSaving","rotation","setRotation","offset","setOffset","dragStart","setDragStart","baseScale","setBaseScale","zoom","setZoom","CANVAS_SIZE","VIEWPORT_W","VIEWPORT_H","useEffect","img","scaleX","scaleY","initScale","handleWheel","delta","prev","draw","useCallback","ctx","rad","localX","localY","currentScale","imgWidth","imgHeight","centerX","centerY","topOffset","handleMouseDown","rect","x","_b","_a","y","_d","_c","handleMouseMove","clientX","clientY","dx","dy","handleMouseUp","handleRotate","handleFinalSave","tempCanvas","tCtx","blob","b","result","uploadAPI","RotateCw","ZoomOut","ZoomIn","StoryCreateView","initialData","notify","form","setForm","selectedChars","setSelectedChars","charOptions","setCharOptions","isDropdownOpen","setIsDropdownOpen","ddRef","React","id","res","charactersAPI","published","it","onDoc","tagInput","setTagInput","showCoverEditor","setShowCoverEditor","addTag","v","p","removeTag","save","payload","storiesAPI","Save","opt","cid","nm","o","StoryManagementInner","view","setView","editing","setEditing","showToast","useToast","list","setList","deleteTarget","setDeleteTarget","reload","d","onCreate","onEdit","item","onDelete","handleToggleStatus","current","Plus","st","t","Edit3","Archive","Send","Fragment","StoryManagement","ToastProvider"],"mappings":"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"}