const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/http-De6Ej-g0.js","assets/index-BQBSjhgZ.js","assets/index-BWHqBk44.css","assets/x-CKrcKAky.js"])))=>i.map(i=>d[i]);
import{a as u,j as n,_ as ve,R as fo}from"./index-BQBSjhgZ.js";import{c as Ve,P as ht,U as un,X as Nt,b as Ss,e as mo,d as po,T as hn,A as Yt,E as xo,S as Si,a as wt,C as Xt,I as Ti,f as Ks,L as er,g as go}from"./x-CKrcKAky.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],fn=Ve("camera",yo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vo=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],_i=Ve("check",vo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],mn=Ve("chevron-up",bo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],jo=Ve("eye-off",wo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],So=Ve("eye",No);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],_o=Ve("globe",To);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],ki=Ve("heart",ko);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],Ao=Ve("house",Co);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Eo=Ve("image",Po);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Mo=Ve("lock",Io);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Do=Ve("mail",Ro);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],pn=Ve("message-circle",Lo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vo=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Fo=Ve("message-square",Vo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oo=[["path",{d:"M5 12h14",key:"1ays0h"}]],$o=Ve("minus",Oo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Bo=Ve("pen-tool",zo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uo=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ys=Ve("pen",Uo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],Wo=Ve("pin",Ho),xn=()=>typeof window<"u"&&typeof window.clarity=="function",st=e=>{try{try{console.log("[analytics] identifyUser",String(e.userId??""),(e==null?void 0:e.name)??null)}catch{}if(!xn())return;const t=e.userId!==void 0&&e.userId!==null?String(e.userId):"",s=e.sessionId??null,r=e.pageId??null,i=e.name??null;window.clarity("identify",t,s,r,i)}catch{}},ke=(e,t)=>{try{if(!xn())return;window.clarity("set",e,t)}catch{}},tt=(e,t)=>{try{if(!xn())return;window.clarity("event",e),t&&Object.entries(t).forEach(([s,r])=>{try{window.clarity("set",s,r)}catch{}})}catch{}},gn=u.createContext({});function yn(e){const t=u.useRef(null);return t.current===null&&(t.current=e()),t.current}const Ts=u.createContext(null),vn=u.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Ko extends u.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=s.offsetHeight||0,r.width=s.offsetWidth||0,r.top=s.offsetTop,r.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Yo({children:e,isPresent:t}){const s=u.useId(),r=u.useRef(null),i=u.useRef({width:0,height:0,top:0,left:0}),{nonce:l}=u.useContext(vn);return u.useInsertionEffect(()=>{const{width:o,height:a,top:c,left:d}=i.current;if(t||!r.current||!o||!a)return;r.current.dataset.motionPopId=s;const h=document.createElement("style");return l&&(h.nonce=l),document.head.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${a}px !important;
            top: ${c}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(h)}},[t]),n.jsx(Ko,{isPresent:t,childRef:r,sizeRef:i,children:u.cloneElement(e,{ref:r})})}const Xo=({children:e,initial:t,isPresent:s,onExitComplete:r,custom:i,presenceAffectsLayout:l,mode:o})=>{const a=yn(Go),c=u.useId(),d=u.useCallback(f=>{a.set(f,!0);for(const x of a.values())if(!x)return;r&&r()},[a,r]),h=u.useMemo(()=>({id:c,initial:t,isPresent:s,custom:i,onExitComplete:d,register:f=>(a.set(f,!1),()=>a.delete(f))}),l?[Math.random(),d]:[s,d]);return u.useMemo(()=>{a.forEach((f,x)=>a.set(x,!1))},[s]),u.useEffect(()=>{!s&&!a.size&&r&&r()},[s]),o==="popLayout"&&(e=n.jsx(Yo,{isPresent:s,children:e})),n.jsx(Ts.Provider,{value:h,children:e})};function Go(){return new Map}function Ci(e=!0){const t=u.useContext(Ts);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:r,register:i}=t,l=u.useId();u.useEffect(()=>{e&&i(l)},[e]);const o=u.useCallback(()=>e&&r&&r(l),[l,r,e]);return!s&&r?[!1,o]:[!0]}const is=e=>e.key||"";function tr(e){const t=[];return u.Children.forEach(e,s=>{u.isValidElement(s)&&t.push(s)}),t}const bn=typeof window<"u",Ai=bn?u.useLayoutEffect:u.useEffect,It=({children:e,custom:t,initial:s=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:l="sync",propagate:o=!1})=>{const[a,c]=Ci(o),d=u.useMemo(()=>tr(e),[e]),h=o&&!a?[]:d.map(is),f=u.useRef(!0),x=u.useRef(d),v=yn(()=>new Map),[_,N]=u.useState(d),[E,S]=u.useState(d);Ai(()=>{f.current=!1,x.current=d;for(let B=0;B<E.length;B++){const b=is(E[B]);h.includes(b)?v.delete(b):v.get(b)!==!0&&v.set(b,!1)}},[E,h.length,h.join("-")]);const I=[];if(d!==_){let B=[...d];for(let b=0;b<E.length;b++){const w=E[b],D=is(w);h.includes(D)||(B.splice(b,0,w),I.push(w))}l==="wait"&&I.length&&(B=I),S(tr(B)),N(d);return}const{forceRender:T}=u.useContext(gn);return n.jsx(n.Fragment,{children:E.map(B=>{const b=is(B),w=o&&!a?!1:d===E||h.includes(b),D=()=>{if(v.has(b))v.set(b,!0);else return;let P=!0;v.forEach(q=>{q||(P=!1)}),P&&(T==null||T(),S(x.current),o&&(c==null||c()),r&&r())};return n.jsx(Xo,{isPresent:w,initial:!f.current||s?void 0:!1,custom:w?void 0:t,presenceAffectsLayout:i,mode:l,onExitComplete:w?void 0:D,children:B},b)})})},We=e=>e;let Pi=We;function wn(e){let t;return()=>(t===void 0&&(t=e()),t)}const Rt=(e,t,s)=>{const r=t-e;return r===0?1:(s-e)/r},ot=e=>e*1e3,lt=e=>e/1e3,qo={useManualTiming:!1};function Jo(e){let t=new Set,s=new Set,r=!1,i=!1;const l=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(d){l.has(d)&&(c.schedule(d),e()),d(o)}const c={schedule:(d,h=!1,f=!1)=>{const v=f&&r?t:s;return h&&l.add(d),v.has(d)||v.add(d),d},cancel:d=>{s.delete(d),l.delete(d)},process:d=>{if(o=d,r){i=!0;return}r=!0,[t,s]=[s,t],t.forEach(a),t.clear(),r=!1,i&&(i=!1,c.process(d))}};return c}const as=["read","resolveKeyframes","update","preRender","render","postRender"],Zo=40;function Ei(e,t){let s=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},l=()=>s=!0,o=as.reduce((S,I)=>(S[I]=Jo(l),S),{}),{read:a,resolveKeyframes:c,update:d,preRender:h,render:f,postRender:x}=o,v=()=>{const S=performance.now();s=!1,i.delta=r?1e3/60:Math.max(Math.min(S-i.timestamp,Zo),1),i.timestamp=S,i.isProcessing=!0,a.process(i),c.process(i),d.process(i),h.process(i),f.process(i),x.process(i),i.isProcessing=!1,s&&t&&(r=!1,e(v))},_=()=>{s=!0,r=!0,i.isProcessing||e(v)};return{schedule:as.reduce((S,I)=>{const T=o[I];return S[I]=(B,b=!1,w=!1)=>(s||_(),T.schedule(B,b,w)),S},{}),cancel:S=>{for(let I=0;I<as.length;I++)o[as[I]].cancel(S)},state:i,steps:o}}const{schedule:we,cancel:ft,state:Le,steps:Is}=Ei(typeof requestAnimationFrame<"u"?requestAnimationFrame:We,!0),Ii=u.createContext({strict:!1}),sr={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Dt={};for(const e in sr)Dt[e]={isEnabled:t=>sr[e].some(s=>!!t[s])};function Qo(e){for(const t in e)Dt[t]={...Dt[t],...e[t]}}const el=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function xs(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||el.has(e)}let Mi=e=>!xs(e);function tl(e){e&&(Mi=t=>t.startsWith("on")?!xs(t):e(t))}try{tl(require("@emotion/is-prop-valid").default)}catch{}function sl(e,t,s){const r={};for(const i in e)i==="values"&&typeof e.values=="object"||(Mi(i)||s===!0&&xs(i)||!t&&!xs(i)||e.draggable&&i.startsWith("onDrag"))&&(r[i]=e[i]);return r}function nl(e){if(typeof Proxy>"u")return e;const t=new Map,s=(...r)=>e(...r);return new Proxy(s,{get:(r,i)=>i==="create"?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}const _s=u.createContext({});function Gt(e){return typeof e=="string"||Array.isArray(e)}function ks(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const jn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Nn=["initial",...jn];function Cs(e){return ks(e.animate)||Nn.some(t=>Gt(e[t]))}function Ri(e){return!!(Cs(e)||e.variants)}function rl(e,t){if(Cs(e)){const{initial:s,animate:r}=e;return{initial:s===!1||Gt(s)?s:void 0,animate:Gt(r)?r:void 0}}return e.inherit!==!1?t:{}}function il(e){const{initial:t,animate:s}=rl(e,u.useContext(_s));return u.useMemo(()=>({initial:t,animate:s}),[nr(t),nr(s)])}function nr(e){return Array.isArray(e)?e.join(" "):e}const al=Symbol.for("motionComponentSymbol");function kt(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function ol(e,t,s){return u.useCallback(r=>{r&&e.onMount&&e.onMount(r),t&&(r?t.mount(r):t.unmount()),s&&(typeof s=="function"?s(r):kt(s)&&(s.current=r))},[t])}const Sn=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ll="framerAppearId",Di="data-"+Sn(ll),{schedule:Tn}=Ei(queueMicrotask,!1),Li=u.createContext({});function cl(e,t,s,r,i){var l,o;const{visualElement:a}=u.useContext(_s),c=u.useContext(Ii),d=u.useContext(Ts),h=u.useContext(vn).reducedMotion,f=u.useRef(null);r=r||c.renderer,!f.current&&r&&(f.current=r(e,{visualState:t,parent:a,props:s,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:h}));const x=f.current,v=u.useContext(Li);x&&!x.projection&&i&&(x.type==="html"||x.type==="svg")&&dl(f.current,s,i,v);const _=u.useRef(!1);u.useInsertionEffect(()=>{x&&_.current&&x.update(s,d)});const N=s[Di],E=u.useRef(!!N&&!(!((l=window.MotionHandoffIsComplete)===null||l===void 0)&&l.call(window,N))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,N)));return Ai(()=>{x&&(_.current=!0,window.MotionIsMounted=!0,x.updateFeatures(),Tn.render(x.render),E.current&&x.animationState&&x.animationState.animateChanges())}),u.useEffect(()=>{x&&(!E.current&&x.animationState&&x.animationState.animateChanges(),E.current&&(queueMicrotask(()=>{var S;(S=window.MotionHandoffMarkAsComplete)===null||S===void 0||S.call(window,N)}),E.current=!1))}),x}function dl(e,t,s,r){const{layoutId:i,layout:l,drag:o,dragConstraints:a,layoutScroll:c,layoutRoot:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:Vi(e.parent)),e.projection.setOptions({layoutId:i,layout:l,alwaysMeasureLayout:!!o||a&&kt(a),visualElement:e,animationType:typeof l=="string"?l:"both",initialPromotionConfig:r,layoutScroll:c,layoutRoot:d})}function Vi(e){if(e)return e.options.allowProjection!==!1?e.projection:Vi(e.parent)}function ul({preloadedFeatures:e,createVisualElement:t,useRender:s,useVisualState:r,Component:i}){var l,o;e&&Qo(e);function a(d,h){let f;const x={...u.useContext(vn),...d,layoutId:hl(d)},{isStatic:v}=x,_=il(d),N=r(d,v);if(!v&&bn){fl();const E=ml(x);f=E.MeasureLayout,_.visualElement=cl(i,N,x,t,E.ProjectionNode)}return n.jsxs(_s.Provider,{value:_,children:[f&&_.visualElement?n.jsx(f,{visualElement:_.visualElement,...x}):null,s(i,d,ol(N,_.visualElement,h),N,v,_.visualElement)]})}a.displayName=`motion.${typeof i=="string"?i:`create(${(o=(l=i.displayName)!==null&&l!==void 0?l:i.name)!==null&&o!==void 0?o:""})`}`;const c=u.forwardRef(a);return c[al]=i,c}function hl({layoutId:e}){const t=u.useContext(gn).id;return t&&e!==void 0?t+"-"+e:e}function fl(e,t){u.useContext(Ii).strict}function ml(e){const{drag:t,layout:s}=Dt;if(!t&&!s)return{};const r={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(e)||s!=null&&s.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}const pl=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function _n(e){return typeof e!="string"||e.includes("-")?!1:!!(pl.indexOf(e)>-1||/[A-Z]/u.test(e))}function rr(e){const t=[{},{}];return e==null||e.values.forEach((s,r)=>{t[0][r]=s.get(),t[1][r]=s.getVelocity()}),t}function kn(e,t,s,r){if(typeof t=="function"){const[i,l]=rr(r);t=t(s!==void 0?s:e.custom,i,l)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[i,l]=rr(r);t=t(s!==void 0?s:e.custom,i,l)}return t}const Xs=e=>Array.isArray(e),xl=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),gl=e=>Xs(e)?e[e.length-1]||0:e,ze=e=>!!(e&&e.getVelocity);function us(e){const t=ze(e)?e.get():e;return xl(t)?t.toValue():t}function yl({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:s},r,i,l){const o={latestValues:vl(r,i,l,e),renderState:t()};return s&&(o.onMount=a=>s({props:r,current:a,...o}),o.onUpdate=a=>s(a)),o}const Fi=e=>(t,s)=>{const r=u.useContext(_s),i=u.useContext(Ts),l=()=>yl(e,t,r,i);return s?l():yn(l)};function vl(e,t,s,r){const i={},l=r(e,{});for(const x in l)i[x]=us(l[x]);let{initial:o,animate:a}=e;const c=Cs(e),d=Ri(e);t&&d&&!c&&e.inherit!==!1&&(o===void 0&&(o=t.initial),a===void 0&&(a=t.animate));let h=s?s.initial===!1:!1;h=h||o===!1;const f=h?a:o;if(f&&typeof f!="boolean"&&!ks(f)){const x=Array.isArray(f)?f:[f];for(let v=0;v<x.length;v++){const _=kn(e,x[v]);if(_){const{transitionEnd:N,transition:E,...S}=_;for(const I in S){let T=S[I];if(Array.isArray(T)){const B=h?T.length-1:0;T=T[B]}T!==null&&(i[I]=T)}for(const I in N)i[I]=N[I]}}}return i}const Vt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Tt=new Set(Vt),Oi=e=>t=>typeof t=="string"&&t.startsWith(e),$i=Oi("--"),bl=Oi("var(--"),Cn=e=>bl(e)?wl.test(e.split("/*")[0].trim()):!1,wl=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,zi=(e,t)=>t&&typeof e=="number"?t.transform(e):e,ct=(e,t,s)=>s>t?t:s<e?e:s,Ft={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},qt={...Ft,transform:e=>ct(0,1,e)},os={...Ft,default:1},es=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),ut=es("deg"),nt=es("%"),ee=es("px"),jl=es("vh"),Nl=es("vw"),ir={...nt,parse:e=>nt.parse(e)/100,transform:e=>nt.transform(e*100)},Sl={borderWidth:ee,borderTopWidth:ee,borderRightWidth:ee,borderBottomWidth:ee,borderLeftWidth:ee,borderRadius:ee,radius:ee,borderTopLeftRadius:ee,borderTopRightRadius:ee,borderBottomRightRadius:ee,borderBottomLeftRadius:ee,width:ee,maxWidth:ee,height:ee,maxHeight:ee,top:ee,right:ee,bottom:ee,left:ee,padding:ee,paddingTop:ee,paddingRight:ee,paddingBottom:ee,paddingLeft:ee,margin:ee,marginTop:ee,marginRight:ee,marginBottom:ee,marginLeft:ee,backgroundPositionX:ee,backgroundPositionY:ee},Tl={rotate:ut,rotateX:ut,rotateY:ut,rotateZ:ut,scale:os,scaleX:os,scaleY:os,scaleZ:os,skew:ut,skewX:ut,skewY:ut,distance:ee,translateX:ee,translateY:ee,translateZ:ee,x:ee,y:ee,z:ee,perspective:ee,transformPerspective:ee,opacity:qt,originX:ir,originY:ir,originZ:ee},ar={...Ft,transform:Math.round},An={...Sl,...Tl,zIndex:ar,size:ee,fillOpacity:qt,strokeOpacity:qt,numOctaves:ar},_l={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},kl=Vt.length;function Cl(e,t,s){let r="",i=!0;for(let l=0;l<kl;l++){const o=Vt[l],a=e[o];if(a===void 0)continue;let c=!0;if(typeof a=="number"?c=a===(o.startsWith("scale")?1:0):c=parseFloat(a)===0,!c||s){const d=zi(a,An[o]);if(!c){i=!1;const h=_l[o]||o;r+=`${h}(${d}) `}s&&(t[o]=d)}}return r=r.trim(),s?r=s(t,i?"":r):i&&(r="none"),r}function Pn(e,t,s){const{style:r,vars:i,transformOrigin:l}=e;let o=!1,a=!1;for(const c in t){const d=t[c];if(Tt.has(c)){o=!0;continue}else if($i(c)){i[c]=d;continue}else{const h=zi(d,An[c]);c.startsWith("origin")?(a=!0,l[c]=h):r[c]=h}}if(t.transform||(o||s?r.transform=Cl(t,e.transform,s):r.transform&&(r.transform="none")),a){const{originX:c="50%",originY:d="50%",originZ:h=0}=l;r.transformOrigin=`${c} ${d} ${h}`}}const Al={offset:"stroke-dashoffset",array:"stroke-dasharray"},Pl={offset:"strokeDashoffset",array:"strokeDasharray"};function El(e,t,s=1,r=0,i=!0){e.pathLength=1;const l=i?Al:Pl;e[l.offset]=ee.transform(-r);const o=ee.transform(t),a=ee.transform(s);e[l.array]=`${o} ${a}`}function or(e,t,s){return typeof e=="string"?e:ee.transform(t+s*e)}function Il(e,t,s){const r=or(t,e.x,e.width),i=or(s,e.y,e.height);return`${r} ${i}`}function En(e,{attrX:t,attrY:s,attrScale:r,originX:i,originY:l,pathLength:o,pathSpacing:a=1,pathOffset:c=0,...d},h,f){if(Pn(e,d,f),h){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:x,style:v,dimensions:_}=e;x.transform&&(_&&(v.transform=x.transform),delete x.transform),_&&(i!==void 0||l!==void 0||v.transform)&&(v.transformOrigin=Il(_,i!==void 0?i:.5,l!==void 0?l:.5)),t!==void 0&&(x.x=t),s!==void 0&&(x.y=s),r!==void 0&&(x.scale=r),o!==void 0&&El(x,o,a,c,!1)}const In=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Bi=()=>({...In(),attrs:{}}),Mn=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Ui(e,{style:t,vars:s},r,i){Object.assign(e.style,t,i&&i.getProjectionStyles(r));for(const l in s)e.style.setProperty(l,s[l])}const Hi=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Wi(e,t,s,r){Ui(e,t,void 0,r);for(const i in t.attrs)e.setAttribute(Hi.has(i)?i:Sn(i),t.attrs[i])}const gs={};function Ml(e){Object.assign(gs,e)}function Ki(e,{layout:t,layoutId:s}){return Tt.has(e)||e.startsWith("origin")||(t||s!==void 0)&&(!!gs[e]||e==="opacity")}function Rn(e,t,s){var r;const{style:i}=e,l={};for(const o in i)(ze(i[o])||t.style&&ze(t.style[o])||Ki(o,e)||((r=s==null?void 0:s.getValue(o))===null||r===void 0?void 0:r.liveStyle)!==void 0)&&(l[o]=i[o]);return l}function Yi(e,t,s){const r=Rn(e,t,s);for(const i in e)if(ze(e[i])||ze(t[i])){const l=Vt.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;r[l]=e[i]}return r}function Rl(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const lr=["x","y","width","height","cx","cy","r"],Dl={useVisualState:Fi({scrapeMotionValuesFromProps:Yi,createRenderState:Bi,onUpdate:({props:e,prevProps:t,current:s,renderState:r,latestValues:i})=>{if(!s)return;let l=!!e.drag;if(!l){for(const a in i)if(Tt.has(a)){l=!0;break}}if(!l)return;let o=!t;if(t)for(let a=0;a<lr.length;a++){const c=lr[a];e[c]!==t[c]&&(o=!0)}o&&we.read(()=>{Rl(s,r),we.render(()=>{En(r,i,Mn(s.tagName),e.transformTemplate),Wi(s,r)})})}})},Ll={useVisualState:Fi({scrapeMotionValuesFromProps:Rn,createRenderState:In})};function Xi(e,t,s){for(const r in t)!ze(t[r])&&!Ki(r,s)&&(e[r]=t[r])}function Vl({transformTemplate:e},t){return u.useMemo(()=>{const s=In();return Pn(s,t,e),Object.assign({},s.vars,s.style)},[t])}function Fl(e,t){const s=e.style||{},r={};return Xi(r,s,e),Object.assign(r,Vl(e,t)),r}function Ol(e,t){const s={},r=Fl(e,t);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=r,s}function $l(e,t,s,r){const i=u.useMemo(()=>{const l=Bi();return En(l,t,Mn(r),e.transformTemplate),{...l.attrs,style:{...l.style}}},[t]);if(e.style){const l={};Xi(l,e.style,e),i.style={...l,...i.style}}return i}function zl(e=!1){return(s,r,i,{latestValues:l},o)=>{const c=(_n(s)?$l:Ol)(r,l,o,s),d=sl(r,typeof s=="string",e),h=s!==u.Fragment?{...d,...c,ref:i}:{},{children:f}=r,x=u.useMemo(()=>ze(f)?f.get():f,[f]);return u.createElement(s,{...h,children:x})}}function Bl(e,t){return function(r,{forwardMotionProps:i}={forwardMotionProps:!1}){const o={..._n(r)?Dl:Ll,preloadedFeatures:e,useRender:zl(i),createVisualElement:t,Component:r};return ul(o)}}function Gi(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let r=0;r<s;r++)if(t[r]!==e[r])return!1;return!0}function As(e,t,s){const r=e.getProps();return kn(r,t,s!==void 0?s:r.custom,e)}const Ul=wn(()=>window.ScrollTimeline!==void 0);class Hl{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let r=0;r<this.animations.length;r++)this.animations[r][t]=s}attachTimeline(t,s){const r=this.animations.map(i=>{if(Ul()&&i.attachTimeline)return i.attachTimeline(t);if(typeof s=="function")return s(i)});return()=>{r.forEach((i,l)=>{i&&i(),this.animations[l].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Wl extends Hl{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function Dn(e,t){return e?e[t]||e.default||e:void 0}const Gs=2e4;function qi(e){let t=0;const s=50;let r=e.next(t);for(;!r.done&&t<Gs;)t+=s,r=e.next(t);return t>=Gs?1/0:t}function Ln(e){return typeof e=="function"}function cr(e,t){e.timeline=t,e.onfinish=null}const Vn=e=>Array.isArray(e)&&typeof e[0]=="number",Kl={linearEasing:void 0};function Yl(e,t){const s=wn(e);return()=>{var r;return(r=Kl[t])!==null&&r!==void 0?r:s()}}const ys=Yl(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Ji=(e,t,s=10)=>{let r="";const i=Math.max(Math.round(t/s),2);for(let l=0;l<i;l++)r+=e(Rt(0,i-1,l))+", ";return`linear(${r.substring(0,r.length-2)})`};function Zi(e){return!!(typeof e=="function"&&ys()||!e||typeof e=="string"&&(e in qs||ys())||Vn(e)||Array.isArray(e)&&e.every(Zi))}const $t=([e,t,s,r])=>`cubic-bezier(${e}, ${t}, ${s}, ${r})`,qs={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:$t([0,.65,.55,1]),circOut:$t([.55,0,1,.45]),backIn:$t([.31,.01,.66,-.59]),backOut:$t([.33,1.53,.69,.99])};function Qi(e,t){if(e)return typeof e=="function"&&ys()?Ji(e,t):Vn(e)?$t(e):Array.isArray(e)?e.map(s=>Qi(s,t)||qs.easeOut):qs[e]}const Qe={x:!1,y:!1};function ea(){return Qe.x||Qe.y}function Xl(e,t,s){var r;if(e instanceof Element)return[e];if(typeof e=="string"){let i=document;const l=(r=void 0)!==null&&r!==void 0?r:i.querySelectorAll(e);return l?Array.from(l):[]}return Array.from(e)}function ta(e,t){const s=Xl(e),r=new AbortController,i={passive:!0,...t,signal:r.signal};return[s,i,()=>r.abort()]}function dr(e){return t=>{t.pointerType==="touch"||ea()||e(t)}}function Gl(e,t,s={}){const[r,i,l]=ta(e,s),o=dr(a=>{const{target:c}=a,d=t(a);if(typeof d!="function"||!c)return;const h=dr(f=>{d(f),c.removeEventListener("pointerleave",h)});c.addEventListener("pointerleave",h,i)});return r.forEach(a=>{a.addEventListener("pointerenter",o,i)}),l}const sa=(e,t)=>t?e===t?!0:sa(e,t.parentElement):!1,Fn=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,ql=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Jl(e){return ql.has(e.tagName)||e.tabIndex!==-1}const zt=new WeakSet;function ur(e){return t=>{t.key==="Enter"&&e(t)}}function Ms(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Zl=(e,t)=>{const s=e.currentTarget;if(!s)return;const r=ur(()=>{if(zt.has(s))return;Ms(s,"down");const i=ur(()=>{Ms(s,"up")}),l=()=>Ms(s,"cancel");s.addEventListener("keyup",i,t),s.addEventListener("blur",l,t)});s.addEventListener("keydown",r,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",r),t)};function hr(e){return Fn(e)&&!ea()}function Ql(e,t,s={}){const[r,i,l]=ta(e,s),o=a=>{const c=a.currentTarget;if(!hr(a)||zt.has(c))return;zt.add(c);const d=t(a),h=(v,_)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",x),!(!hr(v)||!zt.has(c))&&(zt.delete(c),typeof d=="function"&&d(v,{success:_}))},f=v=>{h(v,s.useGlobalTarget||sa(c,v.target))},x=v=>{h(v,!1)};window.addEventListener("pointerup",f,i),window.addEventListener("pointercancel",x,i)};return r.forEach(a=>{!Jl(a)&&a.getAttribute("tabindex")===null&&(a.tabIndex=0),(s.useGlobalTarget?window:a).addEventListener("pointerdown",o,i),a.addEventListener("focus",d=>Zl(d,i),i)}),l}function ec(e){return e==="x"||e==="y"?Qe[e]?null:(Qe[e]=!0,()=>{Qe[e]=!1}):Qe.x||Qe.y?null:(Qe.x=Qe.y=!0,()=>{Qe.x=Qe.y=!1})}const na=new Set(["width","height","top","left","right","bottom",...Vt]);let hs;function tc(){hs=void 0}const rt={now:()=>(hs===void 0&&rt.set(Le.isProcessing||qo.useManualTiming?Le.timestamp:performance.now()),hs),set:e=>{hs=e,queueMicrotask(tc)}};function On(e,t){e.indexOf(t)===-1&&e.push(t)}function $n(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class zn{constructor(){this.subscriptions=[]}add(t){return On(this.subscriptions,t),()=>$n(this.subscriptions,t)}notify(t,s,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](t,s,r);else for(let l=0;l<i;l++){const o=this.subscriptions[l];o&&o(t,s,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function ra(e,t){return t?e*(1e3/t):0}const fr=30,sc=e=>!isNaN(parseFloat(e));class nc{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(r,i=!0)=>{const l=rt.now();this.updatedAt!==l&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=rt.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=sc(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new zn);const r=this.events[t].add(s);return t==="change"?()=>{r(),we.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,r){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-r}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=rt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>fr)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,fr);return ra(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Jt(e,t){return new nc(e,t)}function rc(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,Jt(s))}function ic(e,t){const s=As(e,t);let{transitionEnd:r={},transition:i={},...l}=s||{};l={...l,...r};for(const o in l){const a=gl(l[o]);rc(e,o,a)}}function ac(e){return!!(ze(e)&&e.add)}function Js(e,t){const s=e.getValue("willChange");if(ac(s))return s.add(t)}function ia(e){return e.props[Di]}const aa=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e,oc=1e-7,lc=12;function cc(e,t,s,r,i){let l,o,a=0;do o=t+(s-t)/2,l=aa(o,r,i)-e,l>0?s=o:t=o;while(Math.abs(l)>oc&&++a<lc);return o}function ts(e,t,s,r){if(e===t&&s===r)return We;const i=l=>cc(l,0,1,e,s);return l=>l===0||l===1?l:aa(i(l),t,r)}const oa=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,la=e=>t=>1-e(1-t),ca=ts(.33,1.53,.69,.99),Bn=la(ca),da=oa(Bn),ua=e=>(e*=2)<1?.5*Bn(e):.5*(2-Math.pow(2,-10*(e-1))),Un=e=>1-Math.sin(Math.acos(e)),ha=la(Un),fa=oa(Un),ma=e=>/^0[^.\s]+$/u.test(e);function dc(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||ma(e):!0}const Ut=e=>Math.round(e*1e5)/1e5,Hn=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function uc(e){return e==null}const hc=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Wn=(e,t)=>s=>!!(typeof s=="string"&&hc.test(s)&&s.startsWith(e)||t&&!uc(s)&&Object.prototype.hasOwnProperty.call(s,t)),pa=(e,t,s)=>r=>{if(typeof r!="string")return r;const[i,l,o,a]=r.match(Hn);return{[e]:parseFloat(i),[t]:parseFloat(l),[s]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},fc=e=>ct(0,255,e),Rs={...Ft,transform:e=>Math.round(fc(e))},jt={test:Wn("rgb","red"),parse:pa("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:r=1})=>"rgba("+Rs.transform(e)+", "+Rs.transform(t)+", "+Rs.transform(s)+", "+Ut(qt.transform(r))+")"};function mc(e){let t="",s="",r="",i="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),r=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),r=e.substring(3,4),i=e.substring(4,5),t+=t,s+=s,r+=r,i+=i),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const Zs={test:Wn("#"),parse:mc,transform:jt.transform},Ct={test:Wn("hsl","hue"),parse:pa("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:r=1})=>"hsla("+Math.round(e)+", "+nt.transform(Ut(t))+", "+nt.transform(Ut(s))+", "+Ut(qt.transform(r))+")"},$e={test:e=>jt.test(e)||Zs.test(e)||Ct.test(e),parse:e=>jt.test(e)?jt.parse(e):Ct.test(e)?Ct.parse(e):Zs.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?jt.transform(e):Ct.transform(e)},pc=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function xc(e){var t,s;return isNaN(e)&&typeof e=="string"&&(((t=e.match(Hn))===null||t===void 0?void 0:t.length)||0)+(((s=e.match(pc))===null||s===void 0?void 0:s.length)||0)>0}const xa="number",ga="color",gc="var",yc="var(",mr="${}",vc=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Zt(e){const t=e.toString(),s=[],r={color:[],number:[],var:[]},i=[];let l=0;const a=t.replace(vc,c=>($e.test(c)?(r.color.push(l),i.push(ga),s.push($e.parse(c))):c.startsWith(yc)?(r.var.push(l),i.push(gc),s.push(c)):(r.number.push(l),i.push(xa),s.push(parseFloat(c))),++l,mr)).split(mr);return{values:s,split:a,indexes:r,types:i}}function ya(e){return Zt(e).values}function va(e){const{split:t,types:s}=Zt(e),r=t.length;return i=>{let l="";for(let o=0;o<r;o++)if(l+=t[o],i[o]!==void 0){const a=s[o];a===xa?l+=Ut(i[o]):a===ga?l+=$e.transform(i[o]):l+=i[o]}return l}}const bc=e=>typeof e=="number"?0:e;function wc(e){const t=ya(e);return va(e)(t.map(bc))}const mt={test:xc,parse:ya,createTransformer:va,getAnimatableNone:wc},jc=new Set(["brightness","contrast","saturate","opacity"]);function Nc(e){const[t,s]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=s.match(Hn)||[];if(!r)return e;const i=s.replace(r,"");let l=jc.has(t)?1:0;return r!==s&&(l*=100),t+"("+l+i+")"}const Sc=/\b([a-z-]*)\(.*?\)/gu,Qs={...mt,getAnimatableNone:e=>{const t=e.match(Sc);return t?t.map(Nc).join(" "):e}},Tc={...An,color:$e,backgroundColor:$e,outlineColor:$e,fill:$e,stroke:$e,borderColor:$e,borderTopColor:$e,borderRightColor:$e,borderBottomColor:$e,borderLeftColor:$e,filter:Qs,WebkitFilter:Qs},Kn=e=>Tc[e];function ba(e,t){let s=Kn(e);return s!==Qs&&(s=mt),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const _c=new Set(["auto","none","0"]);function kc(e,t,s){let r=0,i;for(;r<e.length&&!i;){const l=e[r];typeof l=="string"&&!_c.has(l)&&Zt(l).values.length&&(i=e[r]),r++}if(i&&s)for(const l of t)e[l]=ba(s,i)}const pr=e=>e===Ft||e===ee,xr=(e,t)=>parseFloat(e.split(", ")[t]),gr=(e,t)=>(s,{transform:r})=>{if(r==="none"||!r)return 0;const i=r.match(/^matrix3d\((.+)\)$/u);if(i)return xr(i[1],t);{const l=r.match(/^matrix\((.+)\)$/u);return l?xr(l[1],e):0}},Cc=new Set(["x","y","z"]),Ac=Vt.filter(e=>!Cc.has(e));function Pc(e){const t=[];return Ac.forEach(s=>{const r=e.getValue(s);r!==void 0&&(t.push([s,r.get()]),r.set(s.startsWith("scale")?1:0))}),t}const Lt={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:gr(4,13),y:gr(5,14)};Lt.translateX=Lt.x;Lt.translateY=Lt.y;const St=new Set;let en=!1,tn=!1;function wa(){if(tn){const e=Array.from(St).filter(r=>r.needsMeasurement),t=new Set(e.map(r=>r.element)),s=new Map;t.forEach(r=>{const i=Pc(r);i.length&&(s.set(r,i),r.render())}),e.forEach(r=>r.measureInitialState()),t.forEach(r=>{r.render();const i=s.get(r);i&&i.forEach(([l,o])=>{var a;(a=r.getValue(l))===null||a===void 0||a.set(o)})}),e.forEach(r=>r.measureEndState()),e.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}tn=!1,en=!1,St.forEach(e=>e.complete()),St.clear()}function ja(){St.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(tn=!0)})}function Ec(){ja(),wa()}class Yn{constructor(t,s,r,i,l,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=r,this.motionValue=i,this.element=l,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(St.add(this),en||(en=!0,we.read(ja),we.resolveKeyframes(wa))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:r,motionValue:i}=this;for(let l=0;l<t.length;l++)if(t[l]===null)if(l===0){const o=i==null?void 0:i.get(),a=t[t.length-1];if(o!==void 0)t[0]=o;else if(r&&s){const c=r.readValue(s,a);c!=null&&(t[0]=c)}t[0]===void 0&&(t[0]=a),i&&o===void 0&&i.set(t[0])}else t[l]=t[l-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),St.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,St.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Na=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Ic=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Mc(e){const t=Ic.exec(e);if(!t)return[,];const[,s,r,i]=t;return[`--${s??r}`,i]}function Sa(e,t,s=1){const[r,i]=Mc(e);if(!r)return;const l=window.getComputedStyle(t).getPropertyValue(r);if(l){const o=l.trim();return Na(o)?parseFloat(o):o}return Cn(i)?Sa(i,t,s+1):i}const Ta=e=>t=>t.test(e),Rc={test:e=>e==="auto",parse:e=>e},_a=[Ft,ee,nt,ut,Nl,jl,Rc],yr=e=>_a.find(Ta(e));class ka extends Yn{constructor(t,s,r,i,l){super(t,s,r,i,l,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:r}=this;if(!s||!s.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),Cn(d))){const h=Sa(d,s.current);h!==void 0&&(t[c]=h),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!na.has(r)||t.length!==2)return;const[i,l]=t,o=yr(i),a=yr(l);if(o!==a)if(pr(o)&&pr(a))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,r=[];for(let i=0;i<t.length;i++)dc(t[i])&&r.push(i);r.length&&kc(t,r,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:r}=this;if(!t||!t.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Lt[r](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const i=s[s.length-1];i!==void 0&&t.getValue(r,i).jump(i,!1)}measureEndState(){var t;const{element:s,name:r,unresolvedKeyframes:i}=this;if(!s||!s.current)return;const l=s.getValue(r);l&&l.jump(this.measuredOrigin,!1);const o=i.length-1,a=i[o];i[o]=Lt[r](s.measureViewportBox(),window.getComputedStyle(s.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([c,d])=>{s.getValue(c).set(d)}),this.resolveNoneKeyframes()}}const vr=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(mt.test(e)||e==="0")&&!e.startsWith("url("));function Dc(e){const t=e[0];if(e.length===1)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}function Lc(e,t,s,r){const i=e[0];if(i===null)return!1;if(t==="display"||t==="visibility")return!0;const l=e[e.length-1],o=vr(i,t),a=vr(l,t);return!o||!a?!1:Dc(e)||(s==="spring"||Ln(s))&&r}const Vc=e=>e!==null;function Ps(e,{repeat:t,repeatType:s="loop"},r){const i=e.filter(Vc),l=t&&s!=="loop"&&t%2===1?0:i.length-1;return!l||r===void 0?i[l]:r}const Fc=40;class Ca{constructor({autoplay:t=!0,delay:s=0,type:r="keyframes",repeat:i=0,repeatDelay:l=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=rt.now(),this.options={autoplay:t,delay:s,type:r,repeat:i,repeatDelay:l,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>Fc?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Ec(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=rt.now(),this.hasAttemptedResolve=!0;const{name:r,type:i,velocity:l,delay:o,onComplete:a,onUpdate:c,isGenerator:d}=this.options;if(!d&&!Lc(t,r,i,l))if(o)this.options.duration=0;else{c&&c(Ps(t,this.options,s)),a&&a(),this.resolveFinishedPromise();return}const h=this.initPlayback(t,s);h!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...h},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const Te=(e,t,s)=>e+(t-e)*s;function Ds(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(t-e)*6*s:s<1/2?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function Oc({hue:e,saturation:t,lightness:s,alpha:r}){e/=360,t/=100,s/=100;let i=0,l=0,o=0;if(!t)i=l=o=s;else{const a=s<.5?s*(1+t):s+t-s*t,c=2*s-a;i=Ds(c,a,e+1/3),l=Ds(c,a,e),o=Ds(c,a,e-1/3)}return{red:Math.round(i*255),green:Math.round(l*255),blue:Math.round(o*255),alpha:r}}function vs(e,t){return s=>s>0?t:e}const Ls=(e,t,s)=>{const r=e*e,i=s*(t*t-r)+r;return i<0?0:Math.sqrt(i)},$c=[Zs,jt,Ct],zc=e=>$c.find(t=>t.test(e));function br(e){const t=zc(e);if(!t)return!1;let s=t.parse(e);return t===Ct&&(s=Oc(s)),s}const wr=(e,t)=>{const s=br(e),r=br(t);if(!s||!r)return vs(e,t);const i={...s};return l=>(i.red=Ls(s.red,r.red,l),i.green=Ls(s.green,r.green,l),i.blue=Ls(s.blue,r.blue,l),i.alpha=Te(s.alpha,r.alpha,l),jt.transform(i))},Bc=(e,t)=>s=>t(e(s)),ss=(...e)=>e.reduce(Bc),sn=new Set(["none","hidden"]);function Uc(e,t){return sn.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}function Hc(e,t){return s=>Te(e,t,s)}function Xn(e){return typeof e=="number"?Hc:typeof e=="string"?Cn(e)?vs:$e.test(e)?wr:Yc:Array.isArray(e)?Aa:typeof e=="object"?$e.test(e)?wr:Wc:vs}function Aa(e,t){const s=[...e],r=s.length,i=e.map((l,o)=>Xn(l)(l,t[o]));return l=>{for(let o=0;o<r;o++)s[o]=i[o](l);return s}}function Wc(e,t){const s={...e,...t},r={};for(const i in s)e[i]!==void 0&&t[i]!==void 0&&(r[i]=Xn(e[i])(e[i],t[i]));return i=>{for(const l in r)s[l]=r[l](i);return s}}function Kc(e,t){var s;const r=[],i={color:0,var:0,number:0};for(let l=0;l<t.values.length;l++){const o=t.types[l],a=e.indexes[o][i[o]],c=(s=e.values[a])!==null&&s!==void 0?s:0;r[l]=c,i[o]++}return r}const Yc=(e,t)=>{const s=mt.createTransformer(t),r=Zt(e),i=Zt(t);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?sn.has(e)&&!i.values.length||sn.has(t)&&!r.values.length?Uc(e,t):ss(Aa(Kc(r,i),i.values),s):vs(e,t)};function Pa(e,t,s){return typeof e=="number"&&typeof t=="number"&&typeof s=="number"?Te(e,t,s):Xn(e)(e,t)}const Xc=5;function Ea(e,t,s){const r=Math.max(t-Xc,0);return ra(s-e(r),t-r)}const _e={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Vs=.001;function Gc({duration:e=_e.duration,bounce:t=_e.bounce,velocity:s=_e.velocity,mass:r=_e.mass}){let i,l,o=1-t;o=ct(_e.minDamping,_e.maxDamping,o),e=ct(_e.minDuration,_e.maxDuration,lt(e)),o<1?(i=d=>{const h=d*o,f=h*e,x=h-s,v=nn(d,o),_=Math.exp(-f);return Vs-x/v*_},l=d=>{const f=d*o*e,x=f*s+s,v=Math.pow(o,2)*Math.pow(d,2)*e,_=Math.exp(-f),N=nn(Math.pow(d,2),o);return(-i(d)+Vs>0?-1:1)*((x-v)*_)/N}):(i=d=>{const h=Math.exp(-d*e),f=(d-s)*e+1;return-Vs+h*f},l=d=>{const h=Math.exp(-d*e),f=(s-d)*(e*e);return h*f});const a=5/e,c=Jc(i,l,a);if(e=ot(e),isNaN(c))return{stiffness:_e.stiffness,damping:_e.damping,duration:e};{const d=Math.pow(c,2)*r;return{stiffness:d,damping:o*2*Math.sqrt(r*d),duration:e}}}const qc=12;function Jc(e,t,s){let r=s;for(let i=1;i<qc;i++)r=r-e(r)/t(r);return r}function nn(e,t){return e*Math.sqrt(1-t*t)}const Zc=["duration","bounce"],Qc=["stiffness","damping","mass"];function jr(e,t){return t.some(s=>e[s]!==void 0)}function ed(e){let t={velocity:_e.velocity,stiffness:_e.stiffness,damping:_e.damping,mass:_e.mass,isResolvedFromDuration:!1,...e};if(!jr(e,Qc)&&jr(e,Zc))if(e.visualDuration){const s=e.visualDuration,r=2*Math.PI/(s*1.2),i=r*r,l=2*ct(.05,1,1-(e.bounce||0))*Math.sqrt(i);t={...t,mass:_e.mass,stiffness:i,damping:l}}else{const s=Gc(e);t={...t,...s,mass:_e.mass},t.isResolvedFromDuration=!0}return t}function Ia(e=_e.visualDuration,t=_e.bounce){const s=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:i}=s;const l=s.keyframes[0],o=s.keyframes[s.keyframes.length-1],a={done:!1,value:l},{stiffness:c,damping:d,mass:h,duration:f,velocity:x,isResolvedFromDuration:v}=ed({...s,velocity:-lt(s.velocity||0)}),_=x||0,N=d/(2*Math.sqrt(c*h)),E=o-l,S=lt(Math.sqrt(c/h)),I=Math.abs(E)<5;r||(r=I?_e.restSpeed.granular:_e.restSpeed.default),i||(i=I?_e.restDelta.granular:_e.restDelta.default);let T;if(N<1){const b=nn(S,N);T=w=>{const D=Math.exp(-N*S*w);return o-D*((_+N*S*E)/b*Math.sin(b*w)+E*Math.cos(b*w))}}else if(N===1)T=b=>o-Math.exp(-S*b)*(E+(_+S*E)*b);else{const b=S*Math.sqrt(N*N-1);T=w=>{const D=Math.exp(-N*S*w),P=Math.min(b*w,300);return o-D*((_+N*S*E)*Math.sinh(P)+b*E*Math.cosh(P))/b}}const B={calculatedDuration:v&&f||null,next:b=>{const w=T(b);if(v)a.done=b>=f;else{let D=0;N<1&&(D=b===0?ot(_):Ea(T,b,w));const P=Math.abs(D)<=r,q=Math.abs(o-w)<=i;a.done=P&&q}return a.value=a.done?o:w,a},toString:()=>{const b=Math.min(qi(B),Gs),w=Ji(D=>B.next(b*D).value,b,30);return b+"ms "+w}};return B}function Nr({keyframes:e,velocity:t=0,power:s=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:l=500,modifyTarget:o,min:a,max:c,restDelta:d=.5,restSpeed:h}){const f=e[0],x={done:!1,value:f},v=P=>a!==void 0&&P<a||c!==void 0&&P>c,_=P=>a===void 0?c:c===void 0||Math.abs(a-P)<Math.abs(c-P)?a:c;let N=s*t;const E=f+N,S=o===void 0?E:o(E);S!==E&&(N=S-f);const I=P=>-N*Math.exp(-P/r),T=P=>S+I(P),B=P=>{const q=I(P),U=T(P);x.done=Math.abs(q)<=d,x.value=x.done?S:U};let b,w;const D=P=>{v(x.value)&&(b=P,w=Ia({keyframes:[x.value,_(x.value)],velocity:Ea(T,P,x.value),damping:i,stiffness:l,restDelta:d,restSpeed:h}))};return D(0),{calculatedDuration:null,next:P=>{let q=!1;return!w&&b===void 0&&(q=!0,B(P),D(P)),b!==void 0&&P>=b?w.next(P-b):(!q&&B(P),x)}}}const td=ts(.42,0,1,1),sd=ts(0,0,.58,1),Ma=ts(.42,0,.58,1),nd=e=>Array.isArray(e)&&typeof e[0]!="number",rd={linear:We,easeIn:td,easeInOut:Ma,easeOut:sd,circIn:Un,circInOut:fa,circOut:ha,backIn:Bn,backInOut:da,backOut:ca,anticipate:ua},Sr=e=>{if(Vn(e)){Pi(e.length===4);const[t,s,r,i]=e;return ts(t,s,r,i)}else if(typeof e=="string")return rd[e];return e};function id(e,t,s){const r=[],i=s||Pa,l=e.length-1;for(let o=0;o<l;o++){let a=i(e[o],e[o+1]);if(t){const c=Array.isArray(t)?t[o]||We:t;a=ss(c,a)}r.push(a)}return r}function ad(e,t,{clamp:s=!0,ease:r,mixer:i}={}){const l=e.length;if(Pi(l===t.length),l===1)return()=>t[0];if(l===2&&t[0]===t[1])return()=>t[1];const o=e[0]===e[1];e[0]>e[l-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=id(t,r,i),c=a.length,d=h=>{if(o&&h<e[0])return t[0];let f=0;if(c>1)for(;f<e.length-2&&!(h<e[f+1]);f++);const x=Rt(e[f],e[f+1],h);return a[f](x)};return s?h=>d(ct(e[0],e[l-1],h)):d}function od(e,t){const s=e[e.length-1];for(let r=1;r<=t;r++){const i=Rt(0,t,r);e.push(Te(s,1,i))}}function ld(e){const t=[0];return od(t,e.length-1),t}function cd(e,t){return e.map(s=>s*t)}function dd(e,t){return e.map(()=>t||Ma).splice(0,e.length-1)}function bs({duration:e=300,keyframes:t,times:s,ease:r="easeInOut"}){const i=nd(r)?r.map(Sr):Sr(r),l={done:!1,value:t[0]},o=cd(s&&s.length===t.length?s:ld(t),e),a=ad(o,t,{ease:Array.isArray(i)?i:dd(t,i)});return{calculatedDuration:e,next:c=>(l.value=a(c),l.done=c>=e,l)}}const ud=e=>{const t=({timestamp:s})=>e(s);return{start:()=>we.update(t,!0),stop:()=>ft(t),now:()=>Le.isProcessing?Le.timestamp:rt.now()}},hd={decay:Nr,inertia:Nr,tween:bs,keyframes:bs,spring:Ia},fd=e=>e/100;class Gn extends Ca{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:s,motionValue:r,element:i,keyframes:l}=this.options,o=(i==null?void 0:i.KeyframeResolver)||Yn,a=(c,d)=>this.onKeyframesResolved(c,d);this.resolver=new o(l,a,s,r,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:l,velocity:o=0}=this.options,a=Ln(s)?s:hd[s]||bs;let c,d;a!==bs&&typeof t[0]!="number"&&(c=ss(fd,Pa(t[0],t[1])),t=[0,100]);const h=a({...this.options,keyframes:t});l==="mirror"&&(d=a({...this.options,keyframes:[...t].reverse(),velocity:-o})),h.calculatedDuration===null&&(h.calculatedDuration=qi(h));const{calculatedDuration:f}=h,x=f+i,v=x*(r+1)-i;return{generator:h,mirroredGenerator:d,mapPercentToKeyframes:c,calculatedDuration:f,resolvedDuration:x,totalDuration:v}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:r}=this;if(!r){const{keyframes:P}=this.options;return{done:!0,value:P[P.length-1]}}const{finalKeyframe:i,generator:l,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:c,calculatedDuration:d,totalDuration:h,resolvedDuration:f}=r;if(this.startTime===null)return l.next(0);const{delay:x,repeat:v,repeatType:_,repeatDelay:N,onUpdate:E}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-h/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const S=this.currentTime-x*(this.speed>=0?1:-1),I=this.speed>=0?S<0:S>h;this.currentTime=Math.max(S,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let T=this.currentTime,B=l;if(v){const P=Math.min(this.currentTime,h)/f;let q=Math.floor(P),U=P%1;!U&&P>=1&&(U=1),U===1&&q--,q=Math.min(q,v+1),!!(q%2)&&(_==="reverse"?(U=1-U,N&&(U-=N/f)):_==="mirror"&&(B=o)),T=ct(0,1,U)*f}const b=I?{done:!1,value:c[0]}:B.next(T);a&&(b.value=a(b.value));let{done:w}=b;!I&&d!==null&&(w=this.speed>=0?this.currentTime>=h:this.currentTime<=0);const D=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&w);return D&&i!==void 0&&(b.value=Ps(c,this.options,i)),E&&E(b.value),D&&this.finish(),b}get duration(){const{resolved:t}=this;return t?lt(t.calculatedDuration):0}get time(){return lt(this.currentTime)}set time(t){t=ot(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=lt(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=ud,onPlay:s,startTime:r}=this.options;this.driver||(this.driver=t(l=>this.tick(l))),s&&s();const i=this.driver.now();this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=i):this.startTime=r??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const md=new Set(["opacity","clipPath","filter","transform"]);function pd(e,t,s,{delay:r=0,duration:i=300,repeat:l=0,repeatType:o="loop",ease:a="easeInOut",times:c}={}){const d={[t]:s};c&&(d.offset=c);const h=Qi(a,i);return Array.isArray(h)&&(d.easing=h),e.animate(d,{delay:r,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:l+1,direction:o==="reverse"?"alternate":"normal"})}const xd=wn(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),ws=10,gd=2e4;function yd(e){return Ln(e.type)||e.type==="spring"||!Zi(e.ease)}function vd(e,t){const s=new Gn({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let r={done:!1,value:e[0]};const i=[];let l=0;for(;!r.done&&l<gd;)r=s.sample(l),i.push(r.value),l+=ws;return{times:void 0,keyframes:i,duration:l-ws,ease:"linear"}}const Ra={anticipate:ua,backInOut:da,circInOut:fa};function bd(e){return e in Ra}class Tr extends Ca{constructor(t){super(t);const{name:s,motionValue:r,element:i,keyframes:l}=this.options;this.resolver=new ka(l,(o,a)=>this.onKeyframesResolved(o,a),s,r,i),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:r=300,times:i,ease:l,type:o,motionValue:a,name:c,startTime:d}=this.options;if(!a.owner||!a.owner.current)return!1;if(typeof l=="string"&&ys()&&bd(l)&&(l=Ra[l]),yd(this.options)){const{onComplete:f,onUpdate:x,motionValue:v,element:_,...N}=this.options,E=vd(t,N);t=E.keyframes,t.length===1&&(t[1]=t[0]),r=E.duration,i=E.times,l=E.ease,o="keyframes"}const h=pd(a.owner.current,c,t,{...this.options,duration:r,times:i,ease:l});return h.startTime=d??this.calcStartTime(),this.pendingTimeline?(cr(h,this.pendingTimeline),this.pendingTimeline=void 0):h.onfinish=()=>{const{onComplete:f}=this.options;a.set(Ps(t,this.options,s)),f&&f(),this.cancel(),this.resolveFinishedPromise()},{animation:h,duration:r,times:i,type:o,ease:l,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return lt(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return lt(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:r}=s;r.currentTime=ot(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:r}=s;r.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return We;const{animation:r}=s;cr(r,t)}return We}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:r,duration:i,type:l,ease:o,times:a}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:h,onComplete:f,element:x,...v}=this.options,_=new Gn({...v,keyframes:r,duration:i,type:l,ease:o,times:a,isGenerator:!0}),N=ot(this.time);d.setWithVelocity(_.sample(N-ws).value,_.sample(N).value,ws)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:r,repeatDelay:i,repeatType:l,damping:o,type:a}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=s.owner.getProps();return xd()&&r&&md.has(r)&&!c&&!d&&!i&&l!=="mirror"&&o!==0&&a!=="inertia"}}const wd={type:"spring",stiffness:500,damping:25,restSpeed:10},jd=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Nd={type:"keyframes",duration:.8},Sd={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Td=(e,{keyframes:t})=>t.length>2?Nd:Tt.has(e)?e.startsWith("scale")?jd(t[1]):wd:Sd;function _d({when:e,delay:t,delayChildren:s,staggerChildren:r,staggerDirection:i,repeat:l,repeatType:o,repeatDelay:a,from:c,elapsed:d,...h}){return!!Object.keys(h).length}const qn=(e,t,s,r={},i,l)=>o=>{const a=Dn(r,e)||{},c=a.delay||r.delay||0;let{elapsed:d=0}=r;d=d-ot(c);let h={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...a,delay:-d,onUpdate:x=>{t.set(x),a.onUpdate&&a.onUpdate(x)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:e,motionValue:t,element:l?void 0:i};_d(a)||(h={...h,...Td(e,h)}),h.duration&&(h.duration=ot(h.duration)),h.repeatDelay&&(h.repeatDelay=ot(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let f=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(h.duration=0,h.delay===0&&(f=!0)),f&&!l&&t.get()!==void 0){const x=Ps(h.keyframes,a);if(x!==void 0)return we.update(()=>{h.onUpdate(x),h.onComplete()}),new Wl([])}return!l&&Tr.supports(h)?new Tr(h):new Gn(h)};function kd({protectedKeys:e,needsAnimating:t},s){const r=e.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,r}function Da(e,t,{delay:s=0,transitionOverride:r,type:i}={}){var l;let{transition:o=e.getDefaultTransition(),transitionEnd:a,...c}=t;r&&(o=r);const d=[],h=i&&e.animationState&&e.animationState.getState()[i];for(const f in c){const x=e.getValue(f,(l=e.latestValues[f])!==null&&l!==void 0?l:null),v=c[f];if(v===void 0||h&&kd(h,f))continue;const _={delay:s,...Dn(o||{},f)};let N=!1;if(window.MotionHandoffAnimation){const S=ia(e);if(S){const I=window.MotionHandoffAnimation(S,f,we);I!==null&&(_.startTime=I,N=!0)}}Js(e,f),x.start(qn(f,x,v,e.shouldReduceMotion&&na.has(f)?{type:!1}:_,e,N));const E=x.animation;E&&d.push(E)}return a&&Promise.all(d).then(()=>{we.update(()=>{a&&ic(e,a)})}),d}function rn(e,t,s={}){var r;const i=As(e,t,s.type==="exit"?(r=e.presenceContext)===null||r===void 0?void 0:r.custom:void 0);let{transition:l=e.getDefaultTransition()||{}}=i||{};s.transitionOverride&&(l=s.transitionOverride);const o=i?()=>Promise.all(Da(e,i,s)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:h=0,staggerChildren:f,staggerDirection:x}=l;return Cd(e,t,h+d,f,x,s)}:()=>Promise.resolve(),{when:c}=l;if(c){const[d,h]=c==="beforeChildren"?[o,a]:[a,o];return d().then(()=>h())}else return Promise.all([o(),a(s.delay)])}function Cd(e,t,s=0,r=0,i=1,l){const o=[],a=(e.variantChildren.size-1)*r,c=i===1?(d=0)=>d*r:(d=0)=>a-d*r;return Array.from(e.variantChildren).sort(Ad).forEach((d,h)=>{d.notify("AnimationStart",t),o.push(rn(d,t,{...l,delay:s+c(h)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(o)}function Ad(e,t){return e.sortNodePosition(t)}function Pd(e,t,s={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const i=t.map(l=>rn(e,l,s));r=Promise.all(i)}else if(typeof t=="string")r=rn(e,t,s);else{const i=typeof t=="function"?As(e,t,s.custom):t;r=Promise.all(Da(e,i,s))}return r.then(()=>{e.notify("AnimationComplete",t)})}const Ed=Nn.length;function La(e){if(!e)return;if(!e.isControllingVariants){const s=e.parent?La(e.parent)||{}:{};return e.props.initial!==void 0&&(s.initial=e.props.initial),s}const t={};for(let s=0;s<Ed;s++){const r=Nn[s],i=e.props[r];(Gt(i)||i===!1)&&(t[r]=i)}return t}const Id=[...jn].reverse(),Md=jn.length;function Rd(e){return t=>Promise.all(t.map(({animation:s,options:r})=>Pd(e,s,r)))}function Dd(e){let t=Rd(e),s=_r(),r=!0;const i=c=>(d,h)=>{var f;const x=As(e,h,c==="exit"?(f=e.presenceContext)===null||f===void 0?void 0:f.custom:void 0);if(x){const{transition:v,transitionEnd:_,...N}=x;d={...d,...N,..._}}return d};function l(c){t=c(e)}function o(c){const{props:d}=e,h=La(e.parent)||{},f=[],x=new Set;let v={},_=1/0;for(let E=0;E<Md;E++){const S=Id[E],I=s[S],T=d[S]!==void 0?d[S]:h[S],B=Gt(T),b=S===c?I.isActive:null;b===!1&&(_=E);let w=T===h[S]&&T!==d[S]&&B;if(w&&r&&e.manuallyAnimateOnMount&&(w=!1),I.protectedKeys={...v},!I.isActive&&b===null||!T&&!I.prevProp||ks(T)||typeof T=="boolean")continue;const D=Ld(I.prevProp,T);let P=D||S===c&&I.isActive&&!w&&B||E>_&&B,q=!1;const U=Array.isArray(T)?T:[T];let Y=U.reduce(i(S),{});b===!1&&(Y={});const{prevResolvedValues:ce={}}=I,se={...ce,...Y},k=X=>{P=!0,x.has(X)&&(q=!0,x.delete(X)),I.needsAnimating[X]=!0;const oe=e.getValue(X);oe&&(oe.liveStyle=!1)};for(const X in se){const oe=Y[X],K=ce[X];if(v.hasOwnProperty(X))continue;let ne=!1;Xs(oe)&&Xs(K)?ne=!Gi(oe,K):ne=oe!==K,ne?oe!=null?k(X):x.add(X):oe!==void 0&&x.has(X)?k(X):I.protectedKeys[X]=!0}I.prevProp=T,I.prevResolvedValues=Y,I.isActive&&(v={...v,...Y}),r&&e.blockInitialAnimation&&(P=!1),P&&(!(w&&D)||q)&&f.push(...U.map(X=>({animation:X,options:{type:S}})))}if(x.size){const E={};x.forEach(S=>{const I=e.getBaseTarget(S),T=e.getValue(S);T&&(T.liveStyle=!0),E[S]=I??null}),f.push({animation:E})}let N=!!f.length;return r&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(N=!1),r=!1,N?t(f):Promise.resolve()}function a(c,d){var h;if(s[c].isActive===d)return Promise.resolve();(h=e.variantChildren)===null||h===void 0||h.forEach(x=>{var v;return(v=x.animationState)===null||v===void 0?void 0:v.setActive(c,d)}),s[c].isActive=d;const f=o(c);for(const x in s)s[x].protectedKeys={};return f}return{animateChanges:o,setActive:a,setAnimateFunction:l,getState:()=>s,reset:()=>{s=_r(),r=!0}}}function Ld(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!Gi(t,e):!1}function yt(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function _r(){return{animate:yt(!0),whileInView:yt(),whileHover:yt(),whileTap:yt(),whileDrag:yt(),whileFocus:yt(),exit:yt()}}class xt{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Vd extends xt{constructor(t){super(t),t.animationState||(t.animationState=Dd(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();ks(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let Fd=0;class Od extends xt{constructor(){super(...arguments),this.id=Fd++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===r)return;const i=this.node.animationState.setActive("exit",!t);s&&!t&&i.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const $d={animation:{Feature:Vd},exit:{Feature:Od}};function Qt(e,t,s,r={passive:!0}){return e.addEventListener(t,s,r),()=>e.removeEventListener(t,s)}function ns(e){return{point:{x:e.pageX,y:e.pageY}}}const zd=e=>t=>Fn(t)&&e(t,ns(t));function Ht(e,t,s,r){return Qt(e,t,zd(s),r)}const kr=(e,t)=>Math.abs(e-t);function Bd(e,t){const s=kr(e.x,t.x),r=kr(e.y,t.y);return Math.sqrt(s**2+r**2)}class Va{constructor(t,s,{transformPagePoint:r,contextWindow:i,dragSnapToOrigin:l=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=Os(this.lastMoveEventInfo,this.history),x=this.startEvent!==null,v=Bd(f.offset,{x:0,y:0})>=3;if(!x&&!v)return;const{point:_}=f,{timestamp:N}=Le;this.history.push({..._,timestamp:N});const{onStart:E,onMove:S}=this.handlers;x||(E&&E(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),S&&S(this.lastMoveEvent,f)},this.handlePointerMove=(f,x)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=Fs(x,this.transformPagePoint),we.update(this.updatePoint,!0)},this.handlePointerUp=(f,x)=>{this.end();const{onEnd:v,onSessionEnd:_,resumeAnimation:N}=this.handlers;if(this.dragSnapToOrigin&&N&&N(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const E=Os(f.type==="pointercancel"?this.lastMoveEventInfo:Fs(x,this.transformPagePoint),this.history);this.startEvent&&v&&v(f,E),_&&_(f,E)},!Fn(t))return;this.dragSnapToOrigin=l,this.handlers=s,this.transformPagePoint=r,this.contextWindow=i||window;const o=ns(t),a=Fs(o,this.transformPagePoint),{point:c}=a,{timestamp:d}=Le;this.history=[{...c,timestamp:d}];const{onSessionStart:h}=s;h&&h(t,Os(a,this.history)),this.removeListeners=ss(Ht(this.contextWindow,"pointermove",this.handlePointerMove),Ht(this.contextWindow,"pointerup",this.handlePointerUp),Ht(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),ft(this.updatePoint)}}function Fs(e,t){return t?{point:t(e.point)}:e}function Cr(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Os({point:e},t){return{point:e,delta:Cr(e,Fa(t)),offset:Cr(e,Ud(t)),velocity:Hd(t,.1)}}function Ud(e){return e[0]}function Fa(e){return e[e.length-1]}function Hd(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,r=null;const i=Fa(e);for(;s>=0&&(r=e[s],!(i.timestamp-r.timestamp>ot(t)));)s--;if(!r)return{x:0,y:0};const l=lt(i.timestamp-r.timestamp);if(l===0)return{x:0,y:0};const o={x:(i.x-r.x)/l,y:(i.y-r.y)/l};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const Oa=1e-4,Wd=1-Oa,Kd=1+Oa,$a=.01,Yd=0-$a,Xd=0+$a;function Ke(e){return e.max-e.min}function Gd(e,t,s){return Math.abs(e-t)<=s}function Ar(e,t,s,r=.5){e.origin=r,e.originPoint=Te(t.min,t.max,e.origin),e.scale=Ke(s)/Ke(t),e.translate=Te(s.min,s.max,e.origin)-e.originPoint,(e.scale>=Wd&&e.scale<=Kd||isNaN(e.scale))&&(e.scale=1),(e.translate>=Yd&&e.translate<=Xd||isNaN(e.translate))&&(e.translate=0)}function Wt(e,t,s,r){Ar(e.x,t.x,s.x,r?r.originX:void 0),Ar(e.y,t.y,s.y,r?r.originY:void 0)}function Pr(e,t,s){e.min=s.min+t.min,e.max=e.min+Ke(t)}function qd(e,t,s){Pr(e.x,t.x,s.x),Pr(e.y,t.y,s.y)}function Er(e,t,s){e.min=t.min-s.min,e.max=e.min+Ke(t)}function Kt(e,t,s){Er(e.x,t.x,s.x),Er(e.y,t.y,s.y)}function Jd(e,{min:t,max:s},r){return t!==void 0&&e<t?e=r?Te(t,e,r.min):Math.max(e,t):s!==void 0&&e>s&&(e=r?Te(s,e,r.max):Math.min(e,s)),e}function Ir(e,t,s){return{min:t!==void 0?e.min+t:void 0,max:s!==void 0?e.max+s-(e.max-e.min):void 0}}function Zd(e,{top:t,left:s,bottom:r,right:i}){return{x:Ir(e.x,s,i),y:Ir(e.y,t,r)}}function Mr(e,t){let s=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,r]=[r,s]),{min:s,max:r}}function Qd(e,t){return{x:Mr(e.x,t.x),y:Mr(e.y,t.y)}}function eu(e,t){let s=.5;const r=Ke(e),i=Ke(t);return i>r?s=Rt(t.min,t.max-r,e.min):r>i&&(s=Rt(e.min,e.max-i,t.min)),ct(0,1,s)}function tu(e,t){const s={};return t.min!==void 0&&(s.min=t.min-e.min),t.max!==void 0&&(s.max=t.max-e.min),s}const an=.35;function su(e=an){return e===!1?e=0:e===!0&&(e=an),{x:Rr(e,"left","right"),y:Rr(e,"top","bottom")}}function Rr(e,t,s){return{min:Dr(e,t),max:Dr(e,s)}}function Dr(e,t){return typeof e=="number"?e:e[t]||0}const Lr=()=>({translate:0,scale:1,origin:0,originPoint:0}),At=()=>({x:Lr(),y:Lr()}),Vr=()=>({min:0,max:0}),Pe=()=>({x:Vr(),y:Vr()});function Je(e){return[e("x"),e("y")]}function za({top:e,left:t,right:s,bottom:r}){return{x:{min:t,max:s},y:{min:e,max:r}}}function nu({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function ru(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:r.y,right:r.x}}function $s(e){return e===void 0||e===1}function on({scale:e,scaleX:t,scaleY:s}){return!$s(e)||!$s(t)||!$s(s)}function vt(e){return on(e)||Ba(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Ba(e){return Fr(e.x)||Fr(e.y)}function Fr(e){return e&&e!=="0%"}function js(e,t,s){const r=e-s,i=t*r;return s+i}function Or(e,t,s,r,i){return i!==void 0&&(e=js(e,i,r)),js(e,s,r)+t}function ln(e,t=0,s=1,r,i){e.min=Or(e.min,t,s,r,i),e.max=Or(e.max,t,s,r,i)}function Ua(e,{x:t,y:s}){ln(e.x,t.translate,t.scale,t.originPoint),ln(e.y,s.translate,s.scale,s.originPoint)}const $r=.999999999999,zr=1.0000000000001;function iu(e,t,s,r=!1){const i=s.length;if(!i)return;t.x=t.y=1;let l,o;for(let a=0;a<i;a++){l=s[a],o=l.projectionDelta;const{visualElement:c}=l.options;c&&c.props.style&&c.props.style.display==="contents"||(r&&l.options.layoutScroll&&l.scroll&&l!==l.root&&Et(e,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,Ua(e,o)),r&&vt(l.latestValues)&&Et(e,l.latestValues))}t.x<zr&&t.x>$r&&(t.x=1),t.y<zr&&t.y>$r&&(t.y=1)}function Pt(e,t){e.min=e.min+t,e.max=e.max+t}function Br(e,t,s,r,i=.5){const l=Te(e.min,e.max,i);ln(e,t,s,l,r)}function Et(e,t){Br(e.x,t.x,t.scaleX,t.scale,t.originX),Br(e.y,t.y,t.scaleY,t.scale,t.originY)}function Ha(e,t){return za(ru(e.getBoundingClientRect(),t))}function au(e,t,s){const r=Ha(e,s),{scroll:i}=t;return i&&(Pt(r.x,i.offset.x),Pt(r.y,i.offset.y)),r}const Wa=({current:e})=>e?e.ownerDocument.defaultView:null,ou=new WeakMap;class lu{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Pe(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const i=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(ns(h).point)},l=(h,f)=>{const{drag:x,dragPropagation:v,onDragStart:_}=this.getProps();if(x&&!v&&(this.openDragLock&&this.openDragLock(),this.openDragLock=ec(x),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Je(E=>{let S=this.getAxisMotionValue(E).get()||0;if(nt.test(S)){const{projection:I}=this.visualElement;if(I&&I.layout){const T=I.layout.layoutBox[E];T&&(S=Ke(T)*(parseFloat(S)/100))}}this.originPoint[E]=S}),_&&we.postRender(()=>_(h,f)),Js(this.visualElement,"transform");const{animationState:N}=this.visualElement;N&&N.setActive("whileDrag",!0)},o=(h,f)=>{const{dragPropagation:x,dragDirectionLock:v,onDirectionLock:_,onDrag:N}=this.getProps();if(!x&&!this.openDragLock)return;const{offset:E}=f;if(v&&this.currentDirection===null){this.currentDirection=cu(E),this.currentDirection!==null&&_&&_(this.currentDirection);return}this.updateAxis("x",f.point,E),this.updateAxis("y",f.point,E),this.visualElement.render(),N&&N(h,f)},a=(h,f)=>this.stop(h,f),c=()=>Je(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new Va(t,{onSessionStart:i,onStart:l,onMove:o,onSessionEnd:a,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:Wa(this.visualElement)})}stop(t,s){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:i}=s;this.startAnimation(i);const{onDragEnd:l}=this.getProps();l&&we.postRender(()=>l(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,r){const{drag:i}=this.getProps();if(!r||!ls(t,i,this.currentDirection))return;const l=this.getAxisMotionValue(t);let o=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(o=Jd(o,this.constraints[t],this.elastic[t])),l.set(o)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:r}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,l=this.constraints;s&&kt(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&i?this.constraints=Zd(i.layoutBox,s):this.constraints=!1,this.elastic=su(r),l!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Je(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=tu(i.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!kt(t))return!1;const r=t.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const l=au(r,i.root,this.visualElement.getTransformPagePoint());let o=Qd(i.layout.layoutBox,l);if(s){const a=s(nu(o));this.hasMutatedConstraints=!!a,a&&(o=za(a))}return o}startAnimation(t){const{drag:s,dragMomentum:r,dragElastic:i,dragTransition:l,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),c=this.constraints||{},d=Je(h=>{if(!ls(h,s,this.currentDirection))return;let f=c&&c[h]||{};o&&(f={min:0,max:0});const x=i?200:1e6,v=i?40:1e7,_={type:"inertia",velocity:r?t[h]:0,bounceStiffness:x,bounceDamping:v,timeConstant:750,restDelta:1,restSpeed:10,...l,...f};return this.startAxisValueAnimation(h,_)});return Promise.all(d).then(a)}startAxisValueAnimation(t,s){const r=this.getAxisMotionValue(t);return Js(this.visualElement,t),r.start(qn(t,r,0,s,this.visualElement,!1))}stopAnimation(){Je(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Je(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,r=this.visualElement.getProps(),i=r[s];return i||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){Je(s=>{const{drag:r}=this.getProps();if(!ls(s,r,this.currentDirection))return;const{projection:i}=this.visualElement,l=this.getAxisMotionValue(s);if(i&&i.layout){const{min:o,max:a}=i.layout.layoutBox[s];l.set(t[s]-Te(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:r}=this.visualElement;if(!kt(s)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Je(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const c=a.get();i[o]=eu({min:c,max:c},this.constraints[o])}});const{transformTemplate:l}=this.visualElement.getProps();this.visualElement.current.style.transform=l?l({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Je(o=>{if(!ls(o,t,null))return;const a=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];a.set(Te(c,d,i[o]))})}addListeners(){if(!this.visualElement.current)return;ou.set(this.visualElement,this);const t=this.visualElement.current,s=Ht(t,"pointerdown",c=>{const{drag:d,dragListener:h=!0}=this.getProps();d&&h&&this.start(c)}),r=()=>{const{dragConstraints:c}=this.getProps();kt(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,l=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),we.read(r);const o=Qt(window,"resize",()=>this.scalePositionWithinConstraints()),a=i.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Je(h=>{const f=this.getAxisMotionValue(h);f&&(this.originPoint[h]+=c[h].translate,f.set(f.get()+c[h].translate))}),this.visualElement.render())}));return()=>{o(),s(),l(),a&&a()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:l=!1,dragElastic:o=an,dragMomentum:a=!0}=t;return{...t,drag:s,dragDirectionLock:r,dragPropagation:i,dragConstraints:l,dragElastic:o,dragMomentum:a}}}function ls(e,t,s){return(t===!0||t===e)&&(s===null||s===e)}function cu(e,t=10){let s=null;return Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x"),s}class du extends xt{constructor(t){super(t),this.removeGroupControls=We,this.removeListeners=We,this.controls=new lu(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||We}unmount(){this.removeGroupControls(),this.removeListeners()}}const Ur=e=>(t,s)=>{e&&we.postRender(()=>e(t,s))};class uu extends xt{constructor(){super(...arguments),this.removePointerDownListener=We}onPointerDown(t){this.session=new Va(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Wa(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:Ur(t),onStart:Ur(s),onMove:r,onEnd:(l,o)=>{delete this.session,i&&we.postRender(()=>i(l,o))}}}mount(){this.removePointerDownListener=Ht(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const fs={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Hr(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Ot={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(ee.test(e))e=parseFloat(e);else return e;const s=Hr(e,t.target.x),r=Hr(e,t.target.y);return`${s}% ${r}%`}},hu={correct:(e,{treeScale:t,projectionDelta:s})=>{const r=e,i=mt.parse(e);if(i.length>5)return r;const l=mt.createTransformer(e),o=typeof i[0]!="number"?1:0,a=s.x.scale*t.x,c=s.y.scale*t.y;i[0+o]/=a,i[1+o]/=c;const d=Te(a,c,.5);return typeof i[2+o]=="number"&&(i[2+o]/=d),typeof i[3+o]=="number"&&(i[3+o]/=d),l(i)}};class fu extends u.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:r,layoutId:i}=this.props,{projection:l}=t;Ml(mu),l&&(s.group&&s.group.add(l),r&&r.register&&i&&r.register(l),l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,onExitComplete:()=>this.safeToRemove()})),fs.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:r,drag:i,isPresent:l}=this.props,o=r.projection;return o&&(o.isPresent=l,i||t.layoutDependency!==s||s===void 0?o.willUpdate():this.safeToRemove(),t.isPresent!==l&&(l?o.promote():o.relegate()||we.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Tn.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:r}=this.props,{projection:i}=t;i&&(i.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Ka(e){const[t,s]=Ci(),r=u.useContext(gn);return n.jsx(fu,{...e,layoutGroup:r,switchLayoutGroup:u.useContext(Li),isPresent:t,safeToRemove:s})}const mu={borderRadius:{...Ot,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ot,borderTopRightRadius:Ot,borderBottomLeftRadius:Ot,borderBottomRightRadius:Ot,boxShadow:hu};function pu(e,t,s){const r=ze(e)?e:Jt(e);return r.start(qn("",r,t,s)),r.animation}function xu(e){return e instanceof SVGElement&&e.tagName!=="svg"}const gu=(e,t)=>e.depth-t.depth;class yu{constructor(){this.children=[],this.isDirty=!1}add(t){On(this.children,t),this.isDirty=!0}remove(t){$n(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(gu),this.isDirty=!1,this.children.forEach(t)}}function vu(e,t){const s=rt.now(),r=({timestamp:i})=>{const l=i-s;l>=t&&(ft(r),e(l-t))};return we.read(r,!0),()=>ft(r)}const Ya=["TopLeft","TopRight","BottomLeft","BottomRight"],bu=Ya.length,Wr=e=>typeof e=="string"?parseFloat(e):e,Kr=e=>typeof e=="number"||ee.test(e);function wu(e,t,s,r,i,l){i?(e.opacity=Te(0,s.opacity!==void 0?s.opacity:1,ju(r)),e.opacityExit=Te(t.opacity!==void 0?t.opacity:1,0,Nu(r))):l&&(e.opacity=Te(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,r));for(let o=0;o<bu;o++){const a=`border${Ya[o]}Radius`;let c=Yr(t,a),d=Yr(s,a);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||Kr(c)===Kr(d)?(e[a]=Math.max(Te(Wr(c),Wr(d),r),0),(nt.test(d)||nt.test(c))&&(e[a]+="%")):e[a]=d}(t.rotate||s.rotate)&&(e.rotate=Te(t.rotate||0,s.rotate||0,r))}function Yr(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const ju=Xa(0,.5,ha),Nu=Xa(.5,.95,We);function Xa(e,t,s){return r=>r<e?0:r>t?1:s(Rt(e,t,r))}function Xr(e,t){e.min=t.min,e.max=t.max}function qe(e,t){Xr(e.x,t.x),Xr(e.y,t.y)}function Gr(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function qr(e,t,s,r,i){return e-=t,e=js(e,1/s,r),i!==void 0&&(e=js(e,1/i,r)),e}function Su(e,t=0,s=1,r=.5,i,l=e,o=e){if(nt.test(t)&&(t=parseFloat(t),t=Te(o.min,o.max,t/100)-o.min),typeof t!="number")return;let a=Te(l.min,l.max,r);e===l&&(a-=t),e.min=qr(e.min,t,s,a,i),e.max=qr(e.max,t,s,a,i)}function Jr(e,t,[s,r,i],l,o){Su(e,t[s],t[r],t[i],t.scale,l,o)}const Tu=["x","scaleX","originX"],_u=["y","scaleY","originY"];function Zr(e,t,s,r){Jr(e.x,t,Tu,s?s.x:void 0,r?r.x:void 0),Jr(e.y,t,_u,s?s.y:void 0,r?r.y:void 0)}function Qr(e){return e.translate===0&&e.scale===1}function Ga(e){return Qr(e.x)&&Qr(e.y)}function ei(e,t){return e.min===t.min&&e.max===t.max}function ku(e,t){return ei(e.x,t.x)&&ei(e.y,t.y)}function ti(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function qa(e,t){return ti(e.x,t.x)&&ti(e.y,t.y)}function si(e){return Ke(e.x)/Ke(e.y)}function ni(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Cu{constructor(){this.members=[]}add(t){On(this.members,t),t.scheduleRender()}remove(t){if($n(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(i=>t===i);if(s===0)return!1;let r;for(let i=s;i>=0;i--){const l=this.members[i];if(l.isPresent!==!1){r=l;break}}return r?(this.promote(r),!0):!1}promote(t,s){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender(),t.resumeFrom=r,s&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:r}=t;s.onExitComplete&&s.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Au(e,t,s){let r="";const i=e.x.translate/t.x,l=e.y.translate/t.y,o=(s==null?void 0:s.z)||0;if((i||l||o)&&(r=`translate3d(${i}px, ${l}px, ${o}px) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:d,rotate:h,rotateX:f,rotateY:x,skewX:v,skewY:_}=s;d&&(r=`perspective(${d}px) ${r}`),h&&(r+=`rotate(${h}deg) `),f&&(r+=`rotateX(${f}deg) `),x&&(r+=`rotateY(${x}deg) `),v&&(r+=`skewX(${v}deg) `),_&&(r+=`skewY(${_}deg) `)}const a=e.x.scale*t.x,c=e.y.scale*t.y;return(a!==1||c!==1)&&(r+=`scale(${a}, ${c})`),r||"none"}const bt={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Bt=typeof window<"u"&&window.MotionDebug!==void 0,zs=["","X","Y","Z"],Pu={visibility:"hidden"},ri=1e3;let Eu=0;function Bs(e,t,s,r){const{latestValues:i}=t;i[e]&&(s[e]=i[e],t.setStaticValue(e,0),r&&(r[e]=0))}function Ja(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=ia(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:i,layoutId:l}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",we,!(i||l))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&Ja(r)}function Za({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(o={},a=t==null?void 0:t()){this.id=Eu++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Bt&&(bt.totalNodes=bt.resolvedTargetDeltas=bt.recalculatedProjection=0),this.nodes.forEach(Ru),this.nodes.forEach(Ou),this.nodes.forEach($u),this.nodes.forEach(Du),Bt&&window.MotionDebug.record(bt)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new yu)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new zn),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const c=this.eventHandlers.get(o);c&&c.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=xu(o),this.instance=o;const{layoutId:c,layout:d,visualElement:h}=this.options;if(h&&!h.current&&h.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const x=()=>this.root.updateBlockedByResize=!1;e(o,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=vu(x,250),fs.hasAnimatedSinceResize&&(fs.hasAnimatedSinceResize=!1,this.nodes.forEach(ai))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&h&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:x,hasRelativeTargetChanged:v,layout:_})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const N=this.options.transition||h.getDefaultTransition()||Wu,{onLayoutAnimationStart:E,onLayoutAnimationComplete:S}=h.getProps(),I=!this.targetLayout||!qa(this.targetLayout,_)||v,T=!x&&v;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||T||x&&(I||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,T);const B={...Dn(N,"layout"),onPlay:E,onComplete:S};(h.shouldReduceMotion||this.options.layoutRoot)&&(B.delay=0,B.type=!1),this.startAnimation(B)}else x||ai(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=_})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,ft(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(zu),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Ja(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const f=this.path[h];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:a,layout:c}=this.options;if(a===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(ii);return}this.isUpdating||this.nodes.forEach(Vu),this.isUpdating=!1,this.nodes.forEach(Fu),this.nodes.forEach(Iu),this.nodes.forEach(Mu),this.clearAllSnapshots();const a=rt.now();Le.delta=ct(0,1e3/60,a-Le.timestamp),Le.timestamp=a,Le.isProcessing=!0,Is.update.process(Le),Is.preRender.process(Le),Is.render.process(Le),Le.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Tn.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Lu),this.sharedNodes.forEach(Bu)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,we.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){we.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Pe(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const c=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!Ga(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,h=d!==this.prevTransformTemplateValue;o&&(a||vt(this.latestValues)||h)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let c=this.removeElementScroll(a);return o&&(c=this.removeTransform(c)),Ku(c),{animationId:this.root.animationId,measuredBox:a,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return Pe();const c=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(Yu))){const{scroll:h}=this.root;h&&(Pt(c.x,h.offset.x),Pt(c.y,h.offset.y))}return c}removeElementScroll(o){var a;const c=Pe();if(qe(c,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return c;for(let d=0;d<this.path.length;d++){const h=this.path[d],{scroll:f,options:x}=h;h!==this.root&&f&&x.layoutScroll&&(f.wasRoot&&qe(c,o),Pt(c.x,f.offset.x),Pt(c.y,f.offset.y))}return c}applyTransform(o,a=!1){const c=Pe();qe(c,o);for(let d=0;d<this.path.length;d++){const h=this.path[d];!a&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Et(c,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),vt(h.latestValues)&&Et(c,h.latestValues)}return vt(this.latestValues)&&Et(c,this.latestValues),c}removeTransform(o){const a=Pe();qe(a,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!vt(d.latestValues))continue;on(d.latestValues)&&d.updateSnapshot();const h=Pe(),f=d.measurePageBox();qe(h,f),Zr(a,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,h)}return vt(this.latestValues)&&Zr(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Le.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(o||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:x}=this.options;if(!(!this.layout||!(f||x))){if(this.resolvedRelativeTargetAt=Le.timestamp,!this.targetDelta&&!this.relativeTarget){const v=this.getClosestProjectingParent();v&&v.layout&&this.animationProgress!==1?(this.relativeParent=v,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Pe(),this.relativeTargetOrigin=Pe(),Kt(this.relativeTargetOrigin,this.layout.layoutBox,v.layout.layoutBox),qe(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Pe(),this.targetWithTransforms=Pe()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),qd(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):qe(this.target,this.layout.layoutBox),Ua(this.target,this.targetDelta)):qe(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const v=this.getClosestProjectingParent();v&&!!v.resumingFrom==!!this.resumingFrom&&!v.options.layoutScroll&&v.target&&this.animationProgress!==1?(this.relativeParent=v,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Pe(),this.relativeTargetOrigin=Pe(),Kt(this.relativeTargetOrigin,this.target,v.target),qe(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Bt&&bt.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||on(this.parent.latestValues)||Ba(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),c=!!this.resumingFrom||this!==a;let d=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Le.timestamp&&(d=!1),d)return;const{layout:h,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||f))return;qe(this.layoutCorrected,this.layout.layoutBox);const x=this.treeScale.x,v=this.treeScale.y;iu(this.layoutCorrected,this.treeScale,this.path,c),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Pe());const{target:_}=a;if(!_){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Gr(this.prevProjectionDelta.x,this.projectionDelta.x),Gr(this.prevProjectionDelta.y,this.projectionDelta.y)),Wt(this.projectionDelta,this.layoutCorrected,_,this.latestValues),(this.treeScale.x!==x||this.treeScale.y!==v||!ni(this.projectionDelta.x,this.prevProjectionDelta.x)||!ni(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",_)),Bt&&bt.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=At(),this.projectionDelta=At(),this.projectionDeltaWithTransform=At()}setAnimationOrigin(o,a=!1){const c=this.snapshot,d=c?c.latestValues:{},h={...this.latestValues},f=At();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const x=Pe(),v=c?c.source:void 0,_=this.layout?this.layout.source:void 0,N=v!==_,E=this.getStack(),S=!E||E.members.length<=1,I=!!(N&&!S&&this.options.crossfade===!0&&!this.path.some(Hu));this.animationProgress=0;let T;this.mixTargetDelta=B=>{const b=B/1e3;oi(f.x,o.x,b),oi(f.y,o.y,b),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Kt(x,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Uu(this.relativeTarget,this.relativeTargetOrigin,x,b),T&&ku(this.relativeTarget,T)&&(this.isProjectionDirty=!1),T||(T=Pe()),qe(T,this.relativeTarget)),N&&(this.animationValues=h,wu(h,d,this.latestValues,b,I,S)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=b},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(ft(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=we.update(()=>{fs.hasAnimatedSinceResize=!0,this.currentAnimation=pu(0,ri,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(ri),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:c,layout:d,latestValues:h}=o;if(!(!a||!c||!d)){if(this!==o&&this.layout&&d&&Qa(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Pe();const f=Ke(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+f;const x=Ke(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+x}qe(a,c),Et(a,h),Wt(this.projectionDeltaWithTransform,this.layoutCorrected,a,h)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new Cu),this.sharedNodes.get(o).add(a);const d=a.options.initialPromotionConfig;a.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(a=!0),!a)return;const d={};c.z&&Bs("z",o,d,this.animationValues);for(let h=0;h<zs.length;h++)Bs(`rotate${zs[h]}`,o,d,this.animationValues),Bs(`skew${zs[h]}`,o,d,this.animationValues);o.render();for(const h in d)o.setStaticValue(h,d[h]),this.animationValues&&(this.animationValues[h]=d[h]);o.scheduleRender()}getProjectionStyles(o){var a,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Pu;const d={visibility:""},h=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=us(o==null?void 0:o.pointerEvents)||"",d.transform=h?h(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const N={};return this.options.layoutId&&(N.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,N.pointerEvents=us(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!vt(this.latestValues)&&(N.transform=h?h({},""):"none",this.hasProjected=!1),N}const x=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=Au(this.projectionDeltaWithTransform,this.treeScale,x),h&&(d.transform=h(x,d.transform));const{x:v,y:_}=this.projectionDelta;d.transformOrigin=`${v.origin*100}% ${_.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(a=x.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:x.opacityExit:d.opacity=f===this?x.opacity!==void 0?x.opacity:"":x.opacityExit!==void 0?x.opacityExit:0;for(const N in gs){if(x[N]===void 0)continue;const{correct:E,applyTo:S}=gs[N],I=d.transform==="none"?x[N]:E(x[N],f);if(S){const T=S.length;for(let B=0;B<T;B++)d[S[B]]=I}else d[N]=I}return this.options.layoutId&&(d.pointerEvents=f===this?us(o==null?void 0:o.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(ii),this.root.sharedNodes.clear()}}}function Iu(e){e.updateLayout()}function Mu(e){var t;const s=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:i}=e.layout,{animationType:l}=e.options,o=s.source!==e.layout.source;l==="size"?Je(f=>{const x=o?s.measuredBox[f]:s.layoutBox[f],v=Ke(x);x.min=r[f].min,x.max=x.min+v}):Qa(l,s.layoutBox,r)&&Je(f=>{const x=o?s.measuredBox[f]:s.layoutBox[f],v=Ke(r[f]);x.max=x.min+v,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+v)});const a=At();Wt(a,r,s.layoutBox);const c=At();o?Wt(c,e.applyTransform(i,!0),s.measuredBox):Wt(c,r,s.layoutBox);const d=!Ga(a);let h=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:x,layout:v}=f;if(x&&v){const _=Pe();Kt(_,s.layoutBox,x.layoutBox);const N=Pe();Kt(N,r,v.layoutBox),qa(_,N)||(h=!0),f.options.layoutRoot&&(e.relativeTarget=N,e.relativeTargetOrigin=_,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:s,delta:c,layoutDelta:a,hasLayoutChanged:d,hasRelativeTargetChanged:h})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function Ru(e){Bt&&bt.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Du(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Lu(e){e.clearSnapshot()}function ii(e){e.clearMeasurements()}function Vu(e){e.isLayoutDirty=!1}function Fu(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function ai(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Ou(e){e.resolveTargetDelta()}function $u(e){e.calcProjection()}function zu(e){e.resetSkewAndRotation()}function Bu(e){e.removeLeadSnapshot()}function oi(e,t,s){e.translate=Te(t.translate,0,s),e.scale=Te(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function li(e,t,s,r){e.min=Te(t.min,s.min,r),e.max=Te(t.max,s.max,r)}function Uu(e,t,s,r){li(e.x,t.x,s.x,r),li(e.y,t.y,s.y,r)}function Hu(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Wu={duration:.45,ease:[.4,0,.1,1]},ci=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),di=ci("applewebkit/")&&!ci("chrome/")?Math.round:We;function ui(e){e.min=di(e.min),e.max=di(e.max)}function Ku(e){ui(e.x),ui(e.y)}function Qa(e,t,s){return e==="position"||e==="preserve-aspect"&&!Gd(si(t),si(s),.2)}function Yu(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const Xu=Za({attachResizeListener:(e,t)=>Qt(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Us={current:void 0},eo=Za({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Us.current){const e=new Xu({});e.mount(window),e.setOptions({layoutScroll:!0}),Us.current=e}return Us.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Gu={pan:{Feature:uu},drag:{Feature:du,ProjectionNode:eo,MeasureLayout:Ka}};function hi(e,t,s){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover",s==="Start");const i="onHover"+s,l=r[i];l&&we.postRender(()=>l(t,ns(t)))}class qu extends xt{mount(){const{current:t}=this.node;t&&(this.unmount=Gl(t,s=>(hi(this.node,s,"Start"),r=>hi(this.node,r,"End"))))}unmount(){}}class Ju extends xt{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ss(Qt(this.node.current,"focus",()=>this.onFocus()),Qt(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function fi(e,t,s){const{props:r}=e;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap",s==="Start");const i="onTap"+(s==="End"?"":s),l=r[i];l&&we.postRender(()=>l(t,ns(t)))}class Zu extends xt{mount(){const{current:t}=this.node;t&&(this.unmount=Ql(t,s=>(fi(this.node,s,"Start"),(r,{success:i})=>fi(this.node,r,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const cn=new WeakMap,Hs=new WeakMap,Qu=e=>{const t=cn.get(e.target);t&&t(e)},eh=e=>{e.forEach(Qu)};function th({root:e,...t}){const s=e||document;Hs.has(s)||Hs.set(s,{});const r=Hs.get(s),i=JSON.stringify(t);return r[i]||(r[i]=new IntersectionObserver(eh,{root:e,...t})),r[i]}function sh(e,t,s){const r=th(t);return cn.set(e,s),r.observe(e),()=>{cn.delete(e),r.unobserve(e)}}const nh={some:0,all:1};class rh extends xt{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:r,amount:i="some",once:l}=t,o={root:s?s.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:nh[i]},a=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,l&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:h,onViewportLeave:f}=this.node.getProps(),x=d?h:f;x&&x(c)};return sh(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(ih(t,s))&&this.startObserver()}unmount(){}}function ih({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}const ah={inView:{Feature:rh},tap:{Feature:Zu},focus:{Feature:Ju},hover:{Feature:qu}},oh={layout:{ProjectionNode:eo,MeasureLayout:Ka}},dn={current:null},to={current:!1};function lh(){if(to.current=!0,!!bn)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>dn.current=e.matches;e.addListener(t),t()}else dn.current=!1}const ch=[..._a,$e,mt],dh=e=>ch.find(Ta(e)),mi=new WeakMap;function uh(e,t,s){for(const r in t){const i=t[r],l=s[r];if(ze(i))e.addValue(r,i);else if(ze(l))e.addValue(r,Jt(i,{owner:e}));else if(l!==i)if(e.hasValue(r)){const o=e.getValue(r);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=e.getStaticValue(r);e.addValue(r,Jt(o!==void 0?o:i,{owner:e}))}}for(const r in s)t[r]===void 0&&e.removeValue(r);return t}const pi=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class hh{scrapeMotionValuesFromProps(t,s,r){return{}}constructor({parent:t,props:s,presenceContext:r,reducedMotionConfig:i,blockInitialAnimation:l,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Yn,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const v=rt.now();this.renderScheduledAt<v&&(this.renderScheduledAt=v,we.render(this.render,!1,!0))};const{latestValues:c,renderState:d,onUpdate:h}=o;this.onUpdate=h,this.latestValues=c,this.baseTarget={...c},this.initialValues=s.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=s,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=i,this.options=a,this.blockInitialAnimation=!!l,this.isControllingVariants=Cs(s),this.isVariantNode=Ri(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:f,...x}=this.scrapeMotionValuesFromProps(s,{},this);for(const v in x){const _=x[v];c[v]!==void 0&&ze(_)&&_.set(c[v],!1)}}mount(t){this.current=t,mi.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,r)=>this.bindToMotionValue(r,s)),to.current||lh(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:dn.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){mi.delete(this.current),this.projection&&this.projection.unmount(),ft(this.notifyUpdate),ft(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const r=Tt.has(t),i=s.on("change",a=>{this.latestValues[t]=a,this.props.onUpdate&&we.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0)}),l=s.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{i(),l(),o&&o(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Dt){const s=Dt[t];if(!s)continue;const{isEnabled:r,Feature:i}=s;if(!this.features[t]&&i&&r(this.props)&&(this.features[t]=new i(this)),this.features[t]){const l=this.features[t];l.isMounted?l.update():(l.mount(),l.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Pe()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let r=0;r<pi.length;r++){const i=pi[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const l="on"+i,o=t[l];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=uh(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const r=this.values.get(t);s!==r&&(r&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&s!==void 0&&(r=Jt(s===null?void 0:s,{owner:this}),this.addValue(t,r)),r}readValue(t,s){var r;let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(r=this.getBaseTargetFromProps(this.props,t))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&(Na(i)||ma(i))?i=parseFloat(i):!dh(i)&&mt.test(s)&&(i=ba(t,s)),this.setBaseTarget(t,ze(i)?i.get():i)),ze(i)?i.get():i}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:r}=this.props;let i;if(typeof r=="string"||typeof r=="object"){const o=kn(this.props,r,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);o&&(i=o[t])}if(r&&i!==void 0)return i;const l=this.getBaseTargetFromProps(this.props,t);return l!==void 0&&!ze(l)?l:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new zn),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class so extends hh{constructor(){super(...arguments),this.KeyframeResolver=ka}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:r}){delete s[t],delete r[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ze(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function fh(e){return window.getComputedStyle(e)}class mh extends so{constructor(){super(...arguments),this.type="html",this.renderInstance=Ui}readValueFromInstance(t,s){if(Tt.has(s)){const r=Kn(s);return r&&r.default||0}else{const r=fh(t),i=($i(s)?r.getPropertyValue(s):r[s])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(t,{transformPagePoint:s}){return Ha(t,s)}build(t,s,r){Pn(t,s,r.transformTemplate)}scrapeMotionValuesFromProps(t,s,r){return Rn(t,s,r)}}class ph extends so{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Pe}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(Tt.has(s)){const r=Kn(s);return r&&r.default||0}return s=Hi.has(s)?s:Sn(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,r){return Yi(t,s,r)}build(t,s,r){En(t,s,this.isSVGTag,r.transformTemplate)}renderInstance(t,s,r,i){Wi(t,s,r,i)}mount(t){this.isSVGTag=Mn(t.tagName),super.mount(t)}}const xh=(e,t)=>_n(e)?new ph(t):new mh(t,{allowProjection:e!==u.Fragment}),gh=Bl({...$d,...ah,...Gu,...oh},xh),et=nl(gh),yh=({title:e,onFilterClick:t,showAdd:s=!0,variant:r="default"})=>{const i=r==="overlay";return n.jsxs("div",{className:i?"fixed top-0 left-0 right-0 z-30 px-6 py-4 bg-gradient-to-b from-pink-200/60 via-purple-200/40 to-transparent backdrop-blur-sm flex justify-between items-center pointer-events-none":"sticky top-0 z-20 px-6 py-4 bg-primary-50/80 backdrop-blur-md flex justify-between items-center transition-all",children:[n.jsx("div",{className:i?"text-2xl font-bold text-slate-800 tracking-tight flex items-center opacity-0":"text-2xl font-bold text-slate-800 tracking-tight flex items-center",children:e}),n.jsx("div",{className:i?"flex gap-4 opacity-0":"flex gap-4",children:s&&n.jsx("button",{onClick:()=>{try{tt(".",{:""})}catch{}t==null||t()},className:"p-2 rounded-full bg text-primary-500 shadow-sm hover:shadow-md transition-all active:scale-95","aria-label":"",children:n.jsx(ht,{size:20})})})]})};var Ze=(e=>(e.ONLINE="",e.OFFLINE="",e.BUSY="",e))(Ze||{}),at=(e=>(e.TEXT="text",e.SYSTEM="system",e))(at||{}),be=(e=>(e.HOME="home",e.CHAT="chat",e.ME="me",e))(be||{});const vh=({activeTab:e,onTabChange:t})=>{const s=r=>`flex flex-col items-center justify-center w-full h-full transition-all duration-300 ${e===r?"text-primary-600 scale-105":"text-slate-400 hover:text-primary-400"}`;return n.jsx("div",{className:"fixed bottom-0 inset-x-0 z-30",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-20 bg-white/90 backdrop-blur-lg border-t border-primary-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] flex justify-around items-center px-4 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[n.jsxs("button",{className:s(be.HOME),onClick:()=>{t(be.HOME);try{tt("."),ke("","")}catch{}},children:[n.jsx(Ao,{size:24,strokeWidth:e===be.HOME?2.5:2}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]}),n.jsxs("button",{className:s(be.CHAT),onClick:()=>{t(be.CHAT);try{tt("."),ke("","")}catch{}},children:[n.jsxs("div",{className:"relative",children:[n.jsx(pn,{size:24,strokeWidth:e===be.CHAT?2.5:2}),n.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-400 rounded-full border-2 border-white"})]}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]}),n.jsxs("button",{className:s(be.ME),onClick:()=>{t(be.ME);try{tt("."),ke("","")}catch{}},children:[n.jsx(un,{size:24,strokeWidth:e===be.ME?2.5:2}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]})]})})},xi=({chat:e,onClick:t,onTogglePin:s,roundedClass:r})=>{var c;const i=d=>d.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1}),[l,o]=u.useState(!1),a=d=>{d.stopPropagation(),s()};return n.jsxs("div",{onClick:t,className:`group relative flex items-center gap-4 p-4 bg-white ${r||"rounded-2xl"} shadow-sm border border-transparent hover:border-primary-100 hover:shadow-md active:scale-[0.98] transition-all duration-200 cursor-pointer`,children:[n.jsx("div",{className:"relative flex-shrink-0",children:n.jsx("div",{className:"w-14 h-14 rounded-full p-0.5 bg-gradient-to-tr from-primary-300 to-accent-pink",children:!l&&e.character.avatar?n.jsx("img",{src:e.character.avatar,alt:e.character.name,onError:()=>o(!0),className:"w-full h-full rounded-full object-cover border-2 border-white"}):n.jsx("div",{className:"w-full h-full rounded-full border-2 border-white bg-white flex items-center justify-center text-slate-500 font-bold",children:((c=e.character.name)==null?void 0:c[0])||"?"})})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("h3",{className:"font-bold text-slate-800 text-lg truncate",children:e.character.name})}),n.jsx("span",{className:"text-xs text-slate-400 font-medium whitespace-nowrap ml-2",children:i(e.lastMessage.timestamp)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("p",{className:"text-slate-500 text-sm truncate pr-4 leading-relaxed",children:[e.lastMessage.senderId==="user"&&n.jsx("span",{className:"text-slate-400",children:": "}),e.lastMessage.text]}),n.jsxs("div",{className:"flex gap-2 items-center flex-shrink-0",children:[n.jsx("button",{onClick:a,className:`w-6 h-6 flex items-center justify-center rounded-full transition-all ${e.character.isPinned?"bg-primary-50 text-primary-400":"text-slate-200 hover:text-primary-300"}`,children:n.jsx(Wo,{size:14,className:`transform rotate-45 ${e.character.isPinned?"fill-primary-400":""}`})}),e.unreadCount>0&&n.jsx("span",{className:"flex items-center justify-center min-w-[20px] h-5 px-1.5 bg-red-400 text-white text-[10px] font-bold rounded-full",children:e.unreadCount})]})]})]})]})},bh=({chats:e,onChatClick:t,onTogglePin:s,onDeleteChat:r,isDetailOpen:i=!1})=>{const l=(navigator==null?void 0:navigator.maxTouchPoints)>0,o=e.filter(w=>w.character.isPinned),a=e.filter(w=>!w.character.isPinned),[c,d]=u.useState({}),[h,f]=u.useState(null),x=u.useRef(0),v=u.useRef(0),_=u.useRef(null),[N,E]=u.useState({visible:!1,x:0,y:0,id:null});u.useEffect(()=>{try{const w=localStorage.getItem("user_id")||"0",D=localStorage.getItem("user_username")||w,P=localStorage.getItem("user_nickname")||"";st({userId:D,pageId:"CHAT_LIST",name:P}),ke("","")}catch{}},[]);const S=(w,D)=>{x.current=w.touches[0].clientX,v.current=w.touches[0].clientY,_.current=D},I=(w,D)=>{if(_.current!==D)return;const P=w.touches[0].clientX-x.current,q=w.touches[0].clientY-v.current;if(Math.abs(q)>Math.abs(P))return;const U=Math.max(-96,Math.min(0,P));d(Y=>({...Y,[D]:U}))},T=w=>{if(_.current!==w)return;const P=(c[w]||0)<-60?-96:0;d(q=>({...q,[w]:P})),_.current=null},B=w=>d(D=>({...D,[w]:0})),b=(w,D)=>{if(w.preventDefault(),l)return;let P=w.clientX;const q=120;P+q>window.innerWidth&&(P=window.innerWidth-q-10),E({visible:!0,x:P,y:w.clientY,id:D})};return n.jsxs(et.div,{className:"px-6 pb-24 animate-in fade-in slide-in-from-bottom-4 duration-700",initial:{x:0},animate:i&&l?{x:"-100%"}:{x:0},transition:i&&l?{duration:.3,ease:"linear"}:{duration:0},children:[o.length>0&&n.jsxs("div",{className:"mb-6",children:[n.jsx("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 px-1",children:""}),o.map(w=>n.jsxs("div",{className:"relative overflow-hidden mb-3 rounded-2xl",children:[(()=>{const D=Math.min(96,Math.max(0,-(c[w.characterId]||0)));return n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${D}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>f(w.characterId),className:"text-white font-bold drop-shadow-sm",children:""})})})(),n.jsx("div",{onTouchStart:D=>S(D,w.characterId),onTouchMove:D=>I(D,w.characterId),onTouchEnd:()=>T(w.characterId),onContextMenu:D=>b(D,w.characterId),style:{transform:`translateX(${c[w.characterId]||0}px)`,transition:"transform 180ms ease"},children:n.jsx(xi,{chat:w,onClick:()=>t(w),onTogglePin:()=>s(w.characterId),roundedClass:(c[w.characterId]||0)<0?"rounded-l-2xl rounded-r-none":"rounded-2xl"})})]},w.characterId))]}),a.length>0&&n.jsxs("div",{children:[n.jsx("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 px-1",children:""}),a.map(w=>n.jsxs("div",{className:"relative overflow-hidden mb-3 rounded-2xl",children:[(()=>{const D=Math.min(96,Math.max(0,-(c[w.characterId]||0)));return n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${D}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>f(w.characterId),className:"text-white font-bold drop-shadow-sm",children:""})})})(),n.jsx("div",{onTouchStart:D=>S(D,w.characterId),onTouchMove:D=>I(D,w.characterId),onTouchEnd:()=>T(w.characterId),onContextMenu:D=>b(D,w.characterId),style:{transform:`translateX(${c[w.characterId]||0}px)`,transition:"transform 180ms ease"},children:n.jsx(xi,{chat:w,onClick:()=>t(w),onTogglePin:()=>s(w.characterId),roundedClass:(c[w.characterId]||0)<0?"rounded-l-2xl rounded-r-none":"rounded-2xl"})})]},w.characterId))]}),h&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{B(h),f(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{const w=h;f(null),r(w)},children:""})]})]})}),n.jsx("style",{children:`
        @keyframes fadeCard { from { opacity: 0; transform: translateY(-6px) } to { opacity: 1; transform: translateY(0) } }
        @keyframes fadeBg { from { opacity: 0 } to { opacity: 1 } }
      `})]}),e.length===0&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[n.jsx("p",{className:"text-slate-500 font-medium",children:""}),n.jsx("p",{className:"text-slate-400 text-sm mt-1",children:""})]}),N.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>E(w=>({...w,visible:!1})),onContextMenu:w=>{w.preventDefault(),E(D=>({...D,visible:!1}))}}),n.jsx("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95 duration-100",style:{top:N.y,left:N.x},children:n.jsx("button",{onClick:()=>{N.id&&f(N.id),E(w=>({...w,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 transition-colors",children:""})})]})]})},gi={type:"tween",ease:"easeInOut",duration:.28},no={type:"tween",ease:"linear",duration:.28},Jn={duration:.18},ro="/api",wh={async login(e,t){const s=await fetch(`${ro}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});let r=null;try{r=await s.json()}catch{r=null}return{ok:s.ok,status:s.status,data:r}}},jh=()=>localStorage.getItem("user_access_token")||"",Nh=()=>localStorage.getItem("user_refresh_token")||"",Sh=async()=>{const e=Nh();if(!e)return!1;try{const t=await fetch(`${ro}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!t.ok)return!1;const s=await t.json(),r=(s==null?void 0:s.access_token)||"";if(!r)return!1;try{localStorage.setItem("user_access_token",r)}catch{}return!0}catch{return!1}},Zn=e=>e==="male"?"":e==="female"?"":"",Th=async e=>{const t={name:(e==null?void 0:e.name)||"",age:parseInt((e==null?void 0:e.age)||"0")||null,gender:Zn(e==null?void 0:e.gender),profession:(e==null?void 0:e.profession)||null,basic_info:(e==null?void 0:e.basicInfo)||null,personality:(e==null?void 0:e.personality)||null,avatar:(e==null?void 0:e.avatar)||null},{authFetch:s}=await ve(async()=>{const{authFetch:l}=await import("./http-De6Ej-g0.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3])),r=await s("/user/chat-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error("create_role_failed");return(await r.json()).id},_h=async(e,t)=>{const s={name:(t==null?void 0:t.name)||"",age:parseInt((t==null?void 0:t.age)||"0")||null,gender:Zn(t==null?void 0:t.gender),profession:(t==null?void 0:t.profession)||null,basic_info:(t==null?void 0:t.basicInfo)||null,personality:(t==null?void 0:t.personality)||null,avatar:(t==null?void 0:t.avatar)||null},{authFetch:r}=await ve(async()=>{const{authFetch:l}=await import("./http-De6Ej-g0.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3]));if(!(await r(`/user/chat-role/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("update_role_failed");return!0},kh=async()=>{const{authFetch:e}=await ve(async()=>{const{authFetch:r}=await import("./http-De6Ej-g0.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),t=await e("/user/chat-role",{method:"GET"});if(!t.ok)throw new Error("fetch_roles_failed");const s=await t.json();return Array.isArray(s)?s:[]},Ch=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:r}=await import("./http-De6Ej-g0.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user/chat-role/${e}`,{method:"DELETE"})).ok)throw new Error("delete_role_failed");return!0},ms=async(e,t)=>{const s={character_id:Number(e)};typeof t=="number"&&(s.user_chat_role_id=t);const{authFetch:r}=await ve(async()=>{const{authFetch:o}=await import("./http-De6Ej-g0.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),i=await r("/chat/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok)throw new Error("create_session_failed");const l=await i.json();return typeof l=="string"?{sessionId:l}:{sessionId:l.sessionId,model:l.model,temperature:l.temperature}},cs=(e,t,s)=>{const l=`${`${location.protocol==="https:"?"wss":"ws"}://${location.host}`}/ws/chat`;console.log("[ws] connecting",l);let o=null,a=!1,c=1e3;const d=1e4,h=[];let f=null,x=!1,v=!1,_=null;const N=()=>{const T=jh(),B=T?`${l}?token=${encodeURIComponent(T)}`:l;o=new WebSocket(B),o.onmessage=b=>{try{const w=JSON.parse(String(b.data));if(w&&w.type==="assistant_message"&&typeof w.content=="string")t(w.content,w.quote,{chunkIndex:w.chunkIndex,chunkTotal:w.chunkTotal});else if(w&&w.type==="force_logout"){try{s&&s(w)}catch{}a=!0;try{o==null||o.close(1008,"account_disabled")}catch{}}else if(w&&w.type==="refresh_required"){try{s&&s(w)}catch{}x=!0;try{console.log("[ws] refresh_required, will resend last")}catch{}}else if(w&&w.type==="ws_ready"){if(v=!0,_){try{clearTimeout(_)}catch{}_=null}for(;h.length;){const D=h.shift();try{o==null||o.send(JSON.stringify(D))}catch{}}if(x&&f){try{console.log("[ws] resend last payload (ws_ready)",f)}catch{}try{o==null||o.send(JSON.stringify(f))}catch{}x=!1}}}catch{}},o.onerror=b=>{console.error("[ws] error",b)},o.onopen=()=>{console.log("[ws] open"),c=1e3;const b={type:"typing",sessionId:e,typing:!1};try{o==null||o.send(JSON.stringify(b))}catch{}if(v=!1,_){try{clearTimeout(_)}catch{}_=null}_=setTimeout(()=>{if(!v){for(;h.length;){const w=h.shift();try{o==null||o.send(JSON.stringify(w))}catch{}}if(x&&f){try{console.log("[ws] resend last payload (timeout)",f)}catch{}try{o==null||o.send(JSON.stringify(f))}catch{}x=!1}}},300)},o.onclose=async b=>{if(console.log("[ws] closed"),a)return;if(b&&(b.code===1008||String(b.reason||"").toLowerCase().includes("unauthorized"))){const D=await Sh();if(f&&(x=!0),D){c=1e3,N();return}try{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token")}catch{}try{window.location.reload()}catch{}return}setTimeout(N,c),c=Math.min(c*2,d)}};return N(),{ws:o,sendText:(T,B,b,w,D)=>{const P={sessionId:e,text:T,chatMode:B};if(b&&(P.userRole={name:b.name,gender:Zn(b.gender),age:b.age||"",profession:b.profession||"",basic_info:b.basicInfo||"",personality:b.personality||"",avatar:b.avatar||""}),w&&(P.model_id=w),typeof D=="number"&&(P.temperature=D),f=P,o&&o.readyState===WebSocket.OPEN){try{console.log("[ws] send payload",P)}catch{}o.send(JSON.stringify(P))}else{try{console.log("[ws] queue payload (ws not open)",P)}catch{}h.push(P)}},sendTyping:T=>{const B={type:"typing",sessionId:e,typing:T};o&&o.readyState===WebSocket.OPEN?o.send(JSON.stringify(B)):h.push(B)},close:()=>{a=!0;try{o==null||o.close()}catch{}}}},Ah=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:l}=await import("./http-De6Ej-g0.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3])),s=await t(`/chat/sessions/${e}`,{method:"GET"});if(!s.ok){if(s.status===404){const l=new Error("session_not_found");throw l.status=404,l}throw new Error("get_session_failed")}const r=await s.json(),i=(r==null?void 0:r.session)||{};return{model:i==null?void 0:i.model,temperature:i==null?void 0:i.temperature}},Es=({imageSrc:e,onCrop:t,onCancel:s,aspectRatio:r,outputWidth:i,outputHeight:l})=>{const[o,a]=u.useState(1),[c,d]=u.useState({x:0,y:0}),[h,f]=u.useState(!1),[x,v]=u.useState({x:0,y:0}),[_,N]=u.useState(e),[E,S]=u.useState(!1),[I,T]=u.useState(!1),[B,b]=u.useState(!0),w=u.useRef(null),D=u.useRef(null),P=u.useRef(null),q=u.useRef(null),U=r&&r>0?r:1,[Y,ce]=u.useState(Math.round(300*U)),[se,k]=u.useState(300);u.useEffect(()=>{const K=()=>{const ne=D.current?D.current.clientWidth:window.innerWidth,he=D.current?D.current.clientHeight:window.innerHeight;let ue=Math.min(Math.floor(ne*.9),700),xe=Math.round(ue/U);const Re=Math.max(180,Math.min(he-160,380));xe>Re&&(xe=Re,ue=Math.round(xe*U)),ce(ue),k(xe)};return K(),window.addEventListener("resize",K),()=>window.removeEventListener("resize",K)},[U]),u.useEffect(()=>{const K=setTimeout(()=>S(!0),400);return()=>clearTimeout(K)},[]),u.useEffect(()=>{if(!E||!I){b(!0);return}const ne=setTimeout(()=>b(!1),200);return()=>clearTimeout(ne)},[E,I]),u.useEffect(()=>{let K=!1;const ne=new Image;return ne.onload=()=>{const he=document.createElement("canvas");he.width=ne.naturalWidth,he.height=ne.naturalHeight;const ue=he.getContext("2d");if(!ue){K||N(e);return}ue.drawImage(ne,0,0);try{const xe=he.toDataURL("image/jpeg",.92);K||N(xe)}catch{K||N(e)}},ne.onerror=()=>{K||N(e)},ne.src=e,()=>{K=!0}},[e]);const z=K=>{f(!0);const ne="touches"in K?K.touches[0].clientX:K.clientX,he="touches"in K?K.touches[0].clientY:K.clientY;v({x:ne-c.x,y:he-c.y})},G=K=>{if(!h)return;K.preventDefault();const ne="touches"in K?K.touches[0].clientX:K.clientX,he="touches"in K?K.touches[0].clientY:K.clientY;d({x:ne-x.x,y:he-x.y})},X=()=>{f(!1)},oe=()=>{const K=P.current,ne=w.current;if(!K||!ne)return;const he=K.getContext("2d");if(!he)return;const ue=i&&i>0?i:300,xe=l&&l>0?l:Math.round(ue/U);K.width=ue,K.height=xe;const Re=ne.naturalWidth,ge=ne.naturalHeight,j=Math.max(Y/Re,se/ge),$=ue/Y,R=xe/se;he.fillStyle="#000",he.fillRect(0,0,ue,xe),he.translate(ue/2,xe/2),he.translate(c.x*$,c.y*R),he.scale(o*$,o*R),he.scale(j,j),he.drawImage(ne,-Re/2,-ge/2);try{tt(".")}catch{}t(K.toDataURL("image/jpeg",.9))};return n.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center animate-in fade-in duration-300",children:[n.jsxs("div",{className:"absolute top-0 w-full p-4 flex justify-between items-center z-20 text-white",children:[n.jsx("button",{onClick:()=>{try{tt(".")}catch{}s()},className:"p-2 bg-white/10 rounded-full",children:n.jsx(Nt,{size:24})}),n.jsx("h3",{className:"font-bold text-lg tracking-wider",children:""}),n.jsx("button",{onClick:oe,className:"p-2 bg-purple-500 rounded-full text-white shadow-lg shadow-purple-500/30",children:n.jsx(_i,{size:24})})]}),n.jsxs("div",{ref:D,className:"relative w-full h-full overflow-hidden bg-black flex items-center justify-center touch-none select-none",style:{isolation:"isolate"},onMouseDown:z,onMouseMove:G,onMouseUp:X,onMouseLeave:X,onTouchStart:z,onTouchMove:G,onTouchEnd:X,children:[n.jsx("img",{ref:w,src:_,alt:"Crop target",className:"absolute max-w-none transition-transform duration-75 ease-linear pointer-events-none",style:{transform:`translate(${c.x}px, ${c.y}px) scale(${o}) translateZ(0)`,height:"auto",width:Y,willChange:"transform",backfaceVisibility:"hidden"},onLoad:()=>T(!0),draggable:!1}),n.jsxs("div",{className:"absolute inset-0 pointer-events-none z-10",children:[n.jsx("div",{className:"absolute top-0 left-0 right-0 bg-black/80",style:{height:`calc(50% - ${se/2}px)`}}),n.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/80",style:{height:`calc(50% - ${se/2}px)`}}),n.jsx("div",{className:"absolute left-0 bg-black/80",style:{top:`calc(50% - ${se/2}px)`,bottom:`calc(50% - ${se/2}px)`,width:`calc(50% - ${Y/2}px)`}}),n.jsx("div",{className:"absolute right-0 bg-black/80",style:{top:`calc(50% - ${se/2}px)`,bottom:`calc(50% - ${se/2}px)`,width:`calc(50% - ${Y/2}px)`}}),n.jsx("div",{ref:q,className:"absolute border-2 border-white box-content",style:{width:Y,height:se,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:n.jsxs("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 opacity-30",children:[n.jsx("div",{className:"border-r border-white"}),n.jsx("div",{className:"border-r border-white"}),n.jsx("div",{className:"border-b border-white col-span-3 row-start-1"}),n.jsx("div",{className:"border-b border-white col-span-3 row-start-2"})]})})]})]}),n.jsx("div",{className:"absolute bottom-0 w-full bg-slate-900/80 p-6 pb-10 flex flex-col gap-4 z-20",children:n.jsxs("div",{className:"flex items-center gap-4 text-white justify-center",children:[n.jsx($o,{size:20,className:"text-slate-400"}),n.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.05",value:o,onChange:K=>a(parseFloat(K.target.value)),className:"w-64 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-purple-500"}),n.jsx(ht,{size:20,className:"text-slate-400"})]})}),n.jsx("canvas",{ref:P,className:"hidden"}),B&&n.jsx("div",{className:`fixed inset-0 z-[120] bg-black flex items-center justify-center transition-opacity duration-300 ${!E||!I?"opacity-100":"opacity-0"}`,style:{pointerEvents:!E||!I?"auto":"none"},children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})})]})},io=({currentPersona:e,roleId:t,onBack:s,onSave:r,withinContainer:i=!1})=>{const[l,o]=u.useState((e==null?void 0:e.gender)||"female"),[a,c]=u.useState((e==null?void 0:e.name)||""),[d,h]=u.useState((e==null?void 0:e.age)||""),[f,x]=u.useState((e==null?void 0:e.profession)||""),[v,_]=u.useState((e==null?void 0:e.basicInfo)||""),[N,E]=u.useState((e==null?void 0:e.personality)||""),[S,I]=u.useState(e==null?void 0:e.avatar),[T,B]=u.useState(null),[b,w]=u.useState(!1),[D,P]=u.useState(!1),q=u.useRef(null),U=k=>{var ne;const z=k.split(","),G=((ne=z[0].match(/:(.*?);/))==null?void 0:ne[1])||"image/jpeg",X=atob(z[1]);let oe=X.length;const K=new Uint8Array(oe);for(;oe--;)K[oe]=X.charCodeAt(oe);return new Blob([K],{type:G})},Y=async()=>{if(D)return;P(!0);const k=localStorage.getItem("user_access_token");let z=S;try{if(S&&S.startsWith("data:image")){const X=U(S),oe=new FormData,K=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;oe.append("avatar",X,"avatar.jpg"),oe.append("filename",K),z=`/uploads/users/avatars/${K}`,fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:k?`Bearer ${k}`:""},body:oe}).catch(()=>{})}const G={gender:l,name:a,age:d,profession:f,basicInfo:v,personality:N,avatar:z||void 0};typeof t=="number"?await _h(t,G):await Th(G)}catch{}r({gender:l,name:a,age:d,profession:f,basicInfo:v,personality:N,avatar:z});try{tt(".",{:a})}catch{}P(!1),s()},ce=()=>{var k;(k=q.current)==null||k.click()},se=k=>{var G;const z=(G=k.target.files)==null?void 0:G[0];if(z){w(!0);const X=new FileReader;X.onloadend=()=>{B(X.result),w(!1)},X.readAsDataURL(z)}q.current&&(q.current.value="")};return n.jsxs("div",{className:`${i?"absolute":"fixed"} inset-0 z-[80]`,children:[n.jsx(et.div,{className:"absolute inset-0 bg-[#F8F9FA]",initial:{opacity:0},animate:{opacity:1},transition:Jn}),n.jsxs(et.div,{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)] flex flex-col h-[92vh] w-full overflow-y-auto no-scrollbar",initial:{y:"100%"},animate:{y:0},transition:no,children:[T&&n.jsx(Es,{imageSrc:T,onCancel:()=>B(null),onCrop:k=>{I(k),B(null)}}),n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm border-b border-slate-100 rounded-none md:rounded-t-3xl",children:[n.jsx("button",{onClick:s,className:"p-2 -ml-2 text-slate-800 hover:bg-slate-50 rounded-full transition-colors",children:n.jsx(Ss,{size:24})}),n.jsx("button",{onClick:Y,disabled:D,className:`px-4 py-1.5 rounded-lg text-sm font-bold transition-transform ${D?"bg-purple-200 text-white cursor-not-allowed":"bg-purple-50 text-purple-600 active:scale-95"}`,children:""})]}),n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white p-4 space-y-3 pb-10 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[n.jsx("div",{className:"flex justify-center py-6",children:n.jsxs("div",{onClick:ce,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-24 h-24 rounded-full bg-pink-200 flex items-center justify-center text-white shadow-sm border-4 border-white overflow-hidden",children:S?n.jsx("img",{src:S,alt:"User Avatar",className:"w-full h-full object-cover"}):n.jsx(un,{size:48,fill:"currentColor"})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-white p-2 rounded-full shadow-md border border-slate-100",children:n.jsx(mo,{size:14,className:"text-slate-400"})}),n.jsx("input",{type:"file",ref:q,className:"hidden",accept:"image/*",onChange:se})]})}),b&&n.jsx("div",{className:"fixed inset-0 z-[90] bg-black flex items-center justify-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-4",children:""}),n.jsxs("div",{className:"flex gap-6",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${l==="male"?"border-blue-500":"border-slate-300"}`,children:l==="male"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"male",checked:l==="male",onChange:()=>o("male"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${l==="female"?"border-blue-500":"border-slate-300"}`,children:l==="female"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"female",checked:l==="female",onChange:()=>o("female"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${l==="secret"?"border-blue-500":"border-slate-300"}`,children:l==="secret"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"secret",checked:l==="secret",onChange:()=>o("secret"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]})]})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:" ()"}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:a,onChange:k=>c(k.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:d,onChange:k=>h(k.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:f,onChange:k=>x(k.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("textarea",{placeholder:"...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:v,onChange:k=>_(k.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("textarea",{placeholder:"...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:N,onChange:k=>E(k.target.value)})]})]})]})]})},yi=e=>e===""?"male":e===""?"female":"secret",Ph=({isOpen:e,currentPersona:t,onClose:s,onAdd:r,onSelect:i,onEdit:l,characterId:o})=>{const[a,c]=u.useState([]),[d,h]=u.useState(null),[f,x]=u.useState({}),v=u.useRef(0),_=u.useRef(0),N=u.useRef(null),E=u.useRef(0),[S,I]=u.useState(null),T=(navigator==null?void 0:navigator.maxTouchPoints)>0,[B,b]=u.useState({visible:!1,x:0,y:0,id:null});u.useEffect(()=>{e&&((async()=>{try{const z=await kh();c(z)}catch{}})(),x({}))},[e]),u.useEffect(()=>{if(!a.length)return;let k;if(o!=null)try{const G=localStorage.getItem(`chat_config_${String(o)}`);if(G){const X=JSON.parse(G);X&&X.persona&&(k=X.persona)}}catch{}const z=k==null?void 0:k.name;if(z){const G=a.find(X=>X.name===z);if(G){h(G.id);return}}h(null)},[a,o]);const w=k=>{h(k.id);const z={name:k.name||"",gender:yi(k.gender),age:k.age?String(k.age):"",profession:k.profession||"",basicInfo:k.basic_info||"",personality:k.personality||"",avatar:k.avatar||void 0};try{localStorage.setItem("user_chat_role_id",String(k.id))}catch{}try{tt(".",{:z.name,ID:k.id}),ke("",z.name)}catch{}i(z,k.id),s()},D=k=>{ce(k.id);const z={name:k.name||"",gender:yi(k.gender),age:k.age?String(k.age):"",profession:k.profession||"",basicInfo:k.basic_info||"",personality:k.personality||"",avatar:k.avatar||void 0};try{tt(".",{ID:k.id,:z.name})}catch{}l&&l(z,k.id),s()},P=(k,z)=>{if(k.preventDefault(),T)return;let G=k.clientX;const X=140;G+X>window.innerWidth&&(G=window.innerWidth-X-10),b({visible:!0,x:G,y:k.clientY,id:z})},q=(k,z)=>{v.current=k.touches[0].clientX,_.current=k.touches[0].clientY,N.current=z,E.current=f[z]||0},U=(k,z)=>{if(N.current!==z)return;const G=k.touches[0].clientX-v.current,X=k.touches[0].clientY-_.current;if(Math.abs(X)>Math.abs(G))return;let oe=0;E.current===0?oe=Math.max(-96,Math.min(96,G)):E.current>0?oe=Math.max(0,Math.min(96,E.current+G)):oe=Math.min(0,Math.max(-96,E.current+G)),x(K=>({...K,[z]:oe}))},Y=k=>{if(N.current!==k)return;const z=f[k]||0;let G=0;E.current===0?G=z>60?96:z<-60?-96:0:E.current>0?G=z>60?96:0:G=z<-60?-96:0,x(X=>({...X,[k]:G})),N.current=null},ce=k=>x(z=>({...z,[k]:0})),se=async k=>{I(null);try{await Ch(k),c(z=>z.filter(G=>G.id!==k))}catch{}};return n.jsxs("div",{className:`fixed inset-0 z-[90] ${e?"":"pointer-events-none"}`,children:[n.jsx(It,{children:e&&n.jsxs(n.Fragment,{children:[n.jsx(et.div,{className:"absolute inset-0 bg-black/30 will-change-opacity",onClick:s,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:Jn},"backdrop"),n.jsx(et.div,{className:"absolute bottom-0 left-0 right-0 bg-transparent will-change-transform transform-gpu",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:no,children:n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)]",children:[n.jsxs("div",{className:"sticky top-0 bg-white/95 backdrop-blur-md p-3 border-b border-slate-100 flex justify-between items-center z-10",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-2",children:[n.jsx(Ss,{className:"w-6 h-6"}),n.jsx("span",{className:"font-bold text-lg",children:""})]}),n.jsx("button",{onClick:r,className:"w-9 h-9 rounded-full bg-purple-50 text-[#A855F7] flex items-center justify-center active:scale-90 transition-transform",children:n.jsx(ht,{className:"w-6 h-6"})})]}),n.jsxs("div",{className:"p-4 flex flex-col gap-3 max-h-[70vh] overflow-y-auto",children:[a.map(k=>n.jsxs("div",{className:"relative overflow-hidden rounded-xl",children:[(()=>{const z=f[k.id]||0,G=Math.min(96,Math.max(0,-z)),X=Math.min(96,Math.max(0,z));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-xl shadow-sm",style:{width:`${G}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>I(k.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-xl shadow-sm",style:{width:`${X}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>D(k),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onClick:()=>{(f[k.id]||0)===0&&w(k)},onTouchStart:z=>q(z,k.id),onTouchMove:z=>U(z,k.id),onTouchEnd:()=>Y(k.id),onContextMenu:z=>P(z,k.id),className:`${(f[k.id]||0)<0?"rounded-l-xl rounded-r-none":(f[k.id]||0)>0?"rounded-l-none rounded-r-xl":"rounded-xl"} p-4 bg-white shadow-sm border flex items-center gap-3 active:scale-[0.98] transition-transform ${d===k.id?"border-[#A855F7] shadow-[0_0_0_6px_rgba(168,85,247,0.18)]":"border-slate-100"}`,style:{transform:`translateX(${f[k.id]||0}px)`,transition:"transform 180ms ease"},children:[n.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-slate-200 flex items-center justify-center text-slate-600 font-bold",children:k.avatar?n.jsx("img",{src:k.avatar,alt:k.name,className:"w-full h-full object-cover"}):(k.name||"")[0]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-800 truncate",children:k.name}),n.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[k.profession||"",k.age?`  ${k.age}`:""]})]}),d===k.id&&n.jsx(po,{className:"w-5 h-5 text-[#A855F7]"})]})]},k.id)),!a.length&&n.jsxs("div",{className:"p-6 text-center text-slate-500",children:[n.jsx("div",{className:"text-sm",children:""}),n.jsx("div",{className:"mt-3",children:n.jsx("button",{onClick:r,className:"px-3 py-1.5 bg-[#A855F7] text-white rounded-lg text-sm font-bold",children:""})})]})]})]})},"sheet")]})}),S&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[95] bg-black/20"}),n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{S!=null&&ce(S),I(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{se(S)},children:""})]})]})})]}),B.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>b(k=>({...k,visible:!1})),onContextMenu:k=>{k.preventDefault(),b(z=>({...z,visible:!1}))}}),n.jsxs("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px]",style:{top:B.y,left:B.x},children:[n.jsxs("button",{onClick:()=>{const k=a.find(z=>z.id===B.id);k&&D(k),b(z=>({...z,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[n.jsx(Ys,{className:"w-4 h-4 text-indigo-500"}),""]}),n.jsx("div",{className:"h-[1px] bg-slate-100 w-full"}),n.jsxs("button",{onClick:()=>{I(B.id),b(k=>({...k,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 flex items-center gap-2",children:[n.jsx(hn,{className:"w-4 h-4"}),""]})]})]})]})},Eh=({character:e,initialMessages:t,userPersona:s,onBack:r,onUpdateLastMessage:i,onOpenUserSettings:l,onShowProfile:o,onUpdateUserPersona:a})=>{const[c,d]=u.useState(t),[h,f]=u.useState("scene"),[x,v]=u.useState(""),[_,N]=u.useState(!1),[E,S]=u.useState(!1),[I,T]=u.useState(!1),[B,b]=u.useState(void 0),[w,D]=u.useState(void 0),[P,q]=u.useState(!1),[U,Y]=u.useState(!1),[ce,se]=u.useState(void 0),[k,z]=u.useState(.1),[G,X]=u.useState(void 0),[oe,K]=u.useState(!1),[ne,he]=u.useState(!1),[ue,xe]=u.useState(void 0),[Re,ge]=u.useState(!1),[j,$]=u.useState(!1),[R,le]=u.useState(!1),[ie,ye]=u.useState(!1),[Ce,Ie]=u.useState(!1),Fe=u.useRef(null),Me=u.useRef(null),C=u.useRef(null),[W,J]=u.useState(null),ae=u.useRef(null),fe=(()=>{try{return localStorage.getItem("user_id")||"0"}catch{return"0"}})(),Se=`chat_history_${fe}_${e.id}`,Ae=`chat_config_${e.id}`,Be=`chat_model_${e.id}`,je=`chat_temp_${e.id}`,Ue=`chat_model_name_${e.id}`,Ee=`chat_bg_${e.id}`,[Ne,Ye]=u.useState(void 0),Xe=u.useRef(null),[Ge,dt]=u.useState(null),A=m=>{if(m)try{const p=new Image;p.crossOrigin="anonymous",p.src=m,p.onload=()=>{try{const g=document.createElement("canvas"),V=32,F=32;g.width=V,g.height=F;const H=g.getContext("2d");if(!H)return;H.drawImage(p,0,0,V,F);const O=H.getImageData(0,0,V,F).data;let Q=0;for(let me=0;me<O.length;me+=4){const re=O[me],De=O[me+1],Oe=O[me+2],it=.2126*re+.7152*De+.0722*Oe;Q+=it}const te=Q/(V*F);dt(te<128)}catch{}}}catch{}},L=u.useMemo(()=>{if(ue)return ue;try{const m=localStorage.getItem("user_nickname")||"",p=localStorage.getItem("user_avatar")||"";if(m||p)return{name:m||"",gender:"secret",age:"",profession:"",basicInfo:"",personality:"",avatar:p||void 0}}catch{}},[ue]),Z=(m,p,g)=>{d(V=>{const F=[...V];for(let O=F.length-1;O>=0;O--)if(F[O].senderId==="user"&&!F[O].read){F[O]={...F[O],read:!0};break}const H={id:(Date.now()+1).toString(),senderId:e.id,text:m,quote:p,timestamp:new Date,type:at.TEXT};F.push(H);try{setTimeout(()=>i(H),0)}catch{}return F}),g&&typeof g.chunkIndex=="number"&&typeof g.chunkTotal=="number"?N(g.chunkIndex<g.chunkTotal):N(!1)},de=()=>{var m;Me.current?Me.current.scrollTop=Me.current.scrollHeight:(m=Fe.current)==null||m.scrollIntoView({behavior:"smooth"})},pe=()=>{const m=C.current;if(m)try{const p=window.getComputedStyle(m),g=parseFloat(p.lineHeight||"22")||22,V=parseFloat(p.maxHeight||"0")||g*4;m.style.height="auto";const F=m.scrollHeight,H=Math.min(F,V);m.style.height=`${Math.max(H,22)}px`}catch{m.style.height="auto";const p=m.scrollHeight;m.style.height=`${Math.max(Math.min(p,96),22)}px`}};u.useEffect(()=>{de(),pe()},[c,_]),u.useEffect(()=>{const m=requestAnimationFrame(()=>pe());return()=>cancelAnimationFrame(m)},[x]);const[He,_t]=u.useState({height:"100%",top:0});u.useEffect(()=>{const m=()=>{window.visualViewport&&(_t({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`}),Me.current&&(Me.current.scrollTop=Me.current.scrollHeight))};window.visualViewport&&(window.visualViewport.addEventListener("resize",m),window.visualViewport.addEventListener("scroll",m),m());const p=()=>{window.visualViewport||(Me.current?Me.current.scrollTop=Me.current.scrollHeight:de())};return window.addEventListener("resize",p),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",m),window.visualViewport.removeEventListener("scroll",m)),window.removeEventListener("resize",p)}},[]),u.useEffect(()=>{try{const m=`chat_history_${e.id}`,p=localStorage.getItem(Se)||(fe==="0"?localStorage.getItem(m):null);if(p){const V=JSON.parse(p).map(F=>({id:F.id,senderId:F.senderId,text:F.text,timestamp:new Date(F.ts),type:F.type,quote:F.quote,read:F.read}));V.length&&d(V)}}catch{}},[e.id]),u.useEffect(()=>{try{const m=c.map(p=>{var g,V;return{id:p.id,senderId:p.senderId,text:p.text,ts:(V=(g=p.timestamp)==null?void 0:g.getTime)!=null&&V.call(g)?p.timestamp.getTime():Date.now(),type:p.type,quote:p.quote,read:p.read}});localStorage.setItem(Se,JSON.stringify(m))}catch{}},[c]),u.useEffect(()=>{try{const m=localStorage.getItem(Ae);if(m){const O=JSON.parse(m);((O==null?void 0:O.chatMode)==="daily"||(O==null?void 0:O.chatMode)==="scene")&&(f(O.chatMode),v(O.chatMode==="scene"?"":"")),O!=null&&O.persona&&xe(O.persona)}const p=localStorage.getItem(Be)||void 0,g=localStorage.getItem(je),V=g?parseFloat(g):void 0;p&&(se(p),K(!0)),typeof V=="number"&&!isNaN(V)&&(z(V),he(!0));const F=localStorage.getItem(Ue)||void 0;F&&X(F);const H=localStorage.getItem(Ee)||void 0;H&&Ye(H)}catch{}},[e.id]),u.useEffect(()=>{Ne&&A(Ne)},[Ne]),u.useEffect(()=>{const m=`chat_session_${fe}_${e.id}`,p=localStorage.getItem(m)||localStorage.getItem(`chat_session_${e.id}`);return(async()=>{var V;if(p){if(J(p),!localStorage.getItem(m))try{localStorage.setItem(m,p)}catch{}try{const F=await Ah(p);if((F==null?void 0:F.temperature)!==void 0){z(F.temperature);try{localStorage.setItem(je,String(F.temperature))}catch{}}const H=cs(p,(O,Q,te)=>{Z(O,Q,te)},O=>{O&&O.type==="force_logout"&&ye(!0)});ae.current=H;return}catch(F){if(String((F==null?void 0:F.message)||"")==="session_not_found"||(F==null?void 0:F.status)===404){le(!0);return}}}try{const F=localStorage.getItem("user_chat_role_id"),H=F?parseInt(F):void 0,O=await ms(e.id,typeof H=="number"?H:void 0),Q=O.sessionId;if(localStorage.setItem(m,Q),J(Q),(V=O.model)!=null&&V.id){se(O.model.id);try{localStorage.setItem(Be,O.model.id)}catch{}}if(typeof O.temperature=="number"){z(O.temperature);try{localStorage.setItem(je,String(O.temperature))}catch{}}const te=cs(Q,(me,re,De)=>{Z(me,re,De)},me=>{me&&me.type==="force_logout"&&ye(!0)});ae.current=te}catch{}})(),()=>{var V;(V=ae.current)==null||V.close(),ae.current=null}},[e.id]);const rs=m=>{f(m),m==="scene"?!x.includes("")&&!x.includes("(")?v(p=>`${p}`):x===""&&v(""):(x===""||x==="()")&&v("");try{let p=ue||s||void 0;if(!p)try{const g=localStorage.getItem(Ae);if(g){const V=JSON.parse(g);V&&V.persona&&(p=V.persona)}}catch{}localStorage.setItem(Ae,JSON.stringify({chatMode:m,persona:p})),tt(".",{:m==="scene"?"":""}),ke("",m==="scene"?"":"")}catch{}},y=async()=>{var p,g;if(!x.trim()||x.trim()===""||x.trim()==="()")return;const m={id:Date.now().toString(),senderId:"user",text:x,timestamp:new Date,type:at.TEXT,read:!1};d(V=>[...V,m]);try{setTimeout(()=>i(m),0)}catch{}v(h==="scene"?"":""),N(!0);try{tt(".",{:x.length,:h==="scene"?"":""})}catch{}try{if(!W){const V=localStorage.getItem("user_chat_role_id"),F=V?parseInt(V):void 0,O=(await ms(e.id,typeof F=="number"?F:void 0)).sessionId;localStorage.setItem(`chat_session_${fe}_${e.id}`,O),J(O);const Q=cs(O,(te,me,re)=>{Z(te,me,re)});ae.current=Q}(p=ae.current)==null||p.sendText(m.text,h,L,oe?ce:void 0,ne?k:void 0),(g=ae.current)==null||g.sendTyping(!1)}catch(V){console.error(V),N(!1)}},M=m=>m.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1});return n.jsx(et.div,{className:"fixed inset-0 bg-primary-50 z-50",style:{...He,overscrollBehavior:"none",position:"fixed"},initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col relative bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden",children:[n.jsx("div",{className:"bg-primary-50/95 backdrop-blur-md pt-[env(safe-area-inset-top)] shadow-none z-10 border-b border-white/50 flex-shrink-0",children:n.jsxs("div",{className:"px-4 h-12 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:r,className:"p-2 -ml-2 text-slate-800 hover:bg-black/5 rounded-full transition-colors",children:n.jsx(Yt,{size:24})}),n.jsx("div",{className:"flex items-center cursor-pointer active:opacity-70 transition-opacity",children:n.jsx("h2",{className:"font-bold text-slate-800 text-lg",children:_?"...":e.name})})]}),n.jsx("button",{onClick:()=>S(!0),className:"p-2 text-slate-800 hover:text-primary-600 rounded-full hover:bg-black/5 transition-all",children:n.jsx(xo,{size:24})})]})}),n.jsxs("div",{ref:Me,className:`flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar ${Ne?"":"bg-primary-50"}`,style:{overflowAnchor:"none",backgroundImage:Ne?`url(${Ne})`:void 0,backgroundSize:Ne?"cover":void 0,backgroundPosition:Ne?"center":void 0,backgroundRepeat:Ne?"no-repeat":void 0},children:[n.jsx("div",{className:"flex justify-center my-4",children:n.jsx("span",{className:`text-[10px] px-3 py-1 rounded-full font-medium backdrop-blur-sm ${Ne?Ge?"bg-white/30 text-slate-800":"bg-black/30 text-white":"bg-black/10 text-white"}`,children:""})}),c.map((m,p)=>{const g=m.senderId==="user";return n.jsxs("div",{className:`flex w-full ${g?"justify-end":"justify-start"} mb-4 group`,children:[!g&&n.jsx("div",{className:"flex-shrink-0 mr-3 flex flex-col items-center gap-1",children:n.jsx("div",{onClick:o,className:"w-10 h-10 rounded-full overflow-hidden bg-blue-100 flex items-center justify-center text-blue-500 font-bold border border-white cursor-pointer active:scale-95 transition-transform",children:!Re&&e.avatar?n.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full object-cover",onError:()=>ge(!0)}):e.name[0]})}),n.jsxs("div",{className:`flex flex-col ${g?"items-end":"items-start"} max-w-[75%]`,children:[n.jsx("div",{className:`
                      px-4 py-3 text-[15px] shadow-sm leading-relaxed relative
                      ${g?"bg-[#A855F7] text-white rounded-[20px] rounded-tr-sm":"bg-white text-slate-800 rounded-[20px] rounded-tl-sm border border-slate-100"}
                    `,children:m.text}),!g&&m.quote&&n.jsx("div",{className:"mt-1 max-w-full",children:n.jsx("div",{className:"inline-block bg-slate-100 text-slate-500 text-xs leading-tight rounded-[12px] px-2 py-1 border border-slate-200",children:m.quote})}),n.jsxs("div",{className:`flex items-center gap-2 mt-1 ${g?"mr-1":"ml-1"}`,children:[g&&m.read&&n.jsx("span",{className:`text-[10px] ${Ne?"px-1.5 py-0.5 rounded-full backdrop-blur-sm "+(Ge?"bg-white/30 text-slate-800":"bg-black/30 text-white"):"text-slate-400"}`,style:Ne?{textShadow:Ge?"0 1px 1px rgba(255,255,255,0.5)":"0 1px 1px rgba(0,0,0,0.6)"}:void 0,children:""}),n.jsx("span",{className:`text-[10px] ${Ne?"px-1.5 py-0.5 rounded-full backdrop-blur-sm "+(Ge?"bg-white/30 text-slate-800":"bg-black/30 text-white"):"text-slate-400"}`,style:Ne?{textShadow:Ge?"0 1px 1px rgba(255,255,255,0.5)":"0 1px 1px rgba(0,0,0,0.6)"}:void 0,children:M(m.timestamp)})]})]}),g&&n.jsx("div",{className:"flex-shrink-0 ml-3",children:n.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-pink-200 flex items-center justify-center text-pink-600 font-bold border border-white shadow-sm",children:!j&&(L!=null&&L.avatar)?n.jsx("img",{src:L.avatar,alt:(L==null?void 0:L.name)||"",className:"w-full h-full object-cover",onError:()=>$(!0)}):L!=null&&L.name?L.name[0]:""})})]},m.id)}),n.jsx("div",{ref:Fe})]}),n.jsx("div",{className:"bg-white p-3 pb-3 border-t border-slate-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] pb-[env(safe-area-inset-bottom)] mb-3 flex-shrink-0",children:n.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-[24px] px-3 py-2 border border-slate-100 shadow-[0_12px_28px_rgba(0,0,0,0.12)] transition-shadow focus-within:shadow-[0_16px_40px_rgba(0,0,0,0.16)]",children:[n.jsx("div",{className:"flex-1 flex items-center pl-2",children:n.jsx("textarea",{ref:C,value:x,onChange:m=>{var p;v(m.target.value),(p=ae.current)==null||p.sendTyping(!0)},onKeyDown:m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),y())},onFocus:()=>{de(),setTimeout(de,150),setTimeout(de,300),pe(),setTimeout(pe,0)},onBlur:()=>{var m;return(m=ae.current)==null?void 0:m.sendTyping(!1)},placeholder:"",className:"w-full bg-transparent border-none outline-none focus:ring-0 text-slate-700 text-sm p-0 resize-none max-h-24 overflow-y-auto no-scrollbar leading-5 placeholder:text-slate-400",rows:1,style:{minHeight:"22px"}})}),n.jsx("button",{onClick:y,disabled:!x.trim()||x.trim()==="",className:`p-2 rounded-full transition-all duration-300 flex-shrink-0 flex items-center justify-center ${x.trim()&&x.trim()!==""?"bg-[#A855F7] text-white shadow-md active:scale-95":"bg-transparent text-[#A855F7]"}`,children:n.jsx(Si,{size:20,className:x.trim()&&x.trim()!==""?"ml-0.5":""})})]})}),n.jsx(It,{initial:!1,children:E&&n.jsxs(n.Fragment,{children:[n.jsx(et.div,{className:"absolute inset-0 bg-black/20 z-[60] will-change-opacity",onClick:()=>S(!1),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:Jn}),n.jsxs(et.div,{className:"absolute top-0 right-0 h-full w-3/4 bg-white z-[70] shadow-2xl will-change-transform transform-gpu",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:gi,children:[n.jsxs("div",{className:"p-5 border-b border-slate-100 flex justify-between items-center",children:[n.jsx("h3",{className:"font-bold text-lg text-slate-800",children:""}),n.jsx("button",{onClick:()=>S(!1),className:"text-slate-400 hover:text-slate-600",children:n.jsx(Nt,{size:24})})]}),n.jsxs("div",{className:"p-2",children:[n.jsxs("button",{onClick:()=>{S(!1),q(!0)},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(un,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsx(wt,{size:16,className:"text-slate-300"})]}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsxs("div",{className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(Fo,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[n.jsx("button",{onClick:()=>rs("daily"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${h==="daily"?"bg-white text-slate-800 shadow-sm":"text-slate-400"}`,children:""}),n.jsx("button",{onClick:()=>rs("scene"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${h==="scene"?"bg-white text-purple-600 shadow-sm":"text-slate-400"}`,children:""})]})]}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsxs("button",{onClick:()=>{S(!1),Ie(!0)},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(Eo,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsx(wt,{size:16,className:"text-slate-300"})]})]})]})]})}),n.jsx(It,{initial:!1,children:Ce&&n.jsxs(et.div,{className:"absolute inset-0 bg-white z-[70] will-change-transform",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:gi,children:[n.jsxs("div",{className:"p-5 border-b border-slate-100 flex items-center gap-3",children:[n.jsx("button",{onClick:()=>Ie(!1),className:"p-2 -ml-2 text-slate-800 hover:bg-black/5 rounded-full",children:n.jsx(Yt,{size:24})}),n.jsx("h3",{className:"font-bold text-lg text-slate-800",children:""})]}),n.jsxs("div",{className:"p-2",children:[n.jsxs("button",{onClick:()=>{Ye(void 0),dt(null);try{localStorage.removeItem(Ee)}catch{}Ie(!1)},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsx("span",{className:"font-bold text-sm text-slate-700",children:""}),n.jsx(wt,{size:16,className:"text-slate-300"})]}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsxs("button",{onClick:()=>{var m;Ie(!1),(m=Xe.current)==null||m.click()},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsx("span",{className:"font-bold text-sm text-slate-700",children:""}),n.jsx(wt,{size:16,className:"text-slate-300"})]})]})]})}),I&&n.jsx(io,{currentPersona:B,roleId:w,onBack:()=>T(!1),onSave:m=>{T(!1),q(!0)},withinContainer:!0}),n.jsx(Ph,{isOpen:P,currentPersona:ue||s,characterId:e.id,onClose:()=>q(!1),onAdd:()=>{q(!1),b(void 0),D(void 0),T(!0)},onSelect:m=>{xe(m);try{localStorage.setItem(Ae,JSON.stringify({chatMode:h,persona:m}))}catch{}},onEdit:(m,p)=>{q(!1),b(m),D(p),T(!0)}}),R&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-3 text-slate-600 active:opacity-70",onClick:()=>{le(!1),r()},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-3 text-primary-600 font-bold active:opacity-70",onClick:async()=>{var m;try{const p=localStorage.getItem("user_chat_role_id"),g=p?parseInt(p):void 0,V=await ms(e.id,typeof g=="number"?g:void 0),F=V.sessionId,O=`chat_session_${localStorage.getItem("user_id")||"0"}_${e.id}`;try{localStorage.removeItem(O)}catch{}localStorage.setItem(O,F);try{localStorage.removeItem(Se)}catch{}{const te=e.openingLine||e.oneLinePersona||"",me=`msg_${Date.now()}`,re={id:me,senderId:e.id,text:te,ts:Date.now(),type:at.TEXT};try{localStorage.setItem(Se,JSON.stringify([re]))}catch{}const De={id:me,senderId:e.id,text:te,timestamp:new Date,type:at.TEXT};d([De]);try{setTimeout(()=>i(De),0)}catch{}}if(J(F),le(!1),(m=V.model)!=null&&m.id){se(V.model.id);try{localStorage.setItem(Be,V.model.id)}catch{}}if(typeof V.temperature=="number"){z(V.temperature);try{localStorage.setItem(je,String(V.temperature))}catch{}}const Q=cs(F,(te,me,re)=>{Z(te,me,re)},te=>{te&&te.type==="force_logout"&&ye(!0)});ae.current=Q}catch{}},children:""})]})]})})]}),ie&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/30"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm",children:[n.jsx("div",{className:"px-6 py-5 text-center font-bold text-red-600",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsx("div",{className:"flex",children:n.jsx("button",{className:"flex-1 py-3 text-primary-600 font-bold active:opacity-70",onClick:async()=>{try{const m=localStorage.getItem("user_refresh_token")||"";if(m&&!(await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:m})})).ok)try{await fetch("/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:m})})}catch{}}catch{}try{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token")}catch{}ye(!1);try{window.location.reload()}catch{}},children:""})})]})})]}),n.jsx("input",{type:"file",accept:"image/*",ref:Xe,className:"hidden",onChange:m=>{var g;const p=(g=m.target.files)==null?void 0:g[0];if(p){const V=new FileReader;V.onload=F=>{var O;const H=(O=F.target)==null?void 0:O.result;Ye(H);try{localStorage.setItem(Ee,H)}catch{}A(H)},V.readAsDataURL(p)}try{m.currentTarget.value=""}catch{}}})]})})},ao=u.createContext({showToast:()=>{},showCenter:()=>{}}),vi=({children:e})=>{const[t,s]=u.useState([]),r=u.useRef(new Map),i=(a,c)=>{const d=r.current.get(a);d&&clearTimeout(d);const h=window.setTimeout(()=>{s(f=>f.filter(x=>x.id!==a)),r.current.delete(a)},c);r.current.set(a,h)},l=(a,c="info")=>{const d=Date.now(),h=2e3;s(f=>[...f,{id:d,text:a,type:c,position:"bottom",duration:h}]),i(d,h)},o=(a,c="info")=>{s(h=>{const f=h.find(v=>v.position==="center"&&v.text===a);if(f)return i(f.id,3e3),h;const x=Date.now();return i(x,2e3),[...h,{id:x,text:a,type:c,position:"center",duration:2e3}]})};return n.jsxs(ao.Provider,{value:{showToast:l,showCenter:o},children:[e,n.jsx("div",{className:"fixed bottom-6 left-0 right-0 z-[100] flex justify-center pointer-events-none",children:n.jsx("div",{className:"space-y-2",children:t.filter(a=>a.position==="bottom").map(a=>n.jsx("div",{className:`${a.type==="role"?"bg-white text-pink-600 border border-pink-200 shadow-md":a.type==="error"?"bg-red-500 text-white":a.type==="success"?"bg-green-500 text-white":"bg-slate-800 text-white"} px-4 py-2 rounded-2xl shadow-lg inline-block`,children:a.text},a.id))})}),n.jsx("div",{className:"fixed top-[25%] left-1/2 -translate-x-1/2 z-[100] pointer-events-none",children:n.jsx("div",{className:"space-y-2 flex flex-col items-center",children:t.filter(a=>a.position==="center").map(a=>n.jsx("div",{className:`${a.type==="error"?"bg-white text-red-500 border-red-200":"bg-white text-slate-800 border-slate-200"} px-6 py-3 rounded-2xl shadow-2xl border whitespace-nowrap`,children:a.text},a.id))})}),n.jsx("style",{children:`
        @keyframes toastFade {
          0% { opacity: 0; transform: translateY(-6px); }
          10% { opacity: 1; transform: translateY(0); }
          90% { opacity: 1; transform: translateY(0); }
          100% { opacity: 0; transform: translateY(-6px); }
        }
      `})]})},oo=()=>u.useContext(ao),Ih=({character:e,onBack:t,onStartChat:s,isFromChat:r=!1,isExistingChat:i=!1})=>{var v;const[l,o]=u.useState(!1),{showToast:a,showCenter:c}=oo(),[d,h]=u.useState(!1);u.useEffect(()=>{try{const _=localStorage.getItem("user_id")||"0",N=localStorage.getItem("user_username")||_,E=localStorage.getItem("user_nickname")||"";st({userId:N,pageId:"CHAR_DETAIL",name:E}),ke("",""),ke("ID",String((e==null?void 0:e.id)??"")),ke("",(e==null?void 0:e.name)??"")}catch{}},[e]);const f=l?e.tags:e.tags.slice(0,4),x=e.tags.length>4;return n.jsx(et.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0&&r?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0&&r?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0&&r?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[n.jsx("button",{onClick:t,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(Yt,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[n.jsxs("div",{className:"relative w-full h-[55vh]",children:[!d&&(e.profileImage||e.avatar)?n.jsx("img",{src:e.profileImage||e.avatar,alt:e.name,className:"w-full h-full object-cover",onError:()=>h(!0)}):n.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:n.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((v=e.name)==null?void 0:v[0])||"?"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),n.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:e.name}),n.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[n.jsx("span",{className:"text-green-400",children:""})," ",e.character_type||e.roleType||""]})]}),n.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[n.jsx("span",{children:e.profession}),n.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),n.jsx("span",{children:e.age})]}),n.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",e.creator]})]})]}),n.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:f.map((_,N)=>n.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",_]},N))}),x&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>o(!l),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[l?"":""," ",l?n.jsx(mn,{size:14}):n.jsx(Xt,{size:14})]})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsxs("div",{className:"relative pl-4 py-1",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),n.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["",e.oneLinePersona,""]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:e.personality})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{children:n.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[n.jsx(ki,{size:12,fill:"currentColor"})," ",e.currentRelationship]})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:""}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),n.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:e.plotTheme})]}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:e.plotDescription}),e.openingLine&&n.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[n.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:""}),n.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),n.jsx("span",{className:"text-slate-700 font-bold text-sm",children:e.openingLine})]})]})]})]}),n.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:n.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:n.jsx("button",{onClick:()=>{if(r){s();return}if(i){c("");return}s()},className:"w-full font-bold text-lg py-4 rounded-2xl shadow-lg active:scale-[0.98] transition-all flex items-center justify-center gap-2 bg-purple-200 text-purple-900 shadow-purple-100",children:r?n.jsxs(n.Fragment,{children:[n.jsx(pn,{size:20}),""]}):""})})})]})})},Mh=async()=>{const{authFetch:e}=await ve(async()=>{const{authFetch:r}=await import("./http-De6Ej-g0.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),t=await e("/user-characters");if(!t.ok)throw new Error("failed");const s=await t.json();return Array.isArray(s.items)?s.items:[]},Mt=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:r}=await import("./http-De6Ej-g0.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/user-characters/${e}`);if(!s.ok)throw new Error("failed");return await s.json()},Rh=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:i}=await import("./http-De6Ej-g0.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),s=await t("/user-characters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("create_character_failed");return(await s.json()).id},Dh=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:i}=await import("./http-De6Ej-g0.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),s=await t("/user-characters/draft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("create_draft_failed");return(await s.json()).id},Lh=async(e,t)=>{const{authFetch:s}=await ve(async()=>{const{authFetch:i}=await import("./http-De6Ej-g0.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await s(`/user-characters/${e}/draft`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("update_draft_failed");return!0},Vh=async(e,t)=>{const{authFetch:s}=await ve(async()=>{const{authFetch:i}=await import("./http-De6Ej-g0.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await s(`/user-characters/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("update_failed");return!0},Fh=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:r}=await import("./http-De6Ej-g0.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user-characters/${e}`,{method:"DELETE"})).ok)throw new Error("delete_failed");return!0},bi=({character:e,createdId:t,onBack:s,onStartChat:r})=>{var E;const[i,l]=u.useState(!1),[o,a]=u.useState(!0),[c,d]=u.useState(e),[h,f]=u.useState(!1),[x,v]=u.useState(!1);u.useEffect(()=>{try{const S=localStorage.getItem("user_id")||"0",I=localStorage.getItem("user_username")||S,T=localStorage.getItem("user_nickname")||"";st({userId:I,pageId:"CHAR_AWAIT",name:T}),ke("","()"),ke("ID",String(t)),ke("",(c==null?void 0:c.name)||"")}catch{}},[t,c==null?void 0:c.name]),u.useEffect(()=>{let S=!0,I;const T=async()=>{try{const b=await Mt(t);if(!S)return;const w=typeof(b==null?void 0:b.status)=="string"?b.status.trim():"",D=!!(b!=null&&b.hasSystemPrompt);if(w==="draft"){f(!0),a(!1),I&&clearInterval(I);return}if(w==="publishing"||!D){f(!1),a(!1);return}if(b&&(w==="published"||D)){a(!0),f(!1),d(P=>({...P,id:String(b.id||P.id),name:b.name||P.name,avatar:b.avatar||P.avatar,profileImage:P.profileImage,character_type:String(b.character_type||P.character_type||""),oneLinePersona:b.tagline||P.oneLinePersona,personality:b.personality||P.personality,profession:String(b.occupation||P.profession||""),age:String(b.age||P.age||""),currentRelationship:String(b.relationship||P.currentRelationship||""),plotTheme:String(b.plot_theme||P.plotTheme||""),plotDescription:String(b.plot_summary||P.plotDescription||""),openingLine:String(b.opening_line||P.openingLine||"")})),I&&clearInterval(I);return}}catch{}};return(async()=>{try{const b=await Mt(t);if(!S)return;if(b){d(P=>({...P,id:String(b.id||P.id),name:b.name||P.name,avatar:b.avatar||P.avatar,character_type:String(b.character_type||P.character_type||""),oneLinePersona:b.tagline||P.oneLinePersona,personality:b.personality||P.personality,profession:String(b.occupation||P.profession||""),age:String(b.age||P.age||""),currentRelationship:String(b.relationship||P.currentRelationship||""),plotTheme:String(b.plot_theme||P.plotTheme||""),plotDescription:String(b.plot_summary||P.plotDescription||""),openingLine:String(b.opening_line||P.openingLine||"")}));const w=!!b.hasSystemPrompt,D=typeof b.status=="string"?b.status.trim():"";if(D==="draft"){f(!0),a(!1);return}if(D==="publishing"){f(!1),a(!1),I=setInterval(T,3e3),T();return}if(!w){f(!1),a(!1),I=setInterval(T,3e3),T();return}f(!1),a(!0);return}f(!1),a(!0)}catch{f(!1),a(!0)}})(),()=>{S=!1,clearInterval(I)}},[t]);const _=i?c.tags:c.tags.slice(0,4),N=c.tags.length>4;return n.jsx(et.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[n.jsx("button",{onClick:s,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(Yt,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[n.jsxs("div",{className:"relative w-full h-[55vh]",children:[!x&&(c.profileImage||c.avatar)?n.jsx("img",{src:c.profileImage||c.avatar,alt:c.name,className:"w-full h-full object-cover",onError:()=>v(!0)}):n.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:n.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((E=c.name)==null?void 0:E[0])||"?"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),n.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:c.name}),n.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[n.jsx("span",{className:"text-green-400",children:""})," ",c.character_type||c.roleType||""]})]}),n.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[n.jsx("span",{children:c.profession}),n.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),n.jsx("span",{children:c.age})]}),n.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",c.creator]})]})]}),n.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:_.map((S,I)=>n.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",S]},I))}),N&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>l(!i),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[i?"":""," ",i?n.jsx(mn,{size:14}):n.jsx(Xt,{size:14})]})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsxs("div",{className:"relative pl-4 py-1",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),n.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["",c.oneLinePersona,""]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:c.personality})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{children:n.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[n.jsx(ki,{size:12,fill:"currentColor"})," ",c.currentRelationship]})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:""}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),n.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:c.plotTheme})]}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:c.plotDescription}),c.openingLine&&n.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[n.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:""}),n.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),n.jsx("span",{className:"text-slate-700 font-bold text-sm",children:c.openingLine})]})]})]})]}),n.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:n.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:n.jsx("button",{disabled:!o||h,onClick:()=>r(c),className:`w-full font-bold text-lg py-4 rounded-2xl shadow-lg transition-all flex items-center justify-center gap-2 ${o&&!h?"bg-purple-200 text-purple-900 shadow-purple-100 active:scale-[0.98]":"bg-slate-200 text-slate-500 cursor-not-allowed"}`,children:o&&!h?n.jsxs(n.Fragment,{children:[n.jsx(pn,{size:20}),""]}):h?"":""})})})]})})},Oh="ai_chat_drafts",pt="story_drafts",$h=1,Qn=()=>new Promise((e,t)=>{const s=indexedDB.open(Oh,$h);s.onerror=()=>t(s.error),s.onsuccess=()=>e(s.result),s.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains(pt)||i.createObjectStore(pt)}}),lo=async(e,t)=>{try{(await Qn()).transaction(pt,"readwrite").objectStore(pt).put(t,e)}catch(s){console.error("Failed to save draft",s)}},co=async e=>{try{const t=await Qn();return new Promise((s,r)=>{const o=t.transaction(pt,"readonly").objectStore(pt).get(e);o.onsuccess=()=>s(o.result),o.onerror=()=>r(o.error)})}catch{return null}},ps=async e=>{try{(await Qn()).transaction(pt,"readwrite").objectStore(pt).delete(e)}catch(t){console.error("Failed to clear draft",t)}},zh=({onBack:e,onCreate:t,isEdit:s=!1,characterId:r,initial:i,onUpdated:l,onSaveDraft:o})=>{const[a,c]=u.useState({type:"",avatar:"",profileImage:"",name:"",gender:"",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0}),[d,h]=u.useState(!1),[f,x]=u.useState(!0),[v,_]=u.useState(!1),[N,E]=u.useState(""),[S,I]=u.useState(!1),[T,B]=u.useState({}),[b,w]=u.useState(!1),[D,P]=u.useState(null),[q,U]=u.useState(!1),Y=u.useRef(null),ce=j=>{var Ce;const $=j.split(","),R=((Ce=$[0].match(/:(.*?);/))==null?void 0:Ce[1])||"image/jpeg",le=atob($[1]);let ie=le.length;const ye=new Uint8Array(ie);for(;ie--;)ye[ie]=le.charCodeAt(ie);return new Blob([ye],{type:R})};u.useEffect(()=>{try{const j=localStorage.getItem("user_id")||"0",$=localStorage.getItem("user_username")||j,R=localStorage.getItem("user_nickname")||"";st({userId:$,pageId:"CREATE_CHAR",name:R}),ke("",s?"":""),r!=null&&ke("ID",String(r))}catch{}},[s,r]),u.useEffect(()=>{i&&c(j=>({...j,type:i.roleType||j.type,avatar:i.avatar||j.avatar,profileImage:i.profileImage||j.profileImage,name:i.name||j.name,gender:i.gender||j.gender,age:i.age||j.age,profession:i.profession||j.profession,tagline:i.oneLinePersona||j.tagline,personality:i.personality||j.personality,relationship:i.currentRelationship||j.relationship,plotTheme:i.plotTheme||j.plotTheme,plotSummary:i.plotDescription||j.plotSummary,openingLine:i.openingLine||j.openingLine,styleExamples:Array.isArray(i.styleExamples)&&i.styleExamples.length?i.styleExamples:j.styleExamples,hobbies:i.hobbies||j.hobbies,experiences:i.experiences||j.experiences,searchTags:Array.isArray(i.tags)?i.tags:j.searchTags,isPublic:typeof i.isPublic=="boolean"?i.isPublic:j.isPublic}))},[i,s]),u.useEffect(()=>{if(!s||!r)return;const j=!(i&&Array.isArray(i.tags)&&i.tags.length),$=!(i&&Array.isArray(i.styleExamples)&&i.styleExamples.length);!j&&!$||(async()=>{try{const R=await Mt(r),le=Array.isArray(R==null?void 0:R.styleExamples)?R.styleExamples.slice(0,3):[];for(;le.length<3;)le.push("");c(ie=>({...ie,name:(R==null?void 0:R.name)??ie.name,gender:(R==null?void 0:R.gender)??ie.gender,avatar:(R==null?void 0:R.avatar)??ie.avatar,tagline:(R==null?void 0:R.tagline)??ie.tagline,personality:(R==null?void 0:R.personality)??ie.personality,relationship:(R==null?void 0:R.relationship)??ie.relationship,plotTheme:(R==null?void 0:R.plot_theme)??ie.plotTheme,plotSummary:(R==null?void 0:R.plot_summary)??ie.plotSummary,openingLine:(R==null?void 0:R.opening_line)??ie.openingLine,hobbies:(R==null?void 0:R.hobbies)??ie.hobbies,experiences:(R==null?void 0:R.experiences)??ie.experiences,age:(R==null?void 0:R.age)!=null?String(R.age):ie.age,profession:(R==null?void 0:R.occupation)??ie.profession,searchTags:Array.isArray(R==null?void 0:R.tags)?R.tags:ie.searchTags,styleExamples:le,isPublic:R!=null&&R.visibility?R.visibility==="public":ie.isPublic}))}catch{}})()},[s,r,i]);const se=u.useRef(null);u.useEffect(()=>{if(!s)return se.current&&clearTimeout(se.current),se.current=setTimeout(()=>{const j=localStorage.getItem("user_id")||"guest";lo(`create_character_draft_${j}`,a)},300),()=>{se.current&&clearTimeout(se.current)}},[a,s]),u.useEffect(()=>{s||(async()=>{const j=localStorage.getItem("user_id")||"guest",$=await co(`create_character_draft_${j}`);$&&c(R=>({...R,...$}))})()},[s]);const k=["","",""],z=["","","","",""],G=["M/M","M/F","BL","BG","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],X=()=>{var j;(j=Y.current)==null||j.click()},oe=j=>{var R;const $=(R=j.target.files)==null?void 0:R[0];if($){U(!0);const le=new FileReader;le.onloadend=()=>{P(le.result),U(!1)},le.readAsDataURL($)}Y.current&&(Y.current.value="")},K=j=>{a.searchTags.includes(j)?c($=>({...$,searchTags:$.searchTags.filter(R=>R!==j)})):c($=>({...$,searchTags:[...$.searchTags,j]}))},ne=()=>{const j=N.trim();j&&!a.searchTags.includes(j)&&(c($=>({...$,searchTags:[...$.searchTags,j]})),E(""))},he=async j=>{if(j){try{const $=localStorage.getItem("user_access_token");let R=a.avatar||null;if(R&&R.startsWith("data:image")){const Ce=ce(R),Ie=new FormData,Fe=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;Ie.append("avatar",Ce,"avatar.jpg"),Ie.append("filename",Fe),R=`/uploads/users/avatars/${Fe}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:$?`Bearer ${$}`:""},body:Ie})}catch{}}const le={name:a.name||"",gender:a.gender,avatar:R,identity:null,tagline:a.tagline,personality:a.personality,relationship:a.relationship,plotTheme:a.plotTheme,plotSummary:a.plotSummary,openingLine:a.openingLine,hobbies:a.hobbies,experiences:a.experiences,age:a.age&&parseInt(a.age,10)||null,occupation:a.profession,character_type:a.type,visibility:a.isPublic?"public":"private",tags:a.searchTags,styleExamples:a.styleExamples.filter(Boolean)};let ie=null;s&&r?(await Lh(r,le),ie=typeof r=="number"?r:parseInt(String(r))||null):ie=await Dh(le);const ye={id:ie?String(ie):r?String(r):`c_${Date.now()}`,name:a.name||"",avatar:a.avatar||"",profileImage:a.profileImage||a.avatar||"",status:Ze.ONLINE,bio:a.tagline||"",tags:a.searchTags,creator:"",oneLinePersona:a.tagline,personality:a.personality,profession:a.profession,age:a.age,roleType:a.type,currentRelationship:a.relationship,plotTheme:a.plotTheme,plotDescription:a.plotSummary,openingLine:a.openingLine,styleExamples:a.styleExamples.filter(Boolean),hobbies:a.hobbies,experiences:a.experiences,isPublic:a.isPublic};o&&o(ye)}catch{}try{const $=localStorage.getItem("user_id")||"guest";localStorage.removeItem("create_character_draft"),ps(`create_character_draft_${$}`)}catch{}}else{const $=localStorage.getItem("user_id")||"guest";localStorage.removeItem("create_character_draft"),ps(`create_character_draft_${$}`),c({type:"",avatar:"",profileImage:"",name:"",gender:"",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0})}I(!1)},ue=()=>{const j={};return a.name.trim()||(j.name=!0),a.age.trim()||(j.age=!0),a.profession.trim()||(j.profession=!0),a.tagline.trim()||(j.tagline=!0),a.personality.trim()||(j.personality=!0),a.searchTags.length===0&&(j.searchTags=!0),a.relationship.trim()||(j.relationship=!0),a.plotTheme.trim()||(j.plotTheme=!0),a.plotSummary.trim()||(j.plotSummary=!0),a.openingLine.trim()||(j.openingLine=!0),B(j),Object.keys(j).length===0},xe=async()=>{if(!ue()){w(!0);return}let j=null;try{const R=localStorage.getItem("user_access_token");let le=a.avatar||null;if(le&&le.startsWith("data:image")){const ye=ce(le),Ce=new FormData,Ie=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;Ce.append("avatar",ye,"avatar.jpg"),Ce.append("filename",Ie),le=`/uploads/users/avatars/${Ie}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:R?`Bearer ${R}`:""},body:Ce})}catch{}}const ie={name:a.name,gender:a.gender,avatar:le,identity:null,tagline:a.tagline,personality:a.personality,relationship:a.relationship,plotTheme:a.plotTheme,plotSummary:a.plotSummary,openingLine:a.openingLine,hobbies:a.hobbies,experiences:a.experiences,age:a.age&&parseInt(a.age,10)||null,occupation:a.profession,character_type:a.type,visibility:a.isPublic?"public":"private",tags:a.searchTags,styleExamples:a.styleExamples.filter(Boolean)};s&&r?(await Vh(r,ie),j=typeof r=="number"?r:parseInt(String(r))||null):j=await Rh(ie)}catch{}const $={id:j?String(j):`c_${Date.now()}`,name:a.name,avatar:a.avatar||"https://image.pollinations.ai/prompt/anime%20silhouette%20purple?width=400&height=400&nologo=true",profileImage:a.profileImage||a.avatar,status:Ze.ONLINE,bio:`${a.age} ${a.profession}`,tags:a.searchTags,isPinned:!1,relationshipLevel:0,creator:"",playCount:"0",age:a.age||"",profession:a.profession||"",gender:a.gender,roleType:a.type,isOriginal:a.type==="",oneLinePersona:a.tagline,personality:a.personality,currentRelationship:a.relationship,plotTheme:a.plotTheme,plotDescription:a.plotSummary,openingLine:a.openingLine,styleExamples:a.styleExamples.filter(R=>R),hobbies:a.hobbies,experiences:a.experiences,isPublic:a.isPublic};if(localStorage.removeItem("create_character_draft"),!s){const R=localStorage.getItem("user_id")||"guest";ps(`create_character_draft_${R}`)}s&&l?l($):t($)},Re=j=>["","",""][j],ge="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return n.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-3xl shadow-2xl bg font-kosugi",children:[D&&n.jsx(Es,{imageSrc:D,aspectRatio:1,outputWidth:800,outputHeight:800,onCancel:()=>{P(null),Y.current&&(Y.current.value="")},onCrop:j=>{c($=>({...$,avatar:j,profileImage:D})),P(null)}}),n.jsx("div",{className:"ambient-bg hidden"}),n.jsxs("div",{className:"hidden",children:[n.jsx("div",{className:"star",style:{left:"10%",width:"4px",height:"4px"}}),n.jsx("div",{className:"star",style:{left:"80%",animationDelay:"2s",width:"6px",height:"6px"}})]}),n.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-3xl relative",children:[n.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:n.jsx(Ss,{size:20})}),n.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:s?"":""}),!s&&n.jsx("button",{onClick:()=>I(!0),className:"ml-auto text-sm font-bold text-purple-600 font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",children:[n.jsxs("section",{className:"mt-4",children:[n.jsx("div",{className:"text-[#2E1065] font-bold text-[0.9rem] mb-2 ml-1 font-kosugi",children:""}),n.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-1 mt-2",children:k.map(j=>n.jsx("button",{onClick:()=>c($=>({...$,type:j})),className:`
                                flex-shrink-0 px-5 py-2.5 rounded-2xl text-sm font-bold transition-all whitespace-nowrap tracking-wide font-kosugi
                                ${a.type===j?"bg-purple-500 text-white shadow-purple-200 shadow-md":"bg-white/70 text-slate-500 border-transparent"}
                            `,children:j},j))})]}),n.jsxs("section",{className:"flex flex-col items-center py-2",children:[n.jsxs("div",{onClick:X,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-24 h-24 rounded-full bg-white border-[3px] border-white shadow-xl flex items-center justify-center overflow-hidden relative",children:a.avatar?n.jsx("img",{src:a.avatar,className:"w-full h-full object-cover",alt:"avatar"}):n.jsx("div",{className:"text-purple-200 text-3xl",children:n.jsx(fn,{size:32})})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center border-[3px] border-white shadow-md",children:n.jsx(ht,{size:14})})]}),n.jsx("input",{type:"file",ref:Y,className:"hidden",accept:"image/*",onChange:oe}),n.jsx("p",{className:"mt-2 text-xs text-purple-400 font-bold tracking-wide font-kosugi",children:""})]}),q&&n.jsx("div",{className:"fixed inset-0 z-[90] bg-black flex items-center justify-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})}),n.jsxs("section",{className:"glass-card p-6 space-y-6",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:""}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ge} flex items-center gap-1`,children:["",T.name&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("div",{className:"relative",children:n.jsx("input",{value:a.name,onChange:j=>c($=>({...$,name:j.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold ${T.name?"border-red-300 bg-red-50":""}`})})]}),n.jsxs("div",{children:[n.jsx("label",{className:ge,children:""}),n.jsx("div",{className:"flex gap-3",children:["","",""].map(j=>n.jsx("button",{onClick:()=>c($=>({...$,gender:j})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition font-kosugi ${a.gender===j?j===""?"bg-blue-100 text-blue-600 ring-2 ring-blue-200":j===""?"bg-pink-100 text-pink-600 ring-2 ring-pink-200":"bg-purple-100 text-purple-600 ring-2 ring-purple-200":"bg-white/50 text-slate-400"}`,children:j},j))})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"w-full",children:[n.jsxs("label",{className:`${ge} flex items-center gap-1`,children:["",T.age&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.age,onChange:j=>c($=>({...$,age:j.target.value})),type:"text",placeholder:"28",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${T.age?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"w-full",children:[n.jsxs("label",{className:`${ge} flex items-center gap-1`,children:["",T.profession&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.profession,onChange:j=>c($=>({...$,profession:j.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${T.profession?"border-red-300 bg-red-50":""}`})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ge} flex items-center gap-1`,children:["",T.tagline&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:a.tagline,onChange:j=>c($=>({...$,tagline:j.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm ${T.tagline?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ge} flex items-center gap-1`,children:["",T.personality&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("textarea",{value:a.personality,onChange:j=>c($=>({...$,personality:j.target.value})),rows:3,placeholder:"...",className:`dream-input w-full px-4 py-3 text-sm resize-none ${T.personality?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ge} flex items-center gap-1`,children:["",T.searchTags&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsxs("div",{onClick:()=>_(!0),className:`dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition ${T.searchTags?"border-red-300 bg-red-50":""}`,children:[a.searchTags.length===0&&n.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:" (# #...)"}),a.searchTags.map(j=>n.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",j,n.jsx(Nt,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:$=>{$.stopPropagation(),K(j)}})]},j)),n.jsx(wt,{className:"ml-auto text-purple-300",size:16})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${ge} flex items-center gap-1`,children:["",T.relationship&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[n.jsx("button",{onClick:()=>{h(!0),c(j=>({...j,relationship:""}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${d?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:""}),z.map(j=>n.jsx("button",{onClick:()=>{h(!1),c($=>({...$,relationship:j}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${a.relationship===j&&!d?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:j},j))]}),d&&n.jsx("div",{className:"relative animate-in fade-in",children:n.jsx("input",{value:a.relationship,onChange:j=>c($=>({...$,relationship:j.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-2 text-sm ${T.relationship?"border-red-300 bg-red-50":""}`})})]})]}),n.jsxs("section",{className:"glass-card p-6 space-y-5",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-4",children:""}),n.jsxs("p",{className:"text-xs text-slate-500 leading-relaxed bg-purple-50/50 p-3 rounded-xl border border-purple-100 flex gap-1",children:[n.jsx(Ti,{size:14,className:"text-purple-400 mt-0.5 flex-shrink-0"}),n.jsx("span",{children:""})]}),n.jsxs("div",{className:"bg-white/40 p-4 rounded-3xl border border-purple-100/50 space-y-4",children:[n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",T.plotTheme&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("input",{value:a.plotTheme,onChange:j=>c($=>({...$,plotTheme:j.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 ${T.plotTheme?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",T.plotSummary&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:a.plotSummary,onChange:j=>c($=>({...$,plotSummary:j.target.value})),rows:5,placeholder:"......",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none leading-relaxed ${T.plotSummary?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",T.openingLine&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:a.openingLine,onChange:j=>c($=>({...$,openingLine:j.target.value})),rows:2,placeholder:"",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none ${T.openingLine?"border-red-300 bg-red-50":""}`})]})]})]}),n.jsxs("section",{className:"glass-card p-0 overflow-hidden transition-all",children:[n.jsxs("button",{onClick:()=>x(!f),className:"w-full flex items-center justify-between p-6 bg-transparent transition",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:""}),n.jsx("span",{className:"text-[10px] bg-purple-100 text-purple-500 px-1.5 py-0.5 rounded font-bold border border-purple-200 self-center font-kosugi",children:""})]}),f?n.jsx(mn,{className:"text-purple-400"}):n.jsx(Xt,{className:"text-purple-400"})]}),f&&n.jsxs("div",{className:"p-6 pt-0 space-y-5 animate-in slide-in-from-top-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:ge,children:""}),n.jsx("div",{className:"space-y-3",children:[0,1,2].map(j=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs font-bold text-purple-300 w-4 font-mono",children:["0",j+1]}),n.jsx("input",{value:a.styleExamples[j],onChange:$=>{const R=[...a.styleExamples];R[j]=$.target.value,c(le=>({...le,styleExamples:R}))},type:"text",placeholder:Re(j),className:"dream-input flex-1 px-3 py-2.5 rounded-xl text-sm"})]},j))})]}),n.jsxs("div",{children:[n.jsx("label",{className:ge,children:""}),n.jsx("textarea",{value:a.hobbies,onChange:j=>c($=>({...$,hobbies:j.target.value})),rows:2,placeholder:"...",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:ge,children:""}),n.jsx("textarea",{value:a.experiences,onChange:j=>c($=>({...$,experiences:j.target.value})),rows:2,placeholder:"",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),n.jsxs("div",{className:"pt-2 border-t border-purple-100",children:[n.jsx("label",{className:`${ge} mb-1`,children:""}),n.jsx("p",{className:"text-[10px] text-slate-500 leading-tight mb-3",children:""}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:()=>c(j=>({...j,isPublic:!0})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${a.isPublic?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:[n.jsx(_o,{size:14})," "]}),n.jsxs("button",{onClick:()=>c(j=>({...j,isPublic:!1})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${a.isPublic?"bg-white text-slate-500 border border-purple-100":"bg-purple-500 text-white shadow-md"}`,children:[n.jsx(Mo,{size:14})," "]})]})]})]})]})]}),n.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-b-3xl shadow-2xl",children:n.jsx("button",{onClick:xe,className:"w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition-transform flex items-center justify-center tracking-widest text-lg font-kosugi",children:s?"":""})}),v&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>_(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 w-full bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[80vh] animate-in slide-in-from-bottom duration-300",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[n.jsx("button",{onClick:()=>_(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:n.jsx(Xt,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:" #"}),n.jsx("button",{onClick:()=>_(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:""}),n.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[a.searchTags.length===0&&n.jsx("span",{className:"text-xs text-slate-400 self-center",children:""}),a.searchTags.map(j=>n.jsxs("button",{onClick:()=>K(j),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1 font-kosugi",children:["#",j," ",n.jsx(Nt,{size:10,className:"opacity-80"})]},j))]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:" ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:N,onChange:j=>E(j.target.value),onKeyDown:j=>j.key==="Enter"&&ne(),type:"text",placeholder:"#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),n.jsx("button",{onClick:ne,className:"bg-gradient-to-r from-purple-400 to-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition font-kosugi",children:""})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:""}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:G.map(j=>n.jsxs("button",{onClick:()=>K(j),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis font-kosugi
                                            ${a.searchTags.includes(j)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",j]},j))})]})]})]})]}),S&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-4 font-kosugi",children:s?"":""}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>he(!1),className:"flex-1 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors font-kosugi",children:s?"":""}),n.jsx("button",{onClick:()=>he(!0),className:"flex-1 py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:s?"":""})]})]})}),b&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:n.jsx(Ks,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:""}),n.jsx("button",{onClick:()=>w(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:""})]})})]})})},Ns=({src:e,alt:t,className:s,root:r,placeholderChar:i})=>{const l=u.useRef(null),[o,a]=u.useState(""),[c,d]=u.useState(!1);return u.useEffect(()=>{if(!l.current||!e)return;const h=new IntersectionObserver(f=>{if(f.some(x=>x.isIntersecting)){a(e||"");try{h.disconnect()}catch{}}},{root:r||void 0,rootMargin:"0px 0px 240px 0px",threshold:0});return h.observe(l.current),()=>{try{h.disconnect()}catch{}}},[e,r]),n.jsx("div",{ref:l,className:s,children:!c&&o?n.jsx("img",{src:o,alt:t,decoding:"async",loading:"lazy",className:"w-full h-full object-cover",onError:()=>d(!0)}):i?n.jsx("span",{className:"text-2xl font-bold text-slate-500",children:i}):null})},Bh=({onBack:e,onPublish:t,onSaveDraft:s,availableCharacters:r,myUserCharacters:i=[],initialStory:l,importableRoles:o=[]})=>{const{showCenter:a}=oo(),[c,d]=u.useState(()=>l?{title:l.title,description:l.description,image:l.image,content:l.content,tags:l.tags,roles:l.availableRoles||[]}:{title:"",description:"",image:"",content:"",tags:[],roles:[]}),[h,f]=u.useState(!1),[x,v]=u.useState(!1),[_,N]=u.useState(!1),[E,S]=u.useState({}),[I,T]=u.useState(""),[B,b]=u.useState(null),[w,D]=u.useState(!1),[P,q]=u.useState(!1),U=u.useRef(null),[Y,ce]=u.useState(o),se=u.useRef(!1);u.useEffect(()=>{try{const C=localStorage.getItem("user_id")||"0",W=localStorage.getItem("user_username")||C,J=localStorage.getItem("user_nickname")||"";st({userId:W,pageId:"CREATE_STORY",name:J}),ke("",l?"":"")}catch{}},[l]),u.useEffect(()=>{ce(o||[])},[o]),u.useEffect(()=>{se.current||Y&&Y.length||(se.current=!0,(async()=>{try{const{authFetch:C}=await ve(async()=>{const{authFetch:J}=await import("./http-De6Ej-g0.js");return{authFetch:J}},__vite__mapDeps([0,1,2,3])),W=await C("/stories/combine");if(W&&W.ok){const J=await W.json(),ae=Array.isArray(J==null?void 0:J.items)?J.items:[];ce(ae.map(fe=>({id:String(fe.character_id),name:fe.character_name,avatar:fe.character_avatar||"",desc:fe.desc||"",isPrivate:!!fe.isPrivate,isMine:!!fe.isMine})))}}catch{}})())},[]),fo.useMemo(()=>(Array.isArray(i)?i:[]).filter(W=>W.isPublished===!0&&W.isPublic===!1).map(W=>({id:String(W.id),name:W.name,avatar:W.avatar,desc:W.oneLinePersona||W.bio||"",isPrivate:!0,isMine:!0})),[i]);const k=u.useRef(!1);u.useEffect(()=>{if(k.current)return;const C=Array.isArray(l==null?void 0:l.characterIds)?l.characterIds:[];if(!C.length||!Y||!Y.length)return;const W=new Set(C.map(ae=>String(ae))),J=Y.filter(ae=>W.has(String(ae.id))).map(ae=>({name:ae.name,avatar:ae.avatar,description:ae.desc||""}));J.length&&(k.current=!0,d(ae=>({...ae,roles:J})))},[l,Y]),u.useEffect(()=>{if(!l)return;const C=l.availableRoles||[];C.length&&(d(W=>({...W,roles:C})),k.current=!0)},[l]),u.useEffect(()=>{l&&d(C=>({...C,title:l.title||C.title,description:l.description||C.description,image:l.image||C.image,content:l.content||C.content,tags:Array.isArray(l.tags)?l.tags:C.tags}))},[l]);const z=u.useRef(null);u.useEffect(()=>{if(!l)return z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{const C=localStorage.getItem("user_id")||"guest";lo(`create_story_draft_${C}`,c)},300),()=>{z.current&&clearTimeout(z.current)}},[c,l]),u.useEffect(()=>{l||(async()=>{const C=localStorage.getItem("user_id")||"guest",W=await co(`create_story_draft_${C}`);W&&d(J=>({...J,...W}))})()},[l]),u.useEffect(()=>{if(!P)return;const C=setTimeout(()=>q(!1),6e3);return()=>clearTimeout(C)},[P]),u.useEffect(()=>{if(!P)return;const C=W=>{const J=U.current;if(!J){q(!1);return}const ae=W.target;J.contains(ae)||q(!1)};return window.addEventListener("click",C,!0),()=>window.removeEventListener("click",C,!0)},[P]);const G=u.useRef(null),X=u.useRef(null),oe=u.useRef(null),K=C=>{var Ae;const W=C.split(","),J=((Ae=W[0].match(/:(.*?);/))==null?void 0:Ae[1])||"image/jpeg",ae=atob(W[1]);let fe=ae.length;const Se=new Uint8Array(fe);for(;fe--;)Se[fe]=ae.charCodeAt(fe);return new Blob([Se],{type:J})},ne=["BG","BL","GL","","","","","","","","","","","HE","BE","","","","",""],he=()=>{var C;(C=G.current)==null||C.click()},ue=C=>{var J;const W=(J=C.target.files)==null?void 0:J[0];if(W){D(!0);const ae=new FileReader;ae.onloadend=()=>{b(ae.result),D(!1)},ae.readAsDataURL(W)}G.current&&(G.current.value="")},xe=C=>{c.tags.includes(C)?d(W=>({...W,tags:W.tags.filter(J=>J!==C)})):d(W=>({...W,tags:[...W.tags,C]}))},Re=()=>{const C=I.trim();C&&!c.tags.includes(C)&&(d(W=>({...W,tags:[...W.tags,C]})),T(""))},ge=C=>{if(c.roles.some(J=>J.name===C.name))return;const W={name:C.name,avatar:C.avatar,description:C.oneLinePersona||C.bio||""};d(J=>({...J,roles:[...J.roles,W]})),v(!1)},j=C=>{d(W=>({...W,roles:W.roles.filter(J=>J.name!==C)}))},$=()=>{const C=c.roles.map(J=>J.name),W={};return o.forEach(J=>{W[J.name]=J.id}),C.map(J=>W[J]).filter(Boolean)},[R,le]=u.useState("none"),ie=async C=>{try{le(C==="published"?"publish":"draft");let W=c.image||"";try{const je=localStorage.getItem("user_access_token");if(c.image&&c.image.startsWith("data:image")){const Ue=K(c.image),Ee=new FormData,Ne=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;W=`/uploads/covers/${Ne}`,Ee.append("cover",Ue,"cover.jpg"),Ee.append("filename",Ne);const Ye=await fetch("/api/uploads/cover",{method:"POST",headers:{Authorization:je?`Bearer ${je}`:""},body:Ee});if(Ye&&Ye.ok){const Xe=await Ye.json();Xe&&Xe.url&&(W=Xe.url)}}}catch{}const J={title:c.title,description:c.description,image:W,status:C,content:c.content,tags:c.tags,characterIds:$()},{authFetch:ae}=await ve(async()=>{const{authFetch:je}=await import("./http-De6Ej-g0.js");return{authFetch:je}},__vite__mapDeps([0,1,2,3])),fe=!!l,Se=fe?`/user/stories/${l==null?void 0:l.id}`:"/user/stories",Be=await ae(Se,{method:fe?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(J)});if(Be&&Be.ok){let je;try{const Ee=await Be.json();je=Ee==null?void 0:Ee.id}catch{je=l==null?void 0:l.id}const Ue={id:typeof je=="number"?je:l?l.id:Date.now(),title:c.title,description:c.description,image:W||c.image,content:c.content,tags:c.tags,author:localStorage.getItem("user_nickname")||"",likes:"0",availableRoles:c.roles,status:C};if(C==="published"?t(Ue):s(Ue),!l){const Ee=localStorage.getItem("user_id")||"guest";ps(`create_story_draft_${Ee}`)}return}a("","error")}catch{a("","error")}finally{le("none")}},ye=async()=>{try{le("draft");let C=c.image||"";try{const fe=localStorage.getItem("user_access_token");if(c.image&&c.image.startsWith("data:image")){const Se=K(c.image),Ae=new FormData,Be=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;C=`/uploads/covers/${Be}`,Ae.append("cover",Se,"cover.jpg"),Ae.append("filename",Be);const je=await fetch("/api/uploads/cover",{method:"POST",headers:{Authorization:fe?`Bearer ${fe}`:""},body:Ae});if(je&&je.ok){const Ue=await je.json();Ue&&Ue.url&&(C=Ue.url)}}}catch{}const W={title:c.title,description:c.description,image:C,content:c.content,tags:c.tags,characterIds:$()},{authFetch:J}=await ve(async()=>{const{authFetch:fe}=await import("./http-De6Ej-g0.js");return{authFetch:fe}},__vite__mapDeps([0,1,2,3])),ae=await J(`/user/stories/${l==null?void 0:l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)});if(ae&&ae.ok){const fe={id:typeof(l==null?void 0:l.id)=="number"?l.id:Date.now(),title:c.title,description:c.description,image:C||c.image,content:c.content,tags:c.tags,author:localStorage.getItem("user_nickname")||"",likes:"0",availableRoles:c.roles,status:l==null?void 0:l.status};s(fe);return}a("","error")}catch{a("","error")}finally{le("none")}},Ce=()=>{const C={};return c.title.trim()||(C.title=!0),c.content.trim()||(C.content=!0),S(C),Object.keys(C).length===0},Ie=()=>{if(!Ce()){N(!0);return}ie("published")},Fe=()=>{if(!Ce()){N(!0);return}if(l){ye();return}ie("draft")},Me="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return n.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-none md:rounded-3xl shadow-2xl bg font-kosugi",children:[B&&n.jsx(Es,{imageSrc:B,aspectRatio:2,outputWidth:800,outputHeight:400,onCancel:()=>{b(null),G.current&&(G.current.value="")},onCrop:C=>{d(W=>({...W,image:C})),b(null)}}),n.jsx("div",{className:"ambient-bg hidden"}),n.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-none md:rounded-t-3xl relative",children:[l&&n.jsx("button",{onClick:Fe,disabled:R!=="none",className:`absolute right-4 text-sm font-bold font-kosugi ${R!=="none"?"text-slate-400 cursor-not-allowed":"text-purple-600"}`,children:""}),n.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:n.jsx(Ss,{size:20})}),n.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:l?"":""}),!l&&n.jsx("button",{onClick:Fe,disabled:R!=="none",className:`ml-auto text-sm font-bold font-kosugi ${R!=="none"?"text-slate-400 cursor-not-allowed":"text-purple-600"}`,children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",ref:X,children:[n.jsxs("section",{className:"flex flex-col items-center py-2",children:[n.jsxs("div",{onClick:he,className:"relative group cursor-pointer active:scale-95 transition-transform w-full h-40 rounded-3xl overflow-hidden shadow-lg border-4 border-white bg-white/50",children:[c.image?n.jsx("img",{src:c.image,className:"w-full h-full object-cover",alt:"cover"}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-purple-300",children:[n.jsx(fn,{size:32}),n.jsx("span",{className:"text-xs font-bold mt-2",children:""})]}),n.jsx("div",{className:"absolute bottom-2 right-2 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-md",children:n.jsx(ht,{size:14})})]}),n.jsx("input",{type:"file",ref:G,className:"hidden",accept:"image/*",onChange:ue})]}),w&&n.jsx("div",{className:"fixed inset-0 z-[90] bg-black flex items-center justify-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})}),n.jsxs("section",{className:"glass-card p-6 space-y-4",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:""}),n.jsxs("div",{children:[n.jsxs("label",{className:`${Me} flex items-center gap-1`,children:["",E.title&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:c.title,onChange:C=>d(W=>({...W,title:C.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold ${E.title?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsx("label",{className:Me,children:""}),n.jsx("input",{value:c.description,onChange:C=>d(W=>({...W,description:C.target.value})),type:"text",placeholder:"",className:"dream-input w-full px-4 py-3 text-sm"})]}),n.jsxs("div",{children:[n.jsx("label",{className:Me,children:""}),n.jsxs("div",{onClick:()=>f(!0),className:"dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition",children:[c.tags.length===0&&n.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:""}),c.tags.map(C=>n.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",C,n.jsx(Nt,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:W=>{W.stopPropagation(),xe(C)}})]},C)),n.jsx(wt,{className:"ml-auto text-purple-300",size:16})]})]})]}),n.jsxs("section",{className:"glass-card p-6 space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2 relative",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:""}),n.jsx("button",{onClick:()=>q(!0),className:"w-5 h-5 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center border border-purple-100",children:n.jsx(Ks,{size:12})})]}),n.jsx("button",{onClick:()=>v(!0),className:"text-xs bg-purple-100 text-purple-600 px-3 py-1.5 rounded-full font-bold hover:bg-purple-200 transition",children:"+ "}),P&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[60]",onClick:()=>q(!1)}),n.jsxs("div",{ref:U,className:"absolute left-0 top-8 z-[61] bg-white rounded-2xl shadow-xl border border-slate-100 p-3 w-[88%]",children:[n.jsx("div",{className:"text-xs text-slate-700 font-kosugi",children:""}),n.jsx("div",{className:"text-[10px] text-slate-400 mt-1 font-kosugi",children:""})]})]})]}),c.roles.length===0?n.jsx("div",{className:"text-center py-6 text-slate-400 text-xs border border-dashed border-purple-200 rounded-xl",children:""}):n.jsx("div",{className:"flex flex-col divide-y divide-slate-200",children:c.roles.map(C=>n.jsxs("div",{className:"flex items-center gap-3 bg/60 py-3",children:[n.jsx(Ns,{src:C.avatar,alt:C.name,root:X.current,placeholderChar:(C.name||"?")[0],className:"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-700 text-sm",children:C.name}),n.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:C.description})]}),n.jsx("button",{onClick:()=>j(C.name),className:"text-slate-400 hover:text-red-400 p-2",children:n.jsx(hn,{size:16})})]},C.name))})]}),n.jsxs("section",{className:"glass-card p-6 h-auto min-h-[300px] flex flex-col",children:[n.jsxs("div",{className:"section-title !font-kosugi !text-purple-900 mb-4 flex items-center gap-1",children:["",E.content&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:c.content,onChange:C=>d(W=>({...W,content:C.target.value})),placeholder:"...",className:`flex-1 w-full bg-transparent border-none outline-none resize-none text-slate-700 leading-relaxed text-base min-h-[200px] placeholder:text-slate-300 ${E.content?"border-red-300 bg-red-50":""}`})]})]}),n.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-none md:rounded-b-3xl shadow-2xl",children:n.jsxs("button",{onClick:Ie,disabled:R!=="none",className:`w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition flex items-center justify-center gap-2 ${R!=="none"?"opacity-70 cursor-not-allowed":""}`,children:[n.jsx(Si,{size:18})," ",R==="publish"?"...":""]})}),h&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>f(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[70vh] animate-in slide-in-from-bottom duration-300",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[n.jsx("button",{onClick:()=>f(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:n.jsx(Xt,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:""}),n.jsx("button",{onClick:()=>f(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[c.tags.length===0&&n.jsx("span",{className:"text-xs text-slate-400 self-center",children:""}),c.tags.map(C=>n.jsxs("button",{onClick:()=>xe(C),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1",children:["#",C," ",n.jsx(Nt,{size:10,className:"opacity-80"})]},C))]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:I,onChange:C=>T(C.target.value),onKeyDown:C=>C.key==="Enter"&&Re(),type:"text",placeholder:"",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),n.jsx("button",{onClick:Re,className:"bg-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition",children:""})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:ne.map(C=>n.jsxs("button",{onClick:()=>xe(C),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis
                                            ${c.tags.includes(C)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",C]},C))})]})]})]})]}),x&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>v(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-[30px] overflow-hidden z-[62] flex flex-col h-[70vh] animate-in slide-in-from-bottom duration-300 shadow-[0_-10px_40px_rgba(0,0,0,0.1)]",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50",children:[n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:""}),n.jsx("button",{onClick:()=>v(!1),className:"p-2 bg-slate-100 rounded-full",children:n.jsx(Nt,{size:16})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",ref:oe,children:(Y||[]).filter(C=>!c.roles.some(W=>W.name===C.name)).sort((C,W)=>{const J=Se=>Se.isPrivate&&Se.isMine?0:!Se.isPrivate&&Se.isMine?1:2,ae=J(C),fe=J(W);return ae===fe?0:ae<fe?-1:1}).map(C=>n.jsxs("div",{onClick:()=>ge({name:C.name,avatar:C.avatar,oneLinePersona:C.desc,bio:C.desc}),className:"flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-2xl shadow-sm active:scale-[0.98] transition cursor-pointer hover:border-purple-200",children:[n.jsx(Ns,{src:C.avatar,alt:C.name,root:oe.current,placeholderChar:(C.name||"?")[0],className:"w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-800",children:C.name}),n.jsx("div",{className:"text-xs text-slate-400 truncate w-48",children:C.desc})]}),C.isMine&&C.isPrivate&&n.jsx("span",{className:"text-pink-500 text-[10px] font-bold mr-2",children:""}),n.jsx("div",{className:"ml-auto bg-purple-50 text-purple-600 p-2 rounded-full",children:n.jsx(ht,{size:16})})]},`imp_${C.id||C.name}`))})]})]}),_&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:n.jsx(Ks,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:""}),n.jsx("button",{onClick:()=>N(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:""})]})})]})})},Uh=({onLogin:e})=>{const[t,s]=u.useState(""),[r,i]=u.useState(""),[l,o]=u.useState(!1),[a,c]=u.useState(!1),[d,h]=u.useState(null),[f,x]=u.useState({height:"100%",top:0}),v=u.useRef(null),_=u.useRef(null),N=u.useRef(null);u.useEffect(()=>{const S=()=>{window.visualViewport&&x({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`})};return window.visualViewport&&(window.visualViewport.addEventListener("resize",S),window.visualViewport.addEventListener("scroll",S),S()),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",S),window.visualViewport.removeEventListener("scroll",S))}},[]),u.useEffect(()=>{try{const S=localStorage.getItem("user_id")||"0",I=localStorage.getItem("user_username")||S,T=localStorage.getItem("user_nickname")||null;st({userId:I,pageId:"LOGIN",name:T}),ke("","")}catch{}},[]),u.useEffect(()=>{var S;try{(S=_.current)==null||S.focus()}catch{}},[]);const E=async S=>{if(S.preventDefault(),h(null),!t.trim()||!r.trim()){h("");return}c(!0);try{const I=await wh.login(t.trim(),r.trim());if(I&&I.ok&&I.data){const T=I.data;if(T!=null&&T.access_token)try{localStorage.setItem("user_access_token",T.access_token)}catch{}if(T!=null&&T.refresh_token)try{localStorage.setItem("user_refresh_token",T.refresh_token)}catch{}try{localStorage.setItem("user_username",t.trim())}catch{}e()}else{const T=I&&I.data?I.data:{};T&&T.exists===!1?h(""):T&&T.is_active===0?h(""):h("")}}catch{h("")}finally{c(!1)}};return n.jsx("div",{ref:v,className:"fixed left-0 w-full bg-primary-50 overflow-y-auto no-scrollbar scroll-smooth font-sans animate-in fade-in duration-700",style:{...f,overscrollBehavior:"none"},children:n.jsx("div",{className:"h-full w-full max-w-md mx-auto bg-white rounded-none md:rounded-3xl shadow-2xl border border-slate-200 overflow-hidden",children:n.jsx("div",{className:"min-h-full w-full flex flex-col px-8 py-10",children:n.jsxs("div",{className:"w-full flex flex-col items-center z-10 max-w-sm m-auto",children:[n.jsx("div",{className:"text-center mb-12",children:n.jsx("h1",{className:"text-[40px] font-extrabold text-[#A855F7] mb-0 tracking-tight font-sans",children:"YumeCrush"})}),n.jsxs("form",{onSubmit:E,className:"w-full space-y-5",children:[n.jsx("input",{type:"text",placeholder:"",value:t,onChange:S=>s(S.target.value),ref:_,className:"w-full h-[60px] px-6 rounded-2xl bg-white border border-[#F3F4F6] text-[#374151] placeholder:text-[#D1D5DB] outline-none focus:border-[#C084FC] focus:bg focus:ring-4 focus:ring-[#F3E8FF] transition-all text-[15px] font-medium shadow-sm"}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:l?"text":"password",placeholder:"",value:r,onChange:S=>i(S.target.value),ref:N,className:"w-full h-[60px] px-6 rounded-2xl bg border border-[#F3F4F6] text-[#374151] placeholder:text-[#D1D5DB] outline-none focus:border-[#C084FC] focus:bg focus:ring-4 focus:ring-[#F3E8FF] transition-all text-[15px] font-medium shadow-sm"}),n.jsx("button",{type:"button",onClick:()=>o(!l),className:"absolute right-5 top-1/2 -translate-y-1/2 text-[#9CA3AF] hover:text-[#C084FC] transition-colors",children:l?n.jsx(jo,{size:20}):n.jsx(So,{size:20})})]}),d&&n.jsx("div",{className:"text-red-500 text-xs font-bold",children:d}),n.jsx("button",{type:"submit",disabled:a,className:`w-full h-[60px] ${a?"bg-[#A855F7]/70":"bg-[#A855F7] hover:bg-[#9333EA]"} text-white font-bold text-[16px] rounded-2xl shadow-[0_10px_30px_rgba(168,85,247,0.3)] active:scale-[0.98] transition-all mt-4`,children:a?"...":""})]})]})})})})},Hh=e=>({id:typeof(e==null?void 0:e.mypage_id)=="number"?e.mypage_id:(e==null?void 0:e.id)??Date.now(),title:(e==null?void 0:e.mypage_title)??(e==null?void 0:e.title)??"",description:(e==null?void 0:e.mypage_description)??(e==null?void 0:e.description)??"",image:(e==null?void 0:e.mypage_image)??(e==null?void 0:e.image)??"",status:(e==null?void 0:e.mypage_status)??(e==null?void 0:e.status)??void 0,tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[]}),Wh=async e=>{const t=new URLSearchParams;e&&t.set("includeDrafts",String(e.includeDrafts));const{authFetch:s}=await ve(async()=>{const{authFetch:o}=await import("./http-De6Ej-g0.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),r=await s(`/user/stories?${t.toString()}`);if(!r.ok)throw new Error("failed");const i=await r.json();return(Array.isArray(i==null?void 0:i.items)?i.items:[]).map(Hh)},wi=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:i}=await import("./http-De6Ej-g0.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),s=await t(`/user/stories/${e}`);if(!s.ok)throw new Error("failed");const r=await s.json();return{id:(r==null?void 0:r.id)??e,title:(r==null?void 0:r.title)??"",description:(r==null?void 0:r.description)??"",image:(r==null?void 0:r.image)??"",user_avatar:(r==null?void 0:r.user_avatar)??"",status:(r==null?void 0:r.status)??void 0,content:(r==null?void 0:r.content)??"",publishDate:(r==null?void 0:r.publish_date)??void 0,tags:Array.isArray(r==null?void 0:r.tags)?r.tags:[],characterIds:Array.isArray(r==null?void 0:r.characterIds)?r.characterIds:[]}},Kh=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:r}=await import("./http-De6Ej-g0.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user/stories/${e}`,{method:"DELETE"})).ok)throw new Error("failed");return!0},Yh=({avatar:e,name:t})=>{const[s,r]=u.useState(!1);return n.jsx("div",{className:"w-14 h-14 rounded-full bg-slate-100 flex-shrink-0 overflow-hidden border border-slate-50 flex items-center justify-center",children:!s&&e?n.jsx("img",{src:e,className:"w-full h-full object-cover",alt:t,onError:()=>r(!0)}):n.jsx("span",{className:"text-base font-bold text-slate-500",children:(t==null?void 0:t[0])||"?"})})},Xh=({userProfile:e,myCharacters:t,myUserCharacters:s,myStories:r,onUpdateProfile:i,onCharacterClick:l,onLogout:o,onEditStory:a,onDeleteStory:c,onEditCharacter:d,onDeleteCharacter:h,onReadStory:f,onAddStory:x,onAddCharacter:v})=>{var dt;const[_,N]=u.useState(!1),[E,S]=u.useState(e.nickname),[I,T]=u.useState(!1),[B,b]=u.useState(null),[w,D]=u.useState(!1),[P,q]=u.useState(!1),U=(navigator==null?void 0:navigator.maxTouchPoints)>0,[Y,ce]=u.useState(r||[]),[se,k]=u.useState({}),[z,G]=u.useState(null),X=u.useRef(0),oe=u.useRef(0),K=u.useRef(null),ne=u.useRef(0),[he,ue]=u.useState(s||[]),[xe,Re]=u.useState({}),[ge,j]=u.useState(null),$=u.useRef(0),R=u.useRef(0),le=u.useRef(null),ie=u.useRef(0),[ye,Ce]=u.useState({visible:!1,x:0,y:0,id:null,type:null}),Ie=(A,L,Z)=>{if(A.preventDefault(),U)return;let de=A.clientX;const pe=140;de+pe>window.innerWidth&&(de=window.innerWidth-pe-10),Ce({visible:!0,x:de,y:A.clientY,id:L,type:Z})},Fe=u.useRef(null),Me=A=>{var _t;const L=A.split(","),Z=((_t=L[0].match(/:(.*?);/))==null?void 0:_t[1])||"image/jpeg",de=atob(L[1]);let pe=de.length;const He=new Uint8Array(pe);for(;pe--;)He[pe]=de.charCodeAt(pe);return new Blob([He],{type:Z})},C=()=>{var A;(A=Fe.current)==null||A.click()},W=A=>{var Z;const L=(Z=A.target.files)==null?void 0:Z[0];if(L){D(!0);const de=new FileReader;de.onloadend=()=>{b(de.result),D(!1)},de.readAsDataURL(L)}Fe.current&&(Fe.current.value="")},J=async()=>{const A=E.trim();if(!A){S(e.nickname),N(!1);return}try{const{authFetch:L}=await ve(async()=>{const{authFetch:Z}=await import("./http-De6Ej-g0.js");return{authFetch:Z}},__vite__mapDeps([0,1,2,3]));await L("/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:A})}),i({...e,nickname:A})}catch{S(e.nickname)}N(!1)};u.useEffect(()=>{ce(r||[])},[e.usedCount]),u.useEffect(()=>{ce(r||[])},[r]),u.useEffect(()=>{ue(s||[])},[s]);const ae=(A,L)=>{X.current=A.touches[0].clientX,oe.current=A.touches[0].clientY,K.current=L,ne.current=se[L]||0},fe=(A,L)=>{if(K.current!==L)return;const Z=A.touches[0].clientX-X.current,de=A.touches[0].clientY-oe.current;if(Math.abs(de)>Math.abs(Z))return;let pe=0;ne.current===0?pe=Math.max(-96,Math.min(96,Z)):ne.current>0?pe=Math.max(0,Math.min(96,ne.current+Z)):pe=Math.min(0,Math.max(-96,ne.current+Z)),k(He=>({...He,[L]:pe}))},Se=A=>{if(K.current!==A)return;const L=se[A]||0;let Z=0;ne.current===0?Z=L>60?96:L<-60?-96:0:ne.current>0?Z=L>60?96:0:Z=L<-60?-96:0,k(de=>({...de,[A]:Z})),K.current=null},Ae=A=>k(L=>({...L,[A]:0})),Be=(A,L)=>{$.current=A.touches[0].clientX,R.current=A.touches[0].clientY,le.current=L,ie.current=xe[L]||0},je=(A,L)=>{if(le.current!==L)return;const Z=A.touches[0].clientX-$.current,de=A.touches[0].clientY-R.current;if(Math.abs(de)>Math.abs(Z))return;let pe=0;ie.current===0?pe=Math.max(-96,Math.min(96,Z)):ie.current>0?pe=Math.max(0,Math.min(96,ie.current+Z)):pe=Math.min(0,Math.max(-96,ie.current+Z)),Re(He=>({...He,[L]:pe}))},Ue=A=>{if(le.current!==A)return;const L=xe[A]||0;let Z=0;ie.current===0?Z=L>60?96:L<-60?-96:0:ie.current>0?Z=L>60?96:0:Z=L<-60?-96:0,Re(de=>({...de,[A]:Z})),le.current=null},Ee=A=>Re(L=>({...L,[A]:0})),Ne=A=>{Ae(A.id),a&&a(A)},Ye=async A=>{const L=Y.find(Z=>Z.id===A);if(G(null),c&&L){c(L);return}try{await Kh(A),ce(Z=>Z.filter(de=>de.id!==A))}catch{}},Xe=A=>{Ee(A.id),d&&d(A)},Ge=async A=>{const L=he.find(Z=>Z.id===A);j(null),h&&L&&h(L);try{await Fh(A),ue(Z=>Z.filter(de=>de.id!==A)),h&&L&&h(L)}catch{}};return n.jsxs("div",{className:"h-full w-full bg-[#F8F9FB] flex flex-col font-kosugi relative",children:[B&&n.jsx(Es,{imageSrc:B,onCancel:()=>b(null),onCrop:async A=>{const L=localStorage.getItem("user_access_token");let Z=A;try{if(A&&A.startsWith("data:image")){const de=Me(A),pe=new FormData,He=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;pe.append("avatar",de,"avatar.jpg"),pe.append("filename",He),Z=`/uploads/users/avatars/${He}`,await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:L?`Bearer ${L}`:""},body:pe}).catch(()=>{})}}catch{}try{const{authFetch:de}=await ve(async()=>{const{authFetch:pe}=await import("./http-De6Ej-g0.js");return{authFetch:pe}},__vite__mapDeps([0,1,2,3]));await de("/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:Z})})}catch{}i({...e,avatar:Z||e.avatar}),b(null)}}),n.jsxs("div",{className:"relative pb-4",children:[n.jsxs("div",{className:"h-40 bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 rounded-b-[40px] relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-[-20px] left-[-20px] w-40 h-40 bg-white/20 rounded-full blur-xl"}),n.jsx("div",{className:"absolute bottom-[-10px] right-[-10px] w-32 h-32 bg-purple-400/20 rounded-full blur-xl"})]}),n.jsxs("div",{className:"absolute top-16 left-4 right-4 bg-white rounded-3xl shadow-lg p-4 flex flex-col items-center animate-in slide-in-from-bottom-4 duration-500",children:[n.jsxs("div",{className:"relative -mt-12 mb-2 group cursor-pointer",onClick:C,children:[n.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white shadow-md overflow-hidden bg-slate-100 flex items-center justify-center",children:!P&&(e.avatar||!0)?n.jsx("img",{src:e.avatar||"/uploads/avatars/default_avatar.jpg",alt:"Me",className:"w-full h-full object-cover",onError:()=>q(!0)}):n.jsx("span",{className:"text-xl font-bold text-slate-500",children:((dt=e.nickname)==null?void 0:dt[0])||"?"})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-primary-500 p-1.5 rounded-full text-white border-2 border-white shadow-sm",children:n.jsx(fn,{size:10})}),n.jsx("input",{type:"file",ref:Fe,className:"hidden",accept:"image/*",onChange:W})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[_?n.jsx("input",{value:E,onChange:A=>S(A.target.value),onBlur:J,onKeyDown:A=>A.key==="Enter"&&J(),autoFocus:!0,className:"text-lg font-bold text-center text-slate-800 border-b-2 border-primary-300 outline-none bg-transparent min-w-[100px]"}):n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:e.nickname}),!_&&n.jsx("button",{onClick:()=>N(!0),className:"text-slate-400 hover:text-primary-500",children:n.jsx(Ys,{size:12})})]}),n.jsx("div",{className:"flex flex-col items-center gap-1 mb-1",children:n.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-[10px] font-bold bg-slate-50 px-3 py-0.5 rounded-full",children:[n.jsx(Do,{size:10}),n.jsx("span",{className:"tracking-wide",children:e.email})]})})]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-24 space-y-6 no-scrollbar mt-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-1 h-4 bg-indigo-400 rounded-full"}),n.jsx("h3",{className:"font-bold text-slate-700",children:""})]}),n.jsx("button",{onClick:x,className:"w-6 h-6 flex items-center justify-center rounded-full bg-white text-purple-500 border border-purple-100 shadow-sm hover:bg-purple-50 active:scale-95",children:n.jsx(ht,{size:14})})]}),Y&&Y.length>0?n.jsx("div",{className:"flex flex-col gap-3",children:Y.map(A=>n.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[(()=>{const L=se[A.id]||0,Z=Math.min(96,Math.max(0,-L)),de=Math.min(96,Math.max(0,L));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${Z}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>G(A.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-2xl shadow-sm",style:{width:`${de}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>Ne(A),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onTouchStart:L=>ae(L,A.id),onTouchMove:L=>fe(L,A.id),onTouchEnd:()=>Se(A.id),onContextMenu:L=>Ie(L,A.id,"story"),onClick:()=>{(se[A.id]||0)===0&&f&&f(A)},style:{transform:`translateX(${se[A.id]||0}px)`,transition:"transform 180ms ease"},className:`${(se[A.id]||0)<0?"rounded-l-2xl rounded-r-none":(se[A.id]||0)>0?"rounded-l-none rounded-r-2xl":"rounded-2xl"} bg-white p-3 shadow-sm flex gap-4 border border-transparent hover:border-indigo-100 group relative overflow-hidden`,children:[n.jsx("div",{className:"w-16 h-20 rounded-xl bg-slate-100 flex-shrink-0 overflow-hidden relative",children:n.jsx("img",{src:A.image||"/uploads/covers/default_storyimg.jpg",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:A.title})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:"font-bold text-slate-800 text-base",children:A.title}),n.jsx("div",{className:"flex flex-col items-end gap-0.5",children:n.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${A.status==="published"?"bg-green-100 text-green-600":"bg-slate-100 text-slate-400"}`,children:A.status==="published"?"":""})})]}),n.jsx("p",{className:"text-xs text-slate-400 line-clamp-1",children:A.description}),n.jsx("div",{className:"flex gap-2 mt-2",children:(A.tags||[]).slice(0,2).map(L=>n.jsx("span",{className:"text-[10px] bg-slate-50 text-slate-400 px-1.5 py-0.5 rounded",children:L},L))})]}),n.jsx("div",{className:"self-center",children:n.jsx(Bo,{size:16,className:"text-slate-300"})})]})]},A.id))}):n.jsx("div",{className:"bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-50 border-dashed",children:n.jsx("p",{className:"text-xs text-slate-400",children:""})})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-1 h-4 bg-purple-400 rounded-full"}),n.jsx("h3",{className:"font-bold text-slate-700",children:""})]}),n.jsx("button",{onClick:v,className:"w-6 h-6 flex items-center justify-center rounded-full bg-white text-purple-500 border border-purple-100 shadow-sm hover:bg-purple-50 active:scale-95",children:n.jsx(ht,{size:14})})]}),he.length>0?n.jsx("div",{className:"flex flex-col gap-3",children:he.map(A=>n.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[(()=>{const L=xe[A.id]||0,Z=Math.min(96,Math.max(0,-L)),de=Math.min(96,Math.max(0,L));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${Z}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>j(A.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-2xl shadow-sm",style:{width:`${de}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>Xe(A),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onClick:()=>l(A),onTouchStart:L=>Be(L,A.id),onTouchMove:L=>je(L,A.id),onTouchEnd:()=>Ue(A.id),onContextMenu:L=>Ie(L,A.id,"character"),style:{transform:`translateX(${xe[A.id]||0}px)`,transition:"transform 180ms ease"},className:`${(xe[A.id]||0)<0?"rounded-l-2xl rounded-r-none":(xe[A.id]||0)>0?"rounded-l-none rounded-r-2xl":"rounded-2xl"} bg-white p-3 shadow-sm flex items-center gap-4 active:scale-[0.98] transition-all cursor-pointer border border-transparent hover:border-purple-100 group relative overflow-hidden`,children:[n.jsx(Yh,{avatar:A.avatar,name:A.name}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:"font-bold text-slate-800",children:A.name}),n.jsx("div",{className:"flex flex-col items-end gap-0.5",children:n.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${A.isPublished?A.isPublic?"bg-green-100 text-green-600":"bg-pink-100 text-pink-600":"bg-slate-100 text-slate-400"}`,children:A.isPublished?A.isPublic?"":"":""})})]}),n.jsx("p",{className:"text-xs text-slate-400 truncate mt-1",children:A.oneLinePersona||A.bio})]}),n.jsx(wt,{size:16,className:"text-slate-300"})]})]},A.id))}):n.jsx("div",{className:"bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-50 border-dashed",children:n.jsx("p",{className:"text-xs text-slate-400",children:""})})]}),n.jsx("div",{className:"bg-indigo-50 rounded-3xl shadow-sm p-2",children:n.jsx("button",{onClick:()=>{try{window.open("https://v.wjx.cn/vm/rW80AcK.aspx#","_blank","noopener,noreferrer")}catch{}},className:"w-full flex items-center justify-center p-2 rounded-2xl",children:n.jsx("span",{className:"text-center font-bold text-indigo-600 text-base",children:""})})}),n.jsx("div",{className:"bg-white rounded-3xl shadow-sm p-2",children:n.jsxs("button",{onClick:()=>T(!0),className:"w-full flex items-center justify-center gap-3 p-2 hover:bg-red-50 active:bg-red-100 active:scale-95 rounded-2xl transition-all group",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-red-50 text-red-400 flex items-center justify-center group-hover:bg-red-100 group-hover:text-red-500 transition-colors",children:n.jsx(er,{size:16})}),n.jsx("span",{className:"text-center font-bold text-slate-700 text-sm group-hover:text-red-500",children:""}),n.jsx("div",{className:"w-8 h-8 opacity-0"})]})})]}),I&&n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-[32px] p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-50 text-red-400 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(er,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:""}),n.jsx("p",{className:"text-xs text-slate-400 mb-6 px-4 leading-relaxed"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>T(!1),className:"flex-1 py-3 rounded-2xl bg-slate-100 text-slate-600 font-bold hover:bg-slate-200 transition-colors text-sm",children:""}),n.jsx("button",{onClick:o,className:"flex-1 py-3 rounded-2xl bg-red-500 text-white font-bold shadow-lg shadow-red-200 hover:bg-red-600 transition-colors text-sm",children:""})]})]})}),z&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{z!=null&&Ae(z),G(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{Ye(z)},children:""})]})]})}),n.jsx("style",{children:`
            @keyframes fadeCard { from { opacity: 0; transform: translateY(-6px) } to { opacity: 1; transform: translateY(0) } }
            @keyframes fadeBg { from { opacity: 0 } to { opacity: 1 } }
          `})]}),ge&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{ge!=null&&Ee(ge),j(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{Ge(ge)},children:""})]})]})})]}),w&&n.jsx("div",{className:"fixed inset-0 z-[90] bg-black flex items-center justify-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[n.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"}),n.jsx("div",{className:"text-sm tracking-wide",children:"..."})]})}),ye.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>Ce(A=>({...A,visible:!1})),onContextMenu:A=>{A.preventDefault(),Ce(L=>({...L,visible:!1}))}}),n.jsxs("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95 duration-100",style:{top:ye.y,left:ye.x},children:[n.jsxs("button",{onClick:()=>{if(ye.type==="story"){const A=Y.find(L=>L.id===ye.id);A&&Ne(A)}else if(ye.type==="character"){const A=he.find(L=>L.id===ye.id);A&&Xe(A)}Ce(A=>({...A,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50 flex items-center gap-2 transition-colors",children:[n.jsx(Ys,{size:16,className:"text-indigo-500"}),""]}),n.jsx("div",{className:"h-[1px] bg-slate-100 w-full"}),n.jsxs("button",{onClick:()=>{ye.type==="story"?G(ye.id):ye.type==="character"&&j(ye.id),Ce(A=>({...A,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 flex items-center gap-2 transition-colors",children:[n.jsx(hn,{size:16}),""]})]})]})]})},ji=async e=>{const t=new URLSearchParams;e!=null&&e.limit&&t.set("limit",String(e.limit)),typeof(e==null?void 0:e.offset)=="number"&&t.set("offset",String(e.offset));const{authFetch:s}=await ve(async()=>{const{authFetch:o}=await import("./http-De6Ej-g0.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),r=await s(`/stories/?${t.toString()}`);if(!r.ok)throw new Error("failed");const i=await r.json();return Array.isArray(i==null?void 0:i.items)?i.items:[]},Gh=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:i}=await import("./http-De6Ej-g0.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),s=await t(`/stories/${e}`);if(!s.ok)throw new Error("failed");return await s.json()},qh=({story:e,onBack:t,onStartRoleplay:s,connectedRoleNames:r=[],validRoleNames:i=[]})=>{const l=u.useRef(null),o=u.useRef(null),[a,c]=u.useState(20),[d,h]=u.useState(0),[f,x]=u.useState(!1),[v,_]=u.useState(!1),[N,E]=u.useState(null),[S,I]=u.useState(!1),T=u.useRef(0),B=u.useRef(0),b=u.useCallback(()=>{if(!l.current||!o.current)return;const{scrollTop:U,scrollHeight:Y,clientHeight:ce}=l.current,se=o.current.clientHeight;if(Y<=ce){c(se),h(0);return}const k=ce/Y,z=Math.max(k*se,30);c(z);const G=Y-ce,X=se-z,oe=U/G;h(oe*X)},[]);u.useEffect(()=>{try{const U=localStorage.getItem("user_id")||"0",Y=localStorage.getItem("user_username")||U,ce=localStorage.getItem("user_nickname")||"";st({userId:Y,pageId:"READ_STORY",name:ce}),ke("",""),ke("",(e==null?void 0:e.title)||"")}catch{}},[e==null?void 0:e.title]),u.useEffect(()=>{const U=new ResizeObserver(()=>{b()});l.current&&U.observe(l.current),o.current&&U.observe(o.current);const Y=setTimeout(b,100);return()=>{U.disconnect(),clearTimeout(Y)}},[b]);const w=U=>{U.preventDefault(),U.stopPropagation(),x(!0);const Y="touches"in U?U.touches[0].clientX:U.clientY;T.current=Y,B.current=d};u.useEffect(()=>{const U=ce=>{if(!f||!l.current||!o.current)return;ce.preventDefault();const k=("touches"in ce?ce.touches[0].clientY:ce.clientY)-T.current,G=o.current.clientHeight-a,X=l.current.scrollHeight-l.current.clientHeight;if(G<=0)return;let oe=B.current+k;oe=Math.max(0,Math.min(oe,G));const K=oe/G;l.current.scrollTop=K*X},Y=()=>{x(!1)};return f&&(document.addEventListener("mousemove",U),document.addEventListener("mouseup",Y),document.addEventListener("touchmove",U,{passive:!1}),document.addEventListener("touchend",Y)),()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",Y),document.removeEventListener("touchmove",U),document.removeEventListener("touchend",Y)}},[f,a]);const D=()=>{if(N){if(r.includes(N)){I(!0);return}const U=(e.availableRoles||[]).find(Y=>Y.name===N);U&&s(U)}},P=e.content.split(`
`).filter(U=>U.trim()!==""),q=(e.availableRoles||[]).filter(U=>i&&i.length?i.includes(U.name):!0);return n.jsxs("div",{className:"fixed inset-0 bg-white z-[60] flex flex-col h-full w-full animate-in slide-in-from-right duration-300",children:[n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col relative bg-white rounded-none md:rounded-3xl md:overflow-hidden shadow-2xl",children:[n.jsx("button",{onClick:t,className:"absolute top-4 left-4 z-[100] w-10 h-10 bg-black/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(Yt,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar bg-[#FAFAFA]",onScroll:b,ref:l,children:[n.jsxs("div",{className:"w-full h-64 relative",children:[n.jsx("img",{src:e.image||"/uploads/covers/default_storyimg.jpg",alt:e.title,className:"w-full h-full object-cover"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#FAFAFA] to-transparent"})]}),n.jsxs("div",{className:"px-6 -mt-12 relative z-10 pb-20",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4 leading-tight",children:e.title}),n.jsxs("div",{className:"flex items-center mt-2",children:[n.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-200 overflow-hidden border border-white shadow-sm mr-3",children:n.jsx("img",{src:e.user_avatar||`https://api.dicebear.com/7.x/miniavs/svg?seed=${e.author}`,alt:"author",className:"w-full h-full object-cover"})}),n.jsx("span",{className:"text-sm font-bold text-slate-700",children:e.author})]})]}),n.jsx("article",{className:"prose prose-slate max-w-none",children:P.map((U,Y)=>n.jsx("p",{className:"mb-6 text-justify tracking-wide text-[16px]",style:{lineHeight:1.8,color:"#334155"},children:U},Y))}),n.jsx("div",{className:"flex items-center justify-center my-10",children:n.jsx("span",{className:"text-slate-400/80 text-sm font-medium tracking-widest",children:"  "})}),n.jsx("div",{className:"mb-12 flex flex-wrap gap-4 pl-1",children:e.tags.map(U=>n.jsxs("span",{className:"text-sm text-slate-400",children:["#",U]},U))}),q.length>0&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-6 py-3 bg-purple-100 rounded-full shadow-lg shadow-purple-200/50 hover:bg-purple-200 transition-all active:scale-95 cursor-pointer",children:[n.jsx("span",{className:"text-lg font-bold text-purple-600 tracking-widest",children:""}),n.jsx(go,{size:18,className:"text-purple-600"})]})})]})]}),n.jsx("div",{ref:o,className:"absolute right-1 top-4 bottom-4 w-1.5 z-[70]",children:n.jsx("div",{className:"w-full rounded-full cursor-pointer transition-colors duration-200 bg-slate-400/40 hover:bg-slate-400/60",style:{height:`${a}px`,transform:`translateY(${d}px)`,touchAction:"none"},onMouseDown:w,onTouchStart:w})})]}),v&&n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:n.jsxs("div",{className:"bg-white w-[85%] max-w-sm rounded-[32px] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300",children:[n.jsxs("div",{className:"p-6 pb-2",children:[n.jsx("h3",{className:"text-xl font-bold text-slate-900 text-center mb-6 font-kosugi",children:""}),n.jsx("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto no-scrollbar py-2 px-1",children:q.length>0?q.map(U=>{const Y=N===U.name,ce=r.includes(U.name);return n.jsxs("div",{onClick:()=>E(U.name),className:`
                                            relative p-4 rounded-2xl flex items-center justify-between cursor-pointer transition-all border-2
                                            ${Y?"bg-purple-50 border-purple-500 shadow-md scale-[1.02]":"bg-slate-50 border-transparent hover:bg-slate-100"}
                                        `,children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:`font-bold text-base ${Y?"text-purple-700":"text-slate-800"}`,children:U.name}),ce&&n.jsx("span",{className:"text-[10px] text-green-500 font-bold mt-1",children:" "})]}),Y&&n.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center text-white shadow-sm",children:n.jsx(_i,{size:12,strokeWidth:3})})]},U.name)}):n.jsx("p",{className:"text-center text-slate-400 py-4 text-sm",children:""})})]}),n.jsx("div",{className:"p-6 pt-2 bg-gradient-to-t from-white via-white to-transparent",children:n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>_(!1),className:"flex-1 py-3.5 rounded-2xl border border-slate-200 font-bold text-slate-500 hover:bg-slate-50 text-sm",children:""}),n.jsx("button",{onClick:D,disabled:!N,className:`
                                   flex-1 py-3.5 rounded-2xl font-bold text-white text-sm shadow-lg transition-all flex items-center justify-center gap-2
                                   ${N?"bg-purple-600 shadow-purple-200 hover:bg-purple-700 active:scale-95":"bg-slate-300 shadow-none cursor-not-allowed"}
                               `,children:""})]})})]})}),S&&n.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center text-center",children:[n.jsx("div",{className:"w-12 h-12 bg-purple-100 text-purple-500 rounded-full flex items-center justify-center mb-4",children:n.jsx(Ti,{size:24})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 mb-6 font-kosugi",children:""}),n.jsx("button",{onClick:()=>I(!1),className:"w-full py-3 rounded-2xl bg-purple-600 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-700 transition-colors text-sm font-kosugi",children:""})]})})]})},uo=e=>({id:(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.character_id)??String(Date.now()),name:(e==null?void 0:e.name)??(e==null?void 0:e.title)??"",avatar:(e==null?void 0:e.avatar)??(e==null?void 0:e.cover)??(e==null?void 0:e.image)??"",profileImage:(e==null?void 0:e.profileImage)??(e==null?void 0:e.banner)??(e==null?void 0:e.image)??"",bio:(e==null?void 0:e.bio)??(e==null?void 0:e.tagline)??(e==null?void 0:e.description)??"",tags:(e==null?void 0:e.tags)??(e==null?void 0:e.keywords)??[],creator:(e==null?void 0:e.creator)??(e==null?void 0:e.author)??"",oneLinePersona:(e==null?void 0:e.oneLinePersona)??(e==null?void 0:e.tagline)??"",personality:(e==null?void 0:e.personality)??(e==null?void 0:e.personality)??"",profession:(e==null?void 0:e.profession)??(e==null?void 0:e.occupation)??"",age:(e==null?void 0:e.age)??"",roleType:(e==null?void 0:e.roleType)??(e==null?void 0:e.character_type)??"",currentRelationship:(e==null?void 0:e.currentRelationship)??(e==null?void 0:e.relationship)??"",plotTheme:(e==null?void 0:e.plotTheme)??(e==null?void 0:e.plot_theme)??"",plotDescription:(e==null?void 0:e.plotDescription)??(e==null?void 0:e.plot_summary)??"",openingLine:(e==null?void 0:e.openingLine)??(e==null?void 0:e.opening_line)??"",created_at:(e==null?void 0:e.created_at)??0}),Ni=async e=>{const t=new URLSearchParams;e!=null&&e.tag&&t.set("tag",e.tag),e!=null&&e.limit&&t.set("limit",String(e.limit)),typeof(e==null?void 0:e.offset)=="number"&&t.set("offset",String(e.offset));const{authFetch:s}=await ve(async()=>{const{authFetch:o}=await import("./http-De6Ej-g0.js");return{authFetch:o}},__vite__mapDeps([0,1,2,3])),r=await s(`/characters/?${t.toString()}`);if(!r.ok)throw new Error("failed");const i=await r.json(),l=Array.isArray(i==null?void 0:i.items)?i.items:[];return l.sort((o,a)=>Number((a==null?void 0:a.created_at)||0)-Number((o==null?void 0:o.created_at)||0)),l.map(uo)},Ws=async e=>{const{authFetch:t}=await ve(async()=>{const{authFetch:i}=await import("./http-De6Ej-g0.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),s=await t(`/characters/${e}`);if(!s.ok)throw new Error("failed");const r=await s.json();return uo(r)},Jh=[],Zh=({char:e,root:t})=>{var s;return n.jsx(Ns,{src:e.avatar,alt:e.name,root:t,placeholderChar:((s=e.name)==null?void 0:s[0])||"?",className:"w-20 h-28 flex-shrink-0 rounded-xl overflow-hidden bg-slate-100 relative group flex items-center justify-center"})},Qh=()=>{const[e,t]=u.useState(be.HOME),[s,r]=u.useState(Jh),[i,l]=u.useState([]),[o,a]=u.useState(!1),[c,d]=u.useState(null),[h,f]=u.useState(null),[x,v]=u.useState("stories"),[_,N]=u.useState(!1),[E,S]=u.useState(void 0),[I,T]=u.useState(!1),[B,b]=u.useState(!1),[w,D]=u.useState(null),[P,q]=u.useState(null),[U,Y]=u.useState([]),[ce,se]=u.useState(null),[k,z]=u.useState([]),[G,X]=u.useState(null),[oe,K]=u.useState([]),[ne,he]=u.useState(!!localStorage.getItem("user_access_token")),[ue,xe]=u.useState(()=>{const y=localStorage.getItem("user_nickname")||"",M=localStorage.getItem("user_email")||"me@example.com",m=localStorage.getItem("user_avatar")||"";return{nickname:y,email:M,avatar:m}}),[Re,ge]=u.useState(!1),[j,$]=u.useState(!1),[R,le]=u.useState([]),[ie,ye]=u.useState(!1),[Ce,Ie]=u.useState({height:"100%",top:0}),[Fe,Me]=u.useState(0),[C,W]=u.useState(!0),[J,ae]=u.useState(!1),fe=u.useRef(null),Se=u.useRef(null),Ae=u.useRef(null),[Be,je]=u.useState(0),[Ue,Ee]=u.useState(!0),[Ne,Ye]=u.useState(!1),Xe=u.useRef(null),Ge=u.useRef(null),dt=u.useRef(!1),A=()=>{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token"),localStorage.removeItem("user_nickname"),localStorage.removeItem("user_email"),localStorage.removeItem("user_avatar"),S(void 0),d(null),f(null),t(be.HOME),he(!1)};if(u.useEffect(()=>{if(c)try{const y=localStorage.getItem(`chat_config_${c.character.id}`),M=y?JSON.parse(y):null,m=localStorage.getItem("user_id")||"0",p=localStorage.getItem("user_username")||m,g=localStorage.getItem("user_nickname")||"";st({userId:p,sessionId:localStorage.getItem(`chat_session_${m}_${c.character.id}`)||void 0,pageId:"CHAT",name:g}),ke("",""),ke("ID",String(c.character.id)),M!=null&&M.chatMode&&ke("",M.chatMode==="scene"?"":"")}catch{}},[c]),u.useEffect(()=>{ne&&((async()=>{try{const{authFetch:y}=await ve(async()=>{const{authFetch:m}=await import("./http-De6Ej-g0.js");return{authFetch:m}},__vite__mapDeps([0,1,2,3])),M=await y("/user/profile");if(M&&M.ok){const m=await M.json(),p=(m==null?void 0:m.nickname)||"",g=(m==null?void 0:m.email)||"me@example.com",V=(m==null?void 0:m.avatar)||"",F=typeof(m==null?void 0:m.used_count)=="number"?m.used_count:0;xe({nickname:p,email:g,avatar:V,usedCount:F});try{localStorage.setItem("user_nickname",p),localStorage.setItem("user_email",g),V&&localStorage.setItem("user_avatar",V);const H=(m==null?void 0:m.id)??(m==null?void 0:m.user_id)??(m==null?void 0:m.uid);H!=null&&localStorage.setItem("user_id",String(H));const O=localStorage.getItem("user_username")||String((m==null?void 0:m.username)||"");st({userId:O||localStorage.getItem("user_id")||String(H||""),name:p})}catch{}}}catch{}})(),(async()=>{try{const y=await ji({limit:10,offset:0});y.sort((M,m)=>Number((m==null?void 0:m.created_at)||0)-Number((M==null?void 0:M.created_at)||0)),Y(y),je(y.length),Ee(y.length===10)}catch{Y([]),je(0),Ee(!1)}})(),a(!0),Ni({limit:10,offset:0}).then(y=>{const m=[...y].sort((p,g)=>Number((g==null?void 0:g.created_at)||0)-Number((p==null?void 0:p.created_at)||0)).map(p=>({id:String(p.id),name:p.name||"",avatar:p.avatar||"",profileImage:p.profileImage||"",status:Ze.ONLINE,bio:p.bio||"",tags:Array.isArray(p.tags)?p.tags:[],creator:p.creator||"",oneLinePersona:p.oneLinePersona||"",personality:p.personality||"",profession:p.profession||"",age:p.age||"",roleType:p.roleType||"",currentRelationship:p.currentRelationship||"",plotTheme:p.plotTheme||"",plotDescription:p.plotDescription||"",openingLine:p.openingLine||""}));l(m),Me(y.length),W(y.length===10);try{const p=new Map,g=localStorage.getItem("user_id")||"0",F=Object.keys(localStorage).filter(Q=>Q.startsWith(`chat_history_${g}_`)),H=Q=>JSON.parse(Q);F.forEach(Q=>{try{const te=Q.replace(`chat_history_${g}_`,""),me=localStorage.getItem(Q);if(!me)return;const re=H(me);if(!re.length)return;const De=m.find(gt=>String(gt.id)===String(te));if(!De)return;const Oe=re[re.length-1],it={id:Oe.id,senderId:Oe.senderId,text:Oe.text,timestamp:new Date(Oe.ts),type:Oe.type};p.set(String(te),{characterId:String(te),character:De,lastMessage:it,unreadCount:0})}catch{}});const O=Array.from(p.values());O.length&&r(O)}catch{}}).catch(()=>l([])).finally(()=>a(!1)),(async()=>{try{const y=await Mh(),m=(Array.isArray(y)?y.filter(p=>typeof(p==null?void 0:p.mypage_id)<"u"&&typeof(p==null?void 0:p.mypage_name)=="string"&&typeof(p==null?void 0:p.mypage_visibility)=="string"&&typeof(p==null?void 0:p.mypage_status)=="string"):[]).map(p=>({id:String(p.mypage_id),name:p.mypage_name||"",avatar:p.mypage_avatar||"",profileImage:"",status:Ze.ONLINE,bio:"",tags:[],creator:ue.nickname||"",oneLinePersona:p.mypage_tagline||"",personality:"",profession:"",age:"",roleType:"",gender:"",currentRelationship:"",plotTheme:"",plotDescription:"",openingLine:"",styleExamples:[],hobbies:"",experiences:"",isPublic:p.mypage_visibility?p.mypage_visibility==="public":!1,isPublished:p.mypage_status==="published"}));le(m)}catch{le([])}})(),(async()=>{try{const M=(await Wh({includeDrafts:!0})).map(m=>({id:typeof m.id=="number"?m.id:Number(Date.now()),title:m.title||"",description:m.description||"",image:m.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(m.tags)?m.tags:[],author:ue.nickname||"",likes:"0",content:"",status:m.status}));z(M)}catch{z([])}})())},[ne]),u.useEffect(()=>{if(!ne||dt.current)return;(async()=>{try{const M=localStorage.getItem("user_id")||"0",p=Object.keys(localStorage).filter(Q=>Q.startsWith(`chat_history_${M}_`)),g=Q=>JSON.parse(Q),V=new Map,F=Q=>{const te=String(Q);return i.find(me=>String(me.id)===te)||R.find(me=>String(me.id)===te)},H=[];if(p.forEach(Q=>{try{const te=Q.replace(`chat_history_${M}_`,""),me=localStorage.getItem(Q);if(!me)return;const re=g(me);if(!re.length)return;const De=F(te);if(!De){H.push(te);return}const Oe=re[re.length-1],it={id:Oe.id,senderId:Oe.senderId,text:Oe.text,timestamp:new Date(Oe.ts),type:Oe.type};V.set(String(te),{characterId:String(te),character:De,lastMessage:it,unreadCount:0})}catch{}}),H.length){const Q=H.slice(0,20);(await Promise.all(Q.map(async me=>{try{const re=await Ws(me);if(re&&re.id)return{id:String(re.id),name:re.name||"",avatar:re.avatar||"",profileImage:re.profileImage||"",status:Ze.ONLINE,bio:re.bio||"",tags:Array.isArray(re.tags)?re.tags:[],creator:re.creator||"",oneLinePersona:re.oneLinePersona||"",personality:re.personality||"",profession:re.occupation||"",age:re.age||""}}catch{}try{const re=await Mt(me);if(re&&re.id)return{id:String(me),name:re.name||"",avatar:re.avatar||"",profileImage:"",status:Ze.ONLINE,bio:re.tagline||"",tags:Array.isArray(re.tags)?re.tags:[],creator:ue.nickname||"",oneLinePersona:re.tagline||"",personality:re.personality||"",profession:re.occupation||"",age:re.age?String(re.age):""}}catch{}}))).forEach((me,re)=>{const De=Q[re];if(!me)return;const Oe=localStorage.getItem(`chat_history_${M}_${De}`);if(Oe)try{const it=g(Oe);if(!it.length)return;const gt=it[it.length-1],ho={id:gt.id,senderId:gt.senderId,text:gt.text,timestamp:new Date(gt.ts),type:gt.type};V.set(String(De),{characterId:String(De),character:me,lastMessage:ho,unreadCount:0})}catch{}})}const O=Array.from(V.values());O.length&&r(O)}catch{}})(),dt.current=!0},[ne]),u.useEffect(()=>{if(e!==be.HOME||x!=="stories"||!Ue||Ne)return;Ge.current&&(Ge.current.disconnect(),Ge.current=null);const y=Xe.current;if(!y||U.length<7)return;const M=new IntersectionObserver(m=>{m.some(g=>g.isIntersecting)&&(Ne||(Ye(!0),(async()=>{try{const g=await ji({limit:10,offset:Be});g.sort((V,F)=>Number((F==null?void 0:F.created_at)||0)-Number((V==null?void 0:V.created_at)||0)),g.length&&Y(V=>[...V,...g]),je(V=>V+g.length),Ee(g.length===10)}catch{}finally{Ye(!1)}})()))},{threshold:.1,root:Ae.current||void 0});return Ge.current=M,M.observe(y),()=>{try{M.disconnect()}catch{}}},[U,Ue,Ne,Be,e,x]),u.useEffect(()=>{if(e!==be.HOME||x!=="characters"||!C||J)return;Se.current&&(Se.current.disconnect(),Se.current=null);const y=fe.current;if(!y||i.length<7)return;const M=new IntersectionObserver(m=>{m.some(g=>g.isIntersecting)&&(J||(ae(!0),(async()=>{try{const F=[...await Ni({limit:10,offset:Fe})].sort((H,O)=>Number((O==null?void 0:O.created_at)||0)-Number((H==null?void 0:H.created_at)||0)).map(H=>({id:String(H.id),name:H.name||"",avatar:H.avatar||"",profileImage:H.profileImage||"",status:Ze.ONLINE,bio:H.bio||"",tags:Array.isArray(H.tags)?H.tags:[],creator:H.creator||"",oneLinePersona:H.oneLinePersona||"",personality:H.personality||"",profession:H.profession||"",age:H.age||"",roleType:H.roleType||"",currentRelationship:H.currentRelationship||"",plotTheme:H.plotTheme||"",plotDescription:H.plotDescription||"",openingLine:H.openingLine||""}));F.length&&l(H=>[...H,...F]),Me(H=>H+F.length),W(F.length===10)}catch{}finally{ae(!1)}})()))},{threshold:.1,root:Ae.current||void 0});return Se.current=M,M.observe(y),()=>{try{M.disconnect()}catch{}}},[i,C,J,Fe,e,x]),u.useEffect(()=>{if(e===be.ME)try{const y=localStorage.getItem("user_id")||"0",M=localStorage.getItem("user_username")||y,m=localStorage.getItem("user_nickname")||"";st({userId:M,pageId:"ME",name:m}),ke("","")}catch{}},[e]),u.useEffect(()=>{if(!((navigator==null?void 0:navigator.maxTouchPoints)>0))return;const M=document.querySelector('meta[name="viewport"]'),m=(M==null?void 0:M.getAttribute("content"))||"";M&&M.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no");let g=0;const V=F=>{const H=Date.now();H-g<=300&&F.preventDefault(),g=H};return document.addEventListener("touchend",V,{passive:!1}),document.body.style.touchAction="manipulation",()=>{M&&M.setAttribute("content",m),document.removeEventListener("touchend",V),document.body.style.touchAction=""}},[]),u.useEffect(()=>{const y=()=>{window.visualViewport&&Ie({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`})};window.visualViewport&&(window.visualViewport.addEventListener("resize",y),window.visualViewport.addEventListener("scroll",y),y());const M=()=>{window.visualViewport||Ie({height:window.innerHeight,top:0})};return window.addEventListener("resize",M),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",y),window.visualViewport.removeEventListener("scroll",y)),window.removeEventListener("resize",M)}},[]),u.useEffect(()=>{const y=()=>{const m=window.visualViewport&&window.visualViewport.height?window.visualViewport.height:window.innerHeight;document.documentElement.style.setProperty("--vh",`${m*.01}px`)};y();const M=()=>y();return window.addEventListener("resize",M),window.visualViewport&&window.visualViewport.addEventListener("resize",M),()=>{window.removeEventListener("resize",M),window.visualViewport&&window.visualViewport.removeEventListener("resize",M)}},[]),!ne)return n.jsx(vi,{children:n.jsx("div",{className:"fixed inset-0 w-full bg-primary-50 overflow-hidden",style:{height:"calc(var(--vh) * 100)",overscrollBehavior:"none"},children:n.jsx("div",{className:"h-full w-full max-w-md mx-auto bg relative shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden flex",children:n.jsx(Uh,{onLogin:()=>he(!0)})})})});const L=y=>{try{const m=`chat_history_${localStorage.getItem("user_id")||"0"}_${y.characterId}`,p=localStorage.getItem(m);if(p){const V=JSON.parse(p).map(F=>({id:F.id,senderId:F.senderId,text:F.text,timestamp:new Date(F.ts),type:F.type,quote:F.quote,read:F.read}));if(V.length)return V}}catch{}return[]},Z=y=>{c&&r(M=>M.map(m=>m.characterId===c.characterId?{...m,lastMessage:y,unreadCount:0}:m))},de=y=>{r(M=>M.map(m=>m.characterId===y?{...m,character:{...m.character,isPinned:!m.character.isPinned}}:m))},pe=async y=>{const M=s.find(m=>m.characterId===y.id);if(M){f(null),ye(!1),d(M),t(be.CHAT);return}try{const m=localStorage.getItem("user_id")||"0",p=`chat_session_${m}_${y.id}`;let g=localStorage.getItem(p)||"";g||(g=(await ms(y.id)).sessionId,localStorage.setItem(p,g));const V=y.openingLine||y.oneLinePersona||"",F=`msg_${Date.now()}`,H={id:F,senderId:y.id,text:V,timestamp:new Date,type:at.TEXT};try{const Q=`chat_history_${m}_${y.id}`,te={id:F,senderId:y.id,text:V,ts:Date.now(),type:at.TEXT};localStorage.setItem(Q,JSON.stringify([te]))}catch{}const O={characterId:y.id,character:y,lastMessage:H,unreadCount:0};r(Q=>[O,...Q]),f(null),ye(!1),d(O),t(be.CHAT)}catch{const m=y.openingLine||y.oneLinePersona||"",p=`msg_${Date.now()}`,g={id:p,senderId:y.id,text:m,ts:Date.now(),type:at.TEXT};try{const H=`chat_history_${localStorage.getItem("user_id")||"0"}_${y.id}`;localStorage.setItem(H,JSON.stringify([g]))}catch{}const V={characterId:y.id,character:y,lastMessage:{id:p,senderId:y.id,text:m,timestamp:new Date,type:at.TEXT},unreadCount:0};r(F=>[V,...F]),f(null),ye(!1),d(V),t(be.CHAT)}},He=y=>{T(!1),q({character:y,id:String(y.id)})},_t=()=>n.jsxs("div",{className:"flex items-center gap-5",children:[n.jsxs("button",{onClick:()=>v("stories"),className:`relative transition-all duration-300 ${x==="stories"?"text-slate-800 font-extrabold text-2xl scale-105":"text-slate-400 font-semibold text-lg hover:text-slate-600"}`,children:["",x==="stories"&&n.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-1 bg-primary-500 rounded-full"})]}),n.jsx("div",{className:"h-5 w-[1px] bg-slate-300/50 rounded-full"}),n.jsxs("button",{onClick:()=>v("characters"),className:`relative transition-all duration-300 ${x==="characters"?"text-slate-800 font-extrabold text-2xl scale-105":"text-slate-400 font-semibold text-lg hover:text-slate-600"}`,children:["",x==="characters"&&n.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-1 bg-primary-500 rounded-full"})]})]}),rs=()=>{switch(e){case be.HOME:return n.jsx("div",{className:"px-6 pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:x==="stories"?n.jsxs("div",{className:"space-y-6 mt-2",children:[U.map((y,M)=>n.jsxs("div",{ref:M===U.length-3?m=>{Xe.current=m}:void 0,className:"group relative bg-white rounded-3xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer border border-transparent hover:border-primary-100 hover:-translate-y-0.5 duration-200",onClick:async()=>{try{const m=y;if(typeof(m==null?void 0:m.content)=="string"&&m.content.length){const p={id:typeof y.id=="number"?y.id:Number(Date.now()),title:y.title,description:y.description||"",image:y.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(y.tags)?y.tags:[],author:y.author||ue.nickname||"",likes:"0",content:m.content,publishDate:m.publishDate||void 0,status:m.status,availableRoles:Array.isArray(m.availableRoles)?m.availableRoles:[]};se(p)}else{const p=await Gh(y.id),g={id:Number(p.id),title:p.title,description:p.description||"",image:p.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(p.tags)?p.tags:[],author:p.author||"",user_avatar:(p==null?void 0:p.user_avatar)||"",likes:"",content:p.content||"",publishDate:p.publish_date||void 0,availableRoles:Array.isArray(p==null?void 0:p.roles)?p.roles.map(V=>({id:V.id,name:V.name,avatar:"",description:""})):[]};se(g)}}catch{}},children:[n.jsxs("div",{className:"h-40 overflow-hidden relative",children:[n.jsx(Ns,{src:y.image||"/uploads/covers/default_storyimg.jpg",alt:y.title,root:Ae.current,className:"w-full h-full"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent"}),n.jsx("div",{className:"absolute bottom-4 left-4",children:n.jsx("h3",{className:"text-xl font-bold text-white",children:y.title})})]}),n.jsxs("div",{className:"p-5",children:[n.jsx("p",{className:"text-slate-500 text-sm leading-relaxed mb-4 line-clamp-2",children:y.description}),n.jsx("div",{className:"flex justify-between items-center",children:n.jsx("div",{className:"flex gap-2 flex-wrap",children:(y.tags||[]).map(m=>n.jsxs("span",{className:"text-[10px] font-bold text-primary-600 bg-primary-50 px-2 py-1 rounded-full",children:["#",m]},m))})})]})]},y.id)),!U.length&&n.jsx("div",{className:"text-center text-xs text-slate-400",children:""})]}):n.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[o&&n.jsx("div",{className:"text-center text-xs text-slate-400",children:"..."}),!o&&i.map((y,M)=>{var m;return n.jsxs("div",{ref:M===i.length-3?p=>{fe.current=p}:void 0,className:"bg rounded-2xl p-4 shadow-sm flex gap-4 hover:shadow-md transition-all cursor-pointer border border-transparent hover:border-primary-100",onClick:()=>{ge(!1),$(!1),f(y)},children:[n.jsx(Zh,{char:y,root:Ae.current}),n.jsxs("div",{className:"flex-1 flex flex-col justify-between py-1 min-w-0",children:[n.jsxs("div",{children:[n.jsx("div",{className:"flex justify-between items-start",children:n.jsx("h3",{className:"font-bold text-slate-800 text-lg leading-tight",children:y.name})}),n.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2 mb-2",children:(m=y.tags)==null?void 0:m.slice(0,4).map(p=>n.jsx("span",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded-md bg-pink-50 text-pink-500",children:p},p))}),n.jsx("p",{className:"text-xs text-slate-500 line-clamp-2 leading-relaxed mb-2",children:y.oneLinePersona||y.bio})]}),n.jsx("div",{className:"flex items-center justify-end mt-1 border-t border-slate-50 pt-2",children:n.jsxs("div",{className:"text-[10px] text-slate-400",children:["by ",y.creator||""]})})]})]},y.id)}),!o&&i.length===0&&n.jsx("div",{className:"mt-2 text-center",children:n.jsx("p",{className:"text-xs text-slate-300",children:" ~"})})]})});case be.ME:return n.jsx(Xh,{userProfile:ue,myCharacters:i,myUserCharacters:R,myStories:k,onUpdateProfile:y=>{xe(y);try{localStorage.setItem("user_nickname",y.nickname||""),localStorage.setItem("user_email",y.email||"me@example.com"),y.avatar&&localStorage.setItem("user_avatar",y.avatar)}catch{}},onCharacterClick:y=>{ge(!1),$(!0),f(y)},onReadStory:async y=>{try{const M=y;if(typeof(M==null?void 0:M.content)=="string"&&M.content.length){const m={id:typeof y.id=="number"?y.id:Number(Date.now()),title:y.title,description:y.description||"",image:y.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(y.tags)?y.tags:[],author:ue.nickname||"",likes:"0",content:M.content,publishDate:M.publishDate||void 0,status:M.status};se(m)}else{const m=await wi(y.id),p=Array.isArray(m==null?void 0:m.characterIds)?m.characterIds:[];let g=[];if(p.length){const F=H=>i.find(O=>String(O.id)===String(H))||R.find(O=>String(O.id)===String(H));g=p.map(H=>{const O=F(H);return O?{id:H,name:O.name,avatar:O.avatar,description:O.oneLinePersona||O.bio||""}:null}).filter(Boolean)}const V={id:Number(m.id),title:m.title,description:m.description||"",image:m.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(m.tags)?m.tags:[],author:ue.nickname||"",user_avatar:(m==null?void 0:m.user_avatar)||"",likes:"0",content:m.content||"",publishDate:(m==null?void 0:m.publishDate)??void 0,status:y.status||void 0,availableRoles:g};se(V)}}catch{}},onEditStory:y=>{const M={id:typeof y.id=="number"?y.id:Number(Date.now()),title:y.title,description:y.description||"",image:y.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(y.tags)?y.tags:[],author:ue.nickname||"",likes:"0",content:"",status:y.status||void 0,availableRoles:[]};X(M),b(!0),(async()=>{try{const m=await wi(y.id),p=Array.isArray(m==null?void 0:m.characterIds)?m.characterIds:[];let g=[];try{const{authFetch:O}=await ve(async()=>{const{authFetch:te}=await import("./http-De6Ej-g0.js");return{authFetch:te}},__vite__mapDeps([0,1,2,3])),Q=await O("/stories/combine");if(Q&&Q.ok){const te=await Q.json();g=Array.isArray(te==null?void 0:te.items)?te.items:[]}}catch{}K(g.map(O=>({id:String(O.character_id),name:O.character_name,avatar:O.character_avatar||"",desc:O.desc||"",isPrivate:!!O.isPrivate,isMine:!!O.isMine})));const V=O=>{const Q=g.find(te=>String(te.character_id)===String(O));return Q?{id:O,name:Q.character_name,avatar:Q.character_avatar||"",description:Q.desc||""}:null};let F=p.map(V).filter(Boolean);if(!F.length){const O=Q=>i.find(te=>String(te.id)===String(Q))||R.find(te=>String(te.id)===String(Q));F=p.map(Q=>{const te=O(Q);return te?{id:Q,name:te.name,avatar:te.avatar,description:te.oneLinePersona||te.bio||""}:null}).filter(Boolean)}const H={id:Number(m.id),title:m.title,description:m.description||"",image:m.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(m.tags)?m.tags:[],author:ue.nickname||"",likes:"0",content:m.content||"",publishDate:(m==null?void 0:m.publishDate)??void 0,status:y.status||void 0,availableRoles:F,...p&&{characterIds:p}};X(H)}catch{}})()},onEditCharacter:y=>{D({initial:y,id:y.id,isEdit:!0}),T(!0)},onDeleteCharacter:y=>{le(M=>M.filter(m=>m.id!==y.id)),l(M=>M.filter(m=>m.id!==y.id))},onAddCharacter:()=>{D(null),T(!0)},onAddStory:()=>{X(null),b(!0),(async()=>{try{const{authFetch:y}=await ve(async()=>{const{authFetch:m}=await import("./http-De6Ej-g0.js");return{authFetch:m}},__vite__mapDeps([0,1,2,3])),M=await y("/stories/combine");if(M&&M.ok){const m=await M.json(),p=Array.isArray(m==null?void 0:m.items)?m.items:[];K(p.map(g=>({id:String(g.character_id),name:g.character_name,avatar:g.character_avatar||"",desc:g.desc||"",isPrivate:!!g.isPrivate,isMine:!!g.isMine})))}else K([])}catch{K([])}})()},onLogout:A});case be.CHAT:default:return n.jsx(n.Fragment,{children:(!c||ie)&&n.jsx(bh,{chats:s,onChatClick:y=>{ye(!0),d(y)},onTogglePin:de,onDeleteChat:y=>{r(m=>m.filter(p=>p.characterId!==y));const M=localStorage.getItem("user_id")||"0";localStorage.removeItem(`chat_session_${M}_${y}`),localStorage.removeItem(`chat_history_${M}_${y}`),localStorage.removeItem(`chat_config_${y}`),localStorage.removeItem(`chat_model_${y}`),localStorage.removeItem(`chat_temp_${y}`),localStorage.removeItem(`chat_model_name_${y}`),localStorage.removeItem(`chat_history_${y}`),localStorage.removeItem(`chat_session_${y}`),(c==null?void 0:c.characterId)===y&&d(null)},isDetailOpen:ie&&!!c})})}};return n.jsx(vi,{children:n.jsx("div",{className:"fixed inset-0 w-full bg-primary-50 overflow-hidden",style:{...Ce,overscrollBehavior:"none",position:"fixed"},children:n.jsxs("div",{className:"h-full w-full max-w-md mx-auto bg relative shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden flex flex-col",children:[I&&n.jsx(zh,{onBack:()=>{T(!1),D(null)},onCreate:He,isEdit:!!(w!=null&&w.isEdit),characterId:w==null?void 0:w.id,initial:w==null?void 0:w.initial,onUpdated:y=>{T(!1),D(null),f(y)},onSaveDraft:y=>{T(!1),D(null),le(M=>ds(M,y)),t(be.ME)}}),_&&n.jsx(io,{currentPersona:E,onBack:()=>N(!1),onSave:y=>S(y)}),B&&n.jsx(Bh,{onBack:()=>{b(!1),X(null)},onPublish:y=>{Y(M=>ds(M,y)),z(M=>ds(M,y)),b(!1),X(null)},onSaveDraft:y=>{z(M=>ds(M,y)),b(!1),X(null)},availableCharacters:i,myUserCharacters:R,initialStory:G||void 0,importableRoles:oe}),n.jsx(It,{initial:!1,children:c&&!_&&!I&&n.jsx(Eh,{character:c.character,initialMessages:L(c),userPersona:E,onBack:()=>{d(null),ye(!1)},onUpdateLastMessage:Z,onOpenUserSettings:()=>N(!0),onUpdateUserPersona:y=>S(y),onShowProfile:()=>{ge(!0),$(!1),q(null),f(c.character)}})}),n.jsx(It,{initial:!1,children:h&&!_&&!I&&!P&&(j?n.jsx(bi,{character:h,createdId:h.id,onBack:()=>f(null),onStartChat:y=>pe(y)}):n.jsx(Ih,{character:h,onBack:()=>f(null),onStartChat:()=>pe(h),isFromChat:Re,isExistingChat:!!s.find(y=>y.characterId===h.id)}))}),P&&!_&&!I&&n.jsx(bi,{character:P.character,createdId:P.id,onBack:()=>q(null),onStartChat:y=>{q(null),pe(y)}}),ce&&n.jsx(qh,{story:ce,onBack:()=>se(null),connectedRoleNames:s.map(y=>y.character.name),validRoleNames:(ce.availableRoles||[]).map(y=>y.name),onStartRoleplay:y=>{se(null);const M=y==null?void 0:y.id;let m;if(M!=null&&(m=i.find(p=>String(p.id)===String(M))||R.find(p=>String(p.id)===String(M))),!m){const p=(y==null?void 0:y.name)||"";m=i.find(g=>g.name===p)||R.find(g=>g.name===p)}m&&(f(m),ge(!1),$(!1),(async()=>{try{if(!!R.find(g=>String(g.id)===String(m.id))){const g=await Mt(m.id),V={id:String(m.id),name:(g==null?void 0:g.name)||m.name,avatar:(g==null?void 0:g.avatar)||m.avatar||"",profileImage:m.profileImage||"",status:Ze.ONLINE,bio:(g==null?void 0:g.tagline)||"",tags:Array.isArray(g==null?void 0:g.tags)?g.tags:[],creator:ue.nickname||"",oneLinePersona:(g==null?void 0:g.tagline)||"",personality:(g==null?void 0:g.personality)||"",profession:(g==null?void 0:g.occupation)||"",age:g!=null&&g.age?String(g.age):"",roleType:"",gender:(g==null?void 0:g.gender)||"",currentRelationship:(g==null?void 0:g.relationship)||"",plotTheme:(g==null?void 0:g.plot_theme)||"",plotDescription:(g==null?void 0:g.plot_summary)||"",openingLine:(g==null?void 0:g.opening_line)||"",styleExamples:Array.isArray(g==null?void 0:g.styleExamples)?g.styleExamples:[],hobbies:(g==null?void 0:g.hobbies)||"",experiences:(g==null?void 0:g.experiences)||"",isPublic:String((g==null?void 0:g.visibility)||"")==="public",isPublished:String((g==null?void 0:g.status)||"")==="published"};f(V)}else{const g=await Ws(m.id),V={id:String(g.id),name:g.name||m.name,avatar:g.avatar||m.avatar||"",profileImage:g.profileImage||m.profileImage||"",status:Ze.ONLINE,bio:g.bio||"",tags:Array.isArray(g.tags)?g.tags:[],creator:g.creator||"",oneLinePersona:g.oneLinePersona||"",personality:g.personality||"",profession:g.profession||g.occupation||"",age:g.age||"",roleType:g.roleType||"",currentRelationship:g.currentRelationship||g.relationship||"",plotTheme:g.plotTheme||g.plot_theme||"",plotDescription:g.plotDescription||g.plot_summary||"",openingLine:g.openingLine||""};f(V)}}catch{}})()),!m&&M!=null&&(async()=>{try{const p=await Ws(M),g={id:String(p.id),name:p.name||"",avatar:p.avatar||"",profileImage:p.profileImage||"",status:Ze.ONLINE,bio:p.bio||"",tags:Array.isArray(p.tags)?p.tags:[],creator:p.creator||"",oneLinePersona:p.oneLinePersona||"",personality:p.personality||"",profession:p.profession||p.occupation||"",age:p.age||"",roleType:p.roleType||"",currentRelationship:p.currentRelationship||p.relationship||"",plotTheme:p.plotTheme||p.plot_theme||"",plotDescription:p.plotDescription||p.plot_summary||"",openingLine:p.openingLine||""};f(g),ge(!1),$(!1);return}catch{}try{const p=await Mt(M),g={id:String(M),name:(p==null?void 0:p.name)||"",avatar:(p==null?void 0:p.avatar)||"",profileImage:"",status:Ze.ONLINE,bio:(p==null?void 0:p.tagline)||"",tags:Array.isArray(p==null?void 0:p.tags)?p.tags:[],creator:ue.nickname||"",oneLinePersona:(p==null?void 0:p.tagline)||"",personality:(p==null?void 0:p.personality)||"",profession:(p==null?void 0:p.occupation)||"",age:p!=null&&p.age?String(p.age):"",roleType:"",gender:(p==null?void 0:p.gender)||"",currentRelationship:(p==null?void 0:p.relationship)||"",plotTheme:(p==null?void 0:p.plot_theme)||"",plotDescription:(p==null?void 0:p.plot_summary)||"",openingLine:(p==null?void 0:p.opening_line)||"",styleExamples:Array.isArray(p==null?void 0:p.styleExamples)?p.styleExamples:[],hobbies:(p==null?void 0:p.hobbies)||"",experiences:(p==null?void 0:p.experiences)||"",isPublic:String((p==null?void 0:p.visibility)||"")==="public",isPublished:String((p==null?void 0:p.status)||"")==="published"};f(g),ge(!1),$(!1)}catch{}})()}}),!_&&!I&&n.jsxs(n.Fragment,{children:[n.jsx(yh,{title:e===be.HOME?_t():e===be.CHAT?"":"",variant:e===be.ME?"overlay":"default",onFilterClick:()=>{e===be.HOME&&(x==="characters"?T(!0):x==="stories"&&(X(null),K([]),b(!0),(async()=>{try{const{authFetch:y}=await ve(async()=>{const{authFetch:m}=await import("./http-De6Ej-g0.js");return{authFetch:m}},__vite__mapDeps([0,1,2,3])),M=await y("/stories/combine");if(M&&M.ok){const m=await M.json(),p=Array.isArray(m==null?void 0:m.items)?m.items:[];K(p.map(g=>({id:String(g.character_id),name:g.character_name,avatar:g.character_avatar||"",desc:g.desc||"",isPrivate:!!g.isPrivate,isMine:!!g.isMine})))}}catch{}})()))},showAdd:e===be.HOME}),n.jsx(It,{initial:!1,children:n.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar scroll-smooth min-h-0",ref:Ae,children:rs()})}),n.jsx(vh,{activeTab:e,onTabChange:t})]})]})})})},ds=(e,t)=>[t,...e.filter(s=>String(s.id)!==String(t.id))];(function(){const e=()=>{const t=localStorage.getItem("user_id")||"0",s=Object.keys(localStorage),r=s.filter(f=>f.startsWith(`chat_history_${t}_`)),i=s.filter(f=>f.startsWith(`chat_session_${t}_`)),l=s.filter(f=>/^chat_history_\d+$/.test(f)),o=s.filter(f=>/^chat_session_\d+$/.test(f)),a=s.filter(f=>/^chat_config_\d+$/.test(f)),c=s.filter(f=>/^chat_model_\d+$/.test(f)),d=s.filter(f=>/^chat_temp_\d+$/.test(f)),h=s.filter(f=>/^chat_model_name_\d+$/.test(f));return{uid:t,historiesUid:r,sessionsUid:i,legacyHistories:l,legacySessions:o,cfg:a,models:c,temps:d,names:h}};try{window.__listLocalChatKeys=e}catch{}})();const nf=Object.freeze(Object.defineProperty({__proto__:null,default:Qh},Symbol.toStringTag,{value:"Module"}));export{nf as A,ro as B};
//# sourceMappingURL=App-CdwhOwiE.js.map
