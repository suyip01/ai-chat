{"version":3,"file":"CharacterProfile-C2aOr9Sx.js","sources":["../../user/components/CharacterProfile.tsx"],"sourcesContent":["\nimport React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { ArrowLeft, ChevronDown, ChevronUp, Heart, MessageCircle } from 'lucide-react';\nimport { Character } from '../types';\nimport { useToast } from './Toast';\n\ninterface CharacterProfileProps {\n  character: Character;\n  onBack: () => void;\n  onStartChat: () => void;\n  isFromChat?: boolean;\n  isExistingChat?: boolean;\n}\n\nexport const CharacterProfile: React.FC<CharacterProfileProps> = ({ character, onBack, onStartChat, isFromChat = false, isExistingChat = false }) => {\n  const [showAllTags, setShowAllTags] = useState(false);\n  const { showToast, showCenter } = useToast();\n  const [imgError, setImgError] = useState(false);\n\n  // Logic: Show first 4 initially. If showAllTags is true, show all.\n  const visibleTags = showAllTags ? character.tags : character.tags.slice(0, 4);\n  const hasMoreTags = character.tags.length > 4;\n\n  return (\n    <motion.div\n      className=\"fixed inset-0 z-50 bg-primary-50\"\n      initial={{ x: (((navigator as any)?.maxTouchPoints > 0) && isFromChat) ? '100%' : 0 }}\n      animate={{ x: 0 }}\n      exit={{ x: (((navigator as any)?.maxTouchPoints > 0) && isFromChat) ? '100%' : 0 }}\n      transition={{ duration: (((navigator as any)?.maxTouchPoints > 0) && isFromChat) ? 0.3 : 0, ease: 'linear' }}\n    >\n      <div className=\"mx-auto w-full max-w-md h-full flex flex-col bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative\">\n        {/* Back Button - Fixed Position */}\n        <button\n          onClick={onBack}\n          className=\"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all\"\n        >\n          <ArrowLeft size={24} />\n        </button>\n\n        <div className=\"flex-1 overflow-y-auto no-scrollbar relative pb-24\">\n\n          {/* Hero Image Section */}\n          <div className=\"relative w-full h-[55vh]\">\n\n\n            {/* Background Image - Use profileImage (original) if available, else avatar */}\n            {(!imgError && (character.profileImage || character.avatar)) ? (\n              <img\n                src={character.profileImage || character.avatar}\n                alt={character.name}\n                className=\"w-full h-full object-cover\"\n                onError={() => setImgError(true)}\n              />\n            ) : (\n              <div className=\"w-full h-full bg-slate-200 flex items-center justify-center\">\n                <span className=\"text-6xl font-bold text-slate-500\">{character.name?.[0] || '?'}</span>\n              </div>\n            )}\n\n            {/* Gradient Overlay */}\n            <div className=\"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10\"></div>\n\n            {/* Character Info Overlay - Left Aligned */}\n            <div className=\"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1\">\n              <div className=\"flex items-center gap-3\">\n                <h1 className=\"text-5xl font-bold tracking-wide\">{character.name}</h1>\n                {/* Dynamic Role Type Badge */}\n                <span className=\"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1\">\n                  <span className=\"text-green-400\">●</span> {character.roleType || '原创'}\n                </span>\n              </div>\n              <div className=\"flex items-center text-white text-sm font-medium pl-1\">\n                <span>{character.profession}</span>\n                <span className=\"mx-2 bg-white w-1 h-1 rounded-full\"></span>\n                <span>{character.age}</span>\n              </div>\n              <div className=\"text-white text-xs font-medium pl-1\">\n                by {character.creator}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10\">\n\n            {/* Tags */}\n            <div className=\"flex flex-wrap gap-2 mb-3\">\n              {visibleTags.map((tag, idx) => (\n                <span key={idx} className=\"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm\">\n                  # {tag}\n                </span>\n              ))}\n            </div>\n\n            {hasMoreTags && (\n              <div className=\"flex justify-center mb-8\">\n                <button\n                  onClick={() => setShowAllTags(!showAllTags)}\n                  className=\"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors\"\n                >\n                  {showAllTags ? '收起' : '展示更多'} {showAllTags ? <ChevronUp size={14} /> : <ChevronDown size={14} />}\n                </button>\n              </div>\n            )}\n\n            {/* One Line Persona */}\n            <div className=\"mb-8\">\n              <h3 className=\"text-purple-500 font-bold text-sm mb-3\">一句话人设</h3>\n              <div className=\"relative pl-4 py-1\">\n                <div className=\"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full\"></div>\n                <div className=\"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg\">\n                  “{character.oneLinePersona}”\n                </div>\n              </div>\n            </div>\n\n            {/* Personality */}\n            <div className=\"mb-8\">\n              <h3 className=\"text-purple-500 font-bold text-sm mb-3\">性格</h3>\n              <div className=\"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm\">\n                {character.personality}\n              </div>\n            </div>\n\n            {/* Current Relationship */}\n            <div className=\"mb-8\">\n              <h3 className=\"text-purple-500 font-bold text-sm mb-3\">当前关系</h3>\n              <div>\n                <span className=\"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold\">\n                  <Heart size={12} fill=\"currentColor\" /> {character.currentRelationship}\n                </span>\n              </div>\n            </div>\n\n            {/* First Plot */}\n            <div className=\"mb-8\">\n              <h3 className=\"text-purple-900 font-extrabold text-lg mb-4\">第一情节</h3>\n\n              <div className=\"flex items-center gap-2 mb-4\">\n                <span className=\"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold\">THEME</span>\n                <span className=\"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded\">\n                  {character.plotTheme}\n                </span>\n              </div>\n\n              <div className=\"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4\">\n                {character.plotDescription}\n              </div>\n\n              {/* Opening Line Section */}\n              {character.openingLine && (\n                <div className=\"bg-purple-50/50 rounded-2xl p-4 flex items-center\">\n                  <span className=\"text-purple-600 font-bold text-sm whitespace-nowrap mr-3\">\n                    角色开场白\n                  </span>\n                  <div className=\"h-4 w-[1px] bg-purple-200 mr-4\"></div>\n                  <span className=\"text-slate-700 font-bold text-sm\">\n                    {character.openingLine}\n                  </span>\n                </div>\n              )}\n\n            </div>\n\n          </div>\n        </div>\n\n        <div className=\"absolute bottom-3 inset-x-0 z-50\">\n          <div className=\"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]\">\n            <button\n              onClick={() => {\n                if (isFromChat) {\n                  onStartChat();\n                  return;\n                }\n                if (isExistingChat) {\n                  showCenter('当前角色已经在会话列表');\n                  return;\n                }\n                onStartChat();\n              }}\n              className=\"w-full font-bold text-lg py-4 rounded-2xl shadow-lg active:scale-[0.98] transition-all flex items-center justify-center gap-2 bg-purple-200 text-purple-900 shadow-purple-100\"\n            >\n              {isFromChat ? (\n                <>\n                  <MessageCircle size={20} />\n                  回到聊天\n                </>\n              ) : (\n                '唤醒角色'\n              )}\n            </button>\n          </div>\n        </div>\n\n      </div>\n    </motion.div>\n  );\n};\n"],"names":["CharacterProfile","character","onBack","onStartChat","isFromChat","isExistingChat","showAllTags","setShowAllTags","useState","showToast","showCenter","useToast","imgError","setImgError","visibleTags","hasMoreTags","jsx","motion","jsxs","ArrowLeft","_a","tag","idx","ChevronUp","ChevronDown","Heart","Fragment","MessageCircle"],"mappings":"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"}