const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StyleInjector-CAsOM66a.js","assets/index-DiMvcmcb.js","assets/index-CNJf0r43.css","assets/LoginPage-Cwx44NTI.js","assets/log-out-9e2S_i2i.js","assets/createLucideIcon-CiU7U1is.js","assets/Sidebar-waL8Dthh.js","assets/file-text-CyCg3Fb5.js","assets/user-DjmimaIa.js","assets/cpu-DXFdudmA.js","assets/chevron-down-C8dX3bVB.js","assets/chevron-right-jr0esStd.js","assets/TemplatesView-6P7Cp-uJ.js","assets/chevron-left-B3HkbiML.js","assets/save-DC2LZN-i.js","assets/x-CKT7hpuC.js","assets/plus-Bz3dnY0B.js","assets/info-Bu7G037R.js","assets/circle-check-big-IblmQXOf.js","assets/pen-line-BpKLzpbM.js","assets/copy-SCIkRcbw.js","assets/trash-2-CCl4-mF6.js","assets/CharacterManagement-5X-DgjnY.js","assets/pencil-DPfzMC3o.js","assets/zoom-out-1jEnNmIA.js","assets/circle-question-mark-C7ouqtkr.js","assets/send-BX7jbBow.js","assets/UsersView-BjH0VljC.js","assets/ModelSettingsView-CQr3tNG5.js","assets/ModelManageView-CwaOHbl0.js","assets/AdminAccountsView-CyLZFtb9.js","assets/StoryManagement-Ccn5Fdwd.js"])))=>i.map(i=>d[i]);
import{r as l,j as s,R as o,_ as u}from"./index-DiMvcmcb.js";import{c as I}from"./createLucideIcon-CiU7U1is.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],A=I("sparkles",$),w="/api/admin",D=()=>localStorage.getItem("admin_access_token")||"",L=()=>localStorage.getItem("admin_refresh_token")||"",J=(e,t)=>{e&&localStorage.setItem("admin_access_token",e),t&&localStorage.setItem("admin_refresh_token",t)},v=()=>{localStorage.removeItem("admin_access_token"),localStorage.removeItem("admin_refresh_token");const e="/super-admin/login";typeof window<"u"&&window.location&&(typeof window.location.replace=="function"?window.location.replace(e):window.location.href=e)},P=()=>({Authorization:`Bearer ${D()}`});let g=null;const R=async()=>{const e=L();if(!e)throw v(),new Error("unauthorized");const t=await fetch(`${w}/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!t.ok)throw v(),new Error("refresh_failed");const r=await t.json();return J(r.access_token,r.refresh_token),r},a=async(e,t={})=>{const r={...t},m=typeof FormData<"u"&&r.body instanceof FormData,i=P(),p=m?{}:{"Content-Type":"application/json"};r.headers={...r.headers||{},...p,...i};let c=await fetch(`${w}${e}`,r);if(c.status===401){g||(g=R());try{await g}finally{g=null}const d=P(),y=m?{}:{"Content-Type":"application/json"};if(r.headers={...r.headers||{},...y,...d},c=await fetch(`${w}${e}`,r),c.status===401)throw v(),new Error("unauthorized")}if(!c.ok)throw new Error("failed");if(!c.ok){let d="";try{d=await c.text()}catch{}throw console.error("[admin.api.request] failed",{path:e,status:c.status,body:d}),new Error("failed")}return c.json()},X={async list(){return a("/templates")},async create(e){return a("/templates",{method:"POST",body:JSON.stringify(e)})},async update(e,t){return a(`/templates/${e}`,{method:"PUT",body:JSON.stringify(t)})},async remove(e){return a(`/templates/${e}`,{method:"DELETE"})},async copy(e){return a(`/templates/${e}/copy`,{method:"POST"})},async setDefault(e){return a(`/templates/${e}/default`,{method:"POST"})}},Y={async list(e){const t=e?"?"+new URLSearchParams(e).toString():"";return a(`/characters${t}`)},async get(e){return a(`/characters/${e}`)},async create(e){return a("/characters",{method:"POST",body:JSON.stringify(e)})},async update(e,t){return a(`/characters/${e}`,{method:"PUT",body:JSON.stringify(t)})},async remove(e){return a(`/characters/${e}`,{method:"DELETE"})},async setStatus(e,t){return a(`/characters/${e}/status`,{method:"POST",body:JSON.stringify({status:t})})}},Z={async list(){return a("/models")},async create(e){return a("/models",{method:"POST",body:JSON.stringify(e)})},async remove(e){return a(`/models/${e}`,{method:"DELETE"})}},ee={async get(){return a("/settings")},async save(e){return a("/settings",{method:"PUT",body:JSON.stringify(e)})}},te={async list(){return a("/stories")},async get(e){return a(`/stories/${e}`)},async create(e){return a("/stories",{method:"POST",body:JSON.stringify(e)})},async update(e,t){return a(`/stories/${e}`,{method:"PUT",body:JSON.stringify(t)})},async remove(e){return a(`/stories/${e}`,{method:"DELETE"})},async setStatus(e,t){return a(`/stories/${e}/status`,{method:"POST",body:JSON.stringify({status:t})})}},se={async generate(e){return a("/sysprompt/generate",{method:"POST",body:JSON.stringify(e)})},async generateNoScene(e){return a("/sysprompt/generate-noscene",{method:"POST",body:JSON.stringify(e)})}},ae={async avatar(e){const t=new FormData;return t.append("avatar",e),a("/uploads/avatar",{method:"POST",body:t})},async cover(e){const t=new FormData;return t.append("cover",e),a("/uploads/cover",{method:"POST",body:t})}},re={async list(e){const t=e?`?q=${encodeURIComponent(e)}`:"";return a(`/users${t}`)},async create({username:e,nickname:t,email:r,password:m,chatLimit:i}){return a("/users",{method:"POST",body:JSON.stringify({username:e,nickname:t,email:r,password:m,chatLimit:i})})},async update(e,t){return a(`/users/${e}`,{method:"PUT",body:JSON.stringify(t)})},async remove(e){return a(`/users/${e}`,{method:"DELETE"})},async changePassword(e,t){return a(`/users/${e}/password`,{method:"POST",body:JSON.stringify({password:t})})}},z={async list(e){const t=e?`?q=${encodeURIComponent(e)}`:"";return a(`/admins${t}`)},async create({username:e,email:t,password:r}){return a("/admins",{method:"POST",body:JSON.stringify({username:e,email:t,password:r})})},async update(e,t){return a(`/admins/${e}`,{method:"PUT",body:JSON.stringify(t)})},async remove(e){return a(`/admins/${e}`,{method:"DELETE"})},async changePassword(e,t){return a(`/admins/${e}/password`,{method:"POST",body:JSON.stringify({password:t})})},async getMyAvatar(){return a("/admins/me/avatar")},async updateMe(e){return a("/admins/me",{method:"PUT",body:JSON.stringify(e)})}},N=l.createContext(null),ne=()=>l.useContext(N),C=({children:e})=>{const[t,r]=l.useState([]),m=l.useCallback((i,p="success")=>{const c=Date.now()+Math.random();r(d=>[...d,{id:c,message:i,type:p}]),setTimeout(()=>{r(d=>d.filter(y=>y.id!==c))},3e3)},[]);return s.jsxs(N.Provider,{value:{showToast:m},children:[e,s.jsx("div",{className:"fixed top-6 left-64 right-0 z-50 flex flex-col items-center gap-3 pointer-events-none",children:t.map(i=>s.jsx("div",{className:`pointer-events-auto flex items-center justify-center text-center px-4 py-2 rounded-2xl shadow-xl border max-w-[480px] min-w-[180px] mx-auto ${i.type==="success"?"bg-white border-green-200 text-green-700":"bg-white border-red-200 text-red-700"}`,children:i.message},i.id))})]})},E=o.lazy(()=>u(()=>import("./StyleInjector-CAsOM66a.js"),__vite__mapDeps([0,1,2]))),V=o.lazy(()=>u(()=>import("./LoginPage-Cwx44NTI.js"),__vite__mapDeps([3,1,2,4,5]))),M=o.lazy(()=>u(()=>import("./Sidebar-waL8Dthh.js"),__vite__mapDeps([6,1,2,7,5,8,9,10,11,4]))),U=o.lazy(()=>u(()=>import("./TemplatesView-6P7Cp-uJ.js"),__vite__mapDeps([12,1,2,13,5,14,15,16,17,18,19,20,21]))),O=o.lazy(()=>u(()=>import("./CharacterManagement-5X-DgjnY.js"),__vite__mapDeps([22,1,2,13,5,15,23,21,24,14,17,10,25,7,16,19,20,26]))),q=o.lazy(()=>u(()=>import("./UsersView-BjH0VljC.js"),__vite__mapDeps([27,1,2,18,5,19,21,13,16]))),F=o.lazy(()=>u(()=>import("./ModelSettingsView-CQr3tNG5.js"),__vite__mapDeps([28,1,2,14,5,25]))),H=o.lazy(()=>u(()=>import("./ModelManageView-CwaOHbl0.js"),__vite__mapDeps([29,1,2,16,5,21,15]))),B=o.lazy(()=>u(()=>import("./AdminAccountsView-CyLZFtb9.js"),__vite__mapDeps([30,1,2,16,5,15]))),G=o.lazy(()=>u(()=>import("./StoryManagement-Ccn5Fdwd.js"),__vite__mapDeps([31,1,2,13,5,15,24,14,16,19,26]))),K=()=>{const[e,t]=l.useState(!1),[r,m]=l.useState("templates"),[i,p]=l.useState(""),[c,d]=l.useState(!1),[y,x]=l.useState(""),[h,_]=l.useState(""),[b,S]=l.useState(""),k=async()=>{const n={};if(y&&y.trim()&&(n.nickname=y.trim()),h){if(h!==b)return;n.password=h}try{await z.updateMe(n),d(!1),x(""),_(""),S("")}catch{}},f=n=>{window.history&&window.history.replaceState&&window.history.replaceState(null,"",n)};return l.useEffect(()=>{const n=localStorage.getItem("admin_access_token"),j=localStorage.getItem("admin_username"),T=window.location.pathname;n?(t(!0),j&&p(j),m("templates"),T!=="/super-admin/sysprompt"&&f("/super-admin/sysprompt")):(t(!1),T!=="/super-admin/login"&&f("/super-admin/login"))},[]),e?s.jsxs("div",{className:"flex min-h-screen bg白",children:[s.jsx(o.Suspense,{fallback:s.jsx("div",{}),children:s.jsx(E,{})}),s.jsx(o.Suspense,{fallback:s.jsx("div",{}),children:s.jsx(M,{activeTab:r,setActiveTab:n=>{m(n),n==="templates"&&f("/super-admin/sysprompt")},onLogout:()=>{t(!1),localStorage.removeItem("admin_access_token"),localStorage.removeItem("admin_refresh_token"),localStorage.removeItem("admin_username"),f("/super-admin/login")},username:i,onEditProfile:()=>d(!0)})}),s.jsxs("main",{className:"flex-1 ml-16 xl:ml-56 p-8 relative z-10 transition-all duration-300 h-screen overflow-y-auto",children:[s.jsx("div",{className:"absolute top-0 right-0 p-4 pointer-events-none opacity-20",children:s.jsx(A,{size:120,className:"text-pink-300"})}),s.jsxs(o.Suspense,{fallback:s.jsx("div",{}),children:[r==="templates"&&s.jsx(U,{}),r==="stories"&&s.jsx(G,{}),(r==="characters"||r==="official_characters")&&s.jsx(O,{creatorRole:"admin_role"}),r==="user_characters"&&s.jsx(O,{creatorRole:"user_role"}),r==="users"&&s.jsx(q,{}),r==="model_settings"&&s.jsx(F,{}),r==="model_manage"&&i==="admin"&&s.jsx(H,{}),r==="admin_accounts"&&i==="admin"&&s.jsx(B,{})]})]}),s.jsx("div",{className:"ambient-bg"}),c&&s.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/40",children:s.jsxs("div",{className:"bg-white rounded-2xl p-6 w-96 shadow-2xl",children:[s.jsx("div",{className:"font-bold mb-4 text-pink-900",children:"修改资料"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{children:s.jsx("input",{type:"text",placeholder:`昵称（当前：${i}）`,value:y,onChange:n=>x(n.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),s.jsx("div",{children:s.jsx("input",{type:"password",placeholder:"新密码",value:h,onChange:n=>_(n.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),s.jsx("div",{children:s.jsx("input",{type:"password",placeholder:"再次输入新密码",value:b,onChange:n=>S(n.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})})]}),s.jsxs("div",{className:"flex gap-2 justify-end mt-5",children:[s.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{d(!1),x(""),_(""),S("")},children:"取消"}),s.jsx("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:k,disabled:!y.trim()&&!h,children:"保存"})]})]})})]}):s.jsxs(s.Fragment,{children:[s.jsx(o.Suspense,{fallback:s.jsx("div",{}),children:s.jsx(E,{})}),s.jsx(C,{children:s.jsx(o.Suspense,{fallback:s.jsx("div",{}),children:s.jsx(V,{onLogin:()=>{t(!0);const n=localStorage.getItem("admin_username");n&&p(n),m("templates"),f("/super-admin/sysprompt")}})})})]})},oe=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{oe as A,w as B,A as S,C as T,z as a,ae as b,Y as c,re as d,ee as e,te as f,Z as m,se as s,X as t,ne as u};
//# sourceMappingURL=AdminDashboard-D62DCIkd.js.map
