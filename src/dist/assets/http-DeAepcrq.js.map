{"version":3,"file":"http-DeAepcrq.js","sources":["../../user/services/http.ts"],"sourcesContent":["import { BASE_URL } from '../api'\n\nconst getAccessToken = () => localStorage.getItem('user_access_token') || ''\nconst getRefreshToken = () => localStorage.getItem('user_refresh_token') || ''\n\nconst setAccessToken = (t: string) => { if (t) localStorage.setItem('user_access_token', t) }\n\nexport const authFetch = async (path: string, init: RequestInit = {}) => {\n  const url = path.startsWith('http') ? path : `${BASE_URL}${path.startsWith('/') ? '' : '/'}${path}`\n  const headers = new Headers(init.headers || {})\n  const at = getAccessToken()\n  if (at) headers.set('Authorization', `Bearer ${at}`)\n  const res = await fetch(url, { ...init, headers })\n  if (res.status !== 401) return res\n  const rt = getRefreshToken()\n  if (!rt) {\n    try { localStorage.removeItem('user_access_token'); localStorage.removeItem('user_refresh_token') } catch {}\n    try { window.location.reload() } catch {}\n    return res\n  }\n  try {\n    const rf = await fetch(`${BASE_URL}/auth/refresh`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ refresh_token: rt })\n    })\n    if (rf.ok) {\n      const data = await rf.json()\n      if (data?.access_token) setAccessToken(data.access_token)\n      const retryHeaders = new Headers(init.headers || {})\n      retryHeaders.set('Authorization', `Bearer ${data.access_token}`)\n      const retry = await fetch(url, { ...init, headers: retryHeaders })\n      if (retry.status === 401) {\n        try { localStorage.removeItem('user_access_token'); localStorage.removeItem('user_refresh_token') } catch {}\n        try { window.location.reload() } catch {}\n      }\n      return retry\n    }\n    if (rf.status === 401) {\n      try { localStorage.removeItem('user_access_token'); localStorage.removeItem('user_refresh_token') } catch {}\n      try { window.location.reload() } catch {}\n    }\n  } catch {}\n  return res\n}\n"],"names":["getAccessToken","getRefreshToken","setAccessToken","t","authFetch","path","init","url","BASE_URL","headers","at","res","rt","rf","data","retryHeaders","retry"],"mappings":"0FAEA,MAAMA,EAAiB,IAAM,aAAa,QAAQ,mBAAmB,GAAK,GACpEC,EAAkB,IAAM,aAAa,QAAQ,oBAAoB,GAAK,GAEtEC,EAAkBC,GAAc,CAAMA,GAAG,aAAa,QAAQ,oBAAqBA,CAAC,CAAE,EAE/EC,EAAY,MAAOC,EAAcC,EAAoB,KAAO,CACvE,MAAMC,EAAMF,EAAK,WAAW,MAAM,EAAIA,EAAO,GAAGG,CAAQ,GAAGH,EAAK,WAAW,GAAG,EAAI,GAAK,GAAG,GAAGA,CAAI,GAC3FI,EAAU,IAAI,QAAQH,EAAK,SAAW,CAAA,CAAE,EACxCI,EAAKV,EAAA,EACPU,GAAID,EAAQ,IAAI,gBAAiB,UAAUC,CAAE,EAAE,EACnD,MAAMC,EAAM,MAAM,MAAMJ,EAAK,CAAE,GAAGD,EAAM,QAAAG,EAAS,EACjD,GAAIE,EAAI,SAAW,IAAK,OAAOA,EAC/B,MAAMC,EAAKX,EAAA,EACX,GAAI,CAACW,EAAI,CACP,GAAI,CAAE,aAAa,WAAW,mBAAmB,EAAG,aAAa,WAAW,oBAAoB,CAAE,MAAQ,CAAC,CAC3G,GAAI,CAAE,OAAO,SAAS,OAAA,CAAS,MAAQ,CAAC,CACxC,OAAOD,CACT,CACA,GAAI,CACF,MAAME,EAAK,MAAM,MAAM,GAAGL,CAAQ,gBAAiB,CACjD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,cAAeI,EAAI,CAAA,CAC3C,EACD,GAAIC,EAAG,GAAI,CACT,MAAMC,EAAO,MAAMD,EAAG,KAAA,EAClBC,GAAA,MAAAA,EAAM,cAAcZ,EAAeY,EAAK,YAAY,EACxD,MAAMC,EAAe,IAAI,QAAQT,EAAK,SAAW,CAAA,CAAE,EACnDS,EAAa,IAAI,gBAAiB,UAAUD,EAAK,YAAY,EAAE,EAC/D,MAAME,EAAQ,MAAM,MAAMT,EAAK,CAAE,GAAGD,EAAM,QAASS,EAAc,EACjE,GAAIC,EAAM,SAAW,IAAK,CACxB,GAAI,CAAE,aAAa,WAAW,mBAAmB,EAAG,aAAa,WAAW,oBAAoB,CAAE,MAAQ,CAAC,CAC3G,GAAI,CAAE,OAAO,SAAS,OAAA,CAAS,MAAQ,CAAC,CAC1C,CACA,OAAOA,CACT,CACA,GAAIH,EAAG,SAAW,IAAK,CACrB,GAAI,CAAE,aAAa,WAAW,mBAAmB,EAAG,aAAa,WAAW,oBAAoB,CAAE,MAAQ,CAAC,CAC3G,GAAI,CAAE,OAAO,SAAS,OAAA,CAAS,MAAQ,CAAC,CAC1C,CACF,MAAQ,CAAC,CACT,OAAOF,CACT"}