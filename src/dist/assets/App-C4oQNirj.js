const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/http-CAiBnKza.js","assets/index-C_fwXIAE.js","assets/index-DaHB39Rm.css","assets/x-B9sGg7bh.js"])))=>i.map(i=>d[i]);
import{r as h,j as n,_ as de,R as Ja}from"./index-C_fwXIAE.js";import{c as ke,P as st,U as Qs,X as ut,d as Ht,f as Za,e as ur,T as en,S as hr,b as Vt,C as Qa,a as Lt,I as fr,L as $n}from"./x-B9sGg7bh.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],us=ke("arrow-left",eo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],so=ke("arrow-right",to);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const no=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],tn=ke("camera",no);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const io=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],mr=ke("check",io);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ro=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],sn=ke("chevron-up",ro);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ds=ke("circle-alert",ao);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oo=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],lo=ke("ellipsis-vertical",oo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],uo=ke("eye-off",co);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ho=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],fo=ke("eye",ho);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],po=ke("globe",mo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],pr=ke("heart",xo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],yo=ke("house",go);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vo=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],bo=ke("lock",vo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],jo=ke("mail",wo);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],nn=ke("message-circle",No);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],To=ke("message-square",So);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=[["path",{d:"M5 12h14",key:"1ays0h"}]],ko=ke("minus",Co);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],_o=ke("pen-tool",Ao);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Is=ke("pen",Po);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eo=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],Mo=ke("pin",Eo),rn=h.createContext({});function an(e){const t=h.useRef(null);return t.current===null&&(t.current=e()),t.current}const hs=h.createContext(null),on=h.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Ro extends h.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=s.offsetHeight||0,i.width=s.offsetWidth||0,i.top=s.offsetTop,i.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Do({children:e,isPresent:t}){const s=h.useId(),i=h.useRef(null),r=h.useRef({width:0,height:0,top:0,left:0}),{nonce:a}=h.useContext(on);return h.useInsertionEffect(()=>{const{width:l,height:o,top:c,left:d}=r.current;if(t||!i.current||!l||!o)return;i.current.dataset.motionPopId=s;const u=document.createElement("style");return a&&(u.nonce=a),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${o}px !important;
            top: ${c}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[t]),n.jsx(Ro,{isPresent:t,childRef:i,sizeRef:r,children:h.cloneElement(e,{ref:i})})}const Io=({children:e,initial:t,isPresent:s,onExitComplete:i,custom:r,presenceAffectsLayout:a,mode:l})=>{const o=an(Vo),c=h.useId(),d=h.useCallback(f=>{o.set(f,!0);for(const m of o.values())if(!m)return;i&&i()},[o,i]),u=h.useMemo(()=>({id:c,initial:t,isPresent:s,custom:r,onExitComplete:d,register:f=>(o.set(f,!1),()=>o.delete(f))}),a?[Math.random(),d]:[s,d]);return h.useMemo(()=>{o.forEach((f,m)=>o.set(m,!1))},[s]),h.useEffect(()=>{!s&&!o.size&&i&&i()},[s]),l==="popLayout"&&(e=n.jsx(Do,{isPresent:s,children:e})),n.jsx(hs.Provider,{value:u,children:e})};function Vo(){return new Map}function xr(e=!0){const t=h.useContext(hs);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:i,register:r}=t,a=h.useId();h.useEffect(()=>{e&&r(a)},[e]);const l=h.useCallback(()=>e&&i&&i(a),[a,i,e]);return!s&&i?[!1,l]:[!0]}const Gt=e=>e.key||"";function Bn(e){const t=[];return h.Children.forEach(e,s=>{h.isValidElement(s)&&t.push(s)}),t}const ln=typeof window<"u",gr=ln?h.useLayoutEffect:h.useEffect,vt=({children:e,custom:t,initial:s=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:a="sync",propagate:l=!1})=>{const[o,c]=xr(l),d=h.useMemo(()=>Bn(e),[e]),u=l&&!o?[]:d.map(Gt),f=h.useRef(!0),m=h.useRef(d),g=an(()=>new Map),[j,b]=h.useState(d),[P,C]=h.useState(d);gr(()=>{f.current=!1,m.current=d;for(let U=0;U<P.length;U++){const T=Gt(P[U]);u.includes(T)?g.delete(T):g.get(T)!==!0&&g.set(T,!1)}},[P,u.length,u.join("-")]);const E=[];if(d!==j){let U=[...d];for(let T=0;T<P.length;T++){const k=P[T],V=Gt(k);u.includes(V)||(U.splice(T,0,k),E.push(k))}a==="wait"&&E.length&&(U=E),C(Bn(U)),b(d);return}const{forceRender:_}=h.useContext(rn);return n.jsx(n.Fragment,{children:P.map(U=>{const T=Gt(U),k=l&&!o?!1:d===P||u.includes(T),V=()=>{if(g.has(T))g.set(T,!0);else return;let M=!0;g.forEach(W=>{W||(M=!1)}),M&&(_==null||_(),C(m.current),l&&(c==null||c()),i&&i())};return n.jsx(Io,{isPresent:k,initial:!f.current||s?void 0:!1,custom:k?void 0:t,presenceAffectsLayout:r,mode:a,onExitComplete:k?void 0:V,children:U},T)})})},Fe=e=>e;let yr=Fe;function cn(e){let t;return()=>(t===void 0&&(t=e()),t)}const bt=(e,t,s)=>{const i=t-e;return i===0?1:(s-e)/i},qe=e=>e*1e3,Je=e=>e/1e3,Lo={useManualTiming:!1};function Fo(e){let t=new Set,s=new Set,i=!1,r=!1;const a=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function o(d){a.has(d)&&(c.schedule(d),e()),d(l)}const c={schedule:(d,u=!1,f=!1)=>{const g=f&&i?t:s;return u&&a.add(d),g.has(d)||g.add(d),d},cancel:d=>{s.delete(d),a.delete(d)},process:d=>{if(l=d,i){r=!0;return}i=!0,[t,s]=[s,t],t.forEach(o),t.clear(),i=!1,r&&(r=!1,c.process(d))}};return c}const qt=["read","resolveKeyframes","update","preRender","render","postRender"],Oo=40;function vr(e,t){let s=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=()=>s=!0,l=qt.reduce((C,E)=>(C[E]=Fo(a),C),{}),{read:o,resolveKeyframes:c,update:d,preRender:u,render:f,postRender:m}=l,g=()=>{const C=performance.now();s=!1,r.delta=i?1e3/60:Math.max(Math.min(C-r.timestamp,Oo),1),r.timestamp=C,r.isProcessing=!0,o.process(r),c.process(r),d.process(r),u.process(r),f.process(r),m.process(r),r.isProcessing=!1,s&&t&&(i=!1,e(g))},j=()=>{s=!0,i=!0,r.isProcessing||e(g)};return{schedule:qt.reduce((C,E)=>{const _=l[E];return C[E]=(U,T=!1,k=!1)=>(s||j(),_.schedule(U,T,k)),C},{}),cancel:C=>{for(let E=0;E<qt.length;E++)l[qt[E]].cancel(C)},state:r,steps:l}}const{schedule:xe,cancel:nt,state:Ee,steps:bs}=vr(typeof requestAnimationFrame<"u"?requestAnimationFrame:Fe,!0),br=h.createContext({strict:!1}),Un={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},wt={};for(const e in Un)wt[e]={isEnabled:t=>Un[e].some(s=>!!t[s])};function zo(e){for(const t in e)wt[t]={...wt[t],...e[t]}}const $o=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ns(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||$o.has(e)}let wr=e=>!ns(e);function Bo(e){e&&(wr=t=>t.startsWith("on")?!ns(t):e(t))}try{Bo(require("@emotion/is-prop-valid").default)}catch{}function Uo(e,t,s){const i={};for(const r in e)r==="values"&&typeof e.values=="object"||(wr(r)||s===!0&&ns(r)||!t&&!ns(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}function Ho(e){if(typeof Proxy>"u")return e;const t=new Map,s=(...i)=>e(...i);return new Proxy(s,{get:(i,r)=>r==="create"?e:(t.has(r)||t.set(r,e(r)),t.get(r))})}const fs=h.createContext({});function Ft(e){return typeof e=="string"||Array.isArray(e)}function ms(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const dn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],un=["initial",...dn];function ps(e){return ms(e.animate)||un.some(t=>Ft(e[t]))}function jr(e){return!!(ps(e)||e.variants)}function Wo(e,t){if(ps(e)){const{initial:s,animate:i}=e;return{initial:s===!1||Ft(s)?s:void 0,animate:Ft(i)?i:void 0}}return e.inherit!==!1?t:{}}function Ko(e){const{initial:t,animate:s}=Wo(e,h.useContext(fs));return h.useMemo(()=>({initial:t,animate:s}),[Hn(t),Hn(s)])}function Hn(e){return Array.isArray(e)?e.join(" "):e}const Yo=Symbol.for("motionComponentSymbol");function mt(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Xo(e,t,s){return h.useCallback(i=>{i&&e.onMount&&e.onMount(i),t&&(i?t.mount(i):t.unmount()),s&&(typeof s=="function"?s(i):mt(s)&&(s.current=i))},[t])}const hn=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Go="framerAppearId",Nr="data-"+hn(Go),{schedule:fn}=vr(queueMicrotask,!1),Sr=h.createContext({});function qo(e,t,s,i,r){var a,l;const{visualElement:o}=h.useContext(fs),c=h.useContext(br),d=h.useContext(hs),u=h.useContext(on).reducedMotion,f=h.useRef(null);i=i||c.renderer,!f.current&&i&&(f.current=i(e,{visualState:t,parent:o,props:s,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:u}));const m=f.current,g=h.useContext(Sr);m&&!m.projection&&r&&(m.type==="html"||m.type==="svg")&&Jo(f.current,s,r,g);const j=h.useRef(!1);h.useInsertionEffect(()=>{m&&j.current&&m.update(s,d)});const b=s[Nr],P=h.useRef(!!b&&!(!((a=window.MotionHandoffIsComplete)===null||a===void 0)&&a.call(window,b))&&((l=window.MotionHasOptimisedAnimation)===null||l===void 0?void 0:l.call(window,b)));return gr(()=>{m&&(j.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),fn.render(m.render),P.current&&m.animationState&&m.animationState.animateChanges())}),h.useEffect(()=>{m&&(!P.current&&m.animationState&&m.animationState.animateChanges(),P.current&&(queueMicrotask(()=>{var C;(C=window.MotionHandoffMarkAsComplete)===null||C===void 0||C.call(window,b)}),P.current=!1))}),m}function Jo(e,t,s,i){const{layoutId:r,layout:a,drag:l,dragConstraints:o,layoutScroll:c,layoutRoot:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:Tr(e.parent)),e.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:!!l||o&&mt(o),visualElement:e,animationType:typeof a=="string"?a:"both",initialPromotionConfig:i,layoutScroll:c,layoutRoot:d})}function Tr(e){if(e)return e.options.allowProjection!==!1?e.projection:Tr(e.parent)}function Zo({preloadedFeatures:e,createVisualElement:t,useRender:s,useVisualState:i,Component:r}){var a,l;e&&zo(e);function o(d,u){let f;const m={...h.useContext(on),...d,layoutId:Qo(d)},{isStatic:g}=m,j=Ko(d),b=i(d,g);if(!g&&ln){el();const P=tl(m);f=P.MeasureLayout,j.visualElement=qo(r,b,m,t,P.ProjectionNode)}return n.jsxs(fs.Provider,{value:j,children:[f&&j.visualElement?n.jsx(f,{visualElement:j.visualElement,...m}):null,s(r,d,Xo(b,j.visualElement,u),b,g,j.visualElement)]})}o.displayName=`motion.${typeof r=="string"?r:`create(${(l=(a=r.displayName)!==null&&a!==void 0?a:r.name)!==null&&l!==void 0?l:""})`}`;const c=h.forwardRef(o);return c[Yo]=r,c}function Qo({layoutId:e}){const t=h.useContext(rn).id;return t&&e!==void 0?t+"-"+e:e}function el(e,t){h.useContext(br).strict}function tl(e){const{drag:t,layout:s}=wt;if(!t&&!s)return{};const i={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(e)||s!=null&&s.isEnabled(e)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const sl=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function mn(e){return typeof e!="string"||e.includes("-")?!1:!!(sl.indexOf(e)>-1||/[A-Z]/u.test(e))}function Wn(e){const t=[{},{}];return e==null||e.values.forEach((s,i)=>{t[0][i]=s.get(),t[1][i]=s.getVelocity()}),t}function pn(e,t,s,i){if(typeof t=="function"){const[r,a]=Wn(i);t=t(s!==void 0?s:e.custom,r,a)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[r,a]=Wn(i);t=t(s!==void 0?s:e.custom,r,a)}return t}const Vs=e=>Array.isArray(e),nl=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),il=e=>Vs(e)?e[e.length-1]||0:e,De=e=>!!(e&&e.getVelocity);function es(e){const t=De(e)?e.get():e;return nl(t)?t.toValue():t}function rl({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:s},i,r,a){const l={latestValues:al(i,r,a,e),renderState:t()};return s&&(l.onMount=o=>s({props:i,current:o,...l}),l.onUpdate=o=>s(o)),l}const Cr=e=>(t,s)=>{const i=h.useContext(fs),r=h.useContext(hs),a=()=>rl(e,t,i,r);return s?a():an(a)};function al(e,t,s,i){const r={},a=i(e,{});for(const m in a)r[m]=es(a[m]);let{initial:l,animate:o}=e;const c=ps(e),d=jr(e);t&&d&&!c&&e.inherit!==!1&&(l===void 0&&(l=t.initial),o===void 0&&(o=t.animate));let u=s?s.initial===!1:!1;u=u||l===!1;const f=u?o:l;if(f&&typeof f!="boolean"&&!ms(f)){const m=Array.isArray(f)?f:[f];for(let g=0;g<m.length;g++){const j=pn(e,m[g]);if(j){const{transitionEnd:b,transition:P,...C}=j;for(const E in C){let _=C[E];if(Array.isArray(_)){const U=u?_.length-1:0;_=_[U]}_!==null&&(r[E]=_)}for(const E in b)r[E]=b[E]}}}return r}const Nt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ft=new Set(Nt),kr=e=>t=>typeof t=="string"&&t.startsWith(e),Ar=kr("--"),ol=kr("var(--"),xn=e=>ol(e)?ll.test(e.split("/*")[0].trim()):!1,ll=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,_r=(e,t)=>t&&typeof e=="number"?t.transform(e):e,Ze=(e,t,s)=>s>t?t:s<e?e:s,St={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Ot={...St,transform:e=>Ze(0,1,e)},Jt={...St,default:1},Wt=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),tt=Wt("deg"),Xe=Wt("%"),J=Wt("px"),cl=Wt("vh"),dl=Wt("vw"),Kn={...Xe,parse:e=>Xe.parse(e)/100,transform:e=>Xe.transform(e*100)},ul={borderWidth:J,borderTopWidth:J,borderRightWidth:J,borderBottomWidth:J,borderLeftWidth:J,borderRadius:J,radius:J,borderTopLeftRadius:J,borderTopRightRadius:J,borderBottomRightRadius:J,borderBottomLeftRadius:J,width:J,maxWidth:J,height:J,maxHeight:J,top:J,right:J,bottom:J,left:J,padding:J,paddingTop:J,paddingRight:J,paddingBottom:J,paddingLeft:J,margin:J,marginTop:J,marginRight:J,marginBottom:J,marginLeft:J,backgroundPositionX:J,backgroundPositionY:J},hl={rotate:tt,rotateX:tt,rotateY:tt,rotateZ:tt,scale:Jt,scaleX:Jt,scaleY:Jt,scaleZ:Jt,skew:tt,skewX:tt,skewY:tt,distance:J,translateX:J,translateY:J,translateZ:J,x:J,y:J,z:J,perspective:J,transformPerspective:J,opacity:Ot,originX:Kn,originY:Kn,originZ:J},Yn={...St,transform:Math.round},gn={...ul,...hl,zIndex:Yn,size:J,fillOpacity:Ot,strokeOpacity:Ot,numOctaves:Yn},fl={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},ml=Nt.length;function pl(e,t,s){let i="",r=!0;for(let a=0;a<ml;a++){const l=Nt[a],o=e[l];if(o===void 0)continue;let c=!0;if(typeof o=="number"?c=o===(l.startsWith("scale")?1:0):c=parseFloat(o)===0,!c||s){const d=_r(o,gn[l]);if(!c){r=!1;const u=fl[l]||l;i+=`${u}(${d}) `}s&&(t[l]=d)}}return i=i.trim(),s?i=s(t,r?"":i):r&&(i="none"),i}function yn(e,t,s){const{style:i,vars:r,transformOrigin:a}=e;let l=!1,o=!1;for(const c in t){const d=t[c];if(ft.has(c)){l=!0;continue}else if(Ar(c)){r[c]=d;continue}else{const u=_r(d,gn[c]);c.startsWith("origin")?(o=!0,a[c]=u):i[c]=u}}if(t.transform||(l||s?i.transform=pl(t,e.transform,s):i.transform&&(i.transform="none")),o){const{originX:c="50%",originY:d="50%",originZ:u=0}=a;i.transformOrigin=`${c} ${d} ${u}`}}const xl={offset:"stroke-dashoffset",array:"stroke-dasharray"},gl={offset:"strokeDashoffset",array:"strokeDasharray"};function yl(e,t,s=1,i=0,r=!0){e.pathLength=1;const a=r?xl:gl;e[a.offset]=J.transform(-i);const l=J.transform(t),o=J.transform(s);e[a.array]=`${l} ${o}`}function Xn(e,t,s){return typeof e=="string"?e:J.transform(t+s*e)}function vl(e,t,s){const i=Xn(t,e.x,e.width),r=Xn(s,e.y,e.height);return`${i} ${r}`}function vn(e,{attrX:t,attrY:s,attrScale:i,originX:r,originY:a,pathLength:l,pathSpacing:o=1,pathOffset:c=0,...d},u,f){if(yn(e,d,f),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:m,style:g,dimensions:j}=e;m.transform&&(j&&(g.transform=m.transform),delete m.transform),j&&(r!==void 0||a!==void 0||g.transform)&&(g.transformOrigin=vl(j,r!==void 0?r:.5,a!==void 0?a:.5)),t!==void 0&&(m.x=t),s!==void 0&&(m.y=s),i!==void 0&&(m.scale=i),l!==void 0&&yl(m,l,o,c,!1)}const bn=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Pr=()=>({...bn(),attrs:{}}),wn=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Er(e,{style:t,vars:s},i,r){Object.assign(e.style,t,r&&r.getProjectionStyles(i));for(const a in s)e.style.setProperty(a,s[a])}const Mr=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Rr(e,t,s,i){Er(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(Mr.has(r)?r:hn(r),t.attrs[r])}const is={};function bl(e){Object.assign(is,e)}function Dr(e,{layout:t,layoutId:s}){return ft.has(e)||e.startsWith("origin")||(t||s!==void 0)&&(!!is[e]||e==="opacity")}function jn(e,t,s){var i;const{style:r}=e,a={};for(const l in r)(De(r[l])||t.style&&De(t.style[l])||Dr(l,e)||((i=s==null?void 0:s.getValue(l))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(a[l]=r[l]);return a}function Ir(e,t,s){const i=jn(e,t,s);for(const r in e)if(De(e[r])||De(t[r])){const a=Nt.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[a]=e[r]}return i}function wl(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const Gn=["x","y","width","height","cx","cy","r"],jl={useVisualState:Cr({scrapeMotionValuesFromProps:Ir,createRenderState:Pr,onUpdate:({props:e,prevProps:t,current:s,renderState:i,latestValues:r})=>{if(!s)return;let a=!!e.drag;if(!a){for(const o in r)if(ft.has(o)){a=!0;break}}if(!a)return;let l=!t;if(t)for(let o=0;o<Gn.length;o++){const c=Gn[o];e[c]!==t[c]&&(l=!0)}l&&xe.read(()=>{wl(s,i),xe.render(()=>{vn(i,r,wn(s.tagName),e.transformTemplate),Rr(s,i)})})}})},Nl={useVisualState:Cr({scrapeMotionValuesFromProps:jn,createRenderState:bn})};function Vr(e,t,s){for(const i in t)!De(t[i])&&!Dr(i,s)&&(e[i]=t[i])}function Sl({transformTemplate:e},t){return h.useMemo(()=>{const s=bn();return yn(s,t,e),Object.assign({},s.vars,s.style)},[t])}function Tl(e,t){const s=e.style||{},i={};return Vr(i,s,e),Object.assign(i,Sl(e,t)),i}function Cl(e,t){const s={},i=Tl(e,t);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=i,s}function kl(e,t,s,i){const r=h.useMemo(()=>{const a=Pr();return vn(a,t,wn(i),e.transformTemplate),{...a.attrs,style:{...a.style}}},[t]);if(e.style){const a={};Vr(a,e.style,e),r.style={...a,...r.style}}return r}function Al(e=!1){return(s,i,r,{latestValues:a},l)=>{const c=(mn(s)?kl:Cl)(i,a,l,s),d=Uo(i,typeof s=="string",e),u=s!==h.Fragment?{...d,...c,ref:r}:{},{children:f}=i,m=h.useMemo(()=>De(f)?f.get():f,[f]);return h.createElement(s,{...u,children:m})}}function _l(e,t){return function(i,{forwardMotionProps:r}={forwardMotionProps:!1}){const l={...mn(i)?jl:Nl,preloadedFeatures:e,useRender:Al(r),createVisualElement:t,Component:i};return Zo(l)}}function Lr(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}function xs(e,t,s){const i=e.getProps();return pn(i,t,s!==void 0?s:i.custom,e)}const Pl=cn(()=>window.ScrollTimeline!==void 0);class El{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let i=0;i<this.animations.length;i++)this.animations[i][t]=s}attachTimeline(t,s){const i=this.animations.map(r=>{if(Pl()&&r.attachTimeline)return r.attachTimeline(t);if(typeof s=="function")return s(r)});return()=>{i.forEach((r,a)=>{r&&r(),this.animations[a].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Ml extends El{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function Nn(e,t){return e?e[t]||e.default||e:void 0}const Ls=2e4;function Fr(e){let t=0;const s=50;let i=e.next(t);for(;!i.done&&t<Ls;)t+=s,i=e.next(t);return t>=Ls?1/0:t}function Sn(e){return typeof e=="function"}function qn(e,t){e.timeline=t,e.onfinish=null}const Tn=e=>Array.isArray(e)&&typeof e[0]=="number",Rl={linearEasing:void 0};function Dl(e,t){const s=cn(e);return()=>{var i;return(i=Rl[t])!==null&&i!==void 0?i:s()}}const rs=Dl(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Or=(e,t,s=10)=>{let i="";const r=Math.max(Math.round(t/s),2);for(let a=0;a<r;a++)i+=e(bt(0,r-1,a))+", ";return`linear(${i.substring(0,i.length-2)})`};function zr(e){return!!(typeof e=="function"&&rs()||!e||typeof e=="string"&&(e in Fs||rs())||Tn(e)||Array.isArray(e)&&e.every(zr))}const _t=([e,t,s,i])=>`cubic-bezier(${e}, ${t}, ${s}, ${i})`,Fs={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:_t([0,.65,.55,1]),circOut:_t([.55,0,1,.45]),backIn:_t([.31,.01,.66,-.59]),backOut:_t([.33,1.53,.69,.99])};function $r(e,t){if(e)return typeof e=="function"&&rs()?Or(e,t):Tn(e)?_t(e):Array.isArray(e)?e.map(s=>$r(s,t)||Fs.easeOut):Fs[e]}const Ke={x:!1,y:!1};function Br(){return Ke.x||Ke.y}function Il(e,t,s){var i;if(e instanceof Element)return[e];if(typeof e=="string"){let r=document;const a=(i=void 0)!==null&&i!==void 0?i:r.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}function Ur(e,t){const s=Il(e),i=new AbortController,r={passive:!0,...t,signal:i.signal};return[s,r,()=>i.abort()]}function Jn(e){return t=>{t.pointerType==="touch"||Br()||e(t)}}function Vl(e,t,s={}){const[i,r,a]=Ur(e,s),l=Jn(o=>{const{target:c}=o,d=t(o);if(typeof d!="function"||!c)return;const u=Jn(f=>{d(f),c.removeEventListener("pointerleave",u)});c.addEventListener("pointerleave",u,r)});return i.forEach(o=>{o.addEventListener("pointerenter",l,r)}),a}const Hr=(e,t)=>t?e===t?!0:Hr(e,t.parentElement):!1,Cn=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Ll=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Fl(e){return Ll.has(e.tagName)||e.tabIndex!==-1}const Pt=new WeakSet;function Zn(e){return t=>{t.key==="Enter"&&e(t)}}function ws(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Ol=(e,t)=>{const s=e.currentTarget;if(!s)return;const i=Zn(()=>{if(Pt.has(s))return;ws(s,"down");const r=Zn(()=>{ws(s,"up")}),a=()=>ws(s,"cancel");s.addEventListener("keyup",r,t),s.addEventListener("blur",a,t)});s.addEventListener("keydown",i,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",i),t)};function Qn(e){return Cn(e)&&!Br()}function zl(e,t,s={}){const[i,r,a]=Ur(e,s),l=o=>{const c=o.currentTarget;if(!Qn(o)||Pt.has(c))return;Pt.add(c);const d=t(o),u=(g,j)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",m),!(!Qn(g)||!Pt.has(c))&&(Pt.delete(c),typeof d=="function"&&d(g,{success:j}))},f=g=>{u(g,s.useGlobalTarget||Hr(c,g.target))},m=g=>{u(g,!1)};window.addEventListener("pointerup",f,r),window.addEventListener("pointercancel",m,r)};return i.forEach(o=>{!Fl(o)&&o.getAttribute("tabindex")===null&&(o.tabIndex=0),(s.useGlobalTarget?window:o).addEventListener("pointerdown",l,r),o.addEventListener("focus",d=>Ol(d,r),r)}),a}function $l(e){return e==="x"||e==="y"?Ke[e]?null:(Ke[e]=!0,()=>{Ke[e]=!1}):Ke.x||Ke.y?null:(Ke.x=Ke.y=!0,()=>{Ke.x=Ke.y=!1})}const Wr=new Set(["width","height","top","left","right","bottom",...Nt]);let ts;function Bl(){ts=void 0}const Ge={now:()=>(ts===void 0&&Ge.set(Ee.isProcessing||Lo.useManualTiming?Ee.timestamp:performance.now()),ts),set:e=>{ts=e,queueMicrotask(Bl)}};function kn(e,t){e.indexOf(t)===-1&&e.push(t)}function An(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class _n{constructor(){this.subscriptions=[]}add(t){return kn(this.subscriptions,t),()=>An(this.subscriptions,t)}notify(t,s,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](t,s,i);else for(let a=0;a<r;a++){const l=this.subscriptions[a];l&&l(t,s,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Kr(e,t){return t?e*(1e3/t):0}const ei=30,Ul=e=>!isNaN(parseFloat(e));class Hl{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,r=!0)=>{const a=Ge.now();this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Ge.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=Ul(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new _n);const i=this.events[t].add(s);return t==="change"?()=>{i(),xe.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,i){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-i}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Ge.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>ei)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,ei);return Kr(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function zt(e,t){return new Hl(e,t)}function Wl(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,zt(s))}function Kl(e,t){const s=xs(e,t);let{transitionEnd:i={},transition:r={},...a}=s||{};a={...a,...i};for(const l in a){const o=il(a[l]);Wl(e,l,o)}}function Yl(e){return!!(De(e)&&e.add)}function Os(e,t){const s=e.getValue("willChange");if(Yl(s))return s.add(t)}function Yr(e){return e.props[Nr]}const Xr=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e,Xl=1e-7,Gl=12;function ql(e,t,s,i,r){let a,l,o=0;do l=t+(s-t)/2,a=Xr(l,i,r)-e,a>0?s=l:t=l;while(Math.abs(a)>Xl&&++o<Gl);return l}function Kt(e,t,s,i){if(e===t&&s===i)return Fe;const r=a=>ql(a,0,1,e,s);return a=>a===0||a===1?a:Xr(r(a),t,i)}const Gr=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,qr=e=>t=>1-e(1-t),Jr=Kt(.33,1.53,.69,.99),Pn=qr(Jr),Zr=Gr(Pn),Qr=e=>(e*=2)<1?.5*Pn(e):.5*(2-Math.pow(2,-10*(e-1))),En=e=>1-Math.sin(Math.acos(e)),ea=qr(En),ta=Gr(En),sa=e=>/^0[^.\s]+$/u.test(e);function Jl(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||sa(e):!0}const Mt=e=>Math.round(e*1e5)/1e5,Mn=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Zl(e){return e==null}const Ql=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Rn=(e,t)=>s=>!!(typeof s=="string"&&Ql.test(s)&&s.startsWith(e)||t&&!Zl(s)&&Object.prototype.hasOwnProperty.call(s,t)),na=(e,t,s)=>i=>{if(typeof i!="string")return i;const[r,a,l,o]=i.match(Mn);return{[e]:parseFloat(r),[t]:parseFloat(a),[s]:parseFloat(l),alpha:o!==void 0?parseFloat(o):1}},ec=e=>Ze(0,255,e),js={...St,transform:e=>Math.round(ec(e))},ct={test:Rn("rgb","red"),parse:na("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:i=1})=>"rgba("+js.transform(e)+", "+js.transform(t)+", "+js.transform(s)+", "+Mt(Ot.transform(i))+")"};function tc(e){let t="",s="",i="",r="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,s+=s,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const zs={test:Rn("#"),parse:tc,transform:ct.transform},pt={test:Rn("hsl","hue"),parse:na("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:i=1})=>"hsla("+Math.round(e)+", "+Xe.transform(Mt(t))+", "+Xe.transform(Mt(s))+", "+Mt(Ot.transform(i))+")"},Re={test:e=>ct.test(e)||zs.test(e)||pt.test(e),parse:e=>ct.test(e)?ct.parse(e):pt.test(e)?pt.parse(e):zs.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?ct.transform(e):pt.transform(e)},sc=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function nc(e){var t,s;return isNaN(e)&&typeof e=="string"&&(((t=e.match(Mn))===null||t===void 0?void 0:t.length)||0)+(((s=e.match(sc))===null||s===void 0?void 0:s.length)||0)>0}const ia="number",ra="color",ic="var",rc="var(",ti="${}",ac=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function $t(e){const t=e.toString(),s=[],i={color:[],number:[],var:[]},r=[];let a=0;const o=t.replace(ac,c=>(Re.test(c)?(i.color.push(a),r.push(ra),s.push(Re.parse(c))):c.startsWith(rc)?(i.var.push(a),r.push(ic),s.push(c)):(i.number.push(a),r.push(ia),s.push(parseFloat(c))),++a,ti)).split(ti);return{values:s,split:o,indexes:i,types:r}}function aa(e){return $t(e).values}function oa(e){const{split:t,types:s}=$t(e),i=t.length;return r=>{let a="";for(let l=0;l<i;l++)if(a+=t[l],r[l]!==void 0){const o=s[l];o===ia?a+=Mt(r[l]):o===ra?a+=Re.transform(r[l]):a+=r[l]}return a}}const oc=e=>typeof e=="number"?0:e;function lc(e){const t=aa(e);return oa(e)(t.map(oc))}const it={test:nc,parse:aa,createTransformer:oa,getAnimatableNone:lc},cc=new Set(["brightness","contrast","saturate","opacity"]);function dc(e){const[t,s]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[i]=s.match(Mn)||[];if(!i)return e;const r=s.replace(i,"");let a=cc.has(t)?1:0;return i!==s&&(a*=100),t+"("+a+r+")"}const uc=/\b([a-z-]*)\(.*?\)/gu,$s={...it,getAnimatableNone:e=>{const t=e.match(uc);return t?t.map(dc).join(" "):e}},hc={...gn,color:Re,backgroundColor:Re,outlineColor:Re,fill:Re,stroke:Re,borderColor:Re,borderTopColor:Re,borderRightColor:Re,borderBottomColor:Re,borderLeftColor:Re,filter:$s,WebkitFilter:$s},Dn=e=>hc[e];function la(e,t){let s=Dn(e);return s!==$s&&(s=it),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const fc=new Set(["auto","none","0"]);function mc(e,t,s){let i=0,r;for(;i<e.length&&!r;){const a=e[i];typeof a=="string"&&!fc.has(a)&&$t(a).values.length&&(r=e[i]),i++}if(r&&s)for(const a of t)e[a]=la(s,r)}const si=e=>e===St||e===J,ni=(e,t)=>parseFloat(e.split(", ")[t]),ii=(e,t)=>(s,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return ni(r[1],t);{const a=i.match(/^matrix\((.+)\)$/u);return a?ni(a[1],e):0}},pc=new Set(["x","y","z"]),xc=Nt.filter(e=>!pc.has(e));function gc(e){const t=[];return xc.forEach(s=>{const i=e.getValue(s);i!==void 0&&(t.push([s,i.get()]),i.set(s.startsWith("scale")?1:0))}),t}const jt={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:ii(4,13),y:ii(5,14)};jt.translateX=jt.x;jt.translateY=jt.y;const ht=new Set;let Bs=!1,Us=!1;function ca(){if(Us){const e=Array.from(ht).filter(i=>i.needsMeasurement),t=new Set(e.map(i=>i.element)),s=new Map;t.forEach(i=>{const r=gc(i);r.length&&(s.set(i,r),i.render())}),e.forEach(i=>i.measureInitialState()),t.forEach(i=>{i.render();const r=s.get(i);r&&r.forEach(([a,l])=>{var o;(o=i.getValue(a))===null||o===void 0||o.set(l)})}),e.forEach(i=>i.measureEndState()),e.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Us=!1,Bs=!1,ht.forEach(e=>e.complete()),ht.clear()}function da(){ht.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Us=!0)})}function yc(){da(),ca()}class In{constructor(t,s,i,r,a,l=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=i,this.motionValue=r,this.element=a,this.isAsync=l}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ht.add(this),Bs||(Bs=!0,xe.read(da),xe.resolveKeyframes(ca))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:i,motionValue:r}=this;for(let a=0;a<t.length;a++)if(t[a]===null)if(a===0){const l=r==null?void 0:r.get(),o=t[t.length-1];if(l!==void 0)t[0]=l;else if(i&&s){const c=i.readValue(s,o);c!=null&&(t[0]=c)}t[0]===void 0&&(t[0]=o),r&&l===void 0&&r.set(t[0])}else t[a]=t[a-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ht.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ht.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const ua=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),vc=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function bc(e){const t=vc.exec(e);if(!t)return[,];const[,s,i,r]=t;return[`--${s??i}`,r]}function ha(e,t,s=1){const[i,r]=bc(e);if(!i)return;const a=window.getComputedStyle(t).getPropertyValue(i);if(a){const l=a.trim();return ua(l)?parseFloat(l):l}return xn(r)?ha(r,t,s+1):r}const fa=e=>t=>t.test(e),wc={test:e=>e==="auto",parse:e=>e},ma=[St,J,Xe,tt,dl,cl,wc],ri=e=>ma.find(fa(e));class pa extends In{constructor(t,s,i,r,a){super(t,s,i,r,a,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:i}=this;if(!s||!s.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),xn(d))){const u=ha(d,s.current);u!==void 0&&(t[c]=u),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!Wr.has(i)||t.length!==2)return;const[r,a]=t,l=ri(r),o=ri(a);if(l!==o)if(si(l)&&si(o))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,i=[];for(let r=0;r<t.length;r++)Jl(t[r])&&i.push(r);i.length&&mc(t,i,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:i}=this;if(!t||!t.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=jt[i](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const r=s[s.length-1];r!==void 0&&t.getValue(i,r).jump(r,!1)}measureEndState(){var t;const{element:s,name:i,unresolvedKeyframes:r}=this;if(!s||!s.current)return;const a=s.getValue(i);a&&a.jump(this.measuredOrigin,!1);const l=r.length-1,o=r[l];r[l]=jt[i](s.measureViewportBox(),window.getComputedStyle(s.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([c,d])=>{s.getValue(c).set(d)}),this.resolveNoneKeyframes()}}const ai=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(it.test(e)||e==="0")&&!e.startsWith("url("));function jc(e){const t=e[0];if(e.length===1)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}function Nc(e,t,s,i){const r=e[0];if(r===null)return!1;if(t==="display"||t==="visibility")return!0;const a=e[e.length-1],l=ai(r,t),o=ai(a,t);return!l||!o?!1:jc(e)||(s==="spring"||Sn(s))&&i}const Sc=e=>e!==null;function gs(e,{repeat:t,repeatType:s="loop"},i){const r=e.filter(Sc),a=t&&s!=="loop"&&t%2===1?0:r.length-1;return!a||i===void 0?r[a]:i}const Tc=40;class xa{constructor({autoplay:t=!0,delay:s=0,type:i="keyframes",repeat:r=0,repeatDelay:a=0,repeatType:l="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Ge.now(),this.options={autoplay:t,delay:s,type:i,repeat:r,repeatDelay:a,repeatType:l,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>Tc?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&yc(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Ge.now(),this.hasAttemptedResolve=!0;const{name:i,type:r,velocity:a,delay:l,onComplete:o,onUpdate:c,isGenerator:d}=this.options;if(!d&&!Nc(t,i,r,a))if(l)this.options.duration=0;else{c&&c(gs(t,this.options,s)),o&&o(),this.resolveFinishedPromise();return}const u=this.initPlayback(t,s);u!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...u},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const ve=(e,t,s)=>e+(t-e)*s;function Ns(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(t-e)*6*s:s<1/2?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function Cc({hue:e,saturation:t,lightness:s,alpha:i}){e/=360,t/=100,s/=100;let r=0,a=0,l=0;if(!t)r=a=l=s;else{const o=s<.5?s*(1+t):s+t-s*t,c=2*s-o;r=Ns(c,o,e+1/3),a=Ns(c,o,e),l=Ns(c,o,e-1/3)}return{red:Math.round(r*255),green:Math.round(a*255),blue:Math.round(l*255),alpha:i}}function as(e,t){return s=>s>0?t:e}const Ss=(e,t,s)=>{const i=e*e,r=s*(t*t-i)+i;return r<0?0:Math.sqrt(r)},kc=[zs,ct,pt],Ac=e=>kc.find(t=>t.test(e));function oi(e){const t=Ac(e);if(!t)return!1;let s=t.parse(e);return t===pt&&(s=Cc(s)),s}const li=(e,t)=>{const s=oi(e),i=oi(t);if(!s||!i)return as(e,t);const r={...s};return a=>(r.red=Ss(s.red,i.red,a),r.green=Ss(s.green,i.green,a),r.blue=Ss(s.blue,i.blue,a),r.alpha=ve(s.alpha,i.alpha,a),ct.transform(r))},_c=(e,t)=>s=>t(e(s)),Yt=(...e)=>e.reduce(_c),Hs=new Set(["none","hidden"]);function Pc(e,t){return Hs.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}function Ec(e,t){return s=>ve(e,t,s)}function Vn(e){return typeof e=="number"?Ec:typeof e=="string"?xn(e)?as:Re.test(e)?li:Dc:Array.isArray(e)?ga:typeof e=="object"?Re.test(e)?li:Mc:as}function ga(e,t){const s=[...e],i=s.length,r=e.map((a,l)=>Vn(a)(a,t[l]));return a=>{for(let l=0;l<i;l++)s[l]=r[l](a);return s}}function Mc(e,t){const s={...e,...t},i={};for(const r in s)e[r]!==void 0&&t[r]!==void 0&&(i[r]=Vn(e[r])(e[r],t[r]));return r=>{for(const a in i)s[a]=i[a](r);return s}}function Rc(e,t){var s;const i=[],r={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const l=t.types[a],o=e.indexes[l][r[l]],c=(s=e.values[o])!==null&&s!==void 0?s:0;i[a]=c,r[l]++}return i}const Dc=(e,t)=>{const s=it.createTransformer(t),i=$t(e),r=$t(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Hs.has(e)&&!r.values.length||Hs.has(t)&&!i.values.length?Pc(e,t):Yt(ga(Rc(i,r),r.values),s):as(e,t)};function ya(e,t,s){return typeof e=="number"&&typeof t=="number"&&typeof s=="number"?ve(e,t,s):Vn(e)(e,t)}const Ic=5;function va(e,t,s){const i=Math.max(t-Ic,0);return Kr(s-e(i),t-i)}const Ne={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Ts=.001;function Vc({duration:e=Ne.duration,bounce:t=Ne.bounce,velocity:s=Ne.velocity,mass:i=Ne.mass}){let r,a,l=1-t;l=Ze(Ne.minDamping,Ne.maxDamping,l),e=Ze(Ne.minDuration,Ne.maxDuration,Je(e)),l<1?(r=d=>{const u=d*l,f=u*e,m=u-s,g=Ws(d,l),j=Math.exp(-f);return Ts-m/g*j},a=d=>{const f=d*l*e,m=f*s+s,g=Math.pow(l,2)*Math.pow(d,2)*e,j=Math.exp(-f),b=Ws(Math.pow(d,2),l);return(-r(d)+Ts>0?-1:1)*((m-g)*j)/b}):(r=d=>{const u=Math.exp(-d*e),f=(d-s)*e+1;return-Ts+u*f},a=d=>{const u=Math.exp(-d*e),f=(s-d)*(e*e);return u*f});const o=5/e,c=Fc(r,a,o);if(e=qe(e),isNaN(c))return{stiffness:Ne.stiffness,damping:Ne.damping,duration:e};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:l*2*Math.sqrt(i*d),duration:e}}}const Lc=12;function Fc(e,t,s){let i=s;for(let r=1;r<Lc;r++)i=i-e(i)/t(i);return i}function Ws(e,t){return e*Math.sqrt(1-t*t)}const Oc=["duration","bounce"],zc=["stiffness","damping","mass"];function ci(e,t){return t.some(s=>e[s]!==void 0)}function $c(e){let t={velocity:Ne.velocity,stiffness:Ne.stiffness,damping:Ne.damping,mass:Ne.mass,isResolvedFromDuration:!1,...e};if(!ci(e,zc)&&ci(e,Oc))if(e.visualDuration){const s=e.visualDuration,i=2*Math.PI/(s*1.2),r=i*i,a=2*Ze(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Ne.mass,stiffness:r,damping:a}}else{const s=Vc(e);t={...t,...s,mass:Ne.mass},t.isResolvedFromDuration=!0}return t}function ba(e=Ne.visualDuration,t=Ne.bounce){const s=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=s;const a=s.keyframes[0],l=s.keyframes[s.keyframes.length-1],o={done:!1,value:a},{stiffness:c,damping:d,mass:u,duration:f,velocity:m,isResolvedFromDuration:g}=$c({...s,velocity:-Je(s.velocity||0)}),j=m||0,b=d/(2*Math.sqrt(c*u)),P=l-a,C=Je(Math.sqrt(c/u)),E=Math.abs(P)<5;i||(i=E?Ne.restSpeed.granular:Ne.restSpeed.default),r||(r=E?Ne.restDelta.granular:Ne.restDelta.default);let _;if(b<1){const T=Ws(C,b);_=k=>{const V=Math.exp(-b*C*k);return l-V*((j+b*C*P)/T*Math.sin(T*k)+P*Math.cos(T*k))}}else if(b===1)_=T=>l-Math.exp(-C*T)*(P+(j+C*P)*T);else{const T=C*Math.sqrt(b*b-1);_=k=>{const V=Math.exp(-b*C*k),M=Math.min(T*k,300);return l-V*((j+b*C*P)*Math.sinh(M)+T*P*Math.cosh(M))/T}}const U={calculatedDuration:g&&f||null,next:T=>{const k=_(T);if(g)o.done=T>=f;else{let V=0;b<1&&(V=T===0?qe(j):va(_,T,k));const M=Math.abs(V)<=i,W=Math.abs(l-k)<=r;o.done=M&&W}return o.value=o.done?l:k,o},toString:()=>{const T=Math.min(Fr(U),Ls),k=Or(V=>U.next(T*V).value,T,30);return T+"ms "+k}};return U}function di({keyframes:e,velocity:t=0,power:s=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:l,min:o,max:c,restDelta:d=.5,restSpeed:u}){const f=e[0],m={done:!1,value:f},g=M=>o!==void 0&&M<o||c!==void 0&&M>c,j=M=>o===void 0?c:c===void 0||Math.abs(o-M)<Math.abs(c-M)?o:c;let b=s*t;const P=f+b,C=l===void 0?P:l(P);C!==P&&(b=C-f);const E=M=>-b*Math.exp(-M/i),_=M=>C+E(M),U=M=>{const W=E(M),O=_(M);m.done=Math.abs(W)<=d,m.value=m.done?C:O};let T,k;const V=M=>{g(m.value)&&(T=M,k=ba({keyframes:[m.value,j(m.value)],velocity:va(_,M,m.value),damping:r,stiffness:a,restDelta:d,restSpeed:u}))};return V(0),{calculatedDuration:null,next:M=>{let W=!1;return!k&&T===void 0&&(W=!0,U(M),V(M)),T!==void 0&&M>=T?k.next(M-T):(!W&&U(M),m)}}}const Bc=Kt(.42,0,1,1),Uc=Kt(0,0,.58,1),wa=Kt(.42,0,.58,1),Hc=e=>Array.isArray(e)&&typeof e[0]!="number",Wc={linear:Fe,easeIn:Bc,easeInOut:wa,easeOut:Uc,circIn:En,circInOut:ta,circOut:ea,backIn:Pn,backInOut:Zr,backOut:Jr,anticipate:Qr},ui=e=>{if(Tn(e)){yr(e.length===4);const[t,s,i,r]=e;return Kt(t,s,i,r)}else if(typeof e=="string")return Wc[e];return e};function Kc(e,t,s){const i=[],r=s||ya,a=e.length-1;for(let l=0;l<a;l++){let o=r(e[l],e[l+1]);if(t){const c=Array.isArray(t)?t[l]||Fe:t;o=Yt(c,o)}i.push(o)}return i}function Yc(e,t,{clamp:s=!0,ease:i,mixer:r}={}){const a=e.length;if(yr(a===t.length),a===1)return()=>t[0];if(a===2&&t[0]===t[1])return()=>t[1];const l=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=Kc(t,i,r),c=o.length,d=u=>{if(l&&u<e[0])return t[0];let f=0;if(c>1)for(;f<e.length-2&&!(u<e[f+1]);f++);const m=bt(e[f],e[f+1],u);return o[f](m)};return s?u=>d(Ze(e[0],e[a-1],u)):d}function Xc(e,t){const s=e[e.length-1];for(let i=1;i<=t;i++){const r=bt(0,t,i);e.push(ve(s,1,r))}}function Gc(e){const t=[0];return Xc(t,e.length-1),t}function qc(e,t){return e.map(s=>s*t)}function Jc(e,t){return e.map(()=>t||wa).splice(0,e.length-1)}function os({duration:e=300,keyframes:t,times:s,ease:i="easeInOut"}){const r=Hc(i)?i.map(ui):ui(i),a={done:!1,value:t[0]},l=qc(s&&s.length===t.length?s:Gc(t),e),o=Yc(l,t,{ease:Array.isArray(r)?r:Jc(t,r)});return{calculatedDuration:e,next:c=>(a.value=o(c),a.done=c>=e,a)}}const Zc=e=>{const t=({timestamp:s})=>e(s);return{start:()=>xe.update(t,!0),stop:()=>nt(t),now:()=>Ee.isProcessing?Ee.timestamp:Ge.now()}},Qc={decay:di,inertia:di,tween:os,keyframes:os,spring:ba},ed=e=>e/100;class Ln extends xa{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:s,motionValue:i,element:r,keyframes:a}=this.options,l=(r==null?void 0:r.KeyframeResolver)||In,o=(c,d)=>this.onKeyframesResolved(c,d);this.resolver=new l(a,o,s,i,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:a,velocity:l=0}=this.options,o=Sn(s)?s:Qc[s]||os;let c,d;o!==os&&typeof t[0]!="number"&&(c=Yt(ed,ya(t[0],t[1])),t=[0,100]);const u=o({...this.options,keyframes:t});a==="mirror"&&(d=o({...this.options,keyframes:[...t].reverse(),velocity:-l})),u.calculatedDuration===null&&(u.calculatedDuration=Fr(u));const{calculatedDuration:f}=u,m=f+r,g=m*(i+1)-r;return{generator:u,mirroredGenerator:d,mapPercentToKeyframes:c,calculatedDuration:f,resolvedDuration:m,totalDuration:g}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:i}=this;if(!i){const{keyframes:M}=this.options;return{done:!0,value:M[M.length-1]}}const{finalKeyframe:r,generator:a,mirroredGenerator:l,mapPercentToKeyframes:o,keyframes:c,calculatedDuration:d,totalDuration:u,resolvedDuration:f}=i;if(this.startTime===null)return a.next(0);const{delay:m,repeat:g,repeatType:j,repeatDelay:b,onUpdate:P}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-u/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const C=this.currentTime-m*(this.speed>=0?1:-1),E=this.speed>=0?C<0:C>u;this.currentTime=Math.max(C,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let _=this.currentTime,U=a;if(g){const M=Math.min(this.currentTime,u)/f;let W=Math.floor(M),O=M%1;!O&&M>=1&&(O=1),O===1&&W--,W=Math.min(W,g+1),!!(W%2)&&(j==="reverse"?(O=1-O,b&&(O-=b/f)):j==="mirror"&&(U=l)),_=Ze(0,1,O)*f}const T=E?{done:!1,value:c[0]}:U.next(_);o&&(T.value=o(T.value));let{done:k}=T;!E&&d!==null&&(k=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const V=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return V&&r!==void 0&&(T.value=gs(c,this.options,r)),P&&P(T.value),V&&this.finish(),T}get duration(){const{resolved:t}=this;return t?Je(t.calculatedDuration):0}get time(){return Je(this.currentTime)}set time(t){t=qe(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=Je(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=Zc,onPlay:s,startTime:i}=this.options;this.driver||(this.driver=t(a=>this.tick(a))),s&&s();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const td=new Set(["opacity","clipPath","filter","transform"]);function sd(e,t,s,{delay:i=0,duration:r=300,repeat:a=0,repeatType:l="loop",ease:o="easeInOut",times:c}={}){const d={[t]:s};c&&(d.offset=c);const u=$r(o,r);return Array.isArray(u)&&(d.easing=u),e.animate(d,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:a+1,direction:l==="reverse"?"alternate":"normal"})}const nd=cn(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),ls=10,id=2e4;function rd(e){return Sn(e.type)||e.type==="spring"||!zr(e.ease)}function ad(e,t){const s=new Ln({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const r=[];let a=0;for(;!i.done&&a<id;)i=s.sample(a),r.push(i.value),a+=ls;return{times:void 0,keyframes:r,duration:a-ls,ease:"linear"}}const ja={anticipate:Qr,backInOut:Zr,circInOut:ta};function od(e){return e in ja}class hi extends xa{constructor(t){super(t);const{name:s,motionValue:i,element:r,keyframes:a}=this.options;this.resolver=new pa(a,(l,o)=>this.onKeyframesResolved(l,o),s,i,r),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:i=300,times:r,ease:a,type:l,motionValue:o,name:c,startTime:d}=this.options;if(!o.owner||!o.owner.current)return!1;if(typeof a=="string"&&rs()&&od(a)&&(a=ja[a]),rd(this.options)){const{onComplete:f,onUpdate:m,motionValue:g,element:j,...b}=this.options,P=ad(t,b);t=P.keyframes,t.length===1&&(t[1]=t[0]),i=P.duration,r=P.times,a=P.ease,l="keyframes"}const u=sd(o.owner.current,c,t,{...this.options,duration:i,times:r,ease:a});return u.startTime=d??this.calcStartTime(),this.pendingTimeline?(qn(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:f}=this.options;o.set(gs(t,this.options,s)),f&&f(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:i,times:r,type:l,ease:a,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return Je(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return Je(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:i}=s;i.currentTime=qe(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:i}=s;i.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Fe;const{animation:i}=s;qn(i,t)}return Fe}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:i,duration:r,type:a,ease:l,times:o}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:u,onComplete:f,element:m,...g}=this.options,j=new Ln({...g,keyframes:i,duration:r,type:a,ease:l,times:o,isGenerator:!0}),b=qe(this.time);d.setWithVelocity(j.sample(b-ls).value,j.sample(b).value,ls)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:i,repeatDelay:r,repeatType:a,damping:l,type:o}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=s.owner.getProps();return nd()&&i&&td.has(i)&&!c&&!d&&!r&&a!=="mirror"&&l!==0&&o!=="inertia"}}const ld={type:"spring",stiffness:500,damping:25,restSpeed:10},cd=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),dd={type:"keyframes",duration:.8},ud={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},hd=(e,{keyframes:t})=>t.length>2?dd:ft.has(e)?e.startsWith("scale")?cd(t[1]):ld:ud;function fd({when:e,delay:t,delayChildren:s,staggerChildren:i,staggerDirection:r,repeat:a,repeatType:l,repeatDelay:o,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Fn=(e,t,s,i={},r,a)=>l=>{const o=Nn(i,e)||{},c=o.delay||i.delay||0;let{elapsed:d=0}=i;d=d-qe(c);let u={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-d,onUpdate:m=>{t.set(m),o.onUpdate&&o.onUpdate(m)},onComplete:()=>{l(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:a?void 0:r};fd(o)||(u={...u,...hd(e,u)}),u.duration&&(u.duration=qe(u.duration)),u.repeatDelay&&(u.repeatDelay=qe(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let f=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(f=!0)),f&&!a&&t.get()!==void 0){const m=gs(u.keyframes,o);if(m!==void 0)return xe.update(()=>{u.onUpdate(m),u.onComplete()}),new Ml([])}return!a&&hi.supports(u)?new hi(u):new Ln(u)};function md({protectedKeys:e,needsAnimating:t},s){const i=e.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,i}function Na(e,t,{delay:s=0,transitionOverride:i,type:r}={}){var a;let{transition:l=e.getDefaultTransition(),transitionEnd:o,...c}=t;i&&(l=i);const d=[],u=r&&e.animationState&&e.animationState.getState()[r];for(const f in c){const m=e.getValue(f,(a=e.latestValues[f])!==null&&a!==void 0?a:null),g=c[f];if(g===void 0||u&&md(u,f))continue;const j={delay:s,...Nn(l||{},f)};let b=!1;if(window.MotionHandoffAnimation){const C=Yr(e);if(C){const E=window.MotionHandoffAnimation(C,f,xe);E!==null&&(j.startTime=E,b=!0)}}Os(e,f),m.start(Fn(f,m,g,e.shouldReduceMotion&&Wr.has(f)?{type:!1}:j,e,b));const P=m.animation;P&&d.push(P)}return o&&Promise.all(d).then(()=>{xe.update(()=>{o&&Kl(e,o)})}),d}function Ks(e,t,s={}){var i;const r=xs(e,t,s.type==="exit"?(i=e.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=r||{};s.transitionOverride&&(a=s.transitionOverride);const l=r?()=>Promise.all(Na(e,r,s)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:f,staggerDirection:m}=a;return pd(e,t,u+d,f,m,s)}:()=>Promise.resolve(),{when:c}=a;if(c){const[d,u]=c==="beforeChildren"?[l,o]:[o,l];return d().then(()=>u())}else return Promise.all([l(),o(s.delay)])}function pd(e,t,s=0,i=0,r=1,a){const l=[],o=(e.variantChildren.size-1)*i,c=r===1?(d=0)=>d*i:(d=0)=>o-d*i;return Array.from(e.variantChildren).sort(xd).forEach((d,u)=>{d.notify("AnimationStart",t),l.push(Ks(d,t,{...a,delay:s+c(u)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(l)}function xd(e,t){return e.sortNodePosition(t)}function gd(e,t,s={}){e.notify("AnimationStart",t);let i;if(Array.isArray(t)){const r=t.map(a=>Ks(e,a,s));i=Promise.all(r)}else if(typeof t=="string")i=Ks(e,t,s);else{const r=typeof t=="function"?xs(e,t,s.custom):t;i=Promise.all(Na(e,r,s))}return i.then(()=>{e.notify("AnimationComplete",t)})}const yd=un.length;function Sa(e){if(!e)return;if(!e.isControllingVariants){const s=e.parent?Sa(e.parent)||{}:{};return e.props.initial!==void 0&&(s.initial=e.props.initial),s}const t={};for(let s=0;s<yd;s++){const i=un[s],r=e.props[i];(Ft(r)||r===!1)&&(t[i]=r)}return t}const vd=[...dn].reverse(),bd=dn.length;function wd(e){return t=>Promise.all(t.map(({animation:s,options:i})=>gd(e,s,i)))}function jd(e){let t=wd(e),s=fi(),i=!0;const r=c=>(d,u)=>{var f;const m=xs(e,u,c==="exit"?(f=e.presenceContext)===null||f===void 0?void 0:f.custom:void 0);if(m){const{transition:g,transitionEnd:j,...b}=m;d={...d,...b,...j}}return d};function a(c){t=c(e)}function l(c){const{props:d}=e,u=Sa(e.parent)||{},f=[],m=new Set;let g={},j=1/0;for(let P=0;P<bd;P++){const C=vd[P],E=s[C],_=d[C]!==void 0?d[C]:u[C],U=Ft(_),T=C===c?E.isActive:null;T===!1&&(j=P);let k=_===u[C]&&_!==d[C]&&U;if(k&&i&&e.manuallyAnimateOnMount&&(k=!1),E.protectedKeys={...g},!E.isActive&&T===null||!_&&!E.prevProp||ms(_)||typeof _=="boolean")continue;const V=Nd(E.prevProp,_);let M=V||C===c&&E.isActive&&!k&&U||P>j&&U,W=!1;const O=Array.isArray(_)?_:[_];let L=O.reduce(r(C),{});T===!1&&(L={});const{prevResolvedValues:K={}}=E,N={...K,...L},F=G=>{M=!0,m.has(G)&&(W=!0,m.delete(G)),E.needsAnimating[G]=!0;const ne=e.getValue(G);ne&&(ne.liveStyle=!1)};for(const G in N){const ne=L[G],he=K[G];if(g.hasOwnProperty(G))continue;let Se=!1;Vs(ne)&&Vs(he)?Se=!Lr(ne,he):Se=ne!==he,Se?ne!=null?F(G):m.add(G):ne!==void 0&&m.has(G)?F(G):E.protectedKeys[G]=!0}E.prevProp=_,E.prevResolvedValues=L,E.isActive&&(g={...g,...L}),i&&e.blockInitialAnimation&&(M=!1),M&&(!(k&&V)||W)&&f.push(...O.map(G=>({animation:G,options:{type:C}})))}if(m.size){const P={};m.forEach(C=>{const E=e.getBaseTarget(C),_=e.getValue(C);_&&(_.liveStyle=!0),P[C]=E??null}),f.push({animation:P})}let b=!!f.length;return i&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(b=!1),i=!1,b?t(f):Promise.resolve()}function o(c,d){var u;if(s[c].isActive===d)return Promise.resolve();(u=e.variantChildren)===null||u===void 0||u.forEach(m=>{var g;return(g=m.animationState)===null||g===void 0?void 0:g.setActive(c,d)}),s[c].isActive=d;const f=l(c);for(const m in s)s[m].protectedKeys={};return f}return{animateChanges:l,setActive:o,setAnimateFunction:a,getState:()=>s,reset:()=>{s=fi(),i=!0}}}function Nd(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!Lr(t,e):!1}function at(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function fi(){return{animate:at(!0),whileInView:at(),whileHover:at(),whileTap:at(),whileDrag:at(),whileFocus:at(),exit:at()}}class rt{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Sd extends rt{constructor(t){super(t),t.animationState||(t.animationState=jd(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();ms(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let Td=0;class Cd extends rt{constructor(){super(...arguments),this.id=Td++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const r=this.node.animationState.setActive("exit",!t);s&&!t&&r.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const kd={animation:{Feature:Sd},exit:{Feature:Cd}};function Bt(e,t,s,i={passive:!0}){return e.addEventListener(t,s,i),()=>e.removeEventListener(t,s)}function Xt(e){return{point:{x:e.pageX,y:e.pageY}}}const Ad=e=>t=>Cn(t)&&e(t,Xt(t));function Rt(e,t,s,i){return Bt(e,t,Ad(s),i)}const mi=(e,t)=>Math.abs(e-t);function _d(e,t){const s=mi(e.x,t.x),i=mi(e.y,t.y);return Math.sqrt(s**2+i**2)}class Ta{constructor(t,s,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:a=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=ks(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,g=_d(f.offset,{x:0,y:0})>=3;if(!m&&!g)return;const{point:j}=f,{timestamp:b}=Ee;this.history.push({...j,timestamp:b});const{onStart:P,onMove:C}=this.handlers;m||(P&&P(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),C&&C(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=Cs(m,this.transformPagePoint),xe.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:g,onSessionEnd:j,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const P=ks(f.type==="pointercancel"?this.lastMoveEventInfo:Cs(m,this.transformPagePoint),this.history);this.startEvent&&g&&g(f,P),j&&j(f,P)},!Cn(t))return;this.dragSnapToOrigin=a,this.handlers=s,this.transformPagePoint=i,this.contextWindow=r||window;const l=Xt(t),o=Cs(l,this.transformPagePoint),{point:c}=o,{timestamp:d}=Ee;this.history=[{...c,timestamp:d}];const{onSessionStart:u}=s;u&&u(t,ks(o,this.history)),this.removeListeners=Yt(Rt(this.contextWindow,"pointermove",this.handlePointerMove),Rt(this.contextWindow,"pointerup",this.handlePointerUp),Rt(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),nt(this.updatePoint)}}function Cs(e,t){return t?{point:t(e.point)}:e}function pi(e,t){return{x:e.x-t.x,y:e.y-t.y}}function ks({point:e},t){return{point:e,delta:pi(e,Ca(t)),offset:pi(e,Pd(t)),velocity:Ed(t,.1)}}function Pd(e){return e[0]}function Ca(e){return e[e.length-1]}function Ed(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,i=null;const r=Ca(e);for(;s>=0&&(i=e[s],!(r.timestamp-i.timestamp>qe(t)));)s--;if(!i)return{x:0,y:0};const a=Je(r.timestamp-i.timestamp);if(a===0)return{x:0,y:0};const l={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return l.x===1/0&&(l.x=0),l.y===1/0&&(l.y=0),l}const ka=1e-4,Md=1-ka,Rd=1+ka,Aa=.01,Dd=0-Aa,Id=0+Aa;function Oe(e){return e.max-e.min}function Vd(e,t,s){return Math.abs(e-t)<=s}function xi(e,t,s,i=.5){e.origin=i,e.originPoint=ve(t.min,t.max,e.origin),e.scale=Oe(s)/Oe(t),e.translate=ve(s.min,s.max,e.origin)-e.originPoint,(e.scale>=Md&&e.scale<=Rd||isNaN(e.scale))&&(e.scale=1),(e.translate>=Dd&&e.translate<=Id||isNaN(e.translate))&&(e.translate=0)}function Dt(e,t,s,i){xi(e.x,t.x,s.x,i?i.originX:void 0),xi(e.y,t.y,s.y,i?i.originY:void 0)}function gi(e,t,s){e.min=s.min+t.min,e.max=e.min+Oe(t)}function Ld(e,t,s){gi(e.x,t.x,s.x),gi(e.y,t.y,s.y)}function yi(e,t,s){e.min=t.min-s.min,e.max=e.min+Oe(t)}function It(e,t,s){yi(e.x,t.x,s.x),yi(e.y,t.y,s.y)}function Fd(e,{min:t,max:s},i){return t!==void 0&&e<t?e=i?ve(t,e,i.min):Math.max(e,t):s!==void 0&&e>s&&(e=i?ve(s,e,i.max):Math.min(e,s)),e}function vi(e,t,s){return{min:t!==void 0?e.min+t:void 0,max:s!==void 0?e.max+s-(e.max-e.min):void 0}}function Od(e,{top:t,left:s,bottom:i,right:r}){return{x:vi(e.x,s,r),y:vi(e.y,t,i)}}function bi(e,t){let s=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,i]=[i,s]),{min:s,max:i}}function zd(e,t){return{x:bi(e.x,t.x),y:bi(e.y,t.y)}}function $d(e,t){let s=.5;const i=Oe(e),r=Oe(t);return r>i?s=bt(t.min,t.max-i,e.min):i>r&&(s=bt(e.min,e.max-r,t.min)),Ze(0,1,s)}function Bd(e,t){const s={};return t.min!==void 0&&(s.min=t.min-e.min),t.max!==void 0&&(s.max=t.max-e.min),s}const Ys=.35;function Ud(e=Ys){return e===!1?e=0:e===!0&&(e=Ys),{x:wi(e,"left","right"),y:wi(e,"top","bottom")}}function wi(e,t,s){return{min:ji(e,t),max:ji(e,s)}}function ji(e,t){return typeof e=="number"?e:e[t]||0}const Ni=()=>({translate:0,scale:1,origin:0,originPoint:0}),xt=()=>({x:Ni(),y:Ni()}),Si=()=>({min:0,max:0}),Ce=()=>({x:Si(),y:Si()});function Ue(e){return[e("x"),e("y")]}function _a({top:e,left:t,right:s,bottom:i}){return{x:{min:t,max:s},y:{min:e,max:i}}}function Hd({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Wd(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:i.y,right:i.x}}function As(e){return e===void 0||e===1}function Xs({scale:e,scaleX:t,scaleY:s}){return!As(e)||!As(t)||!As(s)}function ot(e){return Xs(e)||Pa(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Pa(e){return Ti(e.x)||Ti(e.y)}function Ti(e){return e&&e!=="0%"}function cs(e,t,s){const i=e-s,r=t*i;return s+r}function Ci(e,t,s,i,r){return r!==void 0&&(e=cs(e,r,i)),cs(e,s,i)+t}function Gs(e,t=0,s=1,i,r){e.min=Ci(e.min,t,s,i,r),e.max=Ci(e.max,t,s,i,r)}function Ea(e,{x:t,y:s}){Gs(e.x,t.translate,t.scale,t.originPoint),Gs(e.y,s.translate,s.scale,s.originPoint)}const ki=.999999999999,Ai=1.0000000000001;function Kd(e,t,s,i=!1){const r=s.length;if(!r)return;t.x=t.y=1;let a,l;for(let o=0;o<r;o++){a=s[o],l=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&yt(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),l&&(t.x*=l.x.scale,t.y*=l.y.scale,Ea(e,l)),i&&ot(a.latestValues)&&yt(e,a.latestValues))}t.x<Ai&&t.x>ki&&(t.x=1),t.y<Ai&&t.y>ki&&(t.y=1)}function gt(e,t){e.min=e.min+t,e.max=e.max+t}function _i(e,t,s,i,r=.5){const a=ve(e.min,e.max,r);Gs(e,t,s,a,i)}function yt(e,t){_i(e.x,t.x,t.scaleX,t.scale,t.originX),_i(e.y,t.y,t.scaleY,t.scale,t.originY)}function Ma(e,t){return _a(Wd(e.getBoundingClientRect(),t))}function Yd(e,t,s){const i=Ma(e,s),{scroll:r}=t;return r&&(gt(i.x,r.offset.x),gt(i.y,r.offset.y)),i}const Ra=({current:e})=>e?e.ownerDocument.defaultView:null,Xd=new WeakMap;class Gd{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ce(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(Xt(u).point)},a=(u,f)=>{const{drag:m,dragPropagation:g,onDragStart:j}=this.getProps();if(m&&!g&&(this.openDragLock&&this.openDragLock(),this.openDragLock=$l(m),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ue(P=>{let C=this.getAxisMotionValue(P).get()||0;if(Xe.test(C)){const{projection:E}=this.visualElement;if(E&&E.layout){const _=E.layout.layoutBox[P];_&&(C=Oe(_)*(parseFloat(C)/100))}}this.originPoint[P]=C}),j&&xe.postRender(()=>j(u,f)),Os(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},l=(u,f)=>{const{dragPropagation:m,dragDirectionLock:g,onDirectionLock:j,onDrag:b}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:P}=f;if(g&&this.currentDirection===null){this.currentDirection=qd(P),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",f.point,P),this.updateAxis("y",f.point,P),this.visualElement.render(),b&&b(u,f)},o=(u,f)=>this.stop(u,f),c=()=>Ue(u=>{var f;return this.getAnimationState(u)==="paused"&&((f=this.getAxisMotionValue(u).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new Ta(t,{onSessionStart:r,onStart:a,onMove:l,onSessionEnd:o,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:Ra(this.visualElement)})}stop(t,s){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=s;this.startAnimation(r);const{onDragEnd:a}=this.getProps();a&&xe.postRender(()=>a(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,i){const{drag:r}=this.getProps();if(!i||!Zt(t,r,this.currentDirection))return;const a=this.getAxisMotionValue(t);let l=this.originPoint[t]+i[t];this.constraints&&this.constraints[t]&&(l=Fd(l,this.constraints[t],this.elastic[t])),a.set(l)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,a=this.constraints;s&&mt(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&r?this.constraints=Od(r.layoutBox,s):this.constraints=!1,this.elastic=Ud(i),a!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Ue(l=>{this.constraints!==!1&&this.getAxisMotionValue(l)&&(this.constraints[l]=Bd(r.layoutBox[l],this.constraints[l]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!mt(t))return!1;const i=t.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const a=Yd(i,r.root,this.visualElement.getTransformPagePoint());let l=zd(r.layout.layoutBox,a);if(s){const o=s(Hd(l));this.hasMutatedConstraints=!!o,o&&(l=_a(o))}return l}startAnimation(t){const{drag:s,dragMomentum:i,dragElastic:r,dragTransition:a,dragSnapToOrigin:l,onDragTransitionEnd:o}=this.getProps(),c=this.constraints||{},d=Ue(u=>{if(!Zt(u,s,this.currentDirection))return;let f=c&&c[u]||{};l&&(f={min:0,max:0});const m=r?200:1e6,g=r?40:1e7,j={type:"inertia",velocity:i?t[u]:0,bounceStiffness:m,bounceDamping:g,timeConstant:750,restDelta:1,restSpeed:10,...a,...f};return this.startAxisValueAnimation(u,j)});return Promise.all(d).then(o)}startAxisValueAnimation(t,s){const i=this.getAxisMotionValue(t);return Os(this.visualElement,t),i.start(Fn(t,i,0,s,this.visualElement,!1))}stopAnimation(){Ue(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Ue(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,i=this.visualElement.getProps(),r=i[s];return r||this.visualElement.getValue(t,(i.initial?i.initial[t]:void 0)||0)}snapToCursor(t){Ue(s=>{const{drag:i}=this.getProps();if(!Zt(s,i,this.currentDirection))return;const{projection:r}=this.visualElement,a=this.getAxisMotionValue(s);if(r&&r.layout){const{min:l,max:o}=r.layout.layoutBox[s];a.set(t[s]-ve(l,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:i}=this.visualElement;if(!mt(s)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Ue(l=>{const o=this.getAxisMotionValue(l);if(o&&this.constraints!==!1){const c=o.get();r[l]=$d({min:c,max:c},this.constraints[l])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Ue(l=>{if(!Zt(l,t,null))return;const o=this.getAxisMotionValue(l),{min:c,max:d}=this.constraints[l];o.set(ve(c,d,r[l]))})}addListeners(){if(!this.visualElement.current)return;Xd.set(this.visualElement,this);const t=this.visualElement.current,s=Rt(t,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();mt(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,a=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),xe.read(i);const l=Bt(window,"resize",()=>this.scalePositionWithinConstraints()),o=r.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Ue(u=>{const f=this.getAxisMotionValue(u);f&&(this.originPoint[u]+=c[u].translate,f.set(f.get()+c[u].translate))}),this.visualElement.render())}));return()=>{l(),s(),a(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:a=!1,dragElastic:l=Ys,dragMomentum:o=!0}=t;return{...t,drag:s,dragDirectionLock:i,dragPropagation:r,dragConstraints:a,dragElastic:l,dragMomentum:o}}}function Zt(e,t,s){return(t===!0||t===e)&&(s===null||s===e)}function qd(e,t=10){let s=null;return Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x"),s}class Jd extends rt{constructor(t){super(t),this.removeGroupControls=Fe,this.removeListeners=Fe,this.controls=new Gd(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Fe}unmount(){this.removeGroupControls(),this.removeListeners()}}const Pi=e=>(t,s)=>{e&&xe.postRender(()=>e(t,s))};class Zd extends rt{constructor(){super(...arguments),this.removePointerDownListener=Fe}onPointerDown(t){this.session=new Ta(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ra(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:Pi(t),onStart:Pi(s),onMove:i,onEnd:(a,l)=>{delete this.session,r&&xe.postRender(()=>r(a,l))}}}mount(){this.removePointerDownListener=Rt(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ss={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Ei(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const At={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(J.test(e))e=parseFloat(e);else return e;const s=Ei(e,t.target.x),i=Ei(e,t.target.y);return`${s}% ${i}%`}},Qd={correct:(e,{treeScale:t,projectionDelta:s})=>{const i=e,r=it.parse(e);if(r.length>5)return i;const a=it.createTransformer(e),l=typeof r[0]!="number"?1:0,o=s.x.scale*t.x,c=s.y.scale*t.y;r[0+l]/=o,r[1+l]/=c;const d=ve(o,c,.5);return typeof r[2+l]=="number"&&(r[2+l]/=d),typeof r[3+l]=="number"&&(r[3+l]/=d),a(r)}};class eu extends h.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:i,layoutId:r}=this.props,{projection:a}=t;bl(tu),a&&(s.group&&s.group.add(a),i&&i.register&&r&&i.register(a),a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),ss.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:i,drag:r,isPresent:a}=this.props,l=i.projection;return l&&(l.isPresent=a,r||t.layoutDependency!==s||s===void 0?l.willUpdate():this.safeToRemove(),t.isPresent!==a&&(a?l.promote():l.relegate()||xe.postRender(()=>{const o=l.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),fn.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:i}=this.props,{projection:r}=t;r&&(r.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Da(e){const[t,s]=xr(),i=h.useContext(rn);return n.jsx(eu,{...e,layoutGroup:i,switchLayoutGroup:h.useContext(Sr),isPresent:t,safeToRemove:s})}const tu={borderRadius:{...At,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:At,borderTopRightRadius:At,borderBottomLeftRadius:At,borderBottomRightRadius:At,boxShadow:Qd};function su(e,t,s){const i=De(e)?e:zt(e);return i.start(Fn("",i,t,s)),i.animation}function nu(e){return e instanceof SVGElement&&e.tagName!=="svg"}const iu=(e,t)=>e.depth-t.depth;class ru{constructor(){this.children=[],this.isDirty=!1}add(t){kn(this.children,t),this.isDirty=!0}remove(t){An(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(iu),this.isDirty=!1,this.children.forEach(t)}}function au(e,t){const s=Ge.now(),i=({timestamp:r})=>{const a=r-s;a>=t&&(nt(i),e(a-t))};return xe.read(i,!0),()=>nt(i)}const Ia=["TopLeft","TopRight","BottomLeft","BottomRight"],ou=Ia.length,Mi=e=>typeof e=="string"?parseFloat(e):e,Ri=e=>typeof e=="number"||J.test(e);function lu(e,t,s,i,r,a){r?(e.opacity=ve(0,s.opacity!==void 0?s.opacity:1,cu(i)),e.opacityExit=ve(t.opacity!==void 0?t.opacity:1,0,du(i))):a&&(e.opacity=ve(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,i));for(let l=0;l<ou;l++){const o=`border${Ia[l]}Radius`;let c=Di(t,o),d=Di(s,o);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||Ri(c)===Ri(d)?(e[o]=Math.max(ve(Mi(c),Mi(d),i),0),(Xe.test(d)||Xe.test(c))&&(e[o]+="%")):e[o]=d}(t.rotate||s.rotate)&&(e.rotate=ve(t.rotate||0,s.rotate||0,i))}function Di(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const cu=Va(0,.5,ea),du=Va(.5,.95,Fe);function Va(e,t,s){return i=>i<e?0:i>t?1:s(bt(e,t,i))}function Ii(e,t){e.min=t.min,e.max=t.max}function Be(e,t){Ii(e.x,t.x),Ii(e.y,t.y)}function Vi(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Li(e,t,s,i,r){return e-=t,e=cs(e,1/s,i),r!==void 0&&(e=cs(e,1/r,i)),e}function uu(e,t=0,s=1,i=.5,r,a=e,l=e){if(Xe.test(t)&&(t=parseFloat(t),t=ve(l.min,l.max,t/100)-l.min),typeof t!="number")return;let o=ve(a.min,a.max,i);e===a&&(o-=t),e.min=Li(e.min,t,s,o,r),e.max=Li(e.max,t,s,o,r)}function Fi(e,t,[s,i,r],a,l){uu(e,t[s],t[i],t[r],t.scale,a,l)}const hu=["x","scaleX","originX"],fu=["y","scaleY","originY"];function Oi(e,t,s,i){Fi(e.x,t,hu,s?s.x:void 0,i?i.x:void 0),Fi(e.y,t,fu,s?s.y:void 0,i?i.y:void 0)}function zi(e){return e.translate===0&&e.scale===1}function La(e){return zi(e.x)&&zi(e.y)}function $i(e,t){return e.min===t.min&&e.max===t.max}function mu(e,t){return $i(e.x,t.x)&&$i(e.y,t.y)}function Bi(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Fa(e,t){return Bi(e.x,t.x)&&Bi(e.y,t.y)}function Ui(e){return Oe(e.x)/Oe(e.y)}function Hi(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class pu{constructor(){this.members=[]}add(t){kn(this.members,t),t.scheduleRender()}remove(t){if(An(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(r=>t===r);if(s===0)return!1;let i;for(let r=s;r>=0;r--){const a=this.members[r];if(a.isPresent!==!1){i=a;break}}return i?(this.promote(i),!0):!1}promote(t,s){const i=this.lead;if(t!==i&&(this.prevLead=i,this.lead=t,t.show(),i)){i.instance&&i.scheduleRender(),t.scheduleRender(),t.resumeFrom=i,s&&(t.resumeFrom.preserveOpacity=!0),i.snapshot&&(t.snapshot=i.snapshot,t.snapshot.latestValues=i.animationValues||i.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:r}=t.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:i}=t;s.onExitComplete&&s.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function xu(e,t,s){let i="";const r=e.x.translate/t.x,a=e.y.translate/t.y,l=(s==null?void 0:s.z)||0;if((r||a||l)&&(i=`translate3d(${r}px, ${a}px, ${l}px) `),(t.x!==1||t.y!==1)&&(i+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:d,rotate:u,rotateX:f,rotateY:m,skewX:g,skewY:j}=s;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),f&&(i+=`rotateX(${f}deg) `),m&&(i+=`rotateY(${m}deg) `),g&&(i+=`skewX(${g}deg) `),j&&(i+=`skewY(${j}deg) `)}const o=e.x.scale*t.x,c=e.y.scale*t.y;return(o!==1||c!==1)&&(i+=`scale(${o}, ${c})`),i||"none"}const lt={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Et=typeof window<"u"&&window.MotionDebug!==void 0,_s=["","X","Y","Z"],gu={visibility:"hidden"},Wi=1e3;let yu=0;function Ps(e,t,s,i){const{latestValues:r}=t;r[e]&&(s[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function Oa(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=Yr(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:r,layoutId:a}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",xe,!(r||a))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&Oa(i)}function za({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(l={},o=t==null?void 0:t()){this.id=yu++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Et&&(lt.totalNodes=lt.resolvedTargetDeltas=lt.recalculatedProjection=0),this.nodes.forEach(wu),this.nodes.forEach(Cu),this.nodes.forEach(ku),this.nodes.forEach(ju),Et&&window.MotionDebug.record(lt)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=l,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new ru)}addEventListener(l,o){return this.eventHandlers.has(l)||this.eventHandlers.set(l,new _n),this.eventHandlers.get(l).add(o)}notifyListeners(l,...o){const c=this.eventHandlers.get(l);c&&c.notify(...o)}hasListeners(l){return this.eventHandlers.has(l)}mount(l,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=nu(l),this.instance=l;const{layoutId:c,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(l),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const m=()=>this.root.updateBlockedByResize=!1;e(l,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=au(m,250),ss.hasAnimatedSinceResize&&(ss.hasAnimatedSinceResize=!1,this.nodes.forEach(Yi))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:m,hasRelativeTargetChanged:g,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const b=this.options.transition||u.getDefaultTransition()||Mu,{onLayoutAnimationStart:P,onLayoutAnimationComplete:C}=u.getProps(),E=!this.targetLayout||!Fa(this.targetLayout,j)||g,_=!m&&g;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||_||m&&(E||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,_);const U={...Nn(b,"layout"),onPlay:P,onComplete:C};(u.shouldReduceMotion||this.options.layoutRoot)&&(U.delay=0,U.type=!1),this.startAnimation(U)}else m||Yi(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const l=this.getStack();l&&l.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,nt(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Au),this.animationId++)}getTransformTemplate(){const{visualElement:l}=this.options;return l&&l.getProps().transformTemplate}willUpdate(l=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Oa(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const f=this.path[u];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:o,layout:c}=this.options;if(o===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),l&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Ki);return}this.isUpdating||this.nodes.forEach(Su),this.isUpdating=!1,this.nodes.forEach(Tu),this.nodes.forEach(vu),this.nodes.forEach(bu),this.clearAllSnapshots();const o=Ge.now();Ee.delta=Ze(0,1e3/60,o-Ee.timestamp),Ee.timestamp=o,Ee.isProcessing=!0,bs.update.process(Ee),bs.preRender.process(Ee),bs.render.process(Ee),Ee.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,fn.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Nu),this.sharedNodes.forEach(_u)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,xe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){xe.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const l=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ce(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,l?l.layoutBox:void 0)}updateScroll(l="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===l&&(o=!1),o){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:l,isRoot:c,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const l=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!La(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;l&&(o||ot(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(l=!0){const o=this.measurePageBox();let c=this.removeElementScroll(o);return l&&(c=this.removeTransform(c)),Ru(c),{animationId:this.root.animationId,measuredBox:o,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var l;const{visualElement:o}=this.options;if(!o)return Ce();const c=o.measureViewportBox();if(!(((l=this.scroll)===null||l===void 0?void 0:l.wasRoot)||this.path.some(Du))){const{scroll:u}=this.root;u&&(gt(c.x,u.offset.x),gt(c.y,u.offset.y))}return c}removeElementScroll(l){var o;const c=Ce();if(Be(c,l),!((o=this.scroll)===null||o===void 0)&&o.wasRoot)return c;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:f,options:m}=u;u!==this.root&&f&&m.layoutScroll&&(f.wasRoot&&Be(c,l),gt(c.x,f.offset.x),gt(c.y,f.offset.y))}return c}applyTransform(l,o=!1){const c=Ce();Be(c,l);for(let d=0;d<this.path.length;d++){const u=this.path[d];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&yt(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),ot(u.latestValues)&&yt(c,u.latestValues)}return ot(this.latestValues)&&yt(c,this.latestValues),c}removeTransform(l){const o=Ce();Be(o,l);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!ot(d.latestValues))continue;Xs(d.latestValues)&&d.updateSnapshot();const u=Ce(),f=d.measurePageBox();Be(u,f),Oi(o,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return ot(this.latestValues)&&Oi(o,this.latestValues),o}setTargetDelta(l){this.targetDelta=l,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(l){this.options={...this.options,...l,crossfade:l.crossfade!==void 0?l.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ee.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(l=!1){var o;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(l||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:m}=this.options;if(!(!this.layout||!(f||m))){if(this.resolvedRelativeTargetAt=Ee.timestamp,!this.targetDelta&&!this.relativeTarget){const g=this.getClosestProjectingParent();g&&g.layout&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ce(),this.relativeTargetOrigin=Ce(),It(this.relativeTargetOrigin,this.layout.layoutBox,g.layout.layoutBox),Be(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ce(),this.targetWithTransforms=Ce()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Ld(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Be(this.target,this.layout.layoutBox),Ea(this.target,this.targetDelta)):Be(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const g=this.getClosestProjectingParent();g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ce(),this.relativeTargetOrigin=Ce(),It(this.relativeTargetOrigin,this.target,g.target),Be(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Et&&lt.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Xs(this.parent.latestValues)||Pa(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var l;const o=this.getLead(),c=!!this.resumingFrom||this!==o;let d=!0;if((this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Ee.timestamp&&(d=!1),d)return;const{layout:u,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||f))return;Be(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,g=this.treeScale.y;Kd(this.layoutCorrected,this.treeScale,this.path,c),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Ce());const{target:j}=o;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Vi(this.prevProjectionDelta.x,this.projectionDelta.x),Vi(this.prevProjectionDelta.y,this.projectionDelta.y)),Dt(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==g||!Hi(this.projectionDelta.x,this.prevProjectionDelta.x)||!Hi(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j)),Et&&lt.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(l=!0){var o;if((o=this.options.visualElement)===null||o===void 0||o.scheduleRender(),l){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=xt(),this.projectionDelta=xt(),this.projectionDeltaWithTransform=xt()}setAnimationOrigin(l,o=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},f=xt();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const m=Ce(),g=c?c.source:void 0,j=this.layout?this.layout.source:void 0,b=g!==j,P=this.getStack(),C=!P||P.members.length<=1,E=!!(b&&!C&&this.options.crossfade===!0&&!this.path.some(Eu));this.animationProgress=0;let _;this.mixTargetDelta=U=>{const T=U/1e3;Xi(f.x,l.x,T),Xi(f.y,l.y,T),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(It(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Pu(this.relativeTarget,this.relativeTargetOrigin,m,T),_&&mu(this.relativeTarget,_)&&(this.isProjectionDirty=!1),_||(_=Ce()),Be(_,this.relativeTarget)),b&&(this.animationValues=u,lu(u,d,this.latestValues,T,E,C)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(l){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(nt(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=xe.update(()=>{ss.hasAnimatedSinceResize=!0,this.currentAnimation=su(0,Wi,{...l,onUpdate:o=>{this.mixTargetDelta(o),l.onUpdate&&l.onUpdate(o)},onComplete:()=>{l.onComplete&&l.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const l=this.getStack();l&&l.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Wi),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const l=this.getLead();let{targetWithTransforms:o,target:c,layout:d,latestValues:u}=l;if(!(!o||!c||!d)){if(this!==l&&this.layout&&d&&$a(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Ce();const f=Oe(this.layout.layoutBox.x);c.x.min=l.target.x.min,c.x.max=c.x.min+f;const m=Oe(this.layout.layoutBox.y);c.y.min=l.target.y.min,c.y.max=c.y.min+m}Be(o,c),yt(o,u),Dt(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(l,o){this.sharedNodes.has(l)||this.sharedNodes.set(l,new pu),this.sharedNodes.get(l).add(o);const d=o.options.initialPromotionConfig;o.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(o):void 0})}isLead(){const l=this.getStack();return l?l.lead===this:!0}getLead(){var l;const{layoutId:o}=this.options;return o?((l=this.getStack())===null||l===void 0?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:o}=this.options;return o?(l=this.getStack())===null||l===void 0?void 0:l.prevLead:void 0}getStack(){const{layoutId:l}=this.options;if(l)return this.root.sharedNodes.get(l)}promote({needsReset:l,transition:o,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),l&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const l=this.getStack();return l?l.relegate(this):!1}resetSkewAndRotation(){const{visualElement:l}=this.options;if(!l)return;let o=!1;const{latestValues:c}=l;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(o=!0),!o)return;const d={};c.z&&Ps("z",l,d,this.animationValues);for(let u=0;u<_s.length;u++)Ps(`rotate${_s[u]}`,l,d,this.animationValues),Ps(`skew${_s[u]}`,l,d,this.animationValues);l.render();for(const u in d)l.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);l.scheduleRender()}getProjectionStyles(l){var o,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return gu;const d={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=es(l==null?void 0:l.pointerEvents)||"",d.transform=u?u(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const b={};return this.options.layoutId&&(b.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,b.pointerEvents=es(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!ot(this.latestValues)&&(b.transform=u?u({},""):"none",this.hasProjected=!1),b}const m=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=xu(this.projectionDeltaWithTransform,this.treeScale,m),u&&(d.transform=u(m,d.transform));const{x:g,y:j}=this.projectionDelta;d.transformOrigin=`${g.origin*100}% ${j.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(o=m.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:d.opacity=f===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const b in is){if(m[b]===void 0)continue;const{correct:P,applyTo:C}=is[b],E=d.transform==="none"?m[b]:P(m[b],f);if(C){const _=C.length;for(let U=0;U<_;U++)d[C[U]]=E}else d[b]=E}return this.options.layoutId&&(d.pointerEvents=f===this?es(l==null?void 0:l.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(l=>{var o;return(o=l.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(Ki),this.root.sharedNodes.clear()}}}function vu(e){e.updateLayout()}function bu(e){var t;const s=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=e.layout,{animationType:a}=e.options,l=s.source!==e.layout.source;a==="size"?Ue(f=>{const m=l?s.measuredBox[f]:s.layoutBox[f],g=Oe(m);m.min=i[f].min,m.max=m.min+g}):$a(a,s.layoutBox,i)&&Ue(f=>{const m=l?s.measuredBox[f]:s.layoutBox[f],g=Oe(i[f]);m.max=m.min+g,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+g)});const o=xt();Dt(o,i,s.layoutBox);const c=xt();l?Dt(c,e.applyTransform(r,!0),s.measuredBox):Dt(c,i,s.layoutBox);const d=!La(o);let u=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:m,layout:g}=f;if(m&&g){const j=Ce();It(j,s.layoutBox,m.layoutBox);const b=Ce();It(b,i,g.layoutBox),Fa(j,b)||(u=!0),f.options.layoutRoot&&(e.relativeTarget=b,e.relativeTargetOrigin=j,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:i,snapshot:s,delta:c,layoutDelta:o,hasLayoutChanged:d,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:i}=e.options;i&&i()}e.options.transition=void 0}function wu(e){Et&&lt.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function ju(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Nu(e){e.clearSnapshot()}function Ki(e){e.clearMeasurements()}function Su(e){e.isLayoutDirty=!1}function Tu(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Yi(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Cu(e){e.resolveTargetDelta()}function ku(e){e.calcProjection()}function Au(e){e.resetSkewAndRotation()}function _u(e){e.removeLeadSnapshot()}function Xi(e,t,s){e.translate=ve(t.translate,0,s),e.scale=ve(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function Gi(e,t,s,i){e.min=ve(t.min,s.min,i),e.max=ve(t.max,s.max,i)}function Pu(e,t,s,i){Gi(e.x,t.x,s.x,i),Gi(e.y,t.y,s.y,i)}function Eu(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Mu={duration:.45,ease:[.4,0,.1,1]},qi=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Ji=qi("applewebkit/")&&!qi("chrome/")?Math.round:Fe;function Zi(e){e.min=Ji(e.min),e.max=Ji(e.max)}function Ru(e){Zi(e.x),Zi(e.y)}function $a(e,t,s){return e==="position"||e==="preserve-aspect"&&!Vd(Ui(t),Ui(s),.2)}function Du(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const Iu=za({attachResizeListener:(e,t)=>Bt(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Es={current:void 0},Ba=za({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Es.current){const e=new Iu({});e.mount(window),e.setOptions({layoutScroll:!0}),Es.current=e}return Es.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Vu={pan:{Feature:Zd},drag:{Feature:Jd,ProjectionNode:Ba,MeasureLayout:Da}};function Qi(e,t,s){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover",s==="Start");const r="onHover"+s,a=i[r];a&&xe.postRender(()=>a(t,Xt(t)))}class Lu extends rt{mount(){const{current:t}=this.node;t&&(this.unmount=Vl(t,s=>(Qi(this.node,s,"Start"),i=>Qi(this.node,i,"End"))))}unmount(){}}class Fu extends rt{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Yt(Bt(this.node.current,"focus",()=>this.onFocus()),Bt(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function er(e,t,s){const{props:i}=e;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap",s==="Start");const r="onTap"+(s==="End"?"":s),a=i[r];a&&xe.postRender(()=>a(t,Xt(t)))}class Ou extends rt{mount(){const{current:t}=this.node;t&&(this.unmount=zl(t,s=>(er(this.node,s,"Start"),(i,{success:r})=>er(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const qs=new WeakMap,Ms=new WeakMap,zu=e=>{const t=qs.get(e.target);t&&t(e)},$u=e=>{e.forEach(zu)};function Bu({root:e,...t}){const s=e||document;Ms.has(s)||Ms.set(s,{});const i=Ms.get(s),r=JSON.stringify(t);return i[r]||(i[r]=new IntersectionObserver($u,{root:e,...t})),i[r]}function Uu(e,t,s){const i=Bu(t);return qs.set(e,s),i.observe(e),()=>{qs.delete(e),i.unobserve(e)}}const Hu={some:0,all:1};class Wu extends rt{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:i,amount:r="some",once:a}=t,l={root:s?s.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:Hu[r]},o=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,a&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:f}=this.node.getProps(),m=d?u:f;m&&m(c)};return Uu(this.node.current,l,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(Ku(t,s))&&this.startObserver()}unmount(){}}function Ku({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}const Yu={inView:{Feature:Wu},tap:{Feature:Ou},focus:{Feature:Fu},hover:{Feature:Lu}},Xu={layout:{ProjectionNode:Ba,MeasureLayout:Da}},Js={current:null},Ua={current:!1};function Gu(){if(Ua.current=!0,!!ln)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Js.current=e.matches;e.addListener(t),t()}else Js.current=!1}const qu=[...ma,Re,it],Ju=e=>qu.find(fa(e)),tr=new WeakMap;function Zu(e,t,s){for(const i in t){const r=t[i],a=s[i];if(De(r))e.addValue(i,r);else if(De(a))e.addValue(i,zt(r,{owner:e}));else if(a!==r)if(e.hasValue(i)){const l=e.getValue(i);l.liveStyle===!0?l.jump(r):l.hasAnimated||l.set(r)}else{const l=e.getStaticValue(i);e.addValue(i,zt(l!==void 0?l:r,{owner:e}))}}for(const i in s)t[i]===void 0&&e.removeValue(i);return t}const sr=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Qu{scrapeMotionValuesFromProps(t,s,i){return{}}constructor({parent:t,props:s,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:a,visualState:l},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=In,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=Ge.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,xe.render(this.render,!1,!0))};const{latestValues:c,renderState:d,onUpdate:u}=l;this.onUpdate=u,this.latestValues=c,this.baseTarget={...c},this.initialValues=s.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=s,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.blockInitialAnimation=!!a,this.isControllingVariants=ps(s),this.isVariantNode=jr(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:f,...m}=this.scrapeMotionValuesFromProps(s,{},this);for(const g in m){const j=m[g];c[g]!==void 0&&De(j)&&j.set(c[g],!1)}}mount(t){this.current=t,tr.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,i)=>this.bindToMotionValue(i,s)),Ua.current||Gu(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Js.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){tr.delete(this.current),this.projection&&this.projection.unmount(),nt(this.notifyUpdate),nt(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const i=ft.has(t),r=s.on("change",o=>{this.latestValues[t]=o,this.props.onUpdate&&xe.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),a=s.on("renderRequest",this.scheduleRender);let l;window.MotionCheckAppearSync&&(l=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{r(),a(),l&&l(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in wt){const s=wt[t];if(!s)continue;const{isEnabled:i,Feature:r}=s;if(!this.features[t]&&r&&i(this.props)&&(this.features[t]=new r(this)),this.features[t]){const a=this.features[t];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ce()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let i=0;i<sr.length;i++){const r=sr[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const a="on"+r,l=t[a];l&&(this.propEventSubscriptions[r]=this.on(r,l))}this.prevMotionValues=Zu(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const i=this.values.get(t);s!==i&&(i&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let i=this.values.get(t);return i===void 0&&s!==void 0&&(i=zt(s===null?void 0:s,{owner:this}),this.addValue(t,i)),i}readValue(t,s){var i;let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(i=this.getBaseTargetFromProps(this.props,t))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(ua(r)||sa(r))?r=parseFloat(r):!Ju(r)&&it.test(s)&&(r=la(t,s)),this.setBaseTarget(t,De(r)?r.get():r)),De(r)?r.get():r}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const l=pn(this.props,i,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);l&&(r=l[t])}if(i&&r!==void 0)return r;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!De(a)?a:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new _n),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class Ha extends Qu{constructor(){super(...arguments),this.KeyframeResolver=pa}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:i}){delete s[t],delete i[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;De(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function eh(e){return window.getComputedStyle(e)}class th extends Ha{constructor(){super(...arguments),this.type="html",this.renderInstance=Er}readValueFromInstance(t,s){if(ft.has(s)){const i=Dn(s);return i&&i.default||0}else{const i=eh(t),r=(Ar(s)?i.getPropertyValue(s):i[s])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(t,{transformPagePoint:s}){return Ma(t,s)}build(t,s,i){yn(t,s,i.transformTemplate)}scrapeMotionValuesFromProps(t,s,i){return jn(t,s,i)}}class sh extends Ha{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ce}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(ft.has(s)){const i=Dn(s);return i&&i.default||0}return s=Mr.has(s)?s:hn(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,i){return Ir(t,s,i)}build(t,s,i){vn(t,s,this.isSVGTag,i.transformTemplate)}renderInstance(t,s,i,r){Rr(t,s,i,r)}mount(t){this.isSVGTag=wn(t.tagName),super.mount(t)}}const nh=(e,t)=>mn(e)?new sh(t):new th(t,{allowProjection:e!==h.Fragment}),ih=_l({...kd,...Yu,...Vu,...Xu},nh),He=Ho(ih),rh=({title:e,onFilterClick:t,showAdd:s=!0,variant:i="default"})=>{const r=i==="overlay";return n.jsxs("div",{className:r?"fixed top-0 left-0 right-0 z-30 px-6 py-4 bg-gradient-to-b from-pink-200/60 via-purple-200/40 to-transparent backdrop-blur-sm flex justify-between items-center pointer-events-none":"sticky top-0 z-20 px-6 py-4 bg-primary-50/80 backdrop-blur-md flex justify-between items-center transition-all",children:[n.jsx("div",{className:r?"text-2xl font-bold text-slate-800 tracking-tight flex items-center opacity-0":"text-2xl font-bold text-slate-800 tracking-tight flex items-center",children:e}),n.jsx("div",{className:r?"flex gap-4 opacity-0":"flex gap-4",children:s&&n.jsx("button",{onClick:t,className:"p-2 rounded-full bg-white text-primary-500 shadow-sm hover:shadow-md transition-all active:scale-95","aria-label":"",children:n.jsx(st,{size:20})})})]})};var Ye=(e=>(e.ONLINE="",e.OFFLINE="",e.BUSY="",e))(Ye||{}),dt=(e=>(e.TEXT="text",e.SYSTEM="system",e))(dt||{}),me=(e=>(e.HOME="home",e.CHAT="chat",e.ME="me",e))(me||{});const ah=({activeTab:e,onTabChange:t})=>{const s=i=>`flex flex-col items-center justify-center w-full h-full transition-all duration-300 ${e===i?"text-primary-600 scale-105":"text-slate-400 hover:text-primary-400"}`;return n.jsx("div",{className:"fixed bottom-0 inset-x-0 z-30",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-20 bg-white/90 backdrop-blur-lg border-t border-primary-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] flex justify-around items-center px-4 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[n.jsxs("button",{className:s(me.HOME),onClick:()=>t(me.HOME),children:[n.jsx(yo,{size:24,strokeWidth:e===me.HOME?2.5:2}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]}),n.jsxs("button",{className:s(me.CHAT),onClick:()=>t(me.CHAT),children:[n.jsxs("div",{className:"relative",children:[n.jsx(nn,{size:24,strokeWidth:e===me.CHAT?2.5:2}),n.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-400 rounded-full border-2 border-white"})]}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]}),n.jsxs("button",{className:s(me.ME),onClick:()=>t(me.ME),children:[n.jsx(Qs,{size:24,strokeWidth:e===me.ME?2.5:2}),n.jsx("span",{className:"text-xs mt-1 font-semibold",children:""})]})]})})},nr=({chat:e,onClick:t,onTogglePin:s,roundedClass:i})=>{var c;const r=d=>d.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1}),[a,l]=h.useState(!1),o=d=>{d.stopPropagation(),s()};return n.jsxs("div",{onClick:t,className:`group relative flex items-center gap-4 p-4 bg-white ${i||"rounded-2xl"} shadow-sm border border-transparent hover:border-primary-100 hover:shadow-md active:scale-[0.98] transition-all duration-200 cursor-pointer`,children:[n.jsx("div",{className:"relative flex-shrink-0",children:n.jsx("div",{className:"w-14 h-14 rounded-full p-0.5 bg-gradient-to-tr from-primary-300 to-accent-pink",children:!a&&e.character.avatar?n.jsx("img",{src:e.character.avatar,alt:e.character.name,onError:()=>l(!0),className:"w-full h-full rounded-full object-cover border-2 border-white"}):n.jsx("div",{className:"w-full h-full rounded-full border-2 border-white bg-white flex items-center justify-center text-slate-500 font-bold",children:((c=e.character.name)==null?void 0:c[0])||"?"})})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("h3",{className:"font-bold text-slate-800 text-lg truncate",children:e.character.name})}),n.jsx("span",{className:"text-xs text-slate-400 font-medium whitespace-nowrap ml-2",children:r(e.lastMessage.timestamp)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("p",{className:"text-slate-500 text-sm truncate pr-4 leading-relaxed",children:[e.lastMessage.senderId==="user"&&n.jsx("span",{className:"text-slate-400",children:": "}),e.lastMessage.text]}),n.jsxs("div",{className:"flex gap-2 items-center flex-shrink-0",children:[n.jsx("button",{onClick:o,className:`w-6 h-6 flex items-center justify-center rounded-full transition-all ${e.character.isPinned?"bg-primary-50 text-primary-400":"text-slate-200 hover:text-primary-300"}`,children:n.jsx(Mo,{size:14,className:`transform rotate-45 ${e.character.isPinned?"fill-primary-400":""}`})}),e.unreadCount>0&&n.jsx("span",{className:"flex items-center justify-center min-w-[20px] h-5 px-1.5 bg-red-400 text-white text-[10px] font-bold rounded-full",children:e.unreadCount})]})]})]})]})},oh=({chats:e,onChatClick:t,onTogglePin:s,onDeleteChat:i,isDetailOpen:r=!1})=>{const a=(navigator==null?void 0:navigator.maxTouchPoints)>0,l=e.filter(k=>k.character.isPinned),o=e.filter(k=>!k.character.isPinned),[c,d]=h.useState({}),[u,f]=h.useState(null),m=h.useRef(0),g=h.useRef(0),j=h.useRef(null),[b,P]=h.useState({visible:!1,x:0,y:0,id:null}),C=(k,V)=>{m.current=k.touches[0].clientX,g.current=k.touches[0].clientY,j.current=V},E=(k,V)=>{if(j.current!==V)return;const M=k.touches[0].clientX-m.current,W=k.touches[0].clientY-g.current;if(Math.abs(W)>Math.abs(M))return;const O=Math.max(-96,Math.min(0,M));d(L=>({...L,[V]:O}))},_=k=>{if(j.current!==k)return;const M=(c[k]||0)<-60?-96:0;d(W=>({...W,[k]:M})),j.current=null},U=k=>d(V=>({...V,[k]:0})),T=(k,V)=>{if(k.preventDefault(),a)return;let M=k.clientX;const W=120;M+W>window.innerWidth&&(M=window.innerWidth-W-10),P({visible:!0,x:M,y:k.clientY,id:V})};return n.jsxs(He.div,{className:"px-6 pb-24 animate-in fade-in slide-in-from-bottom-4 duration-700",initial:{x:0},animate:r&&a?{x:"-100%"}:{x:0},transition:r&&a?{duration:.3,ease:"linear"}:{duration:0},children:[l.length>0&&n.jsxs("div",{className:"mb-6",children:[n.jsx("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 px-1",children:""}),l.map(k=>n.jsxs("div",{className:"relative overflow-hidden mb-3 rounded-2xl",children:[(()=>{const V=Math.min(96,Math.max(0,-(c[k.characterId]||0)));return n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${V}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>f(k.characterId),className:"text-white font-bold drop-shadow-sm",children:""})})})(),n.jsx("div",{onTouchStart:V=>C(V,k.characterId),onTouchMove:V=>E(V,k.characterId),onTouchEnd:()=>_(k.characterId),onContextMenu:V=>T(V,k.characterId),style:{transform:`translateX(${c[k.characterId]||0}px)`,transition:"transform 180ms ease"},children:n.jsx(nr,{chat:k,onClick:()=>t(k),onTogglePin:()=>s(k.characterId),roundedClass:(c[k.characterId]||0)<0?"rounded-l-2xl rounded-r-none":"rounded-2xl"})})]},k.characterId))]}),o.length>0&&n.jsxs("div",{children:[n.jsx("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 px-1",children:""}),o.map(k=>n.jsxs("div",{className:"relative overflow-hidden mb-3 rounded-2xl",children:[(()=>{const V=Math.min(96,Math.max(0,-(c[k.characterId]||0)));return n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${V}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>f(k.characterId),className:"text-white font-bold drop-shadow-sm",children:""})})})(),n.jsx("div",{onTouchStart:V=>C(V,k.characterId),onTouchMove:V=>E(V,k.characterId),onTouchEnd:()=>_(k.characterId),onContextMenu:V=>T(V,k.characterId),style:{transform:`translateX(${c[k.characterId]||0}px)`,transition:"transform 180ms ease"},children:n.jsx(nr,{chat:k,onClick:()=>t(k),onTogglePin:()=>s(k.characterId),roundedClass:(c[k.characterId]||0)<0?"rounded-l-2xl rounded-r-none":"rounded-2xl"})})]},k.characterId))]}),u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{U(u),f(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{const k=u;f(null),i(k)},children:""})]})]})}),n.jsx("style",{children:`
        @keyframes fadeCard { from { opacity: 0; transform: translateY(-6px) } to { opacity: 1; transform: translateY(0) } }
        @keyframes fadeBg { from { opacity: 0 } to { opacity: 1 } }
      `})]}),e.length===0&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[n.jsx("p",{className:"text-slate-500 font-medium",children:""}),n.jsx("p",{className:"text-slate-400 text-sm mt-1",children:""})]}),b.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>P(k=>({...k,visible:!1})),onContextMenu:k=>{k.preventDefault(),P(V=>({...V,visible:!1}))}}),n.jsx("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95 duration-100",style:{top:b.y,left:b.x},children:n.jsx("button",{onClick:()=>{b.id&&f(b.id),P(k=>({...k,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 transition-colors",children:""})})]})]})},lh={type:"tween",ease:"easeInOut",duration:.28},On={type:"tween",ease:"linear",duration:.28},ys={duration:.18},ch="/api",dh={async login(e,t){const s=await fetch(`${ch}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!s.ok)throw new Error("login_failed");return s.json()}},zn=e=>e==="male"?"":e==="female"?"":"",uh=async e=>{const t={name:(e==null?void 0:e.name)||"",age:parseInt((e==null?void 0:e.age)||"0")||null,gender:zn(e==null?void 0:e.gender),profession:(e==null?void 0:e.profession)||null,basic_info:(e==null?void 0:e.basicInfo)||null,personality:(e==null?void 0:e.personality)||null,avatar:(e==null?void 0:e.avatar)||null},{authFetch:s}=await de(async()=>{const{authFetch:a}=await import("./http-CAiBnKza.js");return{authFetch:a}},__vite__mapDeps([0,1,2,3])),i=await s("/user/chat-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error("create_role_failed");return(await i.json()).id},hh=async(e,t)=>{const s={name:(t==null?void 0:t.name)||"",age:parseInt((t==null?void 0:t.age)||"0")||null,gender:zn(t==null?void 0:t.gender),profession:(t==null?void 0:t.profession)||null,basic_info:(t==null?void 0:t.basicInfo)||null,personality:(t==null?void 0:t.personality)||null,avatar:(t==null?void 0:t.avatar)||null},{authFetch:i}=await de(async()=>{const{authFetch:a}=await import("./http-CAiBnKza.js");return{authFetch:a}},__vite__mapDeps([0,1,2,3]));if(!(await i(`/user/chat-role/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("update_role_failed");return!0},fh=async()=>{const{authFetch:e}=await de(async()=>{const{authFetch:i}=await import("./http-CAiBnKza.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),t=await e("/user/chat-role",{method:"GET"});if(!t.ok)throw new Error("fetch_roles_failed");const s=await t.json();return Array.isArray(s)?s:[]},mh=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:i}=await import("./http-CAiBnKza.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user/chat-role/${e}`,{method:"DELETE"})).ok)throw new Error("delete_role_failed");return!0},Zs=async(e,t)=>{const s={character_id:Number(e)};typeof t=="number"&&(s.user_chat_role_id=t);const{authFetch:i}=await de(async()=>{const{authFetch:l}=await import("./http-CAiBnKza.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3])),r=await i("/chat/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("create_session_failed");const a=await r.json();return typeof a=="string"?{sessionId:a}:{sessionId:a.sessionId,model:a.model,temperature:a.temperature}},Rs=(e,t)=>{const r=`${`${location.protocol==="https:"?"wss":"ws"}://${location.host}`}/ws/chat`;console.log("[ws] connecting",r);let a=null,l=!1,o=1e3;const c=1e4,d=[],u=()=>{a=new WebSocket(r),a.onmessage=j=>{try{const b=JSON.parse(String(j.data));b&&b.type==="assistant_message"&&typeof b.content=="string"&&t(b.content,b.quote,{chunkIndex:b.chunkIndex,chunkTotal:b.chunkTotal})}catch{}},a.onerror=j=>{console.error("[ws] error",j)},a.onopen=()=>{for(console.log("[ws] open"),o=1e3;d.length;){const b=d.shift();try{a==null||a.send(JSON.stringify(b))}catch{}}const j={type:"typing",sessionId:e,typing:!1};try{a==null||a.send(JSON.stringify(j))}catch{}},a.onclose=()=>{console.log("[ws] closed"),l||(setTimeout(u,o),o=Math.min(o*2,c))}};return u(),{ws:a,sendText:(j,b,P,C,E)=>{const _={sessionId:e,text:j,chatMode:b};P&&(_.userRole={name:P.name,gender:zn(P.gender),age:P.age||"",profession:P.profession||"",basic_info:P.basicInfo||"",personality:P.personality||"",avatar:P.avatar||""}),C&&(_.model_id=C),typeof E=="number"&&(_.temperature=E),a&&a.readyState===WebSocket.OPEN?a.send(JSON.stringify(_)):d.push(_)},sendTyping:j=>{const b={type:"typing",sessionId:e,typing:j};a&&a.readyState===WebSocket.OPEN?a.send(JSON.stringify(b)):d.push(b)},close:()=>{l=!0;try{a==null||a.close()}catch{}}}},ph=async()=>{const{authFetch:e}=await de(async()=>{const{authFetch:i}=await import("./http-CAiBnKza.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),t=await e("/chat/models",{method:"GET"});if(!t.ok)throw new Error("list_models_failed");const s=await t.json();return Array.isArray(s.items)?s.items:[]},xh=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:a}=await import("./http-CAiBnKza.js");return{authFetch:a}},__vite__mapDeps([0,1,2,3])),s=await t(`/chat/sessions/${e}`,{method:"GET"});if(!s.ok)throw new Error("get_session_failed");const i=await s.json(),r=(i==null?void 0:i.session)||{};return{model:r==null?void 0:r.model,temperature:r==null?void 0:r.temperature}},vs=({imageSrc:e,onCrop:t,onCancel:s,aspectRatio:i,outputWidth:r,outputHeight:a})=>{const[l,o]=h.useState(1),[c,d]=h.useState({x:0,y:0}),[u,f]=h.useState(!1),[m,g]=h.useState({x:0,y:0}),j=h.useRef(null),b=h.useRef(null),P=h.useRef(null),C=h.useRef(null),E=i&&i>0?i:1,[_,U]=h.useState(Math.round(300*E)),[T,k]=h.useState(300);h.useEffect(()=>{const L=()=>{const K=b.current?b.current.clientWidth:window.innerWidth,N=b.current?b.current.clientHeight:window.innerHeight;let F=Math.min(Math.floor(K*.9),700),X=Math.round(F/E);const se=Math.max(180,Math.min(N-160,380));X>se&&(X=se,F=Math.round(X*E)),U(F),k(X)};return L(),window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[E]);const V=L=>{f(!0);const K="touches"in L?L.touches[0].clientX:L.clientX,N="touches"in L?L.touches[0].clientY:L.clientY;g({x:K-c.x,y:N-c.y})},M=L=>{if(!u)return;L.preventDefault();const K="touches"in L?L.touches[0].clientX:L.clientX,N="touches"in L?L.touches[0].clientY:L.clientY;d({x:K-m.x,y:N-m.y})},W=()=>{f(!1)},O=()=>{const L=P.current,K=j.current;if(!L||!K)return;const N=L.getContext("2d");if(!N)return;const F=r&&r>0?r:300,X=a&&a>0?a:Math.round(F/E);L.width=F,L.height=X;const se=K.naturalWidth,G=K.naturalHeight,ne=Math.max(_/se,T/G),he=F/_,Se=X/T;N.fillStyle="#000",N.fillRect(0,0,F,X),N.translate(F/2,X/2),N.translate(c.x*he,c.y*Se),N.scale(l*he,l*Se),N.scale(ne,ne),N.drawImage(K,-se/2,-G/2),t(L.toDataURL("image/jpeg",.9))};return n.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center animate-in fade-in duration-300",children:[n.jsxs("div",{className:"absolute top-0 w-full p-4 flex justify-between items-center z-20 text-white",children:[n.jsx("button",{onClick:s,className:"p-2 bg-white/10 rounded-full backdrop-blur-md",children:n.jsx(ut,{size:24})}),n.jsx("h3",{className:"font-bold text-lg tracking-wider",children:""}),n.jsx("button",{onClick:O,className:"p-2 bg-purple-500 rounded-full text-white shadow-lg shadow-purple-500/30",children:n.jsx(mr,{size:24})})]}),n.jsxs("div",{ref:b,className:"relative w-full h-full overflow-hidden bg-black flex items-center justify-center touch-none select-none",onMouseDown:V,onMouseMove:M,onMouseUp:W,onMouseLeave:W,onTouchStart:V,onTouchMove:M,onTouchEnd:W,children:[n.jsx("img",{ref:j,src:e,alt:"Crop target",className:"absolute max-w-none transition-transform duration-75 ease-linear pointer-events-none",style:{transform:`translate(${c.x}px, ${c.y}px) scale(${l})`,height:"auto",width:_},draggable:!1}),n.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 flex items-center justify-center",children:n.jsx("div",{ref:C,className:"absolute border-2 border-white box-content shadow-[0_0_0_9999px_rgba(0,0,0,0.8)]",style:{width:_,height:T},children:n.jsxs("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 opacity-30",children:[n.jsx("div",{className:"border-r border-white"}),n.jsx("div",{className:"border-r border-white"}),n.jsx("div",{className:"border-b border-white col-span-3 row-start-1"}),n.jsx("div",{className:"border-b border-white col-span-3 row-start-2"})]})})})]}),n.jsx("div",{className:"absolute bottom-0 w-full bg-slate-900/80 backdrop-blur-md p-6 pb-10 flex flex-col gap-4 z-20",children:n.jsxs("div",{className:"flex items-center gap-4 text-white justify-center",children:[n.jsx(ko,{size:20,className:"text-slate-400"}),n.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.05",value:l,onChange:L=>o(parseFloat(L.target.value)),className:"w-64 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-purple-500"}),n.jsx(st,{size:20,className:"text-slate-400"})]})}),n.jsx("canvas",{ref:P,className:"hidden"})]})},Wa=({currentPersona:e,roleId:t,onBack:s,onSave:i,withinContainer:r=!1})=>{const[a,l]=h.useState((e==null?void 0:e.gender)||"female"),[o,c]=h.useState((e==null?void 0:e.name)||""),[d,u]=h.useState((e==null?void 0:e.age)||""),[f,m]=h.useState((e==null?void 0:e.profession)||""),[g,j]=h.useState((e==null?void 0:e.basicInfo)||""),[b,P]=h.useState((e==null?void 0:e.personality)||""),[C,E]=h.useState(e==null?void 0:e.avatar),[_,U]=h.useState(null),[T,k]=h.useState(!1),V=h.useRef(null),M=K=>{var ne;const N=K.split(","),F=((ne=N[0].match(/:(.*?);/))==null?void 0:ne[1])||"image/jpeg",X=atob(N[1]);let se=X.length;const G=new Uint8Array(se);for(;se--;)G[se]=X.charCodeAt(se);return new Blob([G],{type:F})},W=async()=>{if(T)return;k(!0);const K=localStorage.getItem("user_access_token");let N=C;try{if(C&&C.startsWith("data:image")){const X=M(C),se=new FormData,G=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;se.append("avatar",X,"avatar.jpg"),se.append("filename",G),N=`/uploads/users/avatars/${G}`,fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:K?`Bearer ${K}`:""},body:se}).catch(()=>{})}const F={gender:a,name:o,age:d,profession:f,basicInfo:g,personality:b,avatar:N||void 0};typeof t=="number"?await hh(t,F):await uh(F)}catch{}i({gender:a,name:o,age:d,profession:f,basicInfo:g,personality:b,avatar:N}),k(!1),s()},O=()=>{var K;(K=V.current)==null||K.click()},L=K=>{var F;const N=(F=K.target.files)==null?void 0:F[0];if(N){const X=new FileReader;X.onloadend=()=>{U(X.result)},X.readAsDataURL(N)}V.current&&(V.current.value="")};return n.jsxs("div",{className:`${r?"absolute":"fixed"} inset-0 z-[80]`,children:[n.jsx(He.div,{className:"absolute inset-0 bg-[#F8F9FA]",initial:{opacity:0},animate:{opacity:1},transition:ys}),n.jsxs(He.div,{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)] flex flex-col h-[92vh] w-full overflow-y-auto no-scrollbar",initial:{y:"100%"},animate:{y:0},transition:On,children:[_&&n.jsx(vs,{imageSrc:_,onCancel:()=>U(null),onCrop:K=>{E(K),U(null)}}),n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm border-b border-slate-100 rounded-none md:rounded-t-3xl",children:[n.jsx("button",{onClick:s,className:"p-2 -ml-2 text-slate-800 hover:bg-slate-50 rounded-full transition-colors",children:n.jsx(Ht,{size:24})}),n.jsx("button",{onClick:W,disabled:T,className:`px-4 py-1.5 rounded-lg text-sm font-bold transition-transform ${T?"bg-purple-200 text-white cursor-not-allowed":"bg-purple-50 text-purple-600 active:scale-95"}`,children:""})]}),n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white p-4 space-y-3 pb-10 rounded-none md:rounded-b-3xl md:shadow-2xl",children:[n.jsx("div",{className:"flex justify-center py-6",children:n.jsxs("div",{onClick:O,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-24 h-24 rounded-full bg-pink-200 flex items-center justify-center text-white shadow-sm border-4 border-white overflow-hidden",children:C?n.jsx("img",{src:C,alt:"User Avatar",className:"w-full h-full object-cover"}):n.jsx(Qs,{size:48,fill:"currentColor"})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-white p-2 rounded-full shadow-md border border-slate-100",children:n.jsx(Za,{size:14,className:"text-slate-400"})}),n.jsx("input",{type:"file",ref:V,className:"hidden",accept:"image/*",onChange:L})]})}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-4",children:""}),n.jsxs("div",{className:"flex gap-6",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${a==="male"?"border-blue-500":"border-slate-300"}`,children:a==="male"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"male",checked:a==="male",onChange:()=>l("male"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${a==="female"?"border-blue-500":"border-slate-300"}`,children:a==="female"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"female",checked:a==="female",onChange:()=>l("female"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[n.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${a==="secret"?"border-blue-500":"border-slate-300"}`,children:a==="secret"&&n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),n.jsx("input",{type:"radio",name:"gender",value:"secret",checked:a==="secret",onChange:()=>l("secret"),className:"hidden"}),n.jsx("span",{className:"text-sm text-slate-700 group-hover:text-slate-900",children:""})]})]})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:" ()"}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:o,onChange:K=>c(K.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:d,onChange:K=>u(K.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("input",{type:"text",placeholder:"",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1",value:f,onChange:K=>m(K.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("textarea",{placeholder:"...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:g,onChange:K=>j(K.target.value)})]}),n.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:[n.jsx("label",{className:"block font-bold text-slate-800 text-sm mb-2",children:""}),n.jsx("textarea",{placeholder:"...",className:"w-full text-sm outline-none placeholder:text-slate-300 py-1 resize-none h-20",value:b,onChange:K=>P(K.target.value)})]})]})]})]})},ir=e=>e===""?"male":e===""?"female":"secret",gh=({isOpen:e,currentPersona:t,onClose:s,onAdd:i,onSelect:r,onEdit:a})=>{const[l,o]=h.useState([]),[c,d]=h.useState(null),[u,f]=h.useState({}),m=h.useRef(0),g=h.useRef(0),j=h.useRef(null),b=h.useRef(0),[P,C]=h.useState(null),E=(navigator==null?void 0:navigator.maxTouchPoints)>0,[_,U]=h.useState({visible:!1,x:0,y:0,id:null});h.useEffect(()=>{e&&((async()=>{try{const F=await fh();o(F)}catch{}})(),f({}))},[e]),h.useEffect(()=>{if(t){const N=l.find(F=>F.name===t.name);N&&d(N.id)}},[l,t]);const T=N=>{d(N.id);const F={name:N.name||"",gender:ir(N.gender),age:N.age?String(N.age):"",profession:N.profession||"",basicInfo:N.basic_info||"",personality:N.personality||"",avatar:N.avatar||void 0};try{localStorage.setItem("user_chat_role_id",String(N.id))}catch{}r(F,N.id),s()},k=N=>{L(N.id);const F={name:N.name||"",gender:ir(N.gender),age:N.age?String(N.age):"",profession:N.profession||"",basicInfo:N.basic_info||"",personality:N.personality||"",avatar:N.avatar||void 0};a&&a(F,N.id),s()},V=(N,F)=>{if(N.preventDefault(),E)return;let X=N.clientX;const se=140;X+se>window.innerWidth&&(X=window.innerWidth-se-10),U({visible:!0,x:X,y:N.clientY,id:F})},M=(N,F)=>{m.current=N.touches[0].clientX,g.current=N.touches[0].clientY,j.current=F,b.current=u[F]||0},W=(N,F)=>{if(j.current!==F)return;const X=N.touches[0].clientX-m.current,se=N.touches[0].clientY-g.current;if(Math.abs(se)>Math.abs(X))return;let G=0;b.current===0?G=Math.max(-96,Math.min(96,X)):b.current>0?G=Math.max(0,Math.min(96,b.current+X)):G=Math.min(0,Math.max(-96,b.current+X)),f(ne=>({...ne,[F]:G}))},O=N=>{if(j.current!==N)return;const F=u[N]||0;let X=0;b.current===0?X=F>60?96:F<-60?-96:0:b.current>0?X=F>60?96:0:X=F<-60?-96:0,f(se=>({...se,[N]:X})),j.current=null},L=N=>f(F=>({...F,[N]:0})),K=async N=>{C(null);try{await mh(N),o(F=>F.filter(X=>X.id!==N))}catch{}};return n.jsxs("div",{className:`fixed inset-0 z-[90] ${e?"":"pointer-events-none"}`,children:[n.jsx(vt,{children:e&&n.jsxs(n.Fragment,{children:[n.jsx(He.div,{className:"absolute inset-0 bg-black/30 will-change-opacity",onClick:s,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:ys},"backdrop"),n.jsx(He.div,{className:"absolute bottom-0 left-0 right-0 bg-transparent will-change-transform transform-gpu",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:On,children:n.jsxs("div",{className:"mx-auto w-full max-w-md bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)]",children:[n.jsxs("div",{className:"sticky top-0 bg-white/95 backdrop-blur-md p-3 border-b border-slate-100 flex justify-between items-center z-10",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-2",children:[n.jsx(Ht,{className:"w-6 h-6"}),n.jsx("span",{className:"font-bold text-lg",children:""})]}),n.jsx("button",{onClick:i,className:"w-9 h-9 rounded-full bg-purple-50 text-[#A855F7] flex items-center justify-center active:scale-90 transition-transform",children:n.jsx(st,{className:"w-6 h-6"})})]}),n.jsxs("div",{className:"p-4 flex flex-col gap-3 max-h-[70vh] overflow-y-auto",children:[l.map(N=>n.jsxs("div",{className:"relative overflow-hidden rounded-xl",children:[(()=>{const F=u[N.id]||0,X=Math.min(96,Math.max(0,-F)),se=Math.min(96,Math.max(0,F));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-xl shadow-sm",style:{width:`${X}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>C(N.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-xl shadow-sm",style:{width:`${se}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>k(N),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onClick:()=>{(u[N.id]||0)===0&&T(N)},onTouchStart:F=>M(F,N.id),onTouchMove:F=>W(F,N.id),onTouchEnd:()=>O(N.id),onContextMenu:F=>V(F,N.id),className:`${(u[N.id]||0)<0?"rounded-l-xl rounded-r-none":(u[N.id]||0)>0?"rounded-l-none rounded-r-xl":"rounded-xl"} p-4 bg-white shadow-sm border flex items-center gap-3 active:scale-[0.98] transition-transform ${c===N.id?"border-[#A855F7] shadow-[0_0_0_6px_rgba(168,85,247,0.18)]":"border-slate-100"}`,style:{transform:`translateX(${u[N.id]||0}px)`,transition:"transform 180ms ease"},children:[n.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-slate-200 flex items-center justify-center text-slate-600 font-bold",children:N.avatar?n.jsx("img",{src:N.avatar,alt:N.name,className:"w-full h-full object-cover"}):(N.name||"")[0]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-800 truncate",children:N.name}),n.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[N.profession||"",N.age?`  ${N.age}`:""]})]}),c===N.id&&n.jsx(ur,{className:"w-5 h-5 text-[#A855F7]"})]})]},N.id)),!l.length&&n.jsxs("div",{className:"p-6 text-center text-slate-500",children:[n.jsx("div",{className:"text-sm",children:""}),n.jsx("div",{className:"mt-3",children:n.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-[#A855F7] text-white rounded-lg text-sm font-bold",children:""})})]})]})]})},"sheet")]})}),P&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[95] bg-black/20"}),n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{P!=null&&L(P),C(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{K(P)},children:""})]})]})})]}),_.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>U(N=>({...N,visible:!1})),onContextMenu:N=>{N.preventDefault(),U(F=>({...F,visible:!1}))}}),n.jsxs("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px]",style:{top:_.y,left:_.x},children:[n.jsxs("button",{onClick:()=>{const N=l.find(F=>F.id===_.id);N&&k(N),U(F=>({...F,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[n.jsx(Is,{className:"w-4 h-4 text-indigo-500"}),""]}),n.jsx("div",{className:"h-[1px] bg-slate-100 w-full"}),n.jsxs("button",{onClick:()=>{C(_.id),U(N=>({...N,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 flex items-center gap-2",children:[n.jsx(en,{className:"w-4 h-4"}),""]})]})]})]})},yh=({isOpen:e,currentModelId:t,onClose:s,onSelect:i,temperature:r,onTempChange:a})=>{const[l,o]=h.useState([]),[c,d]=h.useState(t),[u,f]=h.useState(typeof r=="number"?r:.1);return h.useEffect(()=>{d(t)},[t]),h.useEffect(()=>{typeof r=="number"&&f(r)},[r]),h.useEffect(()=>{if(!e)return;(async()=>{try{const j=[...await ph()].sort((b,P)=>(b.nickname||b.id).localeCompare(P.nickname||P.id,"zh-CN",{sensitivity:"base"}));o(j)}catch{}})()},[e]),n.jsx("div",{className:`fixed inset-0 z-[90] ${e?"":"pointer-events-none"}`,children:n.jsx(vt,{children:e&&n.jsxs(n.Fragment,{children:[n.jsx(He.div,{className:"absolute inset-0 bg-black/30 will-change-opacity",onClick:s,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:ys},"backdrop"),n.jsxs(He.div,{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-10px_30px_rgba(0,0,0,0.08)] will-change-transform transform-gpu",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:On,children:[n.jsxs("div",{className:"sticky top-0 bg-white/95 backdrop-blur-md p-3 border-b border-slate-100 flex justify-between items-center z-10",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-2",children:[n.jsx(Ht,{className:"w-6 h-6"}),n.jsx("span",{className:"font-bold text-lg",children:""})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-bold text-slate-700",children:""}),n.jsx("input",{value:u,onChange:m=>{const g=parseFloat(m.target.value||"0");f(isNaN(g)?0:g),a==null||a(isNaN(g)?0:g)},type:"number",step:"0.1",min:"0",max:"2",className:"w-16 px-2 py-1 border border-slate-200 rounded-lg text-sm"})]})]}),n.jsxs("div",{className:"p-4 flex flex-col gap-3 max-h-[70vh] overflow-y-auto",children:[l.map(m=>n.jsxs("div",{onClick:()=>{d(m.id),i(m.id,m.nickname),s()},className:`relative p-4 rounded-xl shadow-sm border active:scale-[0.98] transition-transform flex items-center justify-center ${c===m.id?"bg-[#F3E8FF] border-[#A855F7]":"bg-white border-slate-100"}`,children:[n.jsx("div",{className:"w-full text-center font-bold text-slate-800 truncate",children:m.nickname||m.id}),c===m.id&&n.jsx(ur,{className:"w-5 h-5 text-[#A855F7] absolute right-4 top-1/2 -translate-y-1/2"})]},m.id)),!l.length&&n.jsx("div",{className:"p-6 text-center text-slate-500",children:n.jsx("div",{className:"text-sm",children:""})})]})]},"sheet")]})})})},vh=({character:e,initialMessages:t,userPersona:s,onBack:i,onUpdateLastMessage:r,onOpenUserSettings:a,onShowProfile:l,onUpdateUserPersona:o})=>{const[c,d]=h.useState(t),[u,f]=h.useState("scene"),[m,g]=h.useState(""),[j,b]=h.useState(!1),[P,C]=h.useState(!1),[E,_]=h.useState(!1),[U,T]=h.useState(void 0),[k,V]=h.useState(void 0),[M,W]=h.useState(!1),[O,L]=h.useState(!1),[K,N]=h.useState(void 0),[F,X]=h.useState(.1),[se,G]=h.useState(void 0),[ne,he]=h.useState(!1),[Se,Pe]=h.useState(!1),[oe,w]=h.useState(void 0),[B,D]=h.useState(!1),[le,ee]=h.useState(!1),fe=h.useRef(null),ie=h.useRef(null),Ae=h.useRef(null),[Me,Ve]=h.useState(null),A=h.useRef(null),$=(()=>{try{return localStorage.getItem("user_id")||"0"}catch{return"0"}})(),Q=`chat_history_${$}_${e.id}`,re=`chat_config_${e.id}`,ce=`chat_model_${e.id}`,be=`chat_temp_${e.id}`,Ie=`chat_model_name_${e.id}`,pe=h.useMemo(()=>{if(oe)return oe;try{const H=localStorage.getItem("user_nickname")||"",Z=localStorage.getItem("user_avatar")||"";if(H||Z)return{name:H||"",gender:"secret",age:"",profession:"",basicInfo:"",personality:"",avatar:Z||void 0}}catch{}},[oe]),ge=(H,Z,v)=>{d(R=>{const z=[...R];for(let te=z.length-1;te>=0;te--)if(z[te].senderId==="user"&&!z[te].read){z[te]={...z[te],read:!0};break}const Y={id:(Date.now()+1).toString(),senderId:e.id,text:H,quote:Z,timestamp:new Date,type:dt.TEXT};z.push(Y);try{setTimeout(()=>r(Y),0)}catch{}return z}),v&&typeof v.chunkIndex=="number"&&typeof v.chunkTotal=="number"?b(v.chunkIndex<v.chunkTotal):b(!1)},_e=()=>{var H;ie.current?ie.current.scrollTop=ie.current.scrollHeight:(H=fe.current)==null||H.scrollIntoView({behavior:"smooth"})};h.useEffect(()=>{_e()},[c,j]);const[Le,We]=h.useState({height:"100%",top:0});h.useEffect(()=>{const H=()=>{window.visualViewport&&(We({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`}),ie.current&&(ie.current.scrollTop=ie.current.scrollHeight))};window.visualViewport&&(window.visualViewport.addEventListener("resize",H),window.visualViewport.addEventListener("scroll",H),H());const Z=()=>{window.visualViewport||(ie.current?ie.current.scrollTop=ie.current.scrollHeight:_e())};return window.addEventListener("resize",Z),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",H),window.visualViewport.removeEventListener("scroll",H)),window.removeEventListener("resize",Z)}},[]),h.useEffect(()=>{try{const H=`chat_history_${e.id}`,Z=localStorage.getItem(Q)||($==="0"?localStorage.getItem(H):null);if(Z){const R=JSON.parse(Z).map(z=>({id:z.id,senderId:z.senderId,text:z.text,timestamp:new Date(z.ts),type:z.type,quote:z.quote,read:z.read}));R.length&&d(R)}}catch{}},[e.id]),h.useEffect(()=>{try{const H=c.map(Z=>{var v,R;return{id:Z.id,senderId:Z.senderId,text:Z.text,ts:(R=(v=Z.timestamp)==null?void 0:v.getTime)!=null&&R.call(v)?Z.timestamp.getTime():Date.now(),type:Z.type,quote:Z.quote,read:Z.read}});localStorage.setItem(Q,JSON.stringify(H))}catch{}},[c]),h.useEffect(()=>{try{const H=localStorage.getItem(re);if(H){const Y=JSON.parse(H);((Y==null?void 0:Y.chatMode)==="daily"||(Y==null?void 0:Y.chatMode)==="scene")&&(f(Y.chatMode),g(Y.chatMode==="scene"?"":"")),Y!=null&&Y.persona&&w(Y.persona)}const Z=localStorage.getItem(ce)||void 0,v=localStorage.getItem(be),R=v?parseFloat(v):void 0;Z&&(N(Z),he(!0)),typeof R=="number"&&!isNaN(R)&&(X(R),Pe(!0));const z=localStorage.getItem(Ie)||void 0;z&&G(z)}catch{}},[e.id]),h.useEffect(()=>{const H=`chat_session_${$}_${e.id}`,Z=localStorage.getItem(H)||localStorage.getItem(`chat_session_${e.id}`);return(async()=>{var R;if(Z){if(Ve(Z),!localStorage.getItem(H))try{localStorage.setItem(H,Z)}catch{}try{const Y=await xh(Z);if((Y==null?void 0:Y.temperature)!==void 0){X(Y.temperature);try{localStorage.setItem(be,String(Y.temperature))}catch{}}}catch{}const z=Rs(Z,(Y,te,Te)=>{ge(Y,te,Te)});A.current=z;return}try{const z=localStorage.getItem("user_chat_role_id"),Y=z?parseInt(z):void 0,te=await Zs(e.id,typeof Y=="number"?Y:void 0),Te=te.sessionId;if(localStorage.setItem(H,Te),Ve(Te),(R=te.model)!=null&&R.id){N(te.model.id);try{localStorage.setItem(ce,te.model.id)}catch{}}if(typeof te.temperature=="number"){X(te.temperature);try{localStorage.setItem(be,String(te.temperature))}catch{}}const et=Rs(Te,(Tt,Ct,y)=>{ge(Tt,Ct,y)});A.current=et}catch{}})(),()=>{var R;(R=A.current)==null||R.close(),A.current=null}},[e.id]);const ze=H=>{f(H),H==="scene"?!m.includes("")&&!m.includes("(")?g(Z=>`${Z}`):m===""&&g(""):(m===""||m==="()")&&g("");try{localStorage.setItem(re,JSON.stringify({chatMode:H,persona:s||void 0}))}catch{}},$e=async()=>{var Z,v;if(!m.trim()||m.trim()===""||m.trim()==="()")return;const H={id:Date.now().toString(),senderId:"user",text:m,timestamp:new Date,type:dt.TEXT,read:!1};d(R=>[...R,H]);try{setTimeout(()=>r(H),0)}catch{}g(u==="scene"?"":""),b(!0);try{if(!Me){const R=localStorage.getItem("user_chat_role_id"),z=R?parseInt(R):void 0,te=(await Zs(e.id,typeof z=="number"?z:void 0)).sessionId;localStorage.setItem(`chat_session_${$}_${e.id}`,te),Ve(te);const Te=Rs(te,(et,Tt,Ct)=>{ge(et,Tt,Ct)});A.current=Te}(Z=A.current)==null||Z.sendText(H.text,u,pe,ne?K:void 0,Se?F:void 0),(v=A.current)==null||v.sendTyping(!1)}catch(R){console.error(R),b(!1)}},Qe=H=>H.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1});return n.jsx(He.div,{className:"fixed inset-0 bg-primary-50 z-50",style:{...Le,overscrollBehavior:"none",position:"fixed"},initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col relative bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden",children:[n.jsx("div",{className:"bg-primary-50/95 backdrop-blur-md pt-[env(safe-area-inset-top)] shadow-none z-10 border-b border-white/50 flex-shrink-0",children:n.jsxs("div",{className:"px-4 h-12 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:i,className:"p-2 -ml-2 text-slate-800 hover:bg-black/5 rounded-full transition-colors",children:n.jsx(us,{size:24})}),n.jsx("div",{className:"flex items-center cursor-pointer active:opacity-70 transition-opacity",onClick:l,children:n.jsx("h2",{className:"font-bold text-slate-800 text-lg",children:j?"...":e.name})})]}),n.jsx("button",{onClick:()=>C(!0),className:"p-2 text-slate-800 hover:text-primary-600 rounded-full hover:bg-black/5 transition-all",children:n.jsx(lo,{size:24})})]})}),n.jsxs("div",{ref:ie,className:"flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar bg-primary-50",style:{overflowAnchor:"none"},children:[n.jsx("div",{className:"flex justify-center my-4",children:n.jsx("span",{className:"bg-black/10 text-white text-[10px] px-3 py-1 rounded-full font-medium",children:""})}),c.map((H,Z)=>{const v=H.senderId==="user";return n.jsxs("div",{className:`flex w-full ${v?"justify-end":"justify-start"} mb-4 group`,children:[!v&&n.jsx("div",{className:"flex-shrink-0 mr-3 flex flex-col items-center gap-1",children:n.jsx("div",{onClick:l,className:"w-10 h-10 rounded-full overflow-hidden bg-blue-100 flex items-center justify-center text-blue-500 font-bold border border-white cursor-pointer active:scale-95 transition-transform",children:!B&&e.avatar?n.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full object-cover",onError:()=>D(!0)}):e.name[0]})}),n.jsxs("div",{className:`flex flex-col ${v?"items-end":"items-start"} max-w-[75%]`,children:[n.jsx("div",{className:`
                      px-4 py-3 text-[15px] shadow-sm leading-relaxed relative
                      ${v?"bg-[#A855F7] text-white rounded-[20px] rounded-tr-sm":"bg-white text-slate-800 rounded-[20px] rounded-tl-sm border border-slate-100"}
                    `,children:H.text}),!v&&H.quote&&n.jsx("div",{className:"mt-1 max-w-full",children:n.jsx("div",{className:"inline-block bg-slate-100 text-slate-500 text-xs leading-tight rounded-[12px] px-2 py-1 border border-slate-200",children:H.quote})}),n.jsxs("div",{className:`flex items-center gap-2 mt-1 ${v?"mr-1":"ml-1"}`,children:[v&&H.read&&n.jsx("span",{className:"text-[10px] text-slate-400",children:""}),n.jsx("span",{className:"text-[10px] text-slate-400",children:Qe(H.timestamp)})]})]}),v&&n.jsx("div",{className:"flex-shrink-0 ml-3",children:n.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-pink-200 flex items-center justify-center text-pink-600 font-bold border border-white shadow-sm",children:!le&&(pe!=null&&pe.avatar)?n.jsx("img",{src:pe.avatar,alt:(pe==null?void 0:pe.name)||"",className:"w-full h-full object-cover",onError:()=>ee(!0)}):pe!=null&&pe.name?pe.name[0]:""})})]},H.id)}),n.jsx("div",{ref:fe})]}),n.jsx("div",{className:"bg-white p-3 pb-3 border-t border-slate-100 shadow-[0_-4px_20px_rgba(0,0,0,0.02)] pb-[env(safe-area-inset-bottom)] mb-3 flex-shrink-0",children:n.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-[24px] px-3 py-2 border border-slate-100 shadow-[0_12px_28px_rgba(0,0,0,0.12)] transition-shadow focus-within:shadow-[0_16px_40px_rgba(0,0,0,0.16)]",children:[n.jsx("div",{className:"flex-1 flex items-center pl-2",children:n.jsx("textarea",{ref:Ae,value:m,onChange:H=>{var Z;g(H.target.value),(Z=A.current)==null||Z.sendTyping(!0)},onKeyDown:H=>{H.key==="Enter"&&!H.shiftKey&&(H.preventDefault(),$e())},onBlur:()=>{var H;return(H=A.current)==null?void 0:H.sendTyping(!1)},placeholder:"",className:"w-full bg-transparent border-none outline-none focus:ring-0 text-slate-700 text-sm p-0 resize-none max-h-24 overflow-y-auto leading-5 placeholder:text-slate-400",rows:1,style:{minHeight:"22px"}})}),n.jsx("button",{onClick:$e,disabled:!m.trim()||m.trim()==="",className:`p-2 rounded-full transition-all duration-300 flex-shrink-0 flex items-center justify-center ${m.trim()&&m.trim()!==""?"bg-[#A855F7] text-white shadow-md active:scale-95":"bg-transparent text-[#A855F7]"}`,children:n.jsx(hr,{size:20,className:m.trim()&&m.trim()!==""?"ml-0.5":""})})]})}),n.jsx(vt,{initial:!1,children:P&&n.jsxs(n.Fragment,{children:[n.jsx(He.div,{className:"absolute inset-0 bg-black/20 z-[60] will-change-opacity",onClick:()=>C(!1),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:ys}),n.jsxs(He.div,{className:"absolute top-0 right-0 h-full w-3/4 bg-white z-[70] shadow-2xl will-change-transform transform-gpu",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:lh,children:[n.jsxs("div",{className:"p-5 border-b border-slate-100 flex justify-between items-center",children:[n.jsx("h3",{className:"font-bold text-lg text-slate-800",children:""}),n.jsx("button",{onClick:()=>C(!1),className:"text-slate-400 hover:text-slate-600",children:n.jsx(ut,{size:24})})]}),n.jsxs("div",{className:"p-2",children:[n.jsxs("button",{onClick:()=>{C(!1),W(!0)},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(Qs,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsx(Vt,{size:16,className:"text-slate-300"})]}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsxs("button",{onClick:()=>{C(!1),L(!0)},className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(Qa,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-xs text-slate-500",children:se||""}),n.jsx(Vt,{size:16,className:"text-slate-300"})]})]}),n.jsx("div",{className:"h-[1px] bg-slate-50 mx-4"}),n.jsxs("div",{className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:n.jsx(To,{size:18})}),n.jsx("span",{className:"font-bold text-sm",children:""})]}),n.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[n.jsx("button",{onClick:()=>ze("daily"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${u==="daily"?"bg-white text-slate-800 shadow-sm":"text-slate-400"}`,children:""}),n.jsx("button",{onClick:()=>ze("scene"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${u==="scene"?"bg-white text-purple-600 shadow-sm":"text-slate-400"}`,children:""})]})]})]})]})]})}),E&&n.jsx(Wa,{currentPersona:U,roleId:k,onBack:()=>_(!1),onSave:H=>{_(!1),W(!0)},withinContainer:!0}),n.jsx(gh,{isOpen:M,currentPersona:s,onClose:()=>W(!1),onAdd:()=>{W(!1),T(void 0),V(void 0),_(!0)},onSelect:H=>{w(H);try{localStorage.setItem(re,JSON.stringify({chatMode:u,persona:H}))}catch{}},onEdit:(H,Z)=>{W(!1),T(H),V(Z),_(!0)}}),n.jsx(yh,{isOpen:O,currentModelId:K,onClose:()=>L(!1),onSelect:(H,Z)=>{N(H),he(!0),G(Z);try{localStorage.setItem(ce,H),Z&&localStorage.setItem(Ie,Z)}catch{}},temperature:F,onTempChange:H=>{X(H),Pe(!0);try{localStorage.setItem(be,String(H))}catch{}}})]})})},Ka=h.createContext({showToast:()=>{},showCenter:()=>{}}),rr=({children:e})=>{const[t,s]=h.useState([]),i=h.useRef(new Map),r=(o,c)=>{const d=i.current.get(o);d&&clearTimeout(d);const u=window.setTimeout(()=>{s(f=>f.filter(m=>m.id!==o)),i.current.delete(o)},c);i.current.set(o,u)},a=(o,c="info")=>{const d=Date.now(),u=2e3;s(f=>[...f,{id:d,text:o,type:c,position:"bottom",duration:u}]),r(d,u)},l=(o,c="info")=>{s(u=>{const f=u.find(g=>g.position==="center"&&g.text===o);if(f)return r(f.id,3e3),u;const m=Date.now();return r(m,2e3),[...u,{id:m,text:o,type:c,position:"center",duration:2e3}]})};return n.jsxs(Ka.Provider,{value:{showToast:a,showCenter:l},children:[e,n.jsx("div",{className:"fixed bottom-6 left-0 right-0 z-[100] flex justify-center pointer-events-none",children:n.jsx("div",{className:"space-y-2",children:t.filter(o=>o.position==="bottom").map(o=>n.jsx("div",{className:`${o.type==="role"?"bg-white text-pink-600 border border-pink-200 shadow-md":o.type==="error"?"bg-red-500 text-white":o.type==="success"?"bg-green-500 text-white":"bg-slate-800 text-white"} px-4 py-2 rounded-2xl shadow-lg inline-block`,children:o.text},o.id))})}),n.jsx("div",{className:"fixed top-[25%] left-1/2 -translate-x-1/2 z-[100] pointer-events-none",children:n.jsx("div",{className:"space-y-2 flex flex-col items-center",children:t.filter(o=>o.position==="center").map(o=>n.jsx("div",{className:`${o.type==="error"?"bg-white text-red-500 border-red-200":"bg-white text-slate-800 border-slate-200"} px-6 py-3 rounded-2xl shadow-2xl border whitespace-nowrap`,children:o.text},o.id))})}),n.jsx("style",{children:`
        @keyframes toastFade {
          0% { opacity: 0; transform: translateY(-6px); }
          10% { opacity: 1; transform: translateY(0); }
          90% { opacity: 1; transform: translateY(0); }
          100% { opacity: 0; transform: translateY(-6px); }
        }
      `})]})},Ya=()=>h.useContext(Ka),bh=({character:e,onBack:t,onStartChat:s,isFromChat:i=!1,isExistingChat:r=!1})=>{var g;const[a,l]=h.useState(!1),{showToast:o,showCenter:c}=Ya(),[d,u]=h.useState(!1),f=a?e.tags:e.tags.slice(0,4),m=e.tags.length>4;return n.jsx(He.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0&&i?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg-white shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[n.jsx("button",{onClick:t,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(us,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[n.jsxs("div",{className:"relative w-full h-[55vh]",children:[!d&&(e.profileImage||e.avatar)?n.jsx("img",{src:e.profileImage||e.avatar,alt:e.name,className:"w-full h-full object-cover",onError:()=>u(!0)}):n.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:n.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((g=e.name)==null?void 0:g[0])||"?"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),n.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:e.name}),n.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[n.jsx("span",{className:"text-green-400",children:""})," ",e.character_type||e.roleType||""]})]}),n.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[n.jsx("span",{children:e.profession}),n.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),n.jsx("span",{children:e.age})]}),n.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",e.creator]})]})]}),n.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:f.map((j,b)=>n.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",j]},b))}),m&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>l(!a),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[a?"":""," ",a?n.jsx(sn,{size:14}):n.jsx(Lt,{size:14})]})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsxs("div",{className:"relative pl-4 py-1",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),n.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["",e.oneLinePersona,""]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:e.personality})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{children:n.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[n.jsx(pr,{size:12,fill:"currentColor"})," ",e.currentRelationship]})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:""}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),n.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:e.plotTheme})]}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:e.plotDescription}),e.openingLine&&n.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[n.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:""}),n.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),n.jsx("span",{className:"text-slate-700 font-bold text-sm",children:e.openingLine})]})]})]})]}),n.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:n.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:n.jsx("button",{onClick:()=>{if(i){s();return}if(r){c("");return}s()},className:"w-full font-bold text-lg py-4 rounded-2xl shadow-lg active:scale-[0.98] transition-all flex items-center justify-center gap-2 bg-purple-200 text-purple-900 shadow-purple-100",children:i?n.jsxs(n.Fragment,{children:[n.jsx(nn,{size:20}),""]}):""})})})]})})},wh=async()=>{const{authFetch:e}=await de(async()=>{const{authFetch:i}=await import("./http-CAiBnKza.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),t=await e("/user-characters");if(!t.ok)throw new Error("failed");const s=await t.json();return Array.isArray(s.items)?s.items:[]},Ut=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:i}=await import("./http-CAiBnKza.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3])),s=await t(`/user-characters/${e}`);if(!s.ok)throw new Error("failed");return await s.json()},jh=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:r}=await import("./http-CAiBnKza.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t("/user-characters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("create_character_failed");return(await s.json()).id},Nh=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:r}=await import("./http-CAiBnKza.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t("/user-characters/draft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("create_draft_failed");return(await s.json()).id},Sh=async(e,t)=>{const{authFetch:s}=await de(async()=>{const{authFetch:r}=await import("./http-CAiBnKza.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await s(`/user-characters/${e}/draft`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("update_draft_failed");return!0},Th=async(e,t)=>{const{authFetch:s}=await de(async()=>{const{authFetch:r}=await import("./http-CAiBnKza.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3]));if(!(await s(`/user-characters/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("update_failed");return!0},Ch=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:i}=await import("./http-CAiBnKza.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user-characters/${e}`,{method:"DELETE"})).ok)throw new Error("delete_failed");return!0},ar=({character:e,createdId:t,onBack:s,onStartChat:i})=>{var P;const[r,a]=h.useState(!1),[l,o]=h.useState(!0),[c,d]=h.useState(e),[u,f]=h.useState(!1),[m,g]=h.useState(!1);h.useEffect(()=>{let C=!0,E;const _=async()=>{try{const T=await Ut(t);if(!C)return;const k=typeof(T==null?void 0:T.status)=="string"?T.status.trim():"",V=!!(T!=null&&T.hasSystemPrompt);if(k==="draft"){f(!0),o(!1),E&&clearInterval(E);return}if(k==="publishing"||!V){f(!1),o(!1);return}if(T&&(k==="published"||V)){o(!0),f(!1),d(M=>({...M,id:String(T.id||M.id),name:T.name||M.name,avatar:T.avatar||M.avatar,profileImage:M.profileImage,character_type:String(T.character_type||M.character_type||""),oneLinePersona:T.tagline||M.oneLinePersona,personality:T.personality||M.personality,profession:String(T.occupation||M.profession||""),age:String(T.age||M.age||""),currentRelationship:String(T.relationship||M.currentRelationship||""),plotTheme:String(T.plot_theme||M.plotTheme||""),plotDescription:String(T.plot_summary||M.plotDescription||""),openingLine:String(T.opening_line||M.openingLine||"")})),E&&clearInterval(E);return}}catch{}};return(async()=>{try{const T=await Ut(t);if(!C)return;if(T){d(M=>({...M,id:String(T.id||M.id),name:T.name||M.name,avatar:T.avatar||M.avatar,character_type:String(T.character_type||M.character_type||""),oneLinePersona:T.tagline||M.oneLinePersona,personality:T.personality||M.personality,profession:String(T.occupation||M.profession||""),age:String(T.age||M.age||""),currentRelationship:String(T.relationship||M.currentRelationship||""),plotTheme:String(T.plot_theme||M.plotTheme||""),plotDescription:String(T.plot_summary||M.plotDescription||""),openingLine:String(T.opening_line||M.openingLine||"")}));const k=!!T.hasSystemPrompt,V=typeof T.status=="string"?T.status.trim():"";if(V==="draft"){f(!0),o(!1);return}if(V==="publishing"){f(!1),o(!1),E=setInterval(_,3e3),_();return}if(!k){f(!1),o(!1),E=setInterval(_,3e3),_();return}f(!1),o(!0);return}f(!1),o(!0)}catch{f(!1),o(!0)}})(),()=>{C=!1,clearInterval(E)}},[t]);const j=r?c.tags:c.tags.slice(0,4),b=c.tags.length>4;return n.jsx(He.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[n.jsx("button",{onClick:s,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(us,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[n.jsxs("div",{className:"relative w-full h-[55vh]",children:[!m&&(c.profileImage||c.avatar)?n.jsx("img",{src:c.profileImage||c.avatar,alt:c.name,className:"w-full h-full object-cover",onError:()=>g(!0)}):n.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:n.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((P=c.name)==null?void 0:P[0])||"?"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),n.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:c.name}),n.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[n.jsx("span",{className:"text-green-400",children:""})," ",c.character_type||c.roleType||""]})]}),n.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[n.jsx("span",{children:c.profession}),n.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),n.jsx("span",{children:c.age})]}),n.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",c.creator]})]})]}),n.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:j.map((C,E)=>n.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",C]},E))}),b&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>a(!r),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[r?"":""," ",r?n.jsx(sn,{size:14}):n.jsx(Lt,{size:14})]})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsxs("div",{className:"relative pl-4 py-1",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),n.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["",c.oneLinePersona,""]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:c.personality})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:""}),n.jsx("div",{children:n.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[n.jsx(pr,{size:12,fill:"currentColor"})," ",c.currentRelationship]})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:""}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),n.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:c.plotTheme})]}),n.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:c.plotDescription}),c.openingLine&&n.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[n.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:""}),n.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),n.jsx("span",{className:"text-slate-700 font-bold text-sm",children:c.openingLine})]})]})]})]}),n.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:n.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:n.jsx("button",{disabled:!l||u,onClick:()=>i(c),className:`w-full font-bold text-lg py-4 rounded-2xl shadow-lg transition-all flex items-center justify-center gap-2 ${l&&!u?"bg-purple-200 text-purple-900 shadow-purple-100 active:scale-[0.98]":"bg-slate-200 text-slate-500 cursor-not-allowed"}`,children:l&&!u?n.jsxs(n.Fragment,{children:[n.jsx(nn,{size:20}),""]}):u?"":""})})})]})})},kh=({onBack:e,onCreate:t,isEdit:s=!1,characterId:i,initial:r,onUpdated:a,onSaveDraft:l})=>{const[o,c]=h.useState({type:"",avatar:"",profileImage:"",name:"",gender:"",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0}),[d,u]=h.useState(!1),[f,m]=h.useState(!0),[g,j]=h.useState(!1),[b,P]=h.useState(""),[C,E]=h.useState(!1),[_,U]=h.useState({}),[T,k]=h.useState(!1),[V,M]=h.useState(null),W=h.useRef(null),O=w=>{var ie;const B=w.split(","),D=((ie=B[0].match(/:(.*?);/))==null?void 0:ie[1])||"image/jpeg",le=atob(B[1]);let ee=le.length;const fe=new Uint8Array(ee);for(;ee--;)fe[ee]=le.charCodeAt(ee);return new Blob([fe],{type:D})};h.useEffect(()=>{r&&c(w=>({...w,type:r.roleType||w.type,avatar:r.avatar||w.avatar,profileImage:r.profileImage||w.profileImage,name:r.name||w.name,gender:r.gender||w.gender,age:r.age||w.age,profession:r.profession||w.profession,tagline:r.oneLinePersona||w.tagline,personality:r.personality||w.personality,relationship:r.currentRelationship||w.relationship,plotTheme:r.plotTheme||w.plotTheme,plotSummary:r.plotDescription||w.plotSummary,openingLine:r.openingLine||w.openingLine,styleExamples:Array.isArray(r.styleExamples)&&r.styleExamples.length?r.styleExamples:w.styleExamples,hobbies:r.hobbies||w.hobbies,experiences:r.experiences||w.experiences,searchTags:Array.isArray(r.tags)?r.tags:w.searchTags,isPublic:typeof r.isPublic=="boolean"?r.isPublic:w.isPublic}))},[r,s]),h.useEffect(()=>{if(!s||!i)return;const w=!(r&&Array.isArray(r.tags)&&r.tags.length),B=!(r&&Array.isArray(r.styleExamples)&&r.styleExamples.length);!w&&!B||(async()=>{try{const D=await Ut(i),le=Array.isArray(D==null?void 0:D.styleExamples)?D.styleExamples.slice(0,3):[];for(;le.length<3;)le.push("");c(ee=>({...ee,name:(D==null?void 0:D.name)??ee.name,gender:(D==null?void 0:D.gender)??ee.gender,avatar:(D==null?void 0:D.avatar)??ee.avatar,tagline:(D==null?void 0:D.tagline)??ee.tagline,personality:(D==null?void 0:D.personality)??ee.personality,relationship:(D==null?void 0:D.relationship)??ee.relationship,plotTheme:(D==null?void 0:D.plot_theme)??ee.plotTheme,plotSummary:(D==null?void 0:D.plot_summary)??ee.plotSummary,openingLine:(D==null?void 0:D.opening_line)??ee.openingLine,hobbies:(D==null?void 0:D.hobbies)??ee.hobbies,experiences:(D==null?void 0:D.experiences)??ee.experiences,age:(D==null?void 0:D.age)!=null?String(D.age):ee.age,profession:(D==null?void 0:D.occupation)??ee.profession,searchTags:Array.isArray(D==null?void 0:D.tags)?D.tags:ee.searchTags,styleExamples:le,isPublic:D!=null&&D.visibility?D.visibility==="public":ee.isPublic}))}catch{}})()},[s,i,r]);const L=["","",""],K=["","","","",""],N=["M/M","M/F","BL","BG","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],F=()=>{var w;(w=W.current)==null||w.click()},X=w=>{var D;const B=(D=w.target.files)==null?void 0:D[0];if(B){const le=new FileReader;le.onloadend=()=>{M(le.result)},le.readAsDataURL(B)}W.current&&(W.current.value="")},se=w=>{o.searchTags.includes(w)?c(B=>({...B,searchTags:B.searchTags.filter(D=>D!==w)})):c(B=>({...B,searchTags:[...B.searchTags,w]}))},G=()=>{const w=b.trim();w&&!o.searchTags.includes(w)&&(c(B=>({...B,searchTags:[...B.searchTags,w]})),P(""))},ne=async w=>{if(w){try{const B=localStorage.getItem("user_access_token");let D=o.avatar||null;if(D&&D.startsWith("data:image")){const ie=O(D),Ae=new FormData,Me=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;Ae.append("avatar",ie,"avatar.jpg"),Ae.append("filename",Me),D=`/uploads/users/avatars/${Me}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:B?`Bearer ${B}`:""},body:Ae})}catch{}}const le={name:o.name||"",gender:o.gender,avatar:D,identity:null,tagline:o.tagline,personality:o.personality,relationship:o.relationship,plotTheme:o.plotTheme,plotSummary:o.plotSummary,openingLine:o.openingLine,hobbies:o.hobbies,experiences:o.experiences,age:o.age&&parseInt(o.age,10)||null,occupation:o.profession,character_type:o.type,visibility:o.isPublic?"public":"private",tags:o.searchTags,styleExamples:o.styleExamples.filter(Boolean)};let ee=null;s&&i?(await Sh(i,le),ee=typeof i=="number"?i:parseInt(String(i))||null):ee=await Nh(le);const fe={id:ee?String(ee):i?String(i):`c_${Date.now()}`,name:o.name||"",avatar:o.avatar||"",profileImage:o.profileImage||o.avatar||"",status:Ye.ONLINE,bio:o.tagline||"",tags:o.searchTags,creator:"",oneLinePersona:o.tagline,personality:o.personality,profession:o.profession,age:o.age,roleType:o.type,currentRelationship:o.relationship,plotTheme:o.plotTheme,plotDescription:o.plotSummary,openingLine:o.openingLine,styleExamples:o.styleExamples.filter(Boolean),hobbies:o.hobbies,experiences:o.experiences,isPublic:o.isPublic};l&&l(fe)}catch{}try{localStorage.removeItem("create_character_draft")}catch{}}else localStorage.removeItem("create_character_draft"),c({type:"",avatar:"",profileImage:"",name:"",gender:"",age:"",profession:"",tagline:"",personality:"",searchTags:[],relationship:"",plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",isPublic:!0});E(!1)},he=()=>{const w={};return o.name.trim()||(w.name=!0),o.age.trim()||(w.age=!0),o.profession.trim()||(w.profession=!0),o.tagline.trim()||(w.tagline=!0),o.personality.trim()||(w.personality=!0),o.searchTags.length===0&&(w.searchTags=!0),o.relationship.trim()||(w.relationship=!0),o.plotTheme.trim()||(w.plotTheme=!0),o.plotSummary.trim()||(w.plotSummary=!0),o.openingLine.trim()||(w.openingLine=!0),U(w),Object.keys(w).length===0},Se=async()=>{if(!he()){k(!0);return}let w=null;try{const D=localStorage.getItem("user_access_token");let le=o.avatar||null;if(le&&le.startsWith("data:image")){const fe=O(le),ie=new FormData,Ae=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;ie.append("avatar",fe,"avatar.jpg"),ie.append("filename",Ae),le=`/uploads/users/avatars/${Ae}`;try{await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:D?`Bearer ${D}`:""},body:ie})}catch{}}const ee={name:o.name,gender:o.gender,avatar:le,identity:null,tagline:o.tagline,personality:o.personality,relationship:o.relationship,plotTheme:o.plotTheme,plotSummary:o.plotSummary,openingLine:o.openingLine,hobbies:o.hobbies,experiences:o.experiences,age:o.age&&parseInt(o.age,10)||null,occupation:o.profession,character_type:o.type,visibility:o.isPublic?"public":"private",tags:o.searchTags,styleExamples:o.styleExamples.filter(Boolean)};s&&i?(await Th(i,ee),w=typeof i=="number"?i:parseInt(String(i))||null):w=await jh(ee)}catch{}const B={id:w?String(w):`c_${Date.now()}`,name:o.name,avatar:o.avatar||"https://image.pollinations.ai/prompt/anime%20silhouette%20purple?width=400&height=400&nologo=true",profileImage:o.profileImage||o.avatar,status:Ye.ONLINE,bio:`${o.age} ${o.profession}`,tags:o.searchTags,isPinned:!1,relationshipLevel:0,creator:"",playCount:"0",age:o.age||"",profession:o.profession||"",gender:o.gender,roleType:o.type,isOriginal:o.type==="",oneLinePersona:o.tagline,personality:o.personality,currentRelationship:o.relationship,plotTheme:o.plotTheme,plotDescription:o.plotSummary,openingLine:o.openingLine,styleExamples:o.styleExamples.filter(D=>D),hobbies:o.hobbies,experiences:o.experiences,isPublic:o.isPublic};localStorage.removeItem("create_character_draft"),s&&a?a(B):t(B)},Pe=w=>["","",""][w],oe="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return n.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-3xl shadow-2xl bg font-kosugi",children:[V&&n.jsx(vs,{imageSrc:V,aspectRatio:1,outputWidth:800,outputHeight:800,onCancel:()=>{M(null),W.current&&(W.current.value="")},onCrop:w=>{c(B=>({...B,avatar:w,profileImage:V})),M(null)}}),n.jsx("div",{className:"ambient-bg hidden"}),n.jsxs("div",{className:"hidden",children:[n.jsx("div",{className:"star",style:{left:"10%",width:"4px",height:"4px"}}),n.jsx("div",{className:"star",style:{left:"80%",animationDelay:"2s",width:"6px",height:"6px"}})]}),n.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-3xl relative",children:[n.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:n.jsx(Ht,{size:20})}),n.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:s?"":""}),!s&&n.jsx("button",{onClick:()=>E(!0),className:"ml-auto text-sm font-bold text-purple-600 font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",children:[n.jsxs("section",{className:"mt-4",children:[n.jsx("div",{className:"text-[#2E1065] font-bold text-[0.9rem] mb-2 ml-1 font-kosugi",children:""}),n.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-1 mt-2",children:L.map(w=>n.jsx("button",{onClick:()=>c(B=>({...B,type:w})),className:`
                                flex-shrink-0 px-5 py-2.5 rounded-2xl text-sm font-bold transition-all whitespace-nowrap tracking-wide font-kosugi
                                ${o.type===w?"bg-purple-500 text-white shadow-purple-200 shadow-md":"bg-white/70 text-slate-500 border-transparent"}
                            `,children:w},w))})]}),n.jsxs("section",{className:"flex flex-col items-center py-2",children:[n.jsxs("div",{onClick:F,className:"relative group cursor-pointer active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-24 h-24 rounded-full bg-white border-[3px] border-white shadow-xl flex items-center justify-center overflow-hidden relative",children:o.avatar?n.jsx("img",{src:o.avatar,className:"w-full h-full object-cover",alt:"avatar"}):n.jsx("div",{className:"text-purple-200 text-3xl",children:n.jsx(tn,{size:32})})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center border-[3px] border-white shadow-md",children:n.jsx(st,{size:14})})]}),n.jsx("input",{type:"file",ref:W,className:"hidden",accept:"image/*",onChange:X}),n.jsx("p",{className:"mt-2 text-xs text-purple-400 font-bold tracking-wide font-kosugi",children:""})]}),n.jsxs("section",{className:"glass-card p-6 space-y-6",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:""}),n.jsxs("div",{children:[n.jsxs("label",{className:`${oe} flex items-center gap-1`,children:["",_.name&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("div",{className:"relative",children:n.jsx("input",{value:o.name,onChange:w=>c(B=>({...B,name:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold ${_.name?"border-red-300 bg-red-50":""}`})})]}),n.jsxs("div",{children:[n.jsx("label",{className:oe,children:""}),n.jsx("div",{className:"flex gap-3",children:["","",""].map(w=>n.jsx("button",{onClick:()=>c(B=>({...B,gender:w})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition font-kosugi ${o.gender===w?w===""?"bg-blue-100 text-blue-600 ring-2 ring-blue-200":w===""?"bg-pink-100 text-pink-600 ring-2 ring-pink-200":"bg-purple-100 text-purple-600 ring-2 ring-purple-200":"bg-white/50 text-slate-400"}`,children:w},w))})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"w-full",children:[n.jsxs("label",{className:`${oe} flex items-center gap-1`,children:["",_.age&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:o.age,onChange:w=>c(B=>({...B,age:w.target.value})),type:"text",placeholder:"28",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${_.age?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"w-full",children:[n.jsxs("label",{className:`${oe} flex items-center gap-1`,children:["",_.profession&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:o.profession,onChange:w=>c(B=>({...B,profession:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold rounded-2xl ${_.profession?"border-red-300 bg-red-50":""}`})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${oe} flex items-center gap-1`,children:["",_.tagline&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:o.tagline,onChange:w=>c(B=>({...B,tagline:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm ${_.tagline?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${oe} flex items-center gap-1`,children:["",_.personality&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("textarea",{value:o.personality,onChange:w=>c(B=>({...B,personality:w.target.value})),rows:3,placeholder:"...",className:`dream-input w-full px-4 py-3 text-sm resize-none ${_.personality?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${oe} flex items-center gap-1`,children:["",_.searchTags&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsxs("div",{onClick:()=>j(!0),className:`dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition ${_.searchTags?"border-red-300 bg-red-50":""}`,children:[o.searchTags.length===0&&n.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:" (# #...)"}),o.searchTags.map(w=>n.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",w,n.jsx(ut,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:B=>{B.stopPropagation(),se(w)}})]},w)),n.jsx(Vt,{className:"ml-auto text-purple-300",size:16})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`${oe} flex items-center gap-1`,children:["",_.relationship&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[n.jsx("button",{onClick:()=>{u(!0),c(w=>({...w,relationship:""}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${d?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:""}),K.map(w=>n.jsx("button",{onClick:()=>{u(!1),c(B=>({...B,relationship:w}))},className:`px-4 py-2 rounded-xl text-xs font-bold transition-all font-kosugi ${o.relationship===w&&!d?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:w},w))]}),d&&n.jsx("div",{className:"relative animate-in fade-in",children:n.jsx("input",{value:o.relationship,onChange:w=>c(B=>({...B,relationship:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-2 text-sm ${_.relationship?"border-red-300 bg-red-50":""}`})})]})]}),n.jsxs("section",{className:"glass-card p-6 space-y-5",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-4",children:""}),n.jsxs("p",{className:"text-xs text-slate-500 leading-relaxed bg-purple-50/50 p-3 rounded-xl border border-purple-100 flex gap-1",children:[n.jsx(fr,{size:14,className:"text-purple-400 mt-0.5 flex-shrink-0"}),n.jsx("span",{children:""})]}),n.jsxs("div",{className:"bg-white/40 p-4 rounded-3xl border border-purple-100/50 space-y-4",children:[n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",_.plotTheme&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("input",{value:o.plotTheme,onChange:w=>c(B=>({...B,plotTheme:w.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 ${_.plotTheme?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",_.plotSummary&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:o.plotSummary,onChange:w=>c(B=>({...B,plotSummary:w.target.value})),rows:5,placeholder:"......",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none leading-relaxed ${_.plotSummary?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{className:"relative group/input",children:[n.jsxs("label",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1 font-kosugi",children:["",_.openingLine&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:o.openingLine,onChange:w=>c(B=>({...B,openingLine:w.target.value})),rows:2,placeholder:"",className:`dream-input w-full px-3 py-2.5 rounded-xl text-sm bg-white/80 resize-none ${_.openingLine?"border-red-300 bg-red-50":""}`})]})]})]}),n.jsxs("section",{className:"glass-card p-0 overflow-hidden transition-all",children:[n.jsxs("button",{onClick:()=>m(!f),className:"w-full flex items-center justify-between p-6 bg-transparent transition",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:""}),n.jsx("span",{className:"text-[10px] bg-purple-100 text-purple-500 px-1.5 py-0.5 rounded font-bold border border-purple-200 self-center font-kosugi",children:""})]}),f?n.jsx(sn,{className:"text-purple-400"}):n.jsx(Lt,{className:"text-purple-400"})]}),f&&n.jsxs("div",{className:"p-6 pt-0 space-y-5 animate-in slide-in-from-top-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:oe,children:""}),n.jsx("div",{className:"space-y-3",children:[0,1,2].map(w=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs font-bold text-purple-300 w-4 font-mono",children:["0",w+1]}),n.jsx("input",{value:o.styleExamples[w],onChange:B=>{const D=[...o.styleExamples];D[w]=B.target.value,c(le=>({...le,styleExamples:D}))},type:"text",placeholder:Pe(w),className:"dream-input flex-1 px-3 py-2.5 rounded-xl text-sm"})]},w))})]}),n.jsxs("div",{children:[n.jsx("label",{className:oe,children:""}),n.jsx("textarea",{value:o.hobbies,onChange:w=>c(B=>({...B,hobbies:w.target.value})),rows:2,placeholder:"...",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:oe,children:""}),n.jsx("textarea",{value:o.experiences,onChange:w=>c(B=>({...B,experiences:w.target.value})),rows:2,placeholder:"",className:"dream-input w-full px-4 py-3 text-sm resize-none"})]}),n.jsxs("div",{className:"pt-2 border-t border-purple-100",children:[n.jsx("label",{className:`${oe} mb-1`,children:""}),n.jsx("p",{className:"text-[10px] text-slate-500 leading-tight mb-3",children:""}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:()=>c(w=>({...w,isPublic:!0})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${o.isPublic?"bg-purple-500 text-white shadow-md":"bg-white text-slate-500 border border-purple-100"}`,children:[n.jsx(po,{size:14})," "]}),n.jsxs("button",{onClick:()=>c(w=>({...w,isPublic:!1})),className:`flex-1 py-2.5 rounded-2xl text-sm font-bold transition flex items-center justify-center gap-1 font-kosugi ${o.isPublic?"bg-white text-slate-500 border border-purple-100":"bg-purple-500 text-white shadow-md"}`,children:[n.jsx(bo,{size:14})," "]})]})]})]})]})]}),n.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-b-3xl shadow-2xl",children:n.jsx("button",{onClick:Se,className:"w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition-transform flex items-center justify-center tracking-widest text-lg font-kosugi",children:s?"":""})}),g&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>j(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 w-full bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[80vh] animate-in slide-in-from-bottom duration-300",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[n.jsx("button",{onClick:()=>j(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:n.jsx(Lt,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:" #"}),n.jsx("button",{onClick:()=>j(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:""}),n.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[o.searchTags.length===0&&n.jsx("span",{className:"text-xs text-slate-400 self-center",children:""}),o.searchTags.map(w=>n.jsxs("button",{onClick:()=>se(w),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1 font-kosugi",children:["#",w," ",n.jsx(ut,{size:10,className:"opacity-80"})]},w))]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:" ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:b,onChange:w=>P(w.target.value),onKeyDown:w=>w.key==="Enter"&&G(),type:"text",placeholder:"#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),n.jsx("button",{onClick:G,className:"bg-gradient-to-r from-purple-400 to-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition font-kosugi",children:""})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1 font-kosugi",children:""}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:N.map(w=>n.jsxs("button",{onClick:()=>se(w),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis font-kosugi
                                            ${o.searchTags.includes(w)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",w]},w))})]})]})]})]}),C&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-4 font-kosugi",children:s?"":""}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>ne(!1),className:"flex-1 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors font-kosugi",children:s?"":""}),n.jsx("button",{onClick:()=>ne(!0),className:"flex-1 py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:s?"":""})]})]})}),T&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:n.jsx(Ds,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:""}),n.jsx("button",{onClick:()=>k(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:""})]})})]})})},ds=({src:e,alt:t,className:s,root:i,placeholderChar:r})=>{const a=h.useRef(null),[l,o]=h.useState(""),[c,d]=h.useState(!1);return h.useEffect(()=>{if(!a.current||!e)return;const u=new IntersectionObserver(f=>{if(f.some(m=>m.isIntersecting)){o(e||"");try{u.disconnect()}catch{}}},{root:i||void 0,rootMargin:"0px 0px 240px 0px",threshold:0});return u.observe(a.current),()=>{try{u.disconnect()}catch{}}},[e,i]),n.jsx("div",{ref:a,className:s,children:!c&&l?n.jsx("img",{src:l,alt:t,decoding:"async",loading:"lazy",className:"w-full h-full object-cover",onError:()=>d(!0)}):r?n.jsx("span",{className:"text-2xl font-bold text-slate-500",children:r}):null})},Ah=({onBack:e,onPublish:t,onSaveDraft:s,availableCharacters:i,myUserCharacters:r=[],initialStory:a,importableRoles:l=[]})=>{const{showCenter:o}=Ya(),[c,d]=h.useState(()=>a?{title:a.title,description:a.description,image:a.image,content:a.content,tags:a.tags,roles:a.availableRoles||[]}:{title:"",description:"",image:"",content:"",tags:[],roles:[]}),[u,f]=h.useState(!1),[m,g]=h.useState(!1),[j,b]=h.useState(!1),[P,C]=h.useState({}),[E,_]=h.useState(""),[U,T]=h.useState(null),[k,V]=h.useState(!1),M=h.useRef(null),[W,O]=h.useState(l),L=h.useRef(!1);h.useEffect(()=>{O(l||[])},[l]),h.useEffect(()=>{L.current||W&&W.length||(L.current=!0,(async()=>{try{const{authFetch:A}=await de(async()=>{const{authFetch:Q}=await import("./http-CAiBnKza.js");return{authFetch:Q}},__vite__mapDeps([0,1,2,3])),$=await A("/stories/combine");if($&&$.ok){const Q=await $.json(),re=Array.isArray(Q==null?void 0:Q.items)?Q.items:[];O(re.map(ce=>({id:String(ce.character_id),name:ce.character_name,avatar:ce.character_avatar||"",desc:ce.desc||"",isPrivate:!!ce.isPrivate,isMine:!!ce.isMine})))}}catch{}})())},[]),Ja.useMemo(()=>(Array.isArray(r)?r:[]).filter($=>$.isPublished===!0&&$.isPublic===!1).map($=>({id:String($.id),name:$.name,avatar:$.avatar,desc:$.oneLinePersona||$.bio||"",isPrivate:!0,isMine:!0})),[r]);const K=h.useRef(!1);h.useEffect(()=>{if(K.current)return;const A=Array.isArray(a==null?void 0:a.characterIds)?a.characterIds:[];if(!A.length||!W||!W.length)return;const $=new Set(A.map(re=>String(re))),Q=W.filter(re=>$.has(String(re.id))).map(re=>({name:re.name,avatar:re.avatar,description:re.desc||""}));Q.length&&(K.current=!0,d(re=>({...re,roles:Q})))},[a,W]),h.useEffect(()=>{if(!a)return;const A=a.availableRoles||[];A.length&&(d($=>({...$,roles:A})),K.current=!0)},[a]),h.useEffect(()=>{a&&d(A=>({...A,title:a.title||A.title,description:a.description||A.description,image:a.image||A.image,content:a.content||A.content,tags:Array.isArray(a.tags)?a.tags:A.tags}))},[a]),h.useEffect(()=>{if(!k)return;const A=setTimeout(()=>V(!1),6e3);return()=>clearTimeout(A)},[k]),h.useEffect(()=>{if(!k)return;const A=$=>{const Q=M.current;if(!Q){V(!1);return}const re=$.target;Q.contains(re)||V(!1)};return window.addEventListener("click",A,!0),()=>window.removeEventListener("click",A,!0)},[k]);const N=h.useRef(null),F=h.useRef(null),X=h.useRef(null),se=A=>{var Ie;const $=A.split(","),Q=((Ie=$[0].match(/:(.*?);/))==null?void 0:Ie[1])||"image/jpeg",re=atob($[1]);let ce=re.length;const be=new Uint8Array(ce);for(;ce--;)be[ce]=re.charCodeAt(ce);return new Blob([be],{type:Q})},G=["BG","BL","GL","","","","","","","","","","","HE","BE","","","","",""],ne=()=>{var A;(A=N.current)==null||A.click()},he=A=>{var Q;const $=(Q=A.target.files)==null?void 0:Q[0];if($){const re=new FileReader;re.onloadend=()=>{T(re.result)},re.readAsDataURL($)}N.current&&(N.current.value="")},Se=A=>{c.tags.includes(A)?d($=>({...$,tags:$.tags.filter(Q=>Q!==A)})):d($=>({...$,tags:[...$.tags,A]}))},Pe=()=>{const A=E.trim();A&&!c.tags.includes(A)&&(d($=>({...$,tags:[...$.tags,A]})),_(""))},oe=A=>{if(c.roles.some(Q=>Q.name===A.name))return;const $={name:A.name,avatar:A.avatar,description:A.oneLinePersona||A.bio||""};d(Q=>({...Q,roles:[...Q.roles,$]})),g(!1)},w=A=>{d($=>({...$,roles:$.roles.filter(Q=>Q.name!==A)}))},B=()=>{const A=c.roles.map(Q=>Q.name),$={};return l.forEach(Q=>{$[Q.name]=Q.id}),A.map(Q=>$[Q]).filter(Boolean)},[D,le]=h.useState("none"),ee=async A=>{try{le(A==="published"?"publish":"draft");let $=c.image||"";try{const ge=localStorage.getItem("user_access_token");if(c.image&&c.image.startsWith("data:image")){const _e=se(c.image),Le=new FormData,We=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;$=`/uploads/covers/${We}`,Le.append("cover",_e,"cover.jpg"),Le.append("filename",We);const ze=await fetch("/api/uploads/cover",{method:"POST",headers:{Authorization:ge?`Bearer ${ge}`:""},body:Le});if(ze&&ze.ok){const $e=await ze.json();$e&&$e.url&&($=$e.url)}}}catch{}const Q={title:c.title,description:c.description,image:$,status:A,content:c.content,tags:c.tags,characterIds:B()},{authFetch:re}=await de(async()=>{const{authFetch:ge}=await import("./http-CAiBnKza.js");return{authFetch:ge}},__vite__mapDeps([0,1,2,3])),ce=!!a,be=ce?`/user/stories/${a==null?void 0:a.id}`:"/user/stories",pe=await re(be,{method:ce?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(pe&&pe.ok){let ge;try{const Le=await pe.json();ge=Le==null?void 0:Le.id}catch{ge=a==null?void 0:a.id}const _e={id:typeof ge=="number"?ge:a?a.id:Date.now(),title:c.title,description:c.description,image:$||c.image,content:c.content,tags:c.tags,author:localStorage.getItem("user_nickname")||"",likes:"0",availableRoles:c.roles,status:A};A==="published"?t(_e):s(_e);return}o("","error")}catch{o("","error")}finally{le("none")}},fe=async()=>{try{le("draft");let A=c.image||"";try{const ce=localStorage.getItem("user_access_token");if(c.image&&c.image.startsWith("data:image")){const be=se(c.image),Ie=new FormData,pe=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;A=`/uploads/covers/${pe}`,Ie.append("cover",be,"cover.jpg"),Ie.append("filename",pe);const ge=await fetch("/api/uploads/cover",{method:"POST",headers:{Authorization:ce?`Bearer ${ce}`:""},body:Ie});if(ge&&ge.ok){const _e=await ge.json();_e&&_e.url&&(A=_e.url)}}}catch{}const $={title:c.title,description:c.description,image:A,content:c.content,tags:c.tags,characterIds:B()},{authFetch:Q}=await de(async()=>{const{authFetch:ce}=await import("./http-CAiBnKza.js");return{authFetch:ce}},__vite__mapDeps([0,1,2,3])),re=await Q(`/user/stories/${a==null?void 0:a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(re&&re.ok){const ce={id:typeof(a==null?void 0:a.id)=="number"?a.id:Date.now(),title:c.title,description:c.description,image:A||c.image,content:c.content,tags:c.tags,author:localStorage.getItem("user_nickname")||"",likes:"0",availableRoles:c.roles,status:a==null?void 0:a.status};s(ce);return}o("","error")}catch{o("","error")}finally{le("none")}},ie=()=>{const A={};return c.title.trim()||(A.title=!0),c.content.trim()||(A.content=!0),C(A),Object.keys(A).length===0},Ae=()=>{if(!ie()){b(!0);return}ee("published")},Me=()=>{if(!ie()){b(!0);return}if(a){fe();return}ee("draft")},Ve="field-label font-kosugi mb-3 text-slate-700 font-bold text-sm block";return n.jsx("div",{className:"fixed inset-0 bg-white z-[60]",children:n.jsxs("div",{className:"mx-auto w-full max-w-md h-full relative flex flex-col overflow-hidden rounded-none md:rounded-3xl shadow-2xl bg font-kosugi",children:[U&&n.jsx(vs,{imageSrc:U,aspectRatio:2,outputWidth:800,outputHeight:400,onCancel:()=>{T(null),N.current&&(N.current.value="")},onCrop:A=>{d($=>({...$,image:A})),T(null)}}),n.jsx("div",{className:"ambient-bg hidden"}),n.jsxs("div",{className:"sticky top-0 z-50 bg-white px-4 py-3 flex items-center border-b border-slate-100 rounded-t-none md:rounded-t-3xl relative",children:[a&&n.jsx("button",{onClick:Me,disabled:D!=="none",className:`absolute right-4 text-sm font-bold font-kosugi ${D!=="none"?"text-slate-400 cursor-not-allowed":"text-purple-600"}`,children:""}),n.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-purple-800 hover:bg-purple-100 rounded-full transition",children:n.jsx(Ht,{size:20})}),n.jsx("h1",{className:"absolute left-1/2 -translate-x-1/2 text-xl font-bold text-purple-900 font-kosugi",children:a?"":""}),!a&&n.jsx("button",{onClick:Me,disabled:D!=="none",className:`ml-auto text-sm font-bold font-kosugi ${D!=="none"?"text-slate-400 cursor-not-allowed":"text-purple-600"}`,children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-28 px-4 space-y-6",ref:F,children:[n.jsxs("section",{className:"flex flex-col items-center py-2",children:[n.jsxs("div",{onClick:ne,className:"relative group cursor-pointer active:scale-95 transition-transform w-full h-40 rounded-3xl overflow-hidden shadow-lg border-4 border-white bg-white/50",children:[c.image?n.jsx("img",{src:c.image,className:"w-full h-full object-cover",alt:"cover"}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-purple-300",children:[n.jsx(tn,{size:32}),n.jsx("span",{className:"text-xs font-bold mt-2",children:""})]}),n.jsx("div",{className:"absolute bottom-2 right-2 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-md",children:n.jsx(st,{size:14})})]}),n.jsx("input",{type:"file",ref:N,className:"hidden",accept:"image/*",onChange:he})]}),n.jsxs("section",{className:"glass-card p-6 space-y-4",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-2",children:""}),n.jsxs("div",{children:[n.jsxs("label",{className:`${Ve} flex items-center gap-1`,children:["",P.title&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal ml-1",children:""})]}),n.jsx("input",{value:c.title,onChange:A=>d($=>({...$,title:A.target.value})),type:"text",placeholder:"",className:`dream-input w-full px-4 py-3 text-sm font-bold ${P.title?"border-red-300 bg-red-50":""}`})]}),n.jsxs("div",{children:[n.jsx("label",{className:Ve,children:""}),n.jsx("input",{value:c.description,onChange:A=>d($=>({...$,description:A.target.value})),type:"text",placeholder:"",className:"dream-input w-full px-4 py-3 text-sm"})]}),n.jsxs("div",{children:[n.jsx("label",{className:Ve,children:""}),n.jsxs("div",{onClick:()=>f(!0),className:"dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white/80 transition",children:[c.tags.length===0&&n.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:""}),c.tags.map(A=>n.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",A,n.jsx(ut,{size:12,className:"ml-1 opacity-60 hover:opacity-100 cursor-pointer",onClick:$=>{$.stopPropagation(),Se(A)}})]},A)),n.jsx(Vt,{className:"ml-auto text-purple-300",size:16})]})]})]}),n.jsxs("section",{className:"glass-card p-6 space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2 relative",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"section-title !font-kosugi !text-purple-900 mb-0",children:""}),n.jsx("button",{onClick:()=>V(!0),className:"w-5 h-5 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center border border-purple-100",children:n.jsx(Ds,{size:12})})]}),n.jsx("button",{onClick:()=>g(!0),className:"text-xs bg-purple-100 text-purple-600 px-3 py-1.5 rounded-full font-bold hover:bg-purple-200 transition",children:"+ "}),k&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[60]",onClick:()=>V(!1)}),n.jsxs("div",{ref:M,className:"absolute left-0 top-8 z-[61] bg-white rounded-2xl shadow-xl border border-slate-100 p-3 w-[88%]",children:[n.jsx("div",{className:"text-xs text-slate-700 font-kosugi",children:""}),n.jsx("div",{className:"text-[10px] text-slate-400 mt-1 font-kosugi",children:""})]})]})]}),c.roles.length===0?n.jsx("div",{className:"text-center py-6 text-slate-400 text-xs border border-dashed border-purple-200 rounded-xl",children:""}):n.jsx("div",{className:"flex flex-col divide-y divide-slate-200",children:c.roles.map(A=>n.jsxs("div",{className:"flex items-center gap-3 bg/60 py-3",children:[n.jsx(ds,{src:A.avatar,alt:A.name,root:F.current,placeholderChar:(A.name||"?")[0],className:"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-700 text-sm",children:A.name}),n.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:A.description})]}),n.jsx("button",{onClick:()=>w(A.name),className:"text-slate-400 hover:text-red-400 p-2",children:n.jsx(en,{size:16})})]},A.name))})]}),n.jsxs("section",{className:"glass-card p-6 h-auto min-h-[300px] flex flex-col",children:[n.jsxs("div",{className:"section-title !font-kosugi !text-purple-900 mb-4 flex items-center gap-1",children:["",P.content&&n.jsx("span",{className:"text-red-500 text-[10px] font-normal",children:""})]}),n.jsx("textarea",{value:c.content,onChange:A=>d($=>({...$,content:A.target.value})),placeholder:"...",className:`flex-1 w-full bg-transparent border-none outline-none resize-none text-slate-700 leading-relaxed text-base min-h-[200px] placeholder:text-slate-300 ${P.content?"border-red-300 bg-red-50":""}`})]})]}),n.jsx("div",{className:"absolute bottom-0 inset-x-0 mx-auto w-full max-w-md bg-white/90 backdrop-blur-md p-4 z-50 border-t border-purple-50 rounded-none md:rounded-b-3xl shadow-2xl",children:n.jsxs("button",{onClick:Ae,disabled:D!=="none",className:`w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-purple-300 active:scale-95 transition flex items-center justify-center gap-2 ${D!=="none"?"opacity-70 cursor-not-allowed":""}`,children:[n.jsx(hr,{size:18})," ",D==="publish"?"...":""]})}),u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>f(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-[30px] z-[62] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col h-[70vh] animate-in slide-in-from-bottom duration-300",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50 bg-white rounded-t-[30px]",children:[n.jsx("button",{onClick:()=>f(!1),className:"w-8 h-8 rounded-full bg-purple-50 text-purple-800 flex items-center justify-center",children:n.jsx(Lt,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:""}),n.jsx("button",{onClick:()=>f(!1),className:"text-sm font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full font-kosugi",children:""})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-10",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-purple-50/50 p-3 rounded-xl border border-purple-100 border-dashed",children:[c.tags.length===0&&n.jsx("span",{className:"text-xs text-slate-400 self-center",children:""}),c.tags.map(A=>n.jsxs("button",{onClick:()=>Se(A),className:"bg-purple-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1",children:["#",A," ",n.jsx(ut,{size:10,className:"opacity-80"})]},A))]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:E,onChange:A=>_(A.target.value),onKeyDown:A=>A.key==="Enter"&&Pe(),type:"text",placeholder:"",className:"dream-input flex-1 px-4 py-2 text-sm bg-white"}),n.jsx("button",{onClick:Pe,className:"bg-purple-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition",children:""})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-bold text-slate-400 mb-2 ml-1",children:""}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:G.map(A=>n.jsxs("button",{onClick:()=>Se(A),className:`
                                            rounded-2xl font-bold text-[0.85rem] px-2 py-2 transition-all whitespace-nowrap overflow-hidden text-ellipsis
                                            ${c.tags.includes(A)?"bg-[#8B5CF6] text-white shadow-md":"bg-[#F3E8FF] text-[#6B21A8]"}
                                        `,children:["#",A]},A))})]})]})]})]}),m&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-[61]",onClick:()=>g(!1)}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-[30px] overflow-hidden z-[62] flex flex-col h-[70vh] animate-in slide-in-from-bottom duration-300 shadow-[0_-10px_40px_rgba(0,0,0,0.1)]",children:[n.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-purple-50",children:[n.jsx("h3",{className:"text-lg font-bold text-purple-900 font-kosugi",children:""}),n.jsx("button",{onClick:()=>g(!1),className:"p-2 bg-slate-100 rounded-full",children:n.jsx(ut,{size:16})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",ref:X,children:(W||[]).filter(A=>!c.roles.some($=>$.name===A.name)).sort((A,$)=>{const Q=be=>be.isPrivate&&be.isMine?0:!be.isPrivate&&be.isMine?1:2,re=Q(A),ce=Q($);return re===ce?0:re<ce?-1:1}).map(A=>n.jsxs("div",{onClick:()=>oe({name:A.name,avatar:A.avatar,oneLinePersona:A.desc,bio:A.desc}),className:"flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-2xl shadow-sm active:scale-[0.98] transition cursor-pointer hover:border-purple-200",children:[n.jsx(ds,{src:A.avatar,alt:A.name,root:X.current,placeholderChar:(A.name||"?")[0],className:"w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-bold text-slate-800",children:A.name}),n.jsx("div",{className:"text-xs text-slate-400 truncate w-48",children:A.desc})]}),A.isMine&&A.isPrivate&&n.jsx("span",{className:"text-pink-500 text-[10px] font-bold mr-2",children:""}),n.jsx("div",{className:"ml-auto bg-purple-50 text-purple-600 p-2 rounded-full",children:n.jsx(st,{size:16})})]},`imp_${A.id||A.name}`))})]})]}),j&&n.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-3",children:n.jsx(Ds,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center mb-1 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 text-center mb-5 font-kosugi",children:""}),n.jsx("button",{onClick:()=>b(!1),className:"w-full py-2.5 rounded-xl bg-purple-500 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition-colors font-kosugi",children:""})]})})]})})},_h=({onLogin:e})=>{const[t,s]=h.useState(""),[i,r]=h.useState(""),[a,l]=h.useState(!1),[o,c]=h.useState(!1),[d,u]=h.useState(null),[f,m]=h.useState({height:"100%",top:0}),g=h.useRef(null),j=h.useRef(null),b=h.useRef(null);h.useEffect(()=>{const C=()=>{window.visualViewport&&m({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`})};return window.visualViewport&&(window.visualViewport.addEventListener("resize",C),window.visualViewport.addEventListener("scroll",C),C()),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",C),window.visualViewport.removeEventListener("scroll",C))}},[]),h.useEffect(()=>{var C;try{(C=j.current)==null||C.focus()}catch{}},[]);const P=async C=>{if(C.preventDefault(),u(null),!t.trim()||!i.trim()){u("");return}c(!0);try{const E=await dh.login(t.trim(),i.trim());if(E!=null&&E.access_token)try{localStorage.setItem("user_access_token",E.access_token)}catch{}if(E!=null&&E.refresh_token)try{localStorage.setItem("user_refresh_token",E.refresh_token)}catch{}e()}catch{u("")}finally{c(!1)}};return n.jsx("div",{ref:g,className:"fixed left-0 w-full bg-primary-50 overflow-y-auto no-scrollbar scroll-smooth font-sans animate-in fade-in duration-700",style:{...f,overscrollBehavior:"none"},children:n.jsx("div",{className:"h-full w-full max-w-md mx-auto bg-white rounded-none md:rounded-3xl shadow-2xl border border-slate-200 overflow-hidden",children:n.jsx("div",{className:"min-h-full w-full flex flex-col px-8 py-10",children:n.jsxs("div",{className:"w-full flex flex-col items-center z-10 max-w-sm m-auto",children:[n.jsx("div",{className:"text-center mb-12",children:n.jsx("h1",{className:"text-[40px] font-extrabold text-[#A855F7] mb-0 tracking-tight font-sans",children:"YumeCrush"})}),n.jsxs("form",{onSubmit:P,className:"w-full space-y-5",children:[n.jsx("input",{type:"text",placeholder:"",value:t,onChange:C=>s(C.target.value),ref:j,className:"w-full h-[60px] px-6 rounded-2xl bg-white border border-[#F3F4F6] text-[#374151] placeholder:text-[#D1D5DB] outline-none focus:border-[#C084FC] focus:bg focus:ring-4 focus:ring-[#F3E8FF] transition-all text-[15px] font-medium shadow-sm"}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:a?"text":"password",placeholder:"",value:i,onChange:C=>r(C.target.value),ref:b,className:"w-full h-[60px] px-6 rounded-2xl bg border border-[#F3F4F6] text-[#374151] placeholder:text-[#D1D5DB] outline-none focus:border-[#C084FC] focus:bg focus:ring-4 focus:ring-[#F3E8FF] transition-all text-[15px] font-medium shadow-sm"}),n.jsx("button",{type:"button",onClick:()=>l(!a),className:"absolute right-5 top-1/2 -translate-y-1/2 text-[#9CA3AF] hover:text-[#C084FC] transition-colors",children:a?n.jsx(uo,{size:20}):n.jsx(fo,{size:20})})]}),d&&n.jsx("div",{className:"text-red-500 text-xs font-bold",children:d}),n.jsx("button",{type:"submit",disabled:o,className:`w-full h-[60px] ${o?"bg-[#A855F7]/70":"bg-[#A855F7] hover:bg-[#9333EA]"} text-white font-bold text-[16px] rounded-2xl shadow-[0_10px_30px_rgba(168,85,247,0.3)] active:scale-[0.98] transition-all mt-4`,children:o?"...":""})]})]})})})})},Ph=e=>({id:typeof(e==null?void 0:e.mypage_id)=="number"?e.mypage_id:(e==null?void 0:e.id)??Date.now(),title:(e==null?void 0:e.mypage_title)??(e==null?void 0:e.title)??"",description:(e==null?void 0:e.mypage_description)??(e==null?void 0:e.description)??"",image:(e==null?void 0:e.mypage_image)??(e==null?void 0:e.image)??"",status:(e==null?void 0:e.mypage_status)??(e==null?void 0:e.status)??void 0,tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[]}),Eh=async e=>{const t=new URLSearchParams;e&&t.set("includeDrafts",String(e.includeDrafts));const{authFetch:s}=await de(async()=>{const{authFetch:l}=await import("./http-CAiBnKza.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3])),i=await s(`/user/stories?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return(Array.isArray(r==null?void 0:r.items)?r.items:[]).map(Ph)},or=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:r}=await import("./http-CAiBnKza.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/user/stories/${e}`);if(!s.ok)throw new Error("failed");const i=await s.json();return{id:(i==null?void 0:i.id)??e,title:(i==null?void 0:i.title)??"",description:(i==null?void 0:i.description)??"",image:(i==null?void 0:i.image)??"",user_avatar:(i==null?void 0:i.user_avatar)??"",status:(i==null?void 0:i.status)??void 0,content:(i==null?void 0:i.content)??"",publishDate:(i==null?void 0:i.publish_date)??void 0,tags:Array.isArray(i==null?void 0:i.tags)?i.tags:[],characterIds:Array.isArray(i==null?void 0:i.characterIds)?i.characterIds:[]}},Mh=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:i}=await import("./http-CAiBnKza.js");return{authFetch:i}},__vite__mapDeps([0,1,2,3]));if(!(await t(`/user/stories/${e}`,{method:"DELETE"})).ok)throw new Error("failed");return!0},Rh=({avatar:e,name:t})=>{const[s,i]=h.useState(!1);return n.jsx("div",{className:"w-14 h-14 rounded-full bg-slate-100 flex-shrink-0 overflow-hidden border border-slate-50 flex items-center justify-center",children:!s&&e?n.jsx("img",{src:e,className:"w-full h-full object-cover",alt:t,onError:()=>i(!0)}):n.jsx("span",{className:"text-base font-bold text-slate-500",children:(t==null?void 0:t[0])||"?"})})},Dh=({userProfile:e,myCharacters:t,myUserCharacters:s,myStories:i,onUpdateProfile:r,onCharacterClick:a,onLogout:l,onEditStory:o,onDeleteStory:c,onEditCharacter:d,onDeleteCharacter:u,onReadStory:f,onAddStory:m,onAddCharacter:g})=>{var Z;const[j,b]=h.useState(!1),[P,C]=h.useState(e.nickname),[E,_]=h.useState(!1),[U,T]=h.useState(null),[k,V]=h.useState(!1),M=(navigator==null?void 0:navigator.maxTouchPoints)>0,[W,O]=h.useState(i||[]),[L,K]=h.useState({}),[N,F]=h.useState(null),X=h.useRef(0),se=h.useRef(0),G=h.useRef(null),ne=h.useRef(0),[he,Se]=h.useState(s||[]),[Pe,oe]=h.useState({}),[w,B]=h.useState(null),D=h.useRef(0),le=h.useRef(0),ee=h.useRef(null),fe=h.useRef(0),[ie,Ae]=h.useState({visible:!1,x:0,y:0,id:null,type:null}),Me=(v,R,z)=>{if(v.preventDefault(),M)return;let Y=v.clientX;const te=140;Y+te>window.innerWidth&&(Y=window.innerWidth-te-10),Ae({visible:!0,x:Y,y:v.clientY,id:R,type:z})},Ve=h.useRef(null),A=v=>{var et;const R=v.split(","),z=((et=R[0].match(/:(.*?);/))==null?void 0:et[1])||"image/jpeg",Y=atob(R[1]);let te=Y.length;const Te=new Uint8Array(te);for(;te--;)Te[te]=Y.charCodeAt(te);return new Blob([Te],{type:z})},$=()=>{var v;(v=Ve.current)==null||v.click()},Q=v=>{var z;const R=(z=v.target.files)==null?void 0:z[0];if(R){const Y=new FileReader;Y.onloadend=()=>{T(Y.result)},Y.readAsDataURL(R)}Ve.current&&(Ve.current.value="")},re=async()=>{const v=P.trim();if(!v){C(e.nickname),b(!1);return}try{const{authFetch:R}=await de(async()=>{const{authFetch:z}=await import("./http-CAiBnKza.js");return{authFetch:z}},__vite__mapDeps([0,1,2,3]));await R("/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:v})}),r({...e,nickname:v})}catch{C(e.nickname)}b(!1)};h.useEffect(()=>{O(i||[])},[e.usedCount]),h.useEffect(()=>{O(i||[])},[i]),h.useEffect(()=>{Se(s||[])},[s]);const ce=(v,R)=>{X.current=v.touches[0].clientX,se.current=v.touches[0].clientY,G.current=R,ne.current=L[R]||0},be=(v,R)=>{if(G.current!==R)return;const z=v.touches[0].clientX-X.current,Y=v.touches[0].clientY-se.current;if(Math.abs(Y)>Math.abs(z))return;let te=0;ne.current===0?te=Math.max(-96,Math.min(96,z)):ne.current>0?te=Math.max(0,Math.min(96,ne.current+z)):te=Math.min(0,Math.max(-96,ne.current+z)),K(Te=>({...Te,[R]:te}))},Ie=v=>{if(G.current!==v)return;const R=L[v]||0;let z=0;ne.current===0?z=R>60?96:R<-60?-96:0:ne.current>0?z=R>60?96:0:z=R<-60?-96:0,K(Y=>({...Y,[v]:z})),G.current=null},pe=v=>K(R=>({...R,[v]:0})),ge=(v,R)=>{D.current=v.touches[0].clientX,le.current=v.touches[0].clientY,ee.current=R,fe.current=Pe[R]||0},_e=(v,R)=>{if(ee.current!==R)return;const z=v.touches[0].clientX-D.current,Y=v.touches[0].clientY-le.current;if(Math.abs(Y)>Math.abs(z))return;let te=0;fe.current===0?te=Math.max(-96,Math.min(96,z)):fe.current>0?te=Math.max(0,Math.min(96,fe.current+z)):te=Math.min(0,Math.max(-96,fe.current+z)),oe(Te=>({...Te,[R]:te}))},Le=v=>{if(ee.current!==v)return;const R=Pe[v]||0;let z=0;fe.current===0?z=R>60?96:R<-60?-96:0:fe.current>0?z=R>60?96:0:z=R<-60?-96:0,oe(Y=>({...Y,[v]:z})),ee.current=null},We=v=>oe(R=>({...R,[v]:0})),ze=v=>{pe(v.id),o&&o(v)},$e=async v=>{const R=W.find(z=>z.id===v);if(F(null),c&&R){c(R);return}try{await Mh(v),O(z=>z.filter(Y=>Y.id!==v))}catch{}},Qe=v=>{We(v.id),d&&d(v)},H=async v=>{const R=he.find(z=>z.id===v);B(null),u&&R&&u(R);try{await Ch(v),Se(z=>z.filter(Y=>Y.id!==v)),u&&R&&u(R)}catch{}};return n.jsxs("div",{className:"h-full w-full bg-[#F8F9FB] flex flex-col font-kosugi relative",children:[U&&n.jsx(vs,{imageSrc:U,onCancel:()=>T(null),onCrop:async v=>{const R=localStorage.getItem("user_access_token");let z=v;try{if(v&&v.startsWith("data:image")){const Y=A(v),te=new FormData,Te=`${Date.now()}_${Math.random().toString(36).slice(2,8)}.jpg`;te.append("avatar",Y,"avatar.jpg"),te.append("filename",Te),z=`/uploads/users/avatars/${Te}`,await fetch("/api/uploads/avatar",{method:"POST",headers:{Authorization:R?`Bearer ${R}`:""},body:te}).catch(()=>{})}}catch{}try{const{authFetch:Y}=await de(async()=>{const{authFetch:te}=await import("./http-CAiBnKza.js");return{authFetch:te}},__vite__mapDeps([0,1,2,3]));await Y("/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:z})})}catch{}r({...e,avatar:z||e.avatar}),T(null)}}),n.jsxs("div",{className:"relative pb-4",children:[n.jsxs("div",{className:"h-40 bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 rounded-b-[40px] relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-[-20px] left-[-20px] w-40 h-40 bg-white/20 rounded-full blur-xl"}),n.jsx("div",{className:"absolute bottom-[-10px] right-[-10px] w-32 h-32 bg-purple-400/20 rounded-full blur-xl"})]}),n.jsxs("div",{className:"absolute top-16 left-4 right-4 bg-white rounded-3xl shadow-lg p-4 flex flex-col items-center animate-in slide-in-from-bottom-4 duration-500",children:[n.jsxs("div",{className:"relative -mt-12 mb-2 group cursor-pointer",onClick:$,children:[n.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white shadow-md overflow-hidden bg-slate-100 flex items-center justify-center",children:!k&&(e.avatar||!0)?n.jsx("img",{src:e.avatar||"/uploads/avatars/default_avatar.jpg",alt:"Me",className:"w-full h-full object-cover",onError:()=>V(!0)}):n.jsx("span",{className:"text-xl font-bold text-slate-500",children:((Z=e.nickname)==null?void 0:Z[0])||"?"})}),n.jsx("div",{className:"absolute bottom-0 right-0 bg-primary-500 p-1.5 rounded-full text-white border-2 border-white shadow-sm",children:n.jsx(tn,{size:10})}),n.jsx("input",{type:"file",ref:Ve,className:"hidden",accept:"image/*",onChange:Q})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[j?n.jsx("input",{value:P,onChange:v=>C(v.target.value),onBlur:re,onKeyDown:v=>v.key==="Enter"&&re(),autoFocus:!0,className:"text-lg font-bold text-center text-slate-800 border-b-2 border-primary-300 outline-none bg-transparent min-w-[100px]"}):n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:e.nickname}),!j&&n.jsx("button",{onClick:()=>b(!0),className:"text-slate-400 hover:text-primary-500",children:n.jsx(Is,{size:12})})]}),n.jsx("div",{className:"flex flex-col items-center gap-1 mb-1",children:n.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-[10px] font-bold bg-slate-50 px-3 py-0.5 rounded-full",children:[n.jsx(jo,{size:10}),n.jsx("span",{className:"tracking-wide",children:e.email})]})})]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-24 space-y-6 no-scrollbar mt-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-1 h-4 bg-indigo-400 rounded-full"}),n.jsx("h3",{className:"font-bold text-slate-700",children:""})]}),n.jsx("button",{onClick:m,className:"w-6 h-6 flex items-center justify-center rounded-full bg-white text-purple-500 border border-purple-100 shadow-sm hover:bg-purple-50 active:scale-95",children:n.jsx(st,{size:14})})]}),W&&W.length>0?n.jsx("div",{className:"flex flex-col gap-3",children:W.map(v=>n.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[(()=>{const R=L[v.id]||0,z=Math.min(96,Math.max(0,-R)),Y=Math.min(96,Math.max(0,R));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${z}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>F(v.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-2xl shadow-sm",style:{width:`${Y}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>ze(v),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onTouchStart:R=>ce(R,v.id),onTouchMove:R=>be(R,v.id),onTouchEnd:()=>Ie(v.id),onContextMenu:R=>Me(R,v.id,"story"),onClick:()=>{(L[v.id]||0)===0&&f&&f(v)},style:{transform:`translateX(${L[v.id]||0}px)`,transition:"transform 180ms ease"},className:`${(L[v.id]||0)<0?"rounded-l-2xl rounded-r-none":(L[v.id]||0)>0?"rounded-l-none rounded-r-2xl":"rounded-2xl"} bg-white p-3 shadow-sm flex gap-4 border border-transparent hover:border-indigo-100 group relative overflow-hidden`,children:[n.jsx("div",{className:"w-16 h-20 rounded-xl bg-slate-100 flex-shrink-0 overflow-hidden relative",children:n.jsx("img",{src:v.image||"/uploads/covers/default_storyimg.jpg",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:v.title})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:"font-bold text-slate-800 text-base",children:v.title}),n.jsx("div",{className:"flex flex-col items-end gap-0.5",children:n.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${v.status==="published"?"bg-green-100 text-green-600":"bg-slate-100 text-slate-400"}`,children:v.status==="published"?"":""})})]}),n.jsx("p",{className:"text-xs text-slate-400 line-clamp-1",children:v.description}),n.jsx("div",{className:"flex gap-2 mt-2",children:(v.tags||[]).slice(0,2).map(R=>n.jsx("span",{className:"text-[10px] bg-slate-50 text-slate-400 px-1.5 py-0.5 rounded",children:R},R))})]}),n.jsx("div",{className:"self-center",children:n.jsx(_o,{size:16,className:"text-slate-300"})})]})]},v.id))}):n.jsx("div",{className:"bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-50 border-dashed",children:n.jsx("p",{className:"text-xs text-slate-400",children:""})})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-1 h-4 bg-purple-400 rounded-full"}),n.jsx("h3",{className:"font-bold text-slate-700",children:""})]}),n.jsx("button",{onClick:g,className:"w-6 h-6 flex items-center justify-center rounded-full bg-white text-purple-500 border border-purple-100 shadow-sm hover:bg-purple-50 active:scale-95",children:n.jsx(st,{size:14})})]}),he.length>0?n.jsx("div",{className:"flex flex-col gap-3",children:he.map(v=>n.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[(()=>{const R=Pe[v.id]||0,z=Math.min(96,Math.max(0,-R)),Y=Math.min(96,Math.max(0,R));return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 flex items-center justify-center rounded-r-2xl shadow-sm",style:{width:`${z}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>B(v.id),className:"text-white font-bold drop-shadow-sm",children:""})}),n.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-indigo-500 flex items-center justify-center rounded-l-2xl shadow-sm",style:{width:`${Y}px`,transition:"width 120ms ease"},children:n.jsx("button",{onClick:()=>Qe(v),className:"text-white font-bold drop-shadow-sm",children:""})})]})})(),n.jsxs("div",{onClick:()=>a(v),onTouchStart:R=>ge(R,v.id),onTouchMove:R=>_e(R,v.id),onTouchEnd:()=>Le(v.id),onContextMenu:R=>Me(R,v.id,"character"),style:{transform:`translateX(${Pe[v.id]||0}px)`,transition:"transform 180ms ease"},className:`${(Pe[v.id]||0)<0?"rounded-l-2xl rounded-r-none":(Pe[v.id]||0)>0?"rounded-l-none rounded-r-2xl":"rounded-2xl"} bg-white p-3 shadow-sm flex items-center gap-4 active:scale-[0.98] transition-all cursor-pointer border border-transparent hover:border-purple-100 group relative overflow-hidden`,children:[n.jsx(Rh,{avatar:v.avatar,name:v.name}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:"font-bold text-slate-800",children:v.name}),n.jsx("div",{className:"flex flex-col items-end gap-0.5",children:n.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${v.isPublished?v.isPublic?"bg-green-100 text-green-600":"bg-pink-100 text-pink-600":"bg-slate-100 text-slate-400"}`,children:v.isPublished?v.isPublic?"":"":""})})]}),n.jsx("p",{className:"text-xs text-slate-400 truncate mt-1",children:v.oneLinePersona||v.bio})]}),n.jsx(Vt,{size:16,className:"text-slate-300"})]})]},v.id))}):n.jsx("div",{className:"bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-50 border-dashed",children:n.jsx("p",{className:"text-xs text-slate-400",children:""})})]}),n.jsx("div",{className:"bg-white rounded-3xl shadow-sm p-2",children:n.jsxs("button",{onClick:()=>_(!0),className:"w-full flex items-center justify-center gap-3 p-2 hover:bg-red-50 active:bg-red-100 active:scale-95 rounded-2xl transition-all group",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-red-50 text-red-400 flex items-center justify-center group-hover:bg-red-100 group-hover:text-red-500 transition-colors",children:n.jsx($n,{size:16})}),n.jsx("span",{className:"text-center font-bold text-slate-700 text-sm group-hover:text-red-500",children:""})]})})]}),E&&n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-[32px] p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-50 text-red-400 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx($n,{size:28})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:""}),n.jsx("p",{className:"text-xs text-slate-400 mb-6 px-4 leading-relaxed"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>_(!1),className:"flex-1 py-3 rounded-2xl bg-slate-100 text-slate-600 font-bold hover:bg-slate-200 transition-colors text-sm",children:""}),n.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-2xl bg-red-500 text-white font-bold shadow-lg shadow-red-200 hover:bg-red-600 transition-colors text-sm",children:""})]})]})}),N&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{N!=null&&pe(N),F(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{$e(N)},children:""})]})]})}),n.jsx("style",{children:`
            @keyframes fadeCard { from { opacity: 0; transform: translateY(-6px) } to { opacity: 1; transform: translateY(0) } }
            @keyframes fadeBg { from { opacity: 0 } to { opacity: 1 } }
          `})]}),w&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 animate-[fadeBg_200ms_ease]"}),n.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-[85%] max-w-sm animate-[fadeCard_200ms_ease]",children:[n.jsx("div",{className:"px-6 py-5 text-center text-slate-800 font-bold",children:""}),n.jsx("div",{className:"h-[1px] bg-slate-100"}),n.jsxs("div",{className:"flex",children:[n.jsx("button",{className:"flex-1 py-4 text-slate-600 active:opacity-70",onClick:()=>{w!=null&&We(w),B(null)},children:""}),n.jsx("div",{className:"w-[1px] bg-slate-100"}),n.jsx("button",{className:"flex-1 py-4 text-red-600 font-bold active:opacity-70",onClick:()=>{H(w)},children:""})]})]})})]}),ie.visible&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-[99]",onClick:()=>Ae(v=>({...v,visible:!1})),onContextMenu:v=>{v.preventDefault(),Ae(R=>({...R,visible:!1}))}}),n.jsxs("div",{className:"fixed z-[100] bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95 duration-100",style:{top:ie.y,left:ie.x},children:[n.jsxs("button",{onClick:()=>{if(ie.type==="story"){const v=W.find(R=>R.id===ie.id);v&&ze(v)}else if(ie.type==="character"){const v=he.find(R=>R.id===ie.id);v&&Qe(v)}Ae(v=>({...v,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50 flex items-center gap-2 transition-colors",children:[n.jsx(Is,{size:16,className:"text-indigo-500"}),""]}),n.jsx("div",{className:"h-[1px] bg-slate-100 w-full"}),n.jsxs("button",{onClick:()=>{ie.type==="story"?F(ie.id):ie.type==="character"&&B(ie.id),Ae(v=>({...v,visible:!1}))},className:"w-full text-left px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 flex items-center gap-2 transition-colors",children:[n.jsx(en,{size:16}),""]})]})]})]})},lr=async e=>{const t=new URLSearchParams;e!=null&&e.limit&&t.set("limit",String(e.limit)),typeof(e==null?void 0:e.offset)=="number"&&t.set("offset",String(e.offset));const{authFetch:s}=await de(async()=>{const{authFetch:l}=await import("./http-CAiBnKza.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3])),i=await s(`/stories/?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return Array.isArray(r==null?void 0:r.items)?r.items:[]},Ih=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:r}=await import("./http-CAiBnKza.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/stories/${e}`);if(!s.ok)throw new Error("failed");return await s.json()},Vh=({story:e,onBack:t,onStartRoleplay:s,connectedRoleNames:i=[],validRoleNames:r=[]})=>{const a=h.useRef(null),l=h.useRef(null),[o,c]=h.useState(20),[d,u]=h.useState(0),[f,m]=h.useState(!1),[g,j]=h.useState(!1),[b,P]=h.useState(null),[C,E]=h.useState(!1),_=h.useRef(0),U=h.useRef(0),T=h.useCallback(()=>{if(!a.current||!l.current)return;const{scrollTop:O,scrollHeight:L,clientHeight:K}=a.current,N=l.current.clientHeight;if(L<=K){c(N),u(0);return}const F=K/L,X=Math.max(F*N,30);c(X);const se=L-K,G=N-X,ne=O/se;u(ne*G)},[]);h.useEffect(()=>{const O=new ResizeObserver(()=>{T()});a.current&&O.observe(a.current),l.current&&O.observe(l.current);const L=setTimeout(T,100);return()=>{O.disconnect(),clearTimeout(L)}},[T]);const k=O=>{O.preventDefault(),O.stopPropagation(),m(!0);const L="touches"in O?O.touches[0].clientX:O.clientY;_.current=L,U.current=d};h.useEffect(()=>{const O=K=>{if(!f||!a.current||!l.current)return;K.preventDefault();const F=("touches"in K?K.touches[0].clientY:K.clientY)-_.current,se=l.current.clientHeight-o,G=a.current.scrollHeight-a.current.clientHeight;if(se<=0)return;let ne=U.current+F;ne=Math.max(0,Math.min(ne,se));const he=ne/se;a.current.scrollTop=he*G},L=()=>{m(!1)};return f&&(document.addEventListener("mousemove",O),document.addEventListener("mouseup",L),document.addEventListener("touchmove",O,{passive:!1}),document.addEventListener("touchend",L)),()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",L),document.removeEventListener("touchmove",O),document.removeEventListener("touchend",L)}},[f,o]);const V=()=>{if(b){if(i.includes(b)){E(!0);return}const O=(e.availableRoles||[]).find(L=>L.name===b);O&&s(O)}},M=e.content.split(`
`).filter(O=>O.trim()!==""),W=(e.availableRoles||[]).filter(O=>r&&r.length?r.includes(O.name):!0);return n.jsxs("div",{className:"fixed inset-0 bg-white z-[60] flex flex-col h-full w-full animate-in slide-in-from-right duration-300",children:[n.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col relative bg-white rounded-none md:rounded-3xl md:overflow-hidden shadow-2xl",children:[n.jsx("button",{onClick:t,className:"absolute top-4 left-4 z-[100] w-10 h-10 bg-black/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:n.jsx(us,{size:24})}),n.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar bg-[#FAFAFA]",onScroll:T,ref:a,children:[n.jsxs("div",{className:"w-full h-64 relative",children:[n.jsx("img",{src:e.image||"/uploads/covers/default_storyimg.jpg",alt:e.title,className:"w-full h-full object-cover"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#FAFAFA] to-transparent"})]}),n.jsxs("div",{className:"px-6 -mt-12 relative z-10 pb-20",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4 leading-tight",children:e.title}),n.jsxs("div",{className:"flex items-center mt-2",children:[n.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-200 overflow-hidden border border-white shadow-sm mr-3",children:n.jsx("img",{src:e.user_avatar||`https://api.dicebear.com/7.x/miniavs/svg?seed=${e.author}`,alt:"author",className:"w-full h-full object-cover"})}),n.jsx("span",{className:"text-sm font-bold text-slate-700",children:e.author})]})]}),n.jsx("article",{className:"prose prose-slate max-w-none",children:M.map((O,L)=>n.jsx("p",{className:"mb-6 text-justify tracking-wide text-[16px]",style:{lineHeight:1.8,color:"#334155"},children:O},L))}),n.jsx("div",{className:"flex items-center justify-center my-10",children:n.jsx("span",{className:"text-slate-400/80 text-sm font-medium tracking-widest",children:"  "})}),n.jsx("div",{className:"mb-12 flex flex-wrap gap-4 pl-1",children:e.tags.map(O=>n.jsxs("span",{className:"text-sm text-slate-400",children:["#",O]},O))}),W.length>0&&n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-6 py-3 bg-purple-100 rounded-full shadow-lg shadow-purple-200/50 hover:bg-purple-200 transition-all active:scale-95 cursor-pointer",children:[n.jsx("span",{className:"text-lg font-bold text-purple-600 tracking-widest",children:""}),n.jsx(so,{size:18,className:"text-purple-600"})]})})]})]}),n.jsx("div",{ref:l,className:"absolute right-1 top-4 bottom-4 w-1.5 z-[70]",children:n.jsx("div",{className:"w-full rounded-full cursor-pointer transition-colors duration-200 bg-slate-400/40 hover:bg-slate-400/60",style:{height:`${o}px`,transform:`translateY(${d}px)`,touchAction:"none"},onMouseDown:k,onTouchStart:k})})]}),g&&n.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:n.jsxs("div",{className:"bg-white w-[85%] max-w-sm rounded-[32px] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300",children:[n.jsxs("div",{className:"p-6 pb-2",children:[n.jsx("h3",{className:"text-xl font-bold text-slate-900 text-center mb-6 font-kosugi",children:""}),n.jsx("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto no-scrollbar py-2 px-1",children:W.length>0?W.map(O=>{const L=b===O.name,K=i.includes(O.name);return n.jsxs("div",{onClick:()=>P(O.name),className:`
                                            relative p-4 rounded-2xl flex items-center justify-between cursor-pointer transition-all border-2
                                            ${L?"bg-purple-50 border-purple-500 shadow-md scale-[1.02]":"bg-slate-50 border-transparent hover:bg-slate-100"}
                                        `,children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:`font-bold text-base ${L?"text-purple-700":"text-slate-800"}`,children:O.name}),K&&n.jsx("span",{className:"text-[10px] text-green-500 font-bold mt-1",children:" "})]}),L&&n.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center text-white shadow-sm",children:n.jsx(mr,{size:12,strokeWidth:3})})]},O.name)}):n.jsx("p",{className:"text-center text-slate-400 py-4 text-sm",children:""})})]}),n.jsx("div",{className:"p-6 pt-2 bg-gradient-to-t from-white via-white to-transparent",children:n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-3.5 rounded-2xl border border-slate-200 font-bold text-slate-500 hover:bg-slate-50 text-sm",children:""}),n.jsx("button",{onClick:V,disabled:!b,className:`
                                   flex-1 py-3.5 rounded-2xl font-bold text-white text-sm shadow-lg transition-all flex items-center justify-center gap-2
                                   ${b?"bg-purple-600 shadow-purple-200 hover:bg-purple-700 active:scale-95":"bg-slate-300 shadow-none cursor-not-allowed"}
                               `,children:""})]})})]})}),C&&n.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-[80%] max-w-xs shadow-2xl scale-100 animate-in zoom-in-95 duration-200 flex flex-col items-center text-center",children:[n.jsx("div",{className:"w-12 h-12 bg-purple-100 text-purple-500 rounded-full flex items-center justify-center mb-4",children:n.jsx(fr,{size:24})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2 font-kosugi",children:""}),n.jsx("p",{className:"text-xs text-slate-400 mb-6 font-kosugi",children:""}),n.jsx("button",{onClick:()=>E(!1),className:"w-full py-3 rounded-2xl bg-purple-600 text-white font-bold shadow-lg shadow-purple-200 hover:bg-purple-700 transition-colors text-sm font-kosugi",children:""})]})})]})},Xa=e=>({id:(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.character_id)??String(Date.now()),name:(e==null?void 0:e.name)??(e==null?void 0:e.title)??"",avatar:(e==null?void 0:e.avatar)??(e==null?void 0:e.cover)??(e==null?void 0:e.image)??"",profileImage:(e==null?void 0:e.profileImage)??(e==null?void 0:e.banner)??(e==null?void 0:e.image)??"",bio:(e==null?void 0:e.bio)??(e==null?void 0:e.tagline)??(e==null?void 0:e.description)??"",tags:(e==null?void 0:e.tags)??(e==null?void 0:e.keywords)??[],creator:(e==null?void 0:e.creator)??(e==null?void 0:e.author)??"",oneLinePersona:(e==null?void 0:e.oneLinePersona)??(e==null?void 0:e.tagline)??"",personality:(e==null?void 0:e.personality)??(e==null?void 0:e.personality)??"",profession:(e==null?void 0:e.profession)??(e==null?void 0:e.occupation)??"",age:(e==null?void 0:e.age)??"",roleType:(e==null?void 0:e.roleType)??(e==null?void 0:e.character_type)??"",currentRelationship:(e==null?void 0:e.currentRelationship)??(e==null?void 0:e.relationship)??"",plotTheme:(e==null?void 0:e.plotTheme)??(e==null?void 0:e.plot_theme)??"",plotDescription:(e==null?void 0:e.plotDescription)??(e==null?void 0:e.plot_summary)??"",openingLine:(e==null?void 0:e.openingLine)??(e==null?void 0:e.opening_line)??""}),cr=async e=>{const t=new URLSearchParams;e!=null&&e.tag&&t.set("tag",e.tag),e!=null&&e.limit&&t.set("limit",String(e.limit)),typeof(e==null?void 0:e.offset)=="number"&&t.set("offset",String(e.offset));const{authFetch:s}=await de(async()=>{const{authFetch:l}=await import("./http-CAiBnKza.js");return{authFetch:l}},__vite__mapDeps([0,1,2,3])),i=await s(`/characters/?${t.toString()}`);if(!i.ok)throw new Error("failed");const r=await i.json();return(Array.isArray(r==null?void 0:r.items)?r.items:[]).map(Xa)},dr=async e=>{const{authFetch:t}=await de(async()=>{const{authFetch:r}=await import("./http-CAiBnKza.js");return{authFetch:r}},__vite__mapDeps([0,1,2,3])),s=await t(`/characters/${e}`);if(!s.ok)throw new Error("failed");const i=await s.json();return Xa(i)},Lh=[],Fh=({char:e,root:t})=>{var s;return n.jsx(ds,{src:e.avatar,alt:e.name,root:t,placeholderChar:((s=e.name)==null?void 0:s[0])||"?",className:"w-20 h-28 flex-shrink-0 rounded-xl overflow-hidden bg-slate-100 relative group flex items-center justify-center"})},Oh=()=>{const[e,t]=h.useState(me.HOME),[s,i]=h.useState(Lh),[r,a]=h.useState([]),[l,o]=h.useState(!1),[c,d]=h.useState(null),[u,f]=h.useState(null),[m,g]=h.useState("stories"),[j,b]=h.useState(!1),[P,C]=h.useState(void 0),[E,_]=h.useState(!1),[U,T]=h.useState(!1),[k,V]=h.useState(null),[M,W]=h.useState(null),[O,L]=h.useState([]),[K,N]=h.useState(null),[F,X]=h.useState([]),[se,G]=h.useState(null),[ne,he]=h.useState([]),[Se,Pe]=h.useState(!!localStorage.getItem("user_access_token")),[oe,w]=h.useState(()=>{const y=localStorage.getItem("user_nickname")||"",I=localStorage.getItem("user_email")||"me@example.com",p=localStorage.getItem("user_avatar")||"";return{nickname:y,email:I,avatar:p}}),[B,D]=h.useState(!1),[le,ee]=h.useState(!1),[fe,ie]=h.useState([]),[Ae,Me]=h.useState(!1),[Ve,A]=h.useState({height:"100%",top:0}),[$,Q]=h.useState(0),[re,ce]=h.useState(!0),[be,Ie]=h.useState(!1),pe=h.useRef(null),ge=h.useRef(null),_e=h.useRef(null),[Le,We]=h.useState(0),[ze,$e]=h.useState(!0),[Qe,H]=h.useState(!1),Z=h.useRef(null),v=h.useRef(null),R=()=>{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token"),localStorage.removeItem("user_nickname"),localStorage.removeItem("user_email"),localStorage.removeItem("user_avatar"),C(void 0),d(null),f(null),t(me.HOME),Pe(!1)};if(h.useEffect(()=>{Se&&((async()=>{try{const{authFetch:y}=await de(async()=>{const{authFetch:p}=await import("./http-CAiBnKza.js");return{authFetch:p}},__vite__mapDeps([0,1,2,3])),I=await y("/user/profile");if(I&&I.ok){const p=await I.json(),x=(p==null?void 0:p.nickname)||"",S=(p==null?void 0:p.email)||"me@example.com",ae=(p==null?void 0:p.avatar)||"",q=typeof(p==null?void 0:p.used_count)=="number"?p.used_count:0;w({nickname:x,email:S,avatar:ae,usedCount:q});try{localStorage.setItem("user_nickname",x),localStorage.setItem("user_email",S),ae&&localStorage.setItem("user_avatar",ae);const we=(p==null?void 0:p.id)??(p==null?void 0:p.user_id)??(p==null?void 0:p.uid);we!=null&&localStorage.setItem("user_id",String(we))}catch{}}}catch{}})(),(async()=>{try{const y=await lr({limit:10,offset:0});L(y),We(y.length),$e(y.length===10)}catch{L([]),We(0),$e(!1)}})(),o(!0),cr({limit:10,offset:0}).then(y=>{const I=y.map(p=>({id:String(p.id),name:p.name||"",avatar:p.avatar||"",profileImage:p.profileImage||"",status:Ye.ONLINE,bio:p.bio||"",tags:Array.isArray(p.tags)?p.tags:[],creator:p.creator||"",oneLinePersona:p.oneLinePersona||"",personality:p.personality||"",profession:p.profession||"",age:p.age||"",roleType:p.roleType||"",currentRelationship:p.currentRelationship||"",plotTheme:p.plotTheme||"",plotDescription:p.plotDescription||"",openingLine:p.openingLine||""}));a(I),Q(y.length),ce(y.length===10);try{const p=[],x=localStorage.getItem("user_id")||"0";if(!x||x==="0"){i([]);return}Object.keys(localStorage).filter(q=>q.startsWith(`chat_history_${x}_`)).forEach(q=>{const we=q.replace(`chat_history_${x}_`,""),ue=I.find(qa=>String(qa.id)===String(we));if(!ue)return;const je=localStorage.getItem(q);if(!je)return;const ye=JSON.parse(je);if(!ye.length||!!!localStorage.getItem(`chat_session_${x}_${we}`))return;const kt=ye[ye.length-1],Ga={id:kt.id,senderId:kt.senderId,text:kt.text,timestamp:new Date(kt.ts),type:kt.type};p.push({characterId:String(we),character:ue,lastMessage:Ga,unreadCount:0})}),p.length&&i(p)}catch{}}).catch(()=>a([])).finally(()=>o(!1)),(async()=>{try{const y=await wh(),p=(Array.isArray(y)?y.filter(x=>typeof(x==null?void 0:x.mypage_id)<"u"&&typeof(x==null?void 0:x.mypage_name)=="string"&&typeof(x==null?void 0:x.mypage_visibility)=="string"&&typeof(x==null?void 0:x.mypage_status)=="string"):[]).map(x=>({id:String(x.mypage_id),name:x.mypage_name||"",avatar:x.mypage_avatar||"",profileImage:"",status:Ye.ONLINE,bio:"",tags:[],creator:oe.nickname||"",oneLinePersona:x.mypage_tagline||"",personality:"",profession:"",age:"",roleType:"",gender:"",currentRelationship:"",plotTheme:"",plotDescription:"",openingLine:"",styleExamples:[],hobbies:"",experiences:"",isPublic:x.mypage_visibility?x.mypage_visibility==="public":!1,isPublished:x.mypage_status==="published"}));ie(p)}catch{ie([])}})(),(async()=>{try{const I=(await Eh({includeDrafts:!0})).map(p=>({id:typeof p.id=="number"?p.id:Number(Date.now()),title:p.title||"",description:p.description||"",image:p.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(p.tags)?p.tags:[],author:oe.nickname||"",likes:"0",content:"",status:p.status}));X(I)}catch{X([])}})())},[Se]),h.useEffect(()=>{if(e!==me.HOME||m!=="stories"||!ze||Qe)return;v.current&&(v.current.disconnect(),v.current=null);const y=Z.current;if(!y||O.length<7)return;const I=new IntersectionObserver(p=>{p.some(S=>S.isIntersecting)&&(Qe||(H(!0),(async()=>{try{const S=await lr({limit:10,offset:Le});S.length&&L(ae=>[...ae,...S]),We(ae=>ae+S.length),$e(S.length===10)}catch{}finally{H(!1)}})()))},{threshold:.1,root:_e.current||void 0});return v.current=I,I.observe(y),()=>{try{I.disconnect()}catch{}}},[O,ze,Qe,Le,e,m]),h.useEffect(()=>{if(e!==me.HOME||m!=="characters"||!re||be)return;ge.current&&(ge.current.disconnect(),ge.current=null);const y=pe.current;if(!y||r.length<7)return;const I=new IntersectionObserver(p=>{p.some(S=>S.isIntersecting)&&(be||(Ie(!0),(async()=>{try{const ae=(await cr({limit:10,offset:$})).map(q=>({id:String(q.id),name:q.name||"",avatar:q.avatar||"",profileImage:q.profileImage||"",status:Ye.ONLINE,bio:q.bio||"",tags:Array.isArray(q.tags)?q.tags:[],creator:q.creator||"",oneLinePersona:q.oneLinePersona||"",personality:q.personality||"",profession:q.profession||"",age:q.age||"",roleType:q.roleType||"",currentRelationship:q.currentRelationship||"",plotTheme:q.plotTheme||"",plotDescription:q.plotDescription||"",openingLine:q.openingLine||""}));ae.length&&a(q=>[...q,...ae]),Q(q=>q+ae.length),ce(ae.length===10)}catch{}finally{Ie(!1)}})()))},{threshold:.1,root:_e.current||void 0});return ge.current=I,I.observe(y),()=>{try{I.disconnect()}catch{}}},[r,re,be,$,e,m]),h.useEffect(()=>{if(!((navigator==null?void 0:navigator.maxTouchPoints)>0))return;const I=document.querySelector('meta[name="viewport"]'),p=(I==null?void 0:I.getAttribute("content"))||"";I&&I.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no");let S=0;const ae=q=>{const we=Date.now();we-S<=300&&q.preventDefault(),S=we};return document.addEventListener("touchend",ae,{passive:!1}),document.body.style.touchAction="manipulation",()=>{I&&I.setAttribute("content",p),document.removeEventListener("touchend",ae),document.body.style.touchAction=""}},[]),h.useEffect(()=>{const y=()=>{window.visualViewport&&A({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`})};window.visualViewport&&(window.visualViewport.addEventListener("resize",y),window.visualViewport.addEventListener("scroll",y),y());const I=()=>{window.visualViewport||A({height:window.innerHeight,top:0})};return window.addEventListener("resize",I),()=>{window.visualViewport&&(window.visualViewport.removeEventListener("resize",y),window.visualViewport.removeEventListener("scroll",y)),window.removeEventListener("resize",I)}},[]),h.useEffect(()=>{const y=()=>{const p=window.visualViewport&&window.visualViewport.height?window.visualViewport.height:window.innerHeight;document.documentElement.style.setProperty("--vh",`${p*.01}px`)};y();const I=()=>y();return window.addEventListener("resize",I),window.visualViewport&&window.visualViewport.addEventListener("resize",I),()=>{window.removeEventListener("resize",I),window.visualViewport&&window.visualViewport.removeEventListener("resize",I)}},[]),!Se)return n.jsx(rr,{children:n.jsx("div",{className:"fixed inset-0 w-full bg-primary-50 overflow-hidden",style:{height:"calc(var(--vh) * 100)",overscrollBehavior:"none"},children:n.jsx("div",{className:"h-full w-full max-w-md mx-auto bg relative shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden flex",children:n.jsx(_h,{onLogin:()=>Pe(!0)})})})});const z=y=>{try{const p=`chat_history_${localStorage.getItem("user_id")||"0"}_${y.characterId}`,x=localStorage.getItem(p);if(x){const ae=JSON.parse(x).map(q=>({id:q.id,senderId:q.senderId,text:q.text,timestamp:new Date(q.ts),type:q.type,quote:q.quote,read:q.read}));if(ae.length)return ae}}catch{}return[]},Y=y=>{c&&i(I=>I.map(p=>p.characterId===c.characterId?{...p,lastMessage:y,unreadCount:0}:p))},te=y=>{i(I=>I.map(p=>p.characterId===y?{...p,character:{...p.character,isPinned:!p.character.isPinned}}:p))},Te=async y=>{const I=s.find(p=>p.characterId===y.id);if(I){f(null),Me(!1),d(I),t(me.CHAT);return}try{const p=localStorage.getItem("user_id")||"0",x=`chat_session_${p}_${y.id}`;let S=localStorage.getItem(x)||"";S||(S=(await Zs(y.id)).sessionId,localStorage.setItem(x,S));const ae=y.openingLine||y.oneLinePersona||"",q=`msg_${Date.now()}`,we={id:q,senderId:y.id,text:ae,timestamp:new Date,type:dt.TEXT};try{const je=`chat_history_${p}_${y.id}`,ye={id:q,senderId:y.id,text:ae,ts:Date.now(),type:dt.TEXT};localStorage.setItem(je,JSON.stringify([ye]))}catch{}const ue={characterId:y.id,character:y,lastMessage:we,unreadCount:0};i(je=>[ue,...je]),f(null),Me(!1),d(ue),t(me.CHAT)}catch{const p=y.openingLine||y.oneLinePersona||"",x=`msg_${Date.now()}`,S={id:x,senderId:y.id,text:p,ts:Date.now(),type:dt.TEXT};try{const we=`chat_history_${localStorage.getItem("user_id")||"0"}_${y.id}`;localStorage.setItem(we,JSON.stringify([S]))}catch{}const ae={characterId:y.id,character:y,lastMessage:{id:x,senderId:y.id,text:p,timestamp:new Date,type:dt.TEXT},unreadCount:0};i(q=>[ae,...q]),f(null),Me(!1),d(ae),t(me.CHAT)}},et=y=>{_(!1),W({character:y,id:String(y.id)})},Tt=()=>n.jsxs("div",{className:"flex items-center gap-5",children:[n.jsxs("button",{onClick:()=>g("stories"),className:`relative transition-all duration-300 ${m==="stories"?"text-slate-800 font-extrabold text-2xl scale-105":"text-slate-400 font-semibold text-lg hover:text-slate-600"}`,children:["",m==="stories"&&n.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-1 bg-primary-500 rounded-full"})]}),n.jsx("div",{className:"h-5 w-[1px] bg-slate-300/50 rounded-full"}),n.jsxs("button",{onClick:()=>g("characters"),className:`relative transition-all duration-300 ${m==="characters"?"text-slate-800 font-extrabold text-2xl scale-105":"text-slate-400 font-semibold text-lg hover:text-slate-600"}`,children:["",m==="characters"&&n.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-1 bg-primary-500 rounded-full"})]})]}),Ct=()=>{switch(e){case me.HOME:return n.jsx("div",{className:"px-6 pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:m==="stories"?n.jsxs("div",{className:"space-y-6 mt-2",children:[O.map((y,I)=>n.jsxs("div",{ref:I===O.length-3?p=>{Z.current=p}:void 0,className:"group relative bg-white rounded-3xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer border border-transparent hover:border-primary-100 hover:-translate-y-0.5 duration-200",onClick:async()=>{try{const p=y;if(typeof(p==null?void 0:p.content)=="string"&&p.content.length){const x={id:typeof y.id=="number"?y.id:Number(Date.now()),title:y.title,description:y.description||"",image:y.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(y.tags)?y.tags:[],author:y.author||oe.nickname||"",likes:"0",content:p.content,publishDate:p.publishDate||void 0,status:p.status,availableRoles:Array.isArray(p.availableRoles)?p.availableRoles:[]};N(x)}else{const x=await Ih(y.id),S={id:Number(x.id),title:x.title,description:x.description||"",image:x.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(x.tags)?x.tags:[],author:x.author||"",user_avatar:(x==null?void 0:x.user_avatar)||"",likes:"",content:x.content||"",publishDate:x.publish_date||void 0,availableRoles:Array.isArray(x==null?void 0:x.roles)?x.roles.map(ae=>({id:ae.id,name:ae.name,avatar:"",description:""})):[]};N(S)}}catch{}},children:[n.jsxs("div",{className:"h-40 overflow-hidden relative",children:[n.jsx(ds,{src:y.image||"/uploads/covers/default_storyimg.jpg",alt:y.title,root:_e.current,className:"w-full h-full"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent"}),n.jsx("div",{className:"absolute bottom-4 left-4",children:n.jsx("h3",{className:"text-xl font-bold text-white",children:y.title})})]}),n.jsxs("div",{className:"p-5",children:[n.jsx("p",{className:"text-slate-500 text-sm leading-relaxed mb-4 line-clamp-2",children:y.description}),n.jsx("div",{className:"flex justify-between items-center",children:n.jsx("div",{className:"flex gap-2 flex-wrap",children:(y.tags||[]).map(p=>n.jsxs("span",{className:"text-[10px] font-bold text-primary-600 bg-primary-50 px-2 py-1 rounded-full",children:["#",p]},p))})})]})]},y.id)),!O.length&&n.jsx("div",{className:"text-center text-xs text-slate-400",children:""})]}):n.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[l&&n.jsx("div",{className:"text-center text-xs text-slate-400",children:"..."}),!l&&r.map((y,I)=>{var p;return n.jsxs("div",{ref:I===r.length-3?x=>{pe.current=x}:void 0,className:"bg rounded-2xl p-4 shadow-sm flex gap-4 hover:shadow-md transition-all cursor-pointer border border-transparent hover:border-primary-100",onClick:()=>{D(!1),ee(!1),f(y)},children:[n.jsx(Fh,{char:y,root:_e.current}),n.jsxs("div",{className:"flex-1 flex flex-col justify-between py-1 min-w-0",children:[n.jsxs("div",{children:[n.jsx("div",{className:"flex justify-between items-start",children:n.jsx("h3",{className:"font-bold text-slate-800 text-lg leading-tight",children:y.name})}),n.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2 mb-2",children:(p=y.tags)==null?void 0:p.slice(0,4).map(x=>n.jsx("span",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded-md bg-pink-50 text-pink-500",children:x},x))}),n.jsx("p",{className:"text-xs text-slate-500 line-clamp-2 leading-relaxed mb-2",children:y.oneLinePersona||y.bio})]}),n.jsx("div",{className:"flex items-center justify-end mt-1 border-t border-slate-50 pt-2",children:n.jsxs("div",{className:"text-[10px] text-slate-400",children:["by ",y.creator||""]})})]})]},y.id)}),!l&&r.length===0&&n.jsx("div",{className:"mt-2 text-center",children:n.jsx("p",{className:"text-xs text-slate-300",children:" ~"})})]})});case me.ME:return n.jsx(Dh,{userProfile:oe,myCharacters:r,myUserCharacters:fe,myStories:F,onUpdateProfile:y=>{w(y);try{localStorage.setItem("user_nickname",y.nickname||""),localStorage.setItem("user_email",y.email||"me@example.com"),y.avatar&&localStorage.setItem("user_avatar",y.avatar)}catch{}},onCharacterClick:y=>{D(!1),ee(!0),f(y)},onReadStory:async y=>{try{const I=y;if(typeof(I==null?void 0:I.content)=="string"&&I.content.length){const p={id:typeof y.id=="number"?y.id:Number(Date.now()),title:y.title,description:y.description||"",image:y.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(y.tags)?y.tags:[],author:oe.nickname||"",likes:"0",content:I.content,publishDate:I.publishDate||void 0,status:I.status};N(p)}else{const p=await or(y.id),x=Array.isArray(p==null?void 0:p.characterIds)?p.characterIds:[];let S=[];if(x.length){const q=we=>r.find(ue=>String(ue.id)===String(we))||fe.find(ue=>String(ue.id)===String(we));S=x.map(we=>{const ue=q(we);return ue?{id:we,name:ue.name,avatar:ue.avatar,description:ue.oneLinePersona||ue.bio||""}:null}).filter(Boolean)}const ae={id:Number(p.id),title:p.title,description:p.description||"",image:p.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(p.tags)?p.tags:[],author:oe.nickname||"",user_avatar:(p==null?void 0:p.user_avatar)||"",likes:"0",content:p.content||"",publishDate:(p==null?void 0:p.publishDate)??void 0,status:y.status||void 0,availableRoles:S};N(ae)}}catch{}},onEditStory:y=>{const I={id:typeof y.id=="number"?y.id:Number(Date.now()),title:y.title,description:y.description||"",image:y.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(y.tags)?y.tags:[],author:oe.nickname||"",likes:"0",content:"",status:y.status||void 0,availableRoles:[]};G(I),T(!0),(async()=>{try{const p=await or(y.id),x=Array.isArray(p==null?void 0:p.characterIds)?p.characterIds:[];let S=[];try{const{authFetch:ue}=await de(async()=>{const{authFetch:ye}=await import("./http-CAiBnKza.js");return{authFetch:ye}},__vite__mapDeps([0,1,2,3])),je=await ue("/stories/combine");if(je&&je.ok){const ye=await je.json();S=Array.isArray(ye==null?void 0:ye.items)?ye.items:[]}}catch{}he(S.map(ue=>({id:String(ue.character_id),name:ue.character_name,avatar:ue.character_avatar||"",desc:ue.desc||"",isPrivate:!!ue.isPrivate,isMine:!!ue.isMine})));const ae=ue=>{const je=S.find(ye=>String(ye.character_id)===String(ue));return je?{id:ue,name:je.character_name,avatar:je.character_avatar||"",description:je.desc||""}:null};let q=x.map(ae).filter(Boolean);if(!q.length){const ue=je=>r.find(ye=>String(ye.id)===String(je))||fe.find(ye=>String(ye.id)===String(je));q=x.map(je=>{const ye=ue(je);return ye?{id:je,name:ye.name,avatar:ye.avatar,description:ye.oneLinePersona||ye.bio||""}:null}).filter(Boolean)}const we={id:Number(p.id),title:p.title,description:p.description||"",image:p.image||"/uploads/covers/default_storyimg.jpg",tags:Array.isArray(p.tags)?p.tags:[],author:oe.nickname||"",likes:"0",content:p.content||"",publishDate:(p==null?void 0:p.publishDate)??void 0,status:y.status||void 0,availableRoles:q,...x&&{characterIds:x}};G(we)}catch{}})()},onEditCharacter:y=>{V({initial:y,id:y.id,isEdit:!0}),_(!0)},onDeleteCharacter:y=>{ie(I=>I.filter(p=>p.id!==y.id)),a(I=>I.filter(p=>p.id!==y.id))},onAddCharacter:()=>{V(null),_(!0)},onAddStory:()=>{G(null),T(!0),(async()=>{try{const{authFetch:y}=await de(async()=>{const{authFetch:p}=await import("./http-CAiBnKza.js");return{authFetch:p}},__vite__mapDeps([0,1,2,3])),I=await y("/stories/combine");if(I&&I.ok){const p=await I.json(),x=Array.isArray(p==null?void 0:p.items)?p.items:[];he(x.map(S=>({id:String(S.character_id),name:S.character_name,avatar:S.character_avatar||"",desc:S.desc||"",isPrivate:!!S.isPrivate,isMine:!!S.isMine})))}else he([])}catch{he([])}})()},onLogout:R});case me.CHAT:default:return n.jsx(n.Fragment,{children:(!c||Ae)&&n.jsx(oh,{chats:s,onChatClick:y=>{Me(!0),d(y)},onTogglePin:te,onDeleteChat:y=>{i(p=>p.filter(x=>x.characterId!==y));const I=localStorage.getItem("user_id")||"0";localStorage.removeItem(`chat_session_${I}_${y}`),localStorage.removeItem(`chat_history_${I}_${y}`),(c==null?void 0:c.characterId)===y&&d(null)},isDetailOpen:Ae&&!!c})})}};return n.jsx(rr,{children:n.jsx("div",{className:"fixed inset-0 w-full bg-primary-50 overflow-hidden",style:{...Ve,overscrollBehavior:"none",position:"fixed"},children:n.jsxs("div",{className:"h-full w-full max-w-md mx-auto bg relative shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden flex flex-col",children:[E&&n.jsx(kh,{onBack:()=>{_(!1),V(null)},onCreate:et,isEdit:!!(k!=null&&k.isEdit),characterId:k==null?void 0:k.id,initial:k==null?void 0:k.initial,onUpdated:y=>{_(!1),V(null),f(y)},onSaveDraft:y=>{_(!1),V(null),ie(I=>Qt(I,y)),t(me.ME)}}),j&&n.jsx(Wa,{currentPersona:P,onBack:()=>b(!1),onSave:y=>C(y)}),U&&n.jsx(Ah,{onBack:()=>{T(!1),G(null)},onPublish:y=>{L(I=>Qt(I,y)),X(I=>Qt(I,y)),T(!1),G(null)},onSaveDraft:y=>{X(I=>Qt(I,y)),T(!1),G(null)},availableCharacters:r,myUserCharacters:fe,initialStory:se||void 0,importableRoles:ne}),n.jsx(vt,{initial:!1,children:c&&!j&&!E&&n.jsx(vh,{character:c.character,initialMessages:z(c),userPersona:P,onBack:()=>{d(null),Me(!1)},onUpdateLastMessage:Y,onOpenUserSettings:()=>b(!0),onUpdateUserPersona:y=>C(y),onShowProfile:()=>{D(!0),ee(!1),W(null),f(c.character)}})}),n.jsx(vt,{initial:!1,children:u&&!j&&!E&&!M&&(le?n.jsx(ar,{character:u,createdId:u.id,onBack:()=>f(null),onStartChat:y=>Te(y)}):n.jsx(bh,{character:u,onBack:()=>f(null),onStartChat:()=>Te(u),isFromChat:B,isExistingChat:!!s.find(y=>y.characterId===u.id)}))}),M&&!j&&!E&&n.jsx(ar,{character:M.character,createdId:M.id,onBack:()=>W(null),onStartChat:y=>{W(null),Te(y)}}),K&&n.jsx(Vh,{story:K,onBack:()=>N(null),connectedRoleNames:s.map(y=>y.character.name),validRoleNames:(K.availableRoles||[]).map(y=>y.name),onStartRoleplay:y=>{N(null);const I=y==null?void 0:y.id;let p;if(I!=null&&(p=r.find(x=>String(x.id)===String(I))||fe.find(x=>String(x.id)===String(I))),!p){const x=(y==null?void 0:y.name)||"";p=r.find(S=>S.name===x)||fe.find(S=>S.name===x)}p&&(f(p),D(!1),ee(!1),(async()=>{try{if(!!fe.find(S=>String(S.id)===String(p.id))){const S=await Ut(p.id),ae={id:String(p.id),name:(S==null?void 0:S.name)||p.name,avatar:(S==null?void 0:S.avatar)||p.avatar||"",profileImage:p.profileImage||"",status:Ye.ONLINE,bio:(S==null?void 0:S.tagline)||"",tags:Array.isArray(S==null?void 0:S.tags)?S.tags:[],creator:oe.nickname||"",oneLinePersona:(S==null?void 0:S.tagline)||"",personality:(S==null?void 0:S.personality)||"",profession:(S==null?void 0:S.occupation)||"",age:S!=null&&S.age?String(S.age):"",roleType:"",gender:(S==null?void 0:S.gender)||"",currentRelationship:(S==null?void 0:S.relationship)||"",plotTheme:(S==null?void 0:S.plot_theme)||"",plotDescription:(S==null?void 0:S.plot_summary)||"",openingLine:(S==null?void 0:S.opening_line)||"",styleExamples:Array.isArray(S==null?void 0:S.styleExamples)?S.styleExamples:[],hobbies:(S==null?void 0:S.hobbies)||"",experiences:(S==null?void 0:S.experiences)||"",isPublic:String((S==null?void 0:S.visibility)||"")==="public",isPublished:String((S==null?void 0:S.status)||"")==="published"};f(ae)}else{const S=await dr(p.id),ae={id:String(S.id),name:S.name||p.name,avatar:S.avatar||p.avatar||"",profileImage:S.profileImage||p.profileImage||"",status:Ye.ONLINE,bio:S.bio||"",tags:Array.isArray(S.tags)?S.tags:[],creator:S.creator||"",oneLinePersona:S.oneLinePersona||"",personality:S.personality||"",profession:S.profession||S.occupation||"",age:S.age||"",roleType:S.roleType||"",currentRelationship:S.currentRelationship||S.relationship||"",plotTheme:S.plotTheme||S.plot_theme||"",plotDescription:S.plotDescription||S.plot_summary||"",openingLine:S.openingLine||""};f(ae)}}catch{}})()),!p&&I!=null&&(async()=>{try{const x=await dr(I),S={id:String(x.id),name:x.name||"",avatar:x.avatar||"",profileImage:x.profileImage||"",status:Ye.ONLINE,bio:x.bio||"",tags:Array.isArray(x.tags)?x.tags:[],creator:x.creator||"",oneLinePersona:x.oneLinePersona||"",personality:x.personality||"",profession:x.profession||x.occupation||"",age:x.age||"",roleType:x.roleType||"",currentRelationship:x.currentRelationship||x.relationship||"",plotTheme:x.plotTheme||x.plot_theme||"",plotDescription:x.plotDescription||x.plot_summary||"",openingLine:x.openingLine||""};f(S),D(!1),ee(!1);return}catch{}try{const x=await Ut(I),S={id:String(I),name:(x==null?void 0:x.name)||"",avatar:(x==null?void 0:x.avatar)||"",profileImage:"",status:Ye.ONLINE,bio:(x==null?void 0:x.tagline)||"",tags:Array.isArray(x==null?void 0:x.tags)?x.tags:[],creator:oe.nickname||"",oneLinePersona:(x==null?void 0:x.tagline)||"",personality:(x==null?void 0:x.personality)||"",profession:(x==null?void 0:x.occupation)||"",age:x!=null&&x.age?String(x.age):"",roleType:"",gender:(x==null?void 0:x.gender)||"",currentRelationship:(x==null?void 0:x.relationship)||"",plotTheme:(x==null?void 0:x.plot_theme)||"",plotDescription:(x==null?void 0:x.plot_summary)||"",openingLine:(x==null?void 0:x.opening_line)||"",styleExamples:Array.isArray(x==null?void 0:x.styleExamples)?x.styleExamples:[],hobbies:(x==null?void 0:x.hobbies)||"",experiences:(x==null?void 0:x.experiences)||"",isPublic:String((x==null?void 0:x.visibility)||"")==="public",isPublished:String((x==null?void 0:x.status)||"")==="published"};f(S),D(!1),ee(!1)}catch{}})()}}),!j&&!E&&n.jsxs(n.Fragment,{children:[n.jsx(rh,{title:e===me.HOME?Tt():e===me.CHAT?"":"",variant:e===me.ME?"overlay":"default",onFilterClick:()=>{e===me.HOME&&(m==="characters"?_(!0):m==="stories"&&(G(null),he([]),T(!0),(async()=>{try{const{authFetch:y}=await de(async()=>{const{authFetch:p}=await import("./http-CAiBnKza.js");return{authFetch:p}},__vite__mapDeps([0,1,2,3])),I=await y("/stories/combine");if(I&&I.ok){const p=await I.json(),x=Array.isArray(p==null?void 0:p.items)?p.items:[];he(x.map(S=>({id:String(S.character_id),name:S.character_name,avatar:S.character_avatar||"",desc:S.desc||"",isPrivate:!!S.isPrivate,isMine:!!S.isMine})))}}catch{}})()))},showAdd:e===me.HOME}),n.jsx(vt,{initial:!1,children:n.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar scroll-smooth min-h-0",ref:_e,children:Ct()})}),n.jsx(ah,{activeTab:e,onTabChange:t})]})]})})})},Qt=(e,t)=>[t,...e.filter(s=>String(s.id)!==String(t.id))],Hh=Object.freeze(Object.defineProperty({__proto__:null,default:Oh},Symbol.toStringTag,{value:"Module"}));export{Hh as A,ch as B};
//# sourceMappingURL=App-C4oQNirj.js.map
