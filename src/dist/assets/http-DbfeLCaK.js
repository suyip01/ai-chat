import{B as _}from"./App-BM-CUHVr.js";import"./index-Cs440zri.js";import"./x-B1Ttng-s.js";const f=()=>localStorage.getItem("user_access_token")||"",u=()=>localStorage.getItem("user_refresh_token")||"",m=e=>{e&&localStorage.setItem("user_access_token",e)},y=async(e,r={})=>{const a=e.startsWith("http")?e:`${_}${e.startsWith("/")?"":"/"}${e}`,c=new Headers(r.headers||{}),n=f();n&&c.set("Authorization",`Bearer ${n}`);const o=await fetch(a,{...r,headers:c});if(o.status!==401)return o;const h=u();if(!h){try{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token")}catch{}try{window.location.reload()}catch{}return o}try{const s=await fetch(`${_}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:h})});if(s.ok){const t=await s.json();t!=null&&t.access_token&&m(t.access_token);const l=new Headers(r.headers||{});l.set("Authorization",`Bearer ${t.access_token}`);const i=await fetch(a,{...r,headers:l});if(i.status===401){try{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token")}catch{}try{window.location.reload()}catch{}}return i}if(s.status===401){try{localStorage.removeItem("user_access_token"),localStorage.removeItem("user_refresh_token")}catch{}try{window.location.reload()}catch{}}}catch{}return o};export{y as authFetch};
//# sourceMappingURL=http-DbfeLCaK.js.map
