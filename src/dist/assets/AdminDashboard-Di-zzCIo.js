import{j as e,r as l}from"./index-K62UU2ZA.js";import{c as D,L as ze,U as Ie,C as Je,a as Pe,b as Ye,d as oe,X as ee,P as X,I as $e,e as Ee,T as ie,f as Xe,S as Ze}from"./x-B4KpKeGX.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],We=D("archive",Ke);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],et=D("bot",Qe);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],he=D("circle-question-mark",tt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],at=D("cloud-upload",st);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Le=D("copy",nt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],rt=D("database",lt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ue=D("file-text",ot);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],fe=D("pen-line",it);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ke=D("refresh-cw",ct);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],xt=D("rotate-cw",dt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],se=D("save",mt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ht=D("search",pt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],gt=D("settings",ut);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],bt=D("shield",ft);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],ce=D("sparkles",yt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],vt=D("star",jt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],kt=D("user-cog",wt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],St=D("users",Nt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],me=D("wand-sparkles",Ct);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Tt=D("zoom-in",_t);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],zt=D("zoom-out",Mt),le="/api/admin",It=()=>localStorage.getItem("admin_access_token")||"",Pt=()=>localStorage.getItem("admin_refresh_token")||"",$t=(t,r)=>{t&&localStorage.setItem("admin_access_token",t),r&&localStorage.setItem("admin_refresh_token",r)},ge=()=>{localStorage.removeItem("admin_access_token"),localStorage.removeItem("admin_refresh_token");const t="/super-admin/login";typeof window<"u"&&window.location&&(typeof window.location.replace=="function"?window.location.replace(t):window.location.href=t)},Ne=()=>({Authorization:`Bearer ${It()}`});let re=null;const Et=async()=>{const t=Pt();if(!t)throw ge(),new Error("unauthorized");const r=await fetch(`${le}/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t})});if(!r.ok)throw ge(),new Error("refresh_failed");const d=await r.json();return $t(d.access_token,d.refresh_token),d},P=async(t,r={})=>{const d={...r},o=typeof FormData<"u"&&d.body instanceof FormData,s=Ne(),i=o?{}:{"Content-Type":"application/json"};d.headers={...d.headers||{},...i,...s};let p=await fetch(`${le}${t}`,d);if(p.status===401){re||(re=Et());try{await re}finally{re=null}const x=Ne(),h=o?{}:{"Content-Type":"application/json"};if(d.headers={...d.headers||{},...h,...x},p=await fetch(`${le}${t}`,d),p.status===401)throw ge(),new Error("unauthorized")}if(!p.ok)throw new Error("failed");if(!p.ok){let x="";try{x=await p.text()}catch{}throw console.error("[admin.api.request] failed",{path:t,status:p.status,body:x}),new Error("failed")}return p.json()},Q={async list(){return P("/templates")},async create(t){return P("/templates",{method:"POST",body:JSON.stringify(t)})},async update(t,r){return P(`/templates/${t}`,{method:"PUT",body:JSON.stringify(r)})},async remove(t){return P(`/templates/${t}`,{method:"DELETE"})},async copy(t){return P(`/templates/${t}/copy`,{method:"POST"})},async setDefault(t){return P(`/templates/${t}/default`,{method:"POST"})}},ae={async list(t){const r=t?"?"+new URLSearchParams(t).toString():"";return P(`/characters${r}`)},async get(t){return P(`/characters/${t}`)},async create(t){return P("/characters",{method:"POST",body:JSON.stringify(t)})},async update(t,r){return P(`/characters/${t}`,{method:"PUT",body:JSON.stringify(r)})},async remove(t){return P(`/characters/${t}`,{method:"DELETE"})},async setStatus(t,r){return P(`/characters/${t}/status`,{method:"POST",body:JSON.stringify({status:r})})}},ne={async list(){return P("/models")},async create(t){return P("/models",{method:"POST",body:JSON.stringify(t)})},async remove(t){return P(`/models/${t}`,{method:"DELETE"})}},Se={async get(){return P("/settings")},async save(t){return P("/settings",{method:"PUT",body:JSON.stringify(t)})}},Ce={async generate(t){return P("/sysprompt/generate",{method:"POST",body:JSON.stringify(t)})},async generateNoScene(t){return P("/sysprompt/generate-noscene",{method:"POST",body:JSON.stringify(t)})}},Ae={async avatar(t){const r=new FormData;return r.append("avatar",t),P("/uploads/avatar",{method:"POST",body:r})}},te={async list(t){const r=t?`?q=${encodeURIComponent(t)}`:"";return P(`/users${r}`)},async create({username:t,nickname:r,email:d,password:o,chatLimit:s}){return P("/users",{method:"POST",body:JSON.stringify({username:t,nickname:r,email:d,password:o,chatLimit:s})})},async update(t,r){return P(`/users/${t}`,{method:"PUT",body:JSON.stringify(r)})},async remove(t){return P(`/users/${t}`,{method:"DELETE"})},async changePassword(t,r){return P(`/users/${t}/password`,{method:"POST",body:JSON.stringify({password:r})})}},Y={async list(t){const r=t?`?q=${encodeURIComponent(t)}`:"";return P(`/admins${r}`)},async create({username:t,email:r,password:d}){return P("/admins",{method:"POST",body:JSON.stringify({username:t,email:r,password:d})})},async update(t,r){return P(`/admins/${t}`,{method:"PUT",body:JSON.stringify(r)})},async remove(t){return P(`/admins/${t}`,{method:"DELETE"})},async changePassword(t,r){return P(`/admins/${t}/password`,{method:"POST",body:JSON.stringify({password:r})})},async getMyAvatar(){return P("/admins/me/avatar")},async updateMe(t){return P("/admins/me",{method:"PUT",body:JSON.stringify(t)})}},_e=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Varela+Round&display=swap');
    body { font-family: 'Varela Round', 'PingFang SC', sans-serif; background-color: #FFFFFF; color: #4A4060; }
    .font-cute { font-family: 'ZCOOL KuaiLe', cursive; }
    .glass-card { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.9); box-shadow: 0 8px 30px rgba(236, 72, 153, 0.08); }
    .solid-card { background: #FFFFFF; border: 1px solid #FCE7F3; box-shadow: 0 4px 20px rgba(236, 72, 153, 0.05); }
    .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); border-right: 1px solid rgba(255, 255, 255, 0.5); }
    .dream-input { background: rgba(255, 255, 255, 0.6); border: 2px solid #FCE7F3; transition: all 0.3s ease; color: #5D5476; }
    .dream-input:focus { background: #FFFFFF; border-color: #F472B6; outline: none; box-shadow: 0 0 0 4px rgba(244, 114, 182, 0.15); }
    .tag-pill { background: linear-gradient(135deg, #FBCFE8 0%, #FCE7F3 100%); color: #BE185D; font-weight: 700; font-size: 0.75rem; border-radius: 8px; }
    .tag-select-btn { background: #FCE7F3; color: #BE185D; border: 1px solid transparent; border-radius: 20px; font-weight: bold; font-size: 0.85rem; padding: 8px 10px; transition: all 0.2s; white-space: nowrap; }
    .tag-select-btn.active { background: #EC4899; color: white; border-color: #DB2777; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3); }
    .ambient-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(at 0% 0%, hsla(330, 70%, 98%, 1) 0, transparent 50%), radial-gradient(at 50% 100%, hsla(330, 85%, 95%, 1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(330, 80%, 97%, 1) 0, transparent 50%); background-size: 200% 200%; animation: gradientMove 15s ease infinite; }
    @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.02); }
    ::-webkit-scrollbar-thumb { background: #FBCFE8; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #F472B6; }
    .glass-card p, .glass-card h4, .glass-card li, .glass-card ul { color: #4A4060; }
    .solid-card p, .solid-card h4, .solid-card li, .solid-card ul { color: #4A4060; }
  `}),Oe=l.createContext(null),Z=()=>l.useContext(Oe),K=({children:t})=>{const[r,d]=l.useState([]),o=l.useCallback((s,i="success")=>{const p=Date.now()+Math.random();d(x=>[...x,{id:p,message:s,type:i}]),setTimeout(()=>{d(x=>x.filter(h=>h.id!==p))},3e3)},[]);return e.jsxs(Oe.Provider,{value:{showToast:o},children:[t,e.jsx("div",{className:"fixed top-6 left-64 right-0 z-50 flex flex-col items-center gap-3 pointer-events-none",children:r.map(s=>e.jsx("div",{className:`pointer-events-auto flex items-center justify-center text-center px-4 py-2 rounded-2xl shadow-xl border max-w-[480px] min-w-[180px] mx-auto ${s.type==="success"?"bg-white border-green-200 text-green-700":"bg-white border-red-200 text-red-700"}`,children:s.message},s.id))})]})},Lt=({onLogin:t})=>{const[r,d]=l.useState(""),[o,s]=l.useState(""),{showToast:i}=Z(),p=async()=>{try{const y=(await(await fetch(`${le}/crypto/public-key`)).text()).replace(/-----BEGIN PUBLIC KEY-----/,"").replace(/-----END PUBLIC KEY-----/,"").replace(/\s+/g,""),N=Uint8Array.from(atob(y),c=>c.charCodeAt(0)),j=await window.crypto.subtle.importKey("spki",N.buffer,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]),M=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},j,new TextEncoder().encode(o)),_=btoa(String.fromCharCode(...new Uint8Array(M))),f=await fetch(`${le}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password_encrypted:_})});if(!f.ok){i("登录失败","error");return}const u=await f.json();u!=null&&u.access_token&&localStorage.setItem("admin_access_token",u.access_token),u!=null&&u.refresh_token&&localStorage.setItem("admin_refresh_token",u.refresh_token),localStorage.setItem("admin_username",r),t()}catch{i("登录失败","error")}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"ambient-bg"}),e.jsxs("div",{className:"glass-card p-10 rounded-3xl w-full max-w-md shadow-2xl transform transition-all hover:scale-[1.01]",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-pink-100 text-pink-600 mb-4 shadow-inner",children:e.jsx(ce,{size:32})}),e.jsx("h1",{className:"text-3xl font-cute text-pink-900 mb-2",children:"Linkusrge"}),e.jsx("p",{className:"text-pink-400 text-sm",children:"运营管理平台"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-pink-800 mb-2 ml-1",children:"管理员账号"}),e.jsx("input",{type:"text",placeholder:"请输入管理员账号",value:r,onChange:x=>d(x.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-pink-800 mb-2 ml-1",children:"密码"}),e.jsx("input",{type:"password",placeholder:"••••••••",value:o,onChange:x=>s(x.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl"})]}),e.jsxs("button",{onClick:p,className:"w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white font-bold py-3.5 rounded-2xl shadow-lg shadow-pink-200 transition-all transform active:scale-95 flex items-center justify-center gap-2",children:[e.jsx(ze,{size:18,className:"rotate-180"})," 登录后台"]})]})]})]})},At=({activeTab:t,setActiveTab:r,onLogout:d,username:o,onEditProfile:s})=>{const[i,p]=l.useState(["characters","settings"]),x=[{id:"templates",label:"提示词模版",icon:ue},{id:"characters",label:"角色管理",icon:St,subItems:[{id:"official_characters",label:"官方角色",icon:et},{id:"user_characters",label:"用户角色",icon:Ie}]},{id:"users",label:"用户管理",icon:kt},{id:"settings",label:"系统设置",icon:gt,subItems:[{id:"model_settings",label:"模型设置",icon:Je},...o==="admin"?[{id:"model_manage",label:"模型管理",icon:rt},{id:"admin_accounts",label:"管理员账号",icon:bt}]:[]]}];l.useEffect(()=>{const a=x.find(g=>{var z;return(z=g.subItems)==null?void 0:z.some(A=>A.id===t)});a&&p(g=>g.includes(a.id)?g:[...g,a.id])},[t]);const h=a=>{p(g=>g.includes(a)?g.filter(z=>z!==a):[...g,a])},y=a=>{p(g=>g.includes(a)?g:[...g,a])},N=a=>{var A;const g=x.find(O=>O.id===a);((A=g==null?void 0:g.subItems)==null?void 0:A.some(O=>O.id===t))||p(O=>O.filter(b=>b!==a))},j=a=>{a.subItems?h(a.id):(r(a.id),p([]))},[M,_]=l.useState(!1),[f,u]=l.useState(""),[c,$]=l.useState(""),[k,S]=l.useState(""),T=async()=>{const a={};if(f&&f.trim()&&(a.nickname=f.trim()),c){if(c!==k)return;a.password=c}try{await Y.updateMe(a),_(!1),u(""),$(""),S("")}catch{}};return e.jsxs("div",{className:"w-16 xl:w-56 glass-nav h-screen fixed left-0 top-0 flex flex-col z-20 transition-all duration-300",style:{backgroundColor:"#f4f6fb"},children:[e.jsxs("div",{className:"p-4 xl:p-8 flex items-center justify-center xl:justify-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-pink-500 rounded-lg flex items-center justify-center text-white flex-shrink-0",children:e.jsx(ce,{size:18})}),e.jsx("span",{className:"text-xl font-cute text-pink-900 tracking-wide hidden xl:block",children:"Linksurge Admin"})]}),e.jsx("nav",{className:"flex-1 px-4 space-y-2",children:x.map(a=>e.jsxs("div",{onMouseEnter:()=>a.subItems&&y(a.id),onMouseLeave:()=>a.subItems&&N(a.id),children:[e.jsxs("button",{onClick:()=>j(a),className:`w-full flex items-center justify-center xl:justify-start gap-3 px-2 xl:px-4 py-3.5 rounded-2xl transition-all duration-300 font-bold text-sm ${t===a.id||a.subItems&&a.subItems.some(g=>g.id===t)?"bg-pink-100 text-pink-700 shadow-sm":"text-gray-500 hover:bg-white/50 hover:text-pink-600"}`,children:[e.jsx(a.icon,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"hidden xl:block flex-1 text-left",children:a.label}),a.subItems&&e.jsx("span",{className:"hidden xl:block transition-transform duration-300",children:i.includes(a.id)?e.jsx(Pe,{size:14}):e.jsx(Ye,{size:14})})]}),a.subItems&&e.jsx("div",{className:`grid transition-all duration-300 ease-in-out ${i.includes(a.id)?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"mt-1 space-y-1 xl:pl-4",children:a.subItems.map(g=>e.jsxs("button",{onClick:z=>{z.stopPropagation(),r(g.id)},className:`w-full flex items-center justify-center xl:justify-start gap-2 px-2 xl:px-4 py-2.5 rounded-xl transition-all duration-300 text-xs font-bold ${t===g.id?"bg-pink-200/50 text-pink-800":"text-gray-400 hover:text-pink-600 hover:bg-white/30"}`,children:[g.icon?e.jsx(g.icon,{size:16,className:"flex-shrink-0 hidden xl:block"}):e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-current flex-shrink-0 hidden xl:block"}),e.jsx("span",{className:"hidden xl:block",children:g.label}),e.jsx("span",{className:"xl:hidden",children:g.icon?e.jsx(g.icon,{size:14}):g.label.substring(0,1)})]},g.id))})})})]},a.id))}),e.jsx("div",{className:"p-4 border-t border-pink-100",children:e.jsxs("div",{className:"w-full flex xl:flex-row flex-col items-center xl:justify-start justify-center gap-3",children:[e.jsxs("div",{className:"group relative",onClick:()=>s&&s(),children:[e.jsx(Ot,{username:o}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -translate-y-full -top-2 bg-pink-700 text-white text-xs px-2 py-1 rounded shadow opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-50",children:o})]}),e.jsxs("button",{onClick:d,className:"w-full xl:flex-1 flex items-center justify-center xl:justify-start gap-3 px-2 xl:px-4 py-3 text-red-400 hover:bg-red-50 rounded-2xl transition-colors font-bold text-sm",children:[e.jsx(ze,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"hidden xl:block",children:"退出登录"})]})]})}),M&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-96 shadow-2xl",children:[e.jsx("div",{className:"font-bold mb-4 text-pink-900",children:"修改资料"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:`昵称（当前：${o}）`,value:f,onChange:a=>u(a.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"新密码",value:c,onChange:a=>$(a.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"再次输入新密码",value:k,onChange:a=>S(a.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-5",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{_(!1),u(""),$(""),S("")},children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:T,disabled:!f.trim()&&!c,children:"保存"})]})]}),e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-[1px] bg-slate-300"})]})]})},Ot=({username:t})=>{const[r,d]=l.useState("");return l.useEffect(()=>{let o=!0;return Y.getMyAvatar().then(s=>{o&&d((s==null?void 0:s.avatar)||"/uploads/avatars/default_admin.jpg")}).catch(()=>{o&&d("/uploads/avatars/default_admin.jpg")}),()=>{o=!1}},[t]),e.jsx("div",{className:"group relative w-8 h-8 rounded-full overflow-hidden border border-pink-200 bg-white flex items-center justify-center",children:r?e.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover"}):e.jsx(Ie,{size:16,className:"text-pink-500"})})},Ft=({onCancel:t,initialData:r,onSave:d,notify:o})=>{const[s,i]=l.useState({name:"",type:"恋爱",customType:"",tags:[],content:""}),[p,x]=l.useState(""),[h,y]=l.useState(!1),N=["恋爱","玄幻","悬疑","职场","科幻","同人"];l.useEffect(()=>{r&&(i({name:r.name||"",type:r.type||"恋爱",customType:"",tags:r.tags||[],content:r.content||""}),y(!1))},[r]);const j=u=>{u.key==="Enter"&&p.trim()&&(u.preventDefault(),s.tags.includes(p.trim())||i(c=>({...c,tags:[...c.tags,p.trim()]})),x(""))},M=u=>{const c=[...s.tags];c.splice(u,1),i($=>({...$,tags:c}))},_=u=>{y(!1),i(c=>({...c,type:u}))},f=()=>{if(!s.name.trim()){typeof o=="function"&&o("保存失败：请输入模版名称","error");return}const u={id:r==null?void 0:r.id,name:s.name.trim(),type:h&&s.customType.trim()||s.type,tags:s.tags,content:s.content,refCount:(r==null?void 0:r.refCount)??0,creator:(r==null?void 0:r.creator)??"Admin"};try{d&&d(u)}catch{typeof o=="function"&&o("保存失败：请稍后重试","error")}};return e.jsxs("div",{className:"animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(oe,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:r?"编辑提示词模版":"新建提示词模版"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"定义基础 Prompt 框架"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:t,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:f,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text白 font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(se,{size:16})," 保存模版"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:[e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 模版基础信息"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版名称"}),e.jsx("input",{type:"text",value:s.name,onChange:u=>i({...s,name:u.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700 bg-gray-50/50 focus:bg-white",placeholder:"例如：病娇反派通用模版"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版类型"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[N.map(u=>e.jsx("button",{onClick:()=>_(u),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all cute-font tracking-wide border ${!h&&s.type===u?"bg-pink-500 text白 border-pink-500 shadow-md shadow-pink-200":"bg白 text灰-500 border-gray-100 hover:border-pink-200"}`,children:u},u)),e.jsx("button",{onClick:()=>y(!0),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all cute-font tracking-wide border ${h?"bg-pink-500 text白 border-pink-500 shadow-md shadow-pink-200":"bg白 text灰-500 border-gray-100 hover:border-pink-200"}`,children:"自定义..."})]}),h&&e.jsx("div",{className:"animate-fade-in mt-2",children:e.jsx("input",{type:"text",value:s.customType,onChange:u=>i({...s,customType:u.target.value}),placeholder:"请输入自定义类型名称",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"模版标签 (回车生成)"}),e.jsxs("div",{className:"dream-input w-full px-4 py-3 rounded-xl min-h-[50px] flex flex-wrap gap-2 items-center bg-gray-50/50 focus-within:bg-white",children:[s.tags.map((u,c)=>e.jsxs("span",{className:"tag-pill px-3 py-1 flex items-center shadow-sm gap-1",children:["#",u," ",e.jsx("button",{onClick:()=>M(c),className:"hover:text-red-500 opacity-60 hover:opacity-100 transition-opacity",children:e.jsx(ee,{size:12})})]},c)),e.jsx("input",{value:p,onChange:u=>x(u.target.value),onKeyDown:j,type:"text",className:"bg-transparent outline-none text-sm w-40 placeholder-gray-400 h-8",placeholder:"输入标签按回车..."})]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-4",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," Prompt 内容配置"]}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{rows:"15",value:s.content,onChange:u=>i({...s,content:u.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-600 bg-gray-50/50 focus:bg-white resize-y",placeholder:`在此输入系统提示词框架（System Instruction）...
可以使用 {'{{user}}'} 和 {'{{name}}'} 作为占位符。`})})]})]}),e.jsx("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:e.jsxs("div",{className:"solid-card p-6 rounded-3xl bg-gradient-to-br from-pink-500 to-pink-600 text白 shadow-xl shadow-pink-200/50",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2 text-lg font-cute",children:[e.jsx(ce,{size:18,className:"text-yellow-300"})," 编写指南"]}),e.jsxs("ul",{className:"space-y-3 text-sm opacity-90 leading-relaxed list-disc list-inside",children:[e.jsxs("li",{children:["使用 ",e.jsx("b",{children:"{{name}}"})," 代表角色姓名。"]}),e.jsxs("li",{children:["使用 ",e.jsx("b",{children:"{{user}}"})," 代表用户昵称。"]}),e.jsxs("li",{children:["建议明确规定角色的",e.jsx("b",{children:"说话风格"}),"、",e.jsx("b",{children:"禁忌事项"}),"以及",e.jsx("b",{children:"背景设定"}),"。"]})]})]})})]})]})},Rt=()=>{const[t,r]=l.useState("list"),[d,o]=l.useState([]),[s,i]=l.useState(1),p=6,[x,h]=l.useState(null),[y,N]=l.useState(null),{showToast:j}=Z(),M=async()=>{try{const b=await Q.list();o(b.items||[])}catch{j("加载失败：请稍后再试","error")}};l.useEffect(()=>{M()},[]);const _=[...d].sort((b,L)=>{if(b.isDefault&&!L.isDefault)return-1;if(!b.isDefault&&L.isDefault)return 1;const U=b.createdAt?new Date(b.createdAt).getTime():0,C=L.createdAt?new Date(L.createdAt).getTime():0;return U-C}),f=Math.max(1,Math.ceil(_.length/p)),u=(s-1)*p,c=_.slice(u,u+p);l.useEffect(()=>{s>f&&i(f)},[d]);const $=b=>{if(!b)return"-";const L=new Date(b),U=L.getFullYear(),C=String(L.getMonth()+1).padStart(2,"0"),m=String(L.getDate()).padStart(2,"0"),V=String(L.getHours()).padStart(2,"0"),R=String(L.getMinutes()).padStart(2,"0");return`${U}/${C}/${m} ${V}:${R}`},k=async b=>{try{await Q.setDefault(b),j("已设为默认"),M()}catch{j("操作失败","error")}},S=b=>{h(b),r("create")},T=b=>{const L={...b,id:void 0,name:`${b.name}_copy`};h(L),r("create"),j("复制成功，已进入编辑")},a=async b=>{try{await Q.remove(b)}catch{throw new Error("failed")}},g=b=>N(b),z=()=>N(null),A=async()=>{if(y)try{await a(y.id),j("删除成功"),M()}catch{j("删除失败","error")}finally{z()}},O=async b=>{try{x&&x.id?(await Q.update(x.id,b),j("保存成功：模版已更新")):(await Q.create(b),j("创建成功：模版已保存")),h(null),r("list"),M()}catch{j("保存失败：请稍后重试","error")}};return t==="create"?e.jsx(Ft,{onCancel:()=>{h(null),r("list")},initialData:x,onSave:O,notify:j}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"提示词模版库"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"管理用于生成角色的基础 Prompt"})]}),e.jsxs("button",{onClick:()=>{h(null),r("create")},className:"bg-pink-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(X,{size:16})," 新建模版"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-pink-50 p-4 rounded-2xl border border-pink-100 text-sm text-pink-700",children:[e.jsx($e,{size:18,className:"flex-shrink-0 text-pink-500"}),e.jsxs("span",{children:["提示：用户创建角色时，默认使用当前",e.jsx("span",{className:"font-bold",children:"“默认”"}),"提示词模板作为参考生成角色提示词。"]})]}),e.jsxs("div",{className:"glass-card rounded-3xl overflow-hidden",children:[e.jsxs("table",{className:"w-full text-left rounded-2xl overflow-hidden border-collapse",children:[e.jsx("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 pl-6 w-16",children:"序号"}),e.jsx("th",{className:"p-3 pl-7",children:"模版名称"}),e.jsx("th",{className:"p-3",children:"类型"}),e.jsx("th",{className:"p-3",children:"标签"}),e.jsx("th",{className:"p-3",children:"创建时间"}),e.jsx("th",{className:"p-3",children:"引用数"}),e.jsx("th",{className:"p-3",children:"状态 / 操作"}),e.jsx("th",{className:"p-3 text-right pr-8",children:"操作"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-pink-100",children:c.map((b,L)=>{var U;return e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-3 pl-6 text-gray-500 font-mono",children:u+L+1}),e.jsx("td",{className:"p-3 pl-8 font-bold text-gray-700",children:b.name}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"bg-pink-100 text-pink-600 px-2.5 py-1 rounded-lg text-xs font-bold",children:b.type})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex gap-1",children:(U=b.tags)==null?void 0:U.map(C=>e.jsx("span",{className:"text-[10px] bg-white border border-pink-100 text-pink-400 px-1.5 py-0.5 rounded",children:C},C))})}),e.jsx("td",{className:"p-3 text-gray-500",children:$(b.createdAt)}),e.jsx("td",{className:"p-3 text-gray-500 font-mono",children:typeof b.refCount=="number"?b.refCount:0}),e.jsx("td",{className:"p-3",children:b.isDefault?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-green-100 text-green-700 text-xs font-bold border border-green-200",children:[e.jsx(Ee,{size:14,className:"text-green-600"}),"当前默认"]}):e.jsxs("button",{onClick:()=>k(b.id),className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-gray-200 text-gray-500 text-xs font-bold hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50 transition-all group",children:[e.jsx(vt,{size:14,className:"group-hover:fill-pink-200"}),"设为默认"]})}),e.jsxs("td",{className:"p-3 text-right pr-8 space-x-2",children:[e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>S(b),"aria-label":"编辑",className:"text-pink-400 hover:text-pink-600 p-1",children:e.jsx(fe,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"编辑"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>T(b),"aria-label":"复制",className:"text-pink-400 hover:text-pink-600 p-1",children:e.jsx(Le,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"复制"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:()=>g(b),"aria-label":"删除",className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(ie,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"删除"})]})]})]},b.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border-t border-pink-100",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["第 ",s," / ",f," 页"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:s===1,onClick:()=>i(b=>Math.max(1,b-1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${s===1?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"上一页"}),Array.from({length:f}).map((b,L)=>e.jsx("button",{onClick:()=>i(L+1),className:`w-8 h-8 rounded-lg text-xs font-bold ${s===L+1?"bg-pink-500 text-white":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:L+1},L)),e.jsx("button",{disabled:s===f,onClick:()=>i(b=>Math.min(f,b+1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${s===f?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"下一页"})]})]})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:z}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除提示词模版"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",y.name,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:z,className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:A,className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]})]})},Ut=()=>e.jsx(K,{children:e.jsx(Rt,{})}),Vt=t=>new Promise(r=>{const d=new FileReader;d.addEventListener("load",()=>r(d.result),!1),d.readAsDataURL(t)}),Dt=t=>new Promise((r,d)=>{const o=new Image;o.addEventListener("load",()=>r(o)),o.addEventListener("error",s=>d(s)),o.setAttribute("crossOrigin","anonymous"),o.src=t});function Te({initialImage:t,onSave:r,onCancel:d}){const[o,s]=l.useState(t?"main":"upload"),[i,p]=l.useState(t||null),[x,h]=l.useState(null),y=async j=>{if(j.target.files&&j.target.files.length>0){const M=j.target.files[0],_=await Vt(M);h(_),s("edit")}},N=j=>{p(j),r(j)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[e.jsx(Bt,{step:o,onBack:()=>s(o==="edit"?"upload":"main"),onClose:d}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[o==="main"&&e.jsx(Gt,{avatarUrl:i,onChangeClick:()=>s("upload"),onRemoveClick:()=>{p(null),r(null)}}),o==="upload"&&e.jsx(Ht,{onFileChange:y}),o==="edit"&&x&&e.jsx(qt,{imageSrc:x,onSave:N,onCancel:()=>s("upload")})]})]})})}function Bt({step:t,onBack:r,onClose:d}){let o="头像设置";return t==="upload"&&(o="更换头像"),t==="edit"&&(o="裁剪与旋转"),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 shrink-0 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t!=="main"&&t!=="upload"&&e.jsx("button",{onClick:r,className:"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-pink-600 transition-colors",children:e.jsx(oe,{size:20})}),t==="upload"&&r&&null,e.jsx("h2",{className:"text-lg font-cute text-pink-900",children:o})]}),e.jsx("button",{onClick:d,className:"p-2 -mr-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(ee,{size:20})})]})}function Gt({avatarUrl:t,onChangeClick:r,onRemoveClick:d}){return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50/50",children:[e.jsxs("div",{className:"p-8 flex flex-col items-center text-center flex-1 justify-center",children:[e.jsx("div",{className:"relative group mb-8",children:e.jsx("div",{className:"w-48 h-48 rounded-full overflow-hidden ring-8 ring-white shadow-2xl bg-gray-200 flex items-center justify-center",children:t?e.jsx("img",{src:t,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-6xl font-medium text-gray-400",children:"?"})})}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"设置一个好看的头像，让角色更具吸引力"})]}),e.jsxs("div",{className:"flex items-stretch border-t border-gray-100 bg-white divide-x divide-gray-100",children:[e.jsxs("button",{onClick:r,className:"flex-1 py-4 flex items-center justify-center gap-2 text-pink-600 hover:bg-pink-50 transition-colors font-bold text-sm",children:[e.jsx(Xe,{size:16}),"更换头像"]}),e.jsxs("button",{onClick:d,className:"flex-1 py-4 flex items-center justify-center gap-2 text-gray-400 hover:bg-red-50 hover:text-red-500 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:16}),"移除头像"]})]})]})}function Ht({onFileChange:t}){const[r,d]=l.useState(!1),o=l.useRef(null),s=x=>{x.preventDefault(),d(!0)},i=x=>{x.preventDefault(),d(!1)},p=x=>{x.preventDefault(),d(!1),x.dataTransfer.files&&x.dataTransfer.files.length>0&&t({target:{files:x.dataTransfer.files}})};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-1 p-8 flex flex-col items-center justify-center",children:e.jsxs("div",{onDragOver:s,onDragLeave:i,onDrop:p,onClick:()=>o.current.click(),className:`w-full max-w-xs aspect-square rounded-3xl flex flex-col items-center justify-center transition-all duration-300 cursor-pointer border-2 border-dashed ${r?"bg-pink-50 border-pink-400 scale-105":"bg-gray-50 border-gray-200 hover:border-pink-300 hover:bg-pink-50/30"}`,children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white shadow-sm flex items-center justify-center mb-4 text-pink-500",children:e.jsx(at,{size:32})}),e.jsx("p",{className:"text-gray-600 font-bold mb-1",children:"点击或拖拽上传"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"支持 JPG, PNG, GIF"})]})}),e.jsx("input",{type:"file",ref:o,onChange:t,className:"hidden",accept:"image/*"})]})}function qt({imageSrc:t,onSave:r,onCancel:d}){const o=l.useRef(null),[s,i]=l.useState(null),[p,x]=l.useState(!1),[h,y]=l.useState(0),[N,j]=l.useState({x:0,y:0}),[M,_]=l.useState(!1),[f,u]=l.useState({x:0,y:0}),[c,$]=l.useState(1),[k,S]=l.useState(1),T=400,a=280;l.useEffect(()=>{(async()=>{try{const m=await Dt(t);i(m);const V=T/m.width,R=T/m.height,v=Math.max(V,R);$(v),S(1)}catch(m){console.error(m)}})()},[t]);const g=C=>{C.preventDefault();const m=C.deltaY*-.001;S(V=>Math.max(.5,Math.min(V+m,3)))},z=l.useCallback(()=>{if(!s||!o.current)return;const m=o.current.getContext("2d");m.clearRect(0,0,T,T),m.fillStyle="#18181b",m.fillRect(0,0,T,T),m.save(),m.translate(T/2,T/2),m.rotate(h*Math.PI/180),m.translate(-T/2,-T/2);let V=h*Math.PI/180,R=N.x*Math.cos(-V)-N.y*Math.sin(-V),v=N.x*Math.sin(-V)+N.y*Math.cos(-V);const F=c*k,H=s.width*F,B=s.height*F,J=T/2,W=T/2;m.drawImage(s,J-H/2+R,W-B/2+v,H,B),m.restore();const E=(T-a)/2;m.fillStyle="rgba(0, 0, 0, 0.6)",m.beginPath(),m.rect(0,0,T,T),m.rect(E+a,E,-a,a),m.fill("evenodd"),m.strokeStyle="white",m.lineWidth=3;const G=20;m.beginPath(),m.moveTo(E,E+G),m.lineTo(E,E),m.lineTo(E+G,E),m.stroke(),m.beginPath(),m.moveTo(E+a-G,E),m.lineTo(E+a,E),m.lineTo(E+a,E+G),m.stroke(),m.beginPath(),m.moveTo(E,E+a-G),m.lineTo(E,E+a),m.lineTo(E+G,E+a),m.stroke(),m.beginPath(),m.moveTo(E+a-G,E+a),m.lineTo(E+a,E+a),m.lineTo(E+a,E+a-G),m.stroke()},[s,h,N,c,k]);l.useEffect(()=>{z()},[z]);const A=C=>{_(!0);const m=o.current.getBoundingClientRect(),V=C.clientX||C.touches[0].clientX,R=C.clientY||C.touches[0].clientY;u({x:V-m.left,y:R-m.top})},O=C=>{if(!M)return;const m=o.current.getBoundingClientRect(),V=C.clientX||(C.touches?C.touches[0].clientX:0),R=C.clientY||(C.touches?C.touches[0].clientY:0),v=V-m.left,F=R-m.top,H=v-f.x,B=F-f.y;j(J=>({x:J.x+H,y:J.y+B})),u({x:v,y:F})},b=()=>{_(!1)},L=()=>{y(C=>(C+90)%360)},U=async()=>{if(!(!o.current||p)){x(!0);try{const C=document.createElement("canvas"),m=a;C.width=m,C.height=m;const V=C.getContext("2d"),R=(T-a)/2;V.drawImage(o.current,R,R,m,m,0,0,m,m);const v=await new Promise((B,J)=>{C.toBlob(W=>W?B(W):J(new Error("blob_failed")),"image/jpeg",.92)}),F=new File([v],`avatar_${Date.now()}.jpg`,{type:"image/jpeg"}),H=await Ae.avatar(F);r(H.url)}catch(C){console.error(C)}finally{x(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-1 relative flex items-center justify-center bg-gray-900 overflow-hidden",children:e.jsx("canvas",{ref:o,width:T,height:T,onMouseDown:A,onMouseMove:O,onMouseUp:b,onMouseLeave:b,onTouchStart:A,onTouchMove:O,onTouchEnd:b,onWheel:g,className:"cursor-move max-w-full max-h-full",style:{width:"100%",height:"auto",maxHeight:"400px"}})}),e.jsxs("div",{className:"p-4 bg-white flex items-center justify-between border-t border-gray-100 gap-4",children:[e.jsxs("button",{onClick:L,className:"flex flex-col itemscenter gap-1 text-pink-600 hover:text-pink-700 transition text-xs font-bold px-2 py-2 rounded-xl hover:bg-pink-50 shrink-0",children:[e.jsx(xt,{size:20}),"旋转"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 max-w-[200px]",children:[e.jsx(zt,{size:16,className:"text-gray-400 shrink-0"}),e.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:k,onChange:C=>S(parseFloat(C.target.value)),className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-pink-500"}),e.jsx(Tt,{size:16,className:"text-gray-400 shrink-0"})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 rounded-xl text-gray-500 font-bold text-sm hover:bg-gray-100 transition-colors",children:"取消"}),e.jsx("button",{onClick:U,disabled:p,className:`px-5 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 transition-all ${p?"opacity-60 cursor-not-allowed":"hover:opacity-90"}`,children:p?"上传中...":"完成"})]})]})]})}const Jt=({initialData:t,onCancel:r,mode:d="new",notify:o})=>{var ve;const[s,i]=l.useState({name:"",gender:"男",identity:"",tagline:"",tags:[],plotTheme:"",plotSummary:"",openingLine:"",styleExamples:["","",""],hobbies:"",experiences:"",published:!1,generatedPrompt:"",personality:"",relationship:"陌生人",customRelationship:"",sceneDescription:"",sceneGeneratedPrompt:"",avatar:"",characterType:"原创角色",age:"",occupation:""}),p=["陌生人","暧昧","恋爱中","冷战","分手"],[x,h]=l.useState(!1),[y,N]=l.useState(!0);l.useEffect(()=>{if(t){const n=p.includes(t.relationship);i({name:t.name||"",gender:t.gender||"男",identity:t.identity||"",tagline:t.tagline||"",tags:t.tags||[],plotTheme:t.plotTheme||"",plotSummary:t.plotSummary||"",openingLine:t.openingLine||t.opening||"",styleExamples:t.styleExamples||["","",""],hobbies:t.hobbies||"",experiences:t.experiences||"",published:t.status==="published",generatedPrompt:t.systemPrompt||"",personality:t.personality||"",relationship:n?t.relationship||"陌生人":"",customRelationship:n?"":t.relationship||"",avatar:t.avatar||"",sceneDescription:t.sceneDescription||"",sceneGeneratedPrompt:t.systemPromptScene||"",templateIdScene:t.sceneTemplateId?String(t.sceneTemplateId):"",characterType:t.characterType||t.type||"原创角色",age:t.age||"",occupation:t.occupation||""}),h(!n&&!!t.relationship),C(t.promptModelId||""),v(typeof t.promptTemperature=="number"?t.promptTemperature:t.promptTemperature||.1),V(t.sceneModelId||""),H(typeof t.sceneTemperature=="number"?t.sceneTemperature:t.sceneTemperature||.1)}},[t]);const[j,M]=l.useState(!1),[_,f]=l.useState(!1),[u,c]=l.useState(!1),[$,k]=l.useState(""),[S,T]=l.useState(!1),a=l.useRef(null),[g,z]=l.useState(!1),[A,O]=l.useState(!1),b=l.useRef(null),L=l.useRef(null),[U,C]=l.useState(""),[m,V]=l.useState(""),[R,v]=l.useState(.1),[F,H]=l.useState(.1),[B,J]=l.useState([]),[W,E]=l.useState(!1),[G,de]=l.useState(""),[xe,Fe]=l.useState([]),[Re,be]=l.useState(!1),Ue=["M/M","M/F","BL","BG","耽美","百合","责任感","偶像","占有欲","霸道","调戏","腹黑","温柔","年下","年上","感性","体贴","理性","反差","激情","校园","贴心","偏执","疯批","傲娇","职场","冷漠","忧郁","人夫","养胃","控制欲","黏人","可爱","成熟","性感"];l.useEffect(()=>{const n=I=>{S&&a.current&&!a.current.contains(I.target)&&T(!1),g&&b.current&&!b.current.contains(I.target)&&z(!1),A&&L.current&&!L.current.contains(I.target)&&O(!1)},w=I=>{I.key==="Escape"&&(T(!1),z(!1),O(!1))};return document.addEventListener("mousedown",n),document.addEventListener("keydown",w),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("keydown",w)}},[S,g,A]),l.useEffect(()=>{(async()=>{try{const n=await ne.list(),w=I=>{const we=(I.model_nickname||"").match(/^模型-([A-Z])$/i);return we?we[1].toUpperCase():I.model_name||I.model_id||""};J((n.items||[]).sort((I,q)=>w(I).localeCompare(w(q))))}catch{}})()},[]),l.useEffect(()=>{(async()=>{try{be(!0);const n=await Q.list();Fe(n.items||[])}catch{}finally{be(!1)}})()},[]);const ye=n=>{const w=B.find(I=>I.model_id===n);return w?w.model_nickname||w.model_name||w.model_id:"-- 请选择 --"},Ve=s.templateIdScene?(ve=xe.find(n=>n.id===parseInt(s.templateIdScene)))==null?void 0:ve.name:"-- 请选择 --",De=async()=>{T(!S)},Be=async()=>{M(!0),i(n=>({...n,generatedPrompt:""}));try{const n={model:U||void 0,temperature:R===""?void 0:parseFloat(R),sourcePrompt:s.sceneGeneratedPrompt||""},w=await Ce.generateNoScene(n);i(I=>({...I,generatedPrompt:w.prompt||""}))}catch{}finally{M(!1)}},je=n=>{i(w=>({...w,templateIdScene:n})),T(!1)},Ge=n=>{h(!1),i(w=>({...w,relationship:n,customRelationship:""}))},He=()=>{h(!0),i(n=>({...n,relationship:""}))},qe=(n,w)=>{const I=[...s.styleExamples];I[n]=w,i(q=>({...q,styleExamples:I}))};return e.jsxs("div",{className:"animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:r,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(oe,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:t?"编辑角色":"创建新角色"}),e.jsx("p",{className:"text-gray-400 text-xs",children:t?"修改角色设定与提示词":"填写设定并生成专属提示词"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:r,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:async()=>{if(!s.name||!s.name.trim()){o&&o("保存失败：请输入角色名称","error");return}const n={name:s.name.trim(),gender:s.gender,sceneTemplateId:s.templateIdScene?parseInt(s.templateIdScene):(t==null?void 0:t.sceneTemplateId)??null,identity:s.identity||null,tagline:s.tagline||null,personality:s.personality||null,relationship:x?s.customRelationship||null:s.relationship||null,plotTheme:s.plotTheme||null,plotSummary:s.plotSummary||null,openingLine:s.openingLine||null,systemPrompt:s.generatedPrompt||null,systemPromptScene:s.sceneGeneratedPrompt||null,promptModelId:U||null,promptTemperature:R===""?null:parseFloat(R),sceneModelId:m||null,sceneTemperature:F===""?null:parseFloat(F),hobbies:s.hobbies||null,experiences:s.experiences||null,status:s.published?"published":"draft",tags:s.tags||[],styleExamples:s.styleExamples||[],avatar:s.avatar||null,characterType:s.characterType||null,age:s.age===""?null:parseInt(s.age,10),occupation:s.occupation||null};try{d==="edit"&&(t!=null&&t.id)?(await ae.update(t.id,n),o&&o("保存成功：角色已更新")):(await ae.create(n),o&&o("保存成功：角色已保存")),r()}catch(w){console.error("[characters.save] failed",{mode:d,payload:n,error:w}),o&&o("保存失败：请稍后重试","error")}},className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(se,{size:16})," 保存角色"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:[e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-4",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色类型设置"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:["原创角色","二次创作","其他"].map(n=>e.jsx("button",{onClick:()=>i({...s,characterType:n}),className:`px-6 py-3 rounded-2xl text-sm font-bold transition-all ${s.characterType===n?"bg-pink-500 text-white shadow-md":"bg-white text-gray-500 hover:text-pink-600"}`,children:n},n))})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 基础设定"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色名称"}),e.jsx("input",{value:s.name,onChange:n=>i({...s,name:n.target.value}),type:"text",className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"角色姓名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"性别"}),e.jsx("div",{className:"flex bg-gray-50 p-1 rounded-xl border border-gray-200",children:["男","女","其他"].map(n=>e.jsx("button",{onClick:()=>i({...s,gender:n}),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${s.gender===n?"bg-pink-500 text-white shadow-md":"text-gray-400 hover:text-pink-500"}`,children:n},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"年龄"}),e.jsx("input",{value:s.age,onChange:n=>i({...s,age:n.target.value}),type:"number",min:"0",max:"200",className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"年龄"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"职业"}),e.jsx("input",{value:s.occupation,onChange:n=>i({...s,occupation:n.target.value}),type:"text",className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"职业"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"身份背景 (Identity)"}),e.jsx("textarea",{value:s.identity,onChange:n=>i({...s,identity:n.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"角色的年龄、职业、过往经历..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"一句话人设 (Tagline)"}),e.jsx("input",{value:s.tagline,onChange:n=>i({...s,tagline:n.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例如：表面温柔克己实则腹黑"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"性格 (Personality)"}),e.jsx("textarea",{value:s.personality,onChange:n=>i({...s,personality:n.target.value}),rows:"2",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：占有欲强，容易吃醋..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色标签"}),e.jsxs("div",{onClick:()=>E(!0),className:"dream-input w-full px-3 py-2 min-h-[46px] flex flex-wrap gap-2 items-center bg-white/60 cursor-pointer hover:bg-white transition rounded-2xl border border-pink-100",children:[s.tags.length===0&&e.jsx("span",{className:"text-xs text-[#B3A4C8] ml-1",children:"点击添加标签 (#傲娇 #高冷...)"}),s.tags.map(n=>e.jsxs("span",{className:"tag-pill px-2 py-1 flex items-center shadow-sm",children:["#",n,e.jsx("button",{onClick:w=>{w.stopPropagation(),i(I=>({...I,tags:I.tags.filter(q=>q!==n)}))},className:"ml-1 opacity-60 hover:opacity-100",children:e.jsx(ee,{size:12})})]},n)),e.jsx("span",{className:"ml-auto text-pink-300 text-xs",children:"›"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"当下的关系"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("button",{onClick:He,className:`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${x?"bg-pink-500 text-white shadow-md border-pink-500":"bg-white text-gray-500 border-gray-200 hover:border-pink-300"}`,children:"自定义"}),p.map(n=>e.jsx("button",{onClick:()=>Ge(n),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${!x&&s.relationship===n?"bg-pink-500 text-white shadow-md border-pink-500":"bg-white text-gray-500 border-gray-200 hover:border-pink-300"}`,children:n},n))]}),x&&e.jsx("div",{className:"animate-fade-in mt-2",children:e.jsx("input",{type:"text",value:s.customRelationship,onChange:n=>i({...s,customRelationship:n.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm",placeholder:"请输入自定义关系"})})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 第一情节"]}),e.jsxs("div",{className:"bg-pink-50 border border-pink-100 rounded-2xl p-4 flex gap-3 text-pink-700 text-sm leading-relaxed",children:[e.jsx($e,{size:18,className:"flex-shrink-0 mt-0.5 text-pink-500"}),e.jsx("div",{children:"第一情节的内容将被应用于和角色的第一次聊天。此外，设定第一情节并选择公开角色后，情节内容将显示在角色资料页上。"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"主题"}),e.jsx("input",{value:s.plotTheme,onChange:n=>i({...s,plotTheme:n.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例：当温柔人夫终于爆发腹黑属性"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"情节梗概"}),e.jsx("textarea",{value:s.plotSummary,onChange:n=>i({...s,plotSummary:n.target.value}),rows:"4",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：在一起这么久了，他还是一如既往的温柔体贴，从来不干涉你的个人生活。今天晚上你去酒吧玩，故意装作喝醉和他打电话，却在他应了一声后开始软声叫着别人的名字......"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"开场白"}),e.jsx("input",{value:s.openingLine,onChange:n=>i({...s,openingLine:n.target.value}),className:"dream-input w-full px-4 py-3 rounded-xl text-sm",placeholder:"例：“出来，我在酒吧门口”"})]})]}),e.jsxs("div",{className:"solid-card rounded-3xl overflow-hidden",children:[e.jsxs("div",{className:"p-8 pb-4 flex justify-between items-center cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>N(!y),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"}),e.jsx("h3",{className:"font-cute text-lg text-pink-900",children:"进阶设定"}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-pink-100 text-pink-600 rounded",children:"可选"})]}),e.jsx(Pe,{size:20,className:`text-gray-400 transition-transform duration-300 ${y?"rotate-180":""}`})]}),y&&e.jsxs("div",{className:"p-8 pt-0 space-y-6 animate-in slide-in-from-top-4 fade-in duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-3",children:"说话风格示例"}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(n=>e.jsxs("div",{className:"relative flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-bold text-pink-300 font-mono",children:["0",n+1]}),e.jsx("input",{type:"text",value:s.styleExamples[n]||"",onChange:w=>qe(n,w.target.value),className:"dream-input flex-1 px-4 py-3 rounded-xl text-sm",placeholder:n===0?"例：哼，别以为我会感谢你。":n===1?"例：今晚月色真美，不一起走走吗？":"例：再靠近一步，我就不客气了。"})]},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"爱好"}),e.jsx("textarea",{value:s.hobbies,onChange:n=>i({...s,hobbies:n.target.value}),rows:"3",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"例：喜欢看书、收集古董怀表..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"经历"}),e.jsx("textarea",{value:s.experiences,onChange:n=>i({...s,experiences:n.target.value}),rows:"4",className:"dream-input w-full px-4 py-3 rounded-xl text-sm resize-none",placeholder:"请填写角色个人经历或你们的共同经历"})]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl relative overflow-visible bg-gradient-to-r from-pink-50 to-pink-100 border-pink-100",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色提示词配置（带场景描述）"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色提示词AI模型（场景）"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative z-50 flex-1",ref:L,children:[e.jsxs("button",{onClick:()=>O(!A),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${A?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${m?"text-gray-700":"text-gray-400 font-normal"}`,children:ye(m)}),e.jsx("div",{className:`text-pink-400 transition-transform ${A?"rotate-180":""}`,children:"▼"})]}),A&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:B.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型"}):B.map(n=>e.jsx("li",{onClick:()=>{V(n.model_id),O(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${m===n.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:n.model_nickname||n.model_name||n.model_id},n.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-[140px] justify-end",children:[e.jsx("input",{type:"number",min:"0",max:"2",step:"0.05",value:F,onChange:n=>H(n.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.jsxs("div",{className:"relative group",children:[e.jsx(he,{size:18,className:"text-pink-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center",children:"温度：高数值输出随机，低数值输出集中。"})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-end mt-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"选择基础模版"}),e.jsxs("div",{className:"relative z-20 flex-1",ref:a,children:[e.jsxs("button",{onClick:De,className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${S?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${s.templateIdScene?"text-gray-700":"text-gray-400 font-normal"}`,children:Ve}),e.jsx("div",{className:`text-pink-400 transition-transform ${S?"rotate-180":""}`,children:"▼"})]}),S&&e.jsxs("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:[e.jsx("li",{onClick:()=>je(""),className:"px-4 py-3 text-sm text-gray-400 hover:bg-pink-50 cursor-pointer border-b border-pink-50",children:"-- 请选择 --"}),Re?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"加载中..."}):xe.map(n=>e.jsxs("li",{onClick:()=>je(n.id.toString()),className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${s.templateIdScene==n.id?"bg-pink-100 font-bold text-pink-700":""}`,children:[n.name," (",n.type,")"]},n.id))]})]})]}),e.jsxs("button",{onClick:async()=>{if(!s.templateIdScene)return alert("请先选择一个提示词模版");f(!0),i(n=>({...n,sceneGeneratedPrompt:""}));try{const n=xe.find(q=>q.id===parseInt(s.templateIdScene)),w={templateContent:(n==null?void 0:n.content)||"",model:m||void 0,temperature:F===""?void 0:parseFloat(F),name:s.name,gender:s.gender,age:s.age,occupation:s.occupation,identity:s.identity,tagline:s.tagline,tags:s.tags,personality:s.personality,relationship:x?s.customRelationship:s.relationship,styleExamples:s.styleExamples,hobbies:s.hobbies,experiences:s.experiences},I=await Ce.generate(w);i(q=>({...q,sceneGeneratedPrompt:I.prompt||""}))}catch{}finally{f(!1)}},disabled:_,className:"px-6 py-3 rounded-xl bg-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] justify-center z-0",children:[_?e.jsx("span",{className:"animate-spin",children:e.jsx(ke,{size:16})}):e.jsx(me,{size:16,className:"text-yellow-300"}),_?"生成中...":"生成提示词"]})]}),e.jsx("p",{className:"text-xs text-pink-400 mt-2 ml-1",children:"* 将根据上方填写的设定，自动填充到模版占位符中"}),e.jsxs("div",{className:"mt-4 relative",children:[e.jsx("textarea",{rows:"12",value:s.sceneGeneratedPrompt,onChange:n=>i({...s,sceneGeneratedPrompt:n.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner",placeholder:"点击上方“生成提示词”按钮，或在此直接编写 Prompt..."}),!s.sceneGeneratedPrompt&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-30",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{size:48,className:"mx-auto mb-2 text-pink-300"}),e.jsx("p",{className:"text-sm font-bold text-pink-400",children:"等待生成..."})]})})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl relative overflow-visible bg-gradient-to-r from-pink-50 to-pink-100 border-pink-100",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 角色提示词配置"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色提示词AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative z-50 flex-1",ref:b,children:[e.jsxs("button",{onClick:()=>z(!g),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${g?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${U?"text-gray-700":"text-gray-400 font-normal"}`,children:ye(U)}),e.jsx("div",{className:`text-pink-400 transition-transform ${g?"rotate-180":""}`,children:"▼"})]}),g&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:B.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型"}):B.map(n=>e.jsx("li",{onClick:()=>{C(n.model_id),z(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${U===n.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:n.model_nickname||n.model_name||n.model_id},n.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-[140px] justify-end",children:[e.jsx("input",{type:"number",min:"0",max:"2",step:"0.05",value:R,onChange:n=>v(n.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.jsxs("div",{className:"relative group",children:[e.jsx(he,{size:18,className:"text-pink-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center",children:"温度：高数值输出随机，低数值输出集中。"})]})]}),e.jsxs("button",{onClick:Be,disabled:j,className:"px-6 py-3 rounded-xl bg-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] justify-center z-0",children:[j?e.jsx("span",{className:"animate-spin",children:e.jsx(ke,{size:16})}):e.jsx(me,{size:16,className:"text-yellow-300"}),j?"生成中...":"生成提示词"]})]})]}),e.jsx("p",{className:"text-xs text-pink-400 mt-2 ml-1",children:"* 将根据上方输出的提示词，进行二次生成不带场景描述的提示词。"}),e.jsxs("div",{className:"mt-4 relative",children:[e.jsx("textarea",{rows:"12",value:s.generatedPrompt,onChange:n=>i({...s,generatedPrompt:n.target.value}),className:"dream-input w-full px-5 py-4 rounded-xl text-sm leading-relaxed font-mono text-gray-700 bg-white focus:bg-white resize-y shadow-inner",placeholder:"点击上方“生成提示词”按钮，或在此直接编写 Prompt..."}),!s.generatedPrompt&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-30",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{size:48,className:"mx-auto mb-2 text-pink-300"}),e.jsx("p",{className:"text-sm font-bold text-pink-400",children:"等待生成..."})]})})]})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:[e.jsxs("div",{className:"glass-card p-6 rounded-3xl flex flex-col items-center text-center",children:[e.jsx("h3",{className:"font-cute text-pink-900 mb-4 w-full text-left border-b border-pink-100 pb-2",children:"头像预览"}),e.jsxs("div",{onClick:()=>c(!0),className:"w-32 h-32 rounded-full bg-gray-100 border-4 border-white shadow-xl flex items-center justify-center mb-4 relative group cursor-pointer overflow-hidden",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-4xl text-gray-300 font-bold",children:s.name?s.name[0]:"?"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"更换头像"})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:"flex items-center justify-between p-4 bg-white/50 rounded-xl cursor-pointer hover:bg-white transition-colors border border-pink-50",children:[e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"发布到广场"}),e.jsx("div",{onClick:()=>i({...s,published:!s.published}),className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${s.published?"bg-pink-500":"bg-gray-300"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-sm transform transition-transform duration-300 ${s.published?"translate-x-6":""}`})})]}),e.jsx("p",{className:"text-xs text-left text-gray-400 mt-2 px-1",children:"开启后，该角色将出现在公共广场，所有用户可见。"})]})]}),e.jsxs("div",{className:"glass-card p-6 rounded-3xl bg-gradient-to-br from-pink-500 to-pink-600 text-white",children:[e.jsxs("h4",{className:"font-bold mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"inline-block",children:e.jsx(me,{size:16,className:"text-yellow-300"})})," 提示"]}),e.jsx("p",{className:"text-xs opacity-90 leading-relaxed",children:"好的 Prompt 决定了角色的灵魂。建议生成后仔细检查，补充更多细节。"})]})]})]}),W&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:()=>E(!1)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-4xl rounded-3xl bg-white p-6 shadow-2xl border border-pink-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>E(!1),className:"w-8 h-8 rounded-full bg-pink-50 text-pink-800 flex items-center justify-center",children:"‹"}),e.jsx("h3",{className:"text-lg font-bold font-cute text-pink-900",children:"添加 #标签"}),e.jsx("button",{onClick:()=>E(!1),className:"text-sm font-bold text-pink-600 bg-pink-50 px-3 py-1 rounded-full",children:"完成"})]}),e.jsxs("div",{className:"space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"选定的标签"}),e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[46px] bg-pink-50/50 p-3 rounded-xl border border-pink-100 border-dashed",children:s.tags.length===0?e.jsx("span",{className:"text-xs text-gray-400",children:"暂无标签"}):s.tags.map(n=>e.jsxs("button",{onClick:()=>i(w=>({...w,tags:w.tags.filter(I=>I!==n)})),className:"bg-pink-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm flex items-center gap-1",children:["#",n," ",e.jsx("span",{className:"text-[10px] ml-1 opacity-80",children:"×"})]},n))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"直接添加 (自定义)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:G,onChange:n=>de(n.target.value),onKeyDown:n=>{if(n.key==="Enter"){n.preventDefault();const w=G.trim();w&&i(I=>I.tags.includes(w)?I:{...I,tags:[...I.tags,w]}),de("")}},type:"text",placeholder:"输入标签，不用加#",className:"dream-input flex-1 px-4 py-2 text-sm bg-white rounded-xl"}),e.jsx("button",{onClick:()=>{const n=G.trim();n&&i(w=>w.tags.includes(n)?w:{...w,tags:[...w.tags,n]}),de("")},className:"bg-gradient-to-r from-pink-400 to-pink-500 text-white px-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition",children:"添加"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 mb-2 ml-1",children:"标签选择"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Ue.map(n=>e.jsxs("button",{onClick:()=>i(w=>({...w,tags:w.tags.includes(n)?w.tags.filter(I=>I!==n):[...w.tags,n]})),className:`tag-select-btn flex items-center justify-center ${s.tags.includes(n)?"active":""}`,children:["#",n]},n))})]})]})]})})]}),u&&e.jsx(Te,{initialImage:s.avatar||null,onSave:async n=>{try{const w=await Ae.avatar(n);i(I=>({...I,avatar:w.url}))}catch{}c(!1)},onCancel:()=>c(!1)}),u&&e.jsx(Te,{initialImage:s.avatar,onSave:n=>{i(w=>({...w,avatar:n})),c(!1)},onCancel:()=>c(!1)})]})},Yt=({creatorRole:t})=>{const[r,d]=l.useState("list"),[o,s]=l.useState(null),[i,p]=l.useState([]),[x,h]=l.useState("new"),{showToast:y}=Z(),[N,j]=l.useState(null),M=300,_=async()=>{try{const a=t?{creator_role:t}:{},g=await ae.list(a);p(g.items||[])}catch{y("加载失败","error")}};l.useEffect(()=>{_()},[t]);const f=a=>{s(a),h("edit"),d("create")},u=()=>{s(null),h("new"),d("create")},c=a=>{const g={...a,id:void 0,name:`${a.name}_copy`,status:"draft"};s(g),h("copy"),d("create"),y("复制成功，已进入编辑")},$=async(a,g)=>{try{await ae.setStatus(a,g==="published"?"draft":"published"),await _()}catch{y("操作失败","error")}},k=a=>j(a),S=()=>j(null),T=async()=>{if(N)try{await ae.remove(N.id),y("删除成功"),await _()}catch{y("删除失败","error")}finally{S()}};return r==="create"?e.jsx(Jt,{initialData:o,onCancel:()=>{d("list"),_()},mode:x,notify:y}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),t==="user_role"?"用户角色":"官方角色"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:t==="user_role"?"查看用户创建的角色":"管理官方发布的 AI 角色"})]}),t!=="user_role"&&e.jsxs("button",{onClick:u,className:"bg-gradient-to-r from-pink-500 to-pink-600 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:opacity-90 transition-all flex items-center gap-2 text-sm",children:[e.jsx(X,{size:16})," 创建角色"]})]}),e.jsx("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(auto-fit, minmax(320px, 360px))"},children:i.map(a=>e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"glass-card p-4 rounded-3xl hover:shadow-xl transition-all group relative overflow-hidden h-[220px] flex flex-col",children:[e.jsx("div",{className:`absolute top-4 right-4 text-xs px-2 py-0.5 rounded-md font-bold ${a.status==="published"?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"}`,children:a.status==="published"?"已发布":"草稿"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-pink-200 to-pink-300 flex items-center justify-center text-white text-xl font-bold shadow-inner border-2 border-white overflow-hidden flex-shrink-0",children:a.avatar?e.jsx("img",{src:a.avatar,alt:"avatar",className:"w-full h-full object-cover"}):e.jsx("span",{children:a.name?a.name[0]:"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 truncate",children:a.name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[a.age!=null&&a.age!==""?`${a.age}岁`:"",a.occupation?`${a.age!=null&&a.age!==""?" · ":""}${a.occupation}`:""]})]}),e.jsx("div",{className:"flex gap-1 mt-2 flex-nowrap whitespace-nowrap overflow-hidden",style:{maxWidth:M},children:a.tags.map(g=>e.jsxs("span",{className:"text-[10px] bg-pink-50 text-pink-600 px-1.5 py-0.5 rounded border border-pink-100",children:["#",g]},g))})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed break-words",children:a.tagline||"暂无一句话人设"})}),e.jsxs("div",{className:"mt-auto flex gap-2 pt-3 border-t border-white/50",children:[e.jsxs("button",{onClick:()=>f(a),className:"flex-1 py-2 text-xs font-bold text-pink-600 bg-pink-50 hover:bg-pink-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(fe,{size:12})," 编辑"]}),e.jsxs("button",{onClick:()=>c(a),className:"flex-1 py-2 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Le,{size:12})," 复制"]}),a.status==="published"?e.jsxs("button",{onClick:()=>$(a.id,a.status),className:"flex-1 py-2 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(We,{size:12})," 回收"]}):e.jsxs("button",{onClick:()=>$(a.id,a.status),className:"flex-1 py-2 text-xs font-bold text-green-600 bg-green-50 hover:bg-green-100 rounded-lg transition-colors flex items-center justify-center gap-1 mx-1",children:[e.jsx(Ze,{size:12})," 发布"]})]})]}),e.jsx("button",{onClick:()=>k(a),className:"absolute -top-2 -right-2 z-10 w-8 h-8 rounded-full bg-white/60 backdrop-blur-md shadow-lg border border-pink-100 flex items-center justify-center text-gray-400 hover:text-red-500 transition",children:e.jsx(ee,{size:12})})]},a.id))}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50",onClick:S}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-50 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除角色"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",N.name,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:S,className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:T,className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]})]})},Me=({creatorRole:t})=>e.jsx(K,{children:e.jsx(Yt,{creatorRole:t})}),Xt=({user:t,onSaveLimit:r,onDelete:d,onChangePwd:o})=>{const[s,i]=l.useState(t.chatLimit),p=s!==t.chatLimit,x=()=>{r(t.id,s)};return e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-5 pl-8",children:e.jsx("img",{src:t.avatar||"/uploads/avatars/default_avatar.jpg",alt:t.username,className:"w-10 h-10 rounded-full object-cover shadow-sm"})}),e.jsx("td",{className:"p-5 font-mono text-gray-500",children:t.id.toString().padStart(4,"0")}),e.jsxs("td",{className:"p-5",children:[e.jsx("div",{className:"font-bold text-gray-700",children:t.username}),e.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),e.jsx("td",{className:"p-5",children:e.jsx("div",{className:"text-xs text-gray-700",children:t.nickname||"-"})}),e.jsxs("td",{className:"p-5",children:[e.jsx("span",{className:"font-mono text-pink-600 font-bold",children:t.used})," 次"]}),e.jsx("td",{className:"p-5",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"number",value:s,onChange:h=>i(parseInt(h.target.value)||0),className:"dream-input w-24 px-4 py-2 rounded-2xl text-sm text-center",min:"0"})})}),e.jsx("td",{className:"p-5 text-right pr-8",children:e.jsxs("div",{className:"space-x-2",children:[e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:x,disabled:!p,className:`p-1 rounded ${p?"text-green-600 hover:text-green-700":"text-gray-300 cursor-not-allowed"}`,"aria-label":"保存设置",children:e.jsx(Ee,{size:16})}),e.jsx("span",{className:`absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap transition-opacity ${p?"opacity-0 group-hover:opacity-100":"hidden"}`,children:"保存设置"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:o,className:"p-1 rounded text-pink-400 hover:text-pink-600","aria-label":"修改密码",children:e.jsx(fe,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"修改密码"})]}),e.jsxs("span",{className:"relative inline-flex group",children:[e.jsx("button",{onClick:d,className:"p-1 rounded text-red-400 hover:text-red-600","aria-label":"删除",children:e.jsx(ie,{size:16})}),e.jsx("span",{className:"absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 rounded-md text-xs bg-gray-800 text-white whitespace-nowrap opacity-0 group-hover:opacity-100",children:"删除"})]})]})})]})},Zt=({onCancel:t,onSave:r,notify:d})=>{const[o,s]=l.useState({username:"",nickname:"",email:"",password:"",chatLimit:0}),i=x=>{const{name:h,value:y}=x.target;s(N=>({...N,[h]:h==="chatLimit"?parseInt(y)||0:y}))},p=()=>{if(!o.username||!o.password){d&&d("创建失败：请填写用户名和密码","error");return}const x={username:o.username,nickname:o.nickname||null,email:o.email||`${o.username.toLowerCase()}@example.com`,password:o.password,chatLimit:o.chatLimit};r(x)};return e.jsxs("div",{className:"animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-pink-600 transition-colors",children:e.jsx(oe,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:"添加新用户"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"分配后台登录权限和聊天额度"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:t,className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:p,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text白 font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(X,{size:16})," 创建用户"]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6 max-w-2xl mx-auto",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 用户基础信息"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"用户名"}),e.jsx("input",{type:"text",name:"username",value:o.username,onChange:i,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"为新用户设置一个用户名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"昵称"}),e.jsx("input",{type:"text",name:"nickname",value:o.nickname,onChange:i,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"显示名称（可选）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"邮箱"}),e.jsx("input",{type:"email",name:"email",value:o.email,onChange:i,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"用于联系与通知（可选）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"密码 (初始密码)"}),e.jsx("input",{type:"password",name:"password",value:o.password,onChange:i,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"设置初始密码"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"聊天额度 (次数)"}),e.jsx("input",{type:"number",name:"chatLimit",value:o.chatLimit,onChange:i,className:"dream-input w-full px-4 py-3 rounded-xl text-sm font-bold text-gray-700",placeholder:"0 表示默认无额度",min:"0"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"设置用户默认可用的聊天次数，0 次表示用户初始无额度。"})]})]})]})},Kt=()=>{const[t,r]=l.useState([]),[d,o]=l.useState("list"),[s,i]=l.useState(""),[p,x]=l.useState(null),[h,y]=l.useState(""),[N,j]=l.useState(""),[M,_]=l.useState(null),{showToast:f}=Z();l.useEffect(()=>{te.list().then(r).catch(()=>{})},[]);const u=async a=>{try{const{id:g}=await te.create(a);r(z=>[...z,{...a,id:g,used:0}]),f(`用户 ${a.username} 创建成功`),o("list")}catch{f("创建失败","error")}},c=async(a,g)=>{try{await te.update(a,{chatLimit:g}),r(A=>A.map(O=>O.id===a?{...O,chatLimit:g}:O));const z=t.find(A=>A.id===a);f(`用户 ${(z==null?void 0:z.username)??a} 限额已更新`)}catch{f("保存失败","error")}},$=async a=>{try{await te.remove(a),r(g=>g.filter(z=>z.id!==a)),f("用户已删除")}catch{f("删除失败","error")}},k=M&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-80",children:[e.jsx("div",{className:"font-bold mb-3",children:"确认删除该用户？"}),e.jsx("p",{className:"text-sm text-gray-500 mb-5",children:"此操作不可恢复。"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>_(null),children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-red-500 text-white",onClick:()=>{const a=M.id;_(null),$(a)},children:"删除"})]})]})}),S=p&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-96",children:[e.jsxs("div",{className:"font-bold mb-3",children:["为用户 ",p.username," 修改密码"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"password",placeholder:"输入新密码",className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700",value:h,onChange:a=>y(a.target.value)}),e.jsx("input",{type:"password",placeholder:"再次输入新密码",className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700",value:N,onChange:a=>j(a.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-5",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{x(null),y(""),j("")},children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:async()=>{if(!h||h!==N){f("两次输入密码不一致","error");return}try{await te.changePassword(p.id,h),f("密码已更新")}catch{f("更新失败","error")}x(null),y(""),j("")},children:"确认修改"})]})]})}),T=t.filter(a=>{var g,z;return((g=a.username)==null?void 0:g.toLowerCase().includes(s.toLowerCase()))||(a.nickname?a.nickname.toLowerCase().includes(s.toLowerCase()):!1)||((z=a.email)==null?void 0:z.toLowerCase().includes(s.toLowerCase()))});return d==="create"?e.jsx(Zt,{onCancel:()=>o("list"),onSave:u,notify:f}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[k,S,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"})," 用户管理"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"监控用户使用情况与限额"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"搜索用户名/邮箱...",className:"dream-input pl-10 pr-4 py-2 rounded-xl text-sm w-64",value:s,onChange:a=>i(a.target.value)}),e.jsx(ht,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-pink-300"})]}),e.jsxs("button",{onClick:()=>o("create"),className:"bg-pink-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(X,{size:16})," 添加用户"]})]})]}),e.jsx("div",{className:"glass-card rounded-3xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-pink-50/50 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-5 pl-8",children:"头像"}),e.jsx("th",{className:"p-5",children:"用户 ID"}),e.jsx("th",{className:"p-5",children:"用户名 / 邮箱"}),e.jsx("th",{className:"p-5",children:"昵称"}),e.jsx("th",{className:"p-5",children:"已用次数"}),e.jsx("th",{className:"p-5",children:"剩余额度"}),e.jsx("th",{className:"p-5 text-right pr-8",children:"操作"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-pink-50",children:T.length>0?T.map(a=>e.jsx(Xt,{user:a,onSaveLimit:c,onDelete:()=>_(a),onChangePwd:()=>x(a)},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-10 text-center text-gray-400",children:"未找到匹配的用户。"})})})]})})]})},Wt=()=>e.jsx(K,{children:e.jsx(Kt,{})}),pe=({value:t,onChange:r})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"2",step:"0.05",value:t,onChange:d=>r(d.target.value),className:"dream-input w-24 px-2 py-3 rounded-xl text-sm font-bold text-center"}),e.jsxs("div",{className:"relative group",children:[e.jsx(he,{size:18,className:"text-pink-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-3 bg-white/90 backdrop-blur-sm border border-pink-100 text-pink-900 text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none text-center",children:"温度：高数值输出随机，低数值输出集中。"})]})]}),Qt=()=>{const[t,r]=l.useState([]),[d,o]=l.useState(""),[s,i]=l.useState(!1),p=l.useRef(null),[x,h]=l.useState(""),[y,N]=l.useState(!1),j=l.useRef(null),[M,_]=l.useState(""),[f,u]=l.useState(!1),c=l.useRef(null),[$,k]=l.useState(.1),[S,T]=l.useState(.1),[a,g]=l.useState(.1),[z,A]=l.useState(null),{showToast:O}=Z(),b=v=>{const F=t.find(H=>H.model_id===v);return F?F.model_name||F.model_id:"-- 请选择 --"},L=async()=>{try{const v=await ne.list();r(v.items||[])}catch{O("模型列表加载失败","error")}};l.useEffect(()=>{L(),(async()=>{try{const v=await Se.get();o(v.selected_model),h(v.selected_chat_model),_(v.selected_story_model),k(Number(v.model_temperature||.1)),T(Number(v.chat_temperature||.1)),g(Number(v.story_temperature||.1)),A(v.default_template_id||null)}catch{O("加载设置失败","error")}})()},[]),l.useEffect(()=>{const v=F=>{s&&p.current&&!p.current.contains(F.target)&&i(!1),y&&j.current&&!j.current.contains(F.target)&&N(!1),f&&c.current&&!c.current.contains(F.target)&&u(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[s,y,f]);const U=[...t].sort((v,F)=>(v.model_name||v.model_id).localeCompare(F.model_name||F.model_id)),C=b(d),m=b(x),V=b(M),R=async()=>{try{await Se.save({selected_model:d,selected_chat_model:x,selected_story_model:M,model_temperature:Number($),chat_temperature:Number(S),story_temperature:Number(a),default_template_id:z}),O("设置已保存")}catch{O("保存失败","error")}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"模型设置"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"配置全局模型与温度参数"})]})}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"}),"模型配置"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色提示词AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-full max-w-md",ref:p,children:[e.jsxs("button",{onClick:()=>i(!s),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${s?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${d?"text-gray-700":"text-gray-400 font-normal"}`,children:C}),e.jsx("div",{className:`text-pink-400 transition-transform ${s?"rotate-180":""}`,children:"▼"})]}),s&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:U.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型，请先添加"}):U.map(v=>e.jsx("li",{onClick:()=>{o(v.model_id),i(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${d===v.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:v.model_name||v.model_id},v.id))})]}),e.jsx(pe,{value:$,onChange:k}),e.jsxs("button",{onClick:R,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2",children:[e.jsx(se,{size:16})," 确认"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"角色聊天AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-full max-w-md",ref:j,children:[e.jsxs("button",{onClick:()=>N(!y),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${y?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${x?"text-gray-700":"text-gray-400 font-normal"}`,children:m}),e.jsx("div",{className:`text-pink-400 transition-transform ${y?"rotate-180":""}`,children:"▼"})]}),y&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:U.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型，请先添加"}):U.map(v=>e.jsx("li",{onClick:()=>{h(v.model_id),N(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${x===v.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:v.model_name||v.model_id},v.id))})]}),e.jsx(pe,{value:S,onChange:T}),e.jsxs("button",{onClick:R,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2",children:[e.jsx(se,{size:16})," 确认"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"故事生成AI模型"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-full max-w-md",ref:c,children:[e.jsxs("button",{onClick:()=>u(!f),className:`dream-input w-full px-4 py-3 rounded-xl text-sm text-left font-bold transition-all bg-white flex justify-between items-center ${f?"border-pink-500 ring-4 ring-pink-100/50":""}`,children:[e.jsx("span",{className:`${M?"text-gray-700":"text-gray-400 font-normal"}`,children:V}),e.jsx("div",{className:`text-pink-400 transition-transform ${f?"rotate-180":""}`,children:"▼"})]}),f&&e.jsx("ul",{className:"absolute top-full mt-1 w-full bg-white border border-pink-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-50",children:U.length===0?e.jsx("li",{className:"px-4 py-3 text-sm text-gray-400",children:"暂无模型，请先添加"}):U.map(v=>e.jsx("li",{onClick:()=>{_(v.model_id),u(!1)},className:`px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 cursor-pointer transition-colors ${M===v.model_id?"bg-pink-100 font-bold text-pink-700":""}`,children:v.model_name||v.model_id},v.id))})]}),e.jsx(pe,{value:a,onChange:g}),e.jsxs("button",{onClick:R,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-700 transition-all flex items-center gap-2",children:[e.jsx(se,{size:16})," 确认"]})]})]})]})]})]})},es=()=>e.jsx(K,{children:e.jsx(Qt,{})}),ts=()=>{const{showToast:t}=Z(),[r,d]=l.useState([]),[o,s]=l.useState(1),i=6,[p,x]=l.useState(!1),[h,y]=l.useState({model_id:"",model_name:"",model_nickname:""}),[N,j]=l.useState(null),M=async()=>{try{const k=await ne.list();d(k.items||[])}catch{t("模型列表加载失败","error")}};l.useEffect(()=>{M()},[]);const _=k=>{if(!k)return"-";const S=new Date(k),T=S.getFullYear(),a=String(S.getMonth()+1).padStart(2,"0"),g=String(S.getDate()).padStart(2,"0"),z=String(S.getHours()).padStart(2,"0"),A=String(S.getMinutes()).padStart(2,"0");return`${T}/${a}/${g} ${z}:${A}`},f=Math.max(1,Math.ceil(r.length/i)),u=(o-1)*i,c=r.slice(u,u+i);l.useEffect(()=>{o>f&&s(f)},[r]);const $=async()=>{if(!h.model_id||!h.model_name){t("请填写完整信息","error");return}try{await ne.create(h),t("模型添加成功"),x(!1),y({model_id:"",model_name:"",model_nickname:""}),M()}catch{t("添加失败","error")}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"模型管理"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"维护可用的模型列表"})]}),e.jsxs("button",{onClick:()=>x(!0),className:"bg-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-xs",children:[e.jsx(X,{size:14})," 添加模型"]})]}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden border border-pink-100",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 pl-6 w-16",children:"序号"}),e.jsx("th",{className:"p-3",children:"模型名称"}),e.jsx("th",{className:"p-3",children:"模型ID"}),e.jsx("th",{className:"p-3",children:"盲测模型昵称"}),e.jsx("th",{className:"p-3",children:"添加时间"}),e.jsx("th",{className:"p-3 text-right pr-6",children:"操作"})]})}),e.jsxs("tbody",{className:"text-sm divide-y divide-pink-100",children:[c.map((k,S)=>e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-3 pl-6 text-gray-500 font-mono",children:u+S+1}),e.jsx("td",{className:"p-3 font-bold text-pink-700",children:k.model_name}),e.jsx("td",{className:"p-3 font-mono text-gray-600",children:k.model_id}),e.jsx("td",{className:"p-3 text-gray-600",children:k.model_nickname||"-"}),e.jsx("td",{className:"p-3 text-gray-500",children:_(k.created_at)}),e.jsx("td",{className:"p-3 text-right pr-6",children:e.jsx("button",{onClick:()=>j(k),className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(ie,{size:16})})})]},k.id)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-8 text-center text-gray-400 text-sm",children:"暂无模型数据"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["第 ",o," / ",f," 页"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:o===1,onClick:()=>s(k=>Math.max(1,k-1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${o===1?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"上一页"}),Array.from({length:f}).map((k,S)=>e.jsx("button",{onClick:()=>s(S+1),className:`w-8 h-8 rounded-lg text-xs font-bold ${o===S+1?"bg-pink-500 text-white":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:S+1},S)),e.jsx("button",{disabled:o===f,onClick:()=>s(k=>Math.min(f,k+1)),className:`px-3 py-1 rounded-lg text-xs font-bold ${o===f?"bg-gray-100 text-gray-400":"bg-white border border-gray-200 text-gray-600 hover:border-pink-300 hover:text-pink-600 hover:bg-pink-50"}`,children:"下一页"})]})]})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 z-50",onClick:()=>j(null)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg白 rounded-3xl border border-pink-100 p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900 mb-2",children:"删除模型"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["确定删除“",N.model_name,"”吗？此操作不可撤回。"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>j(null),className:"px-5 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:async()=>{try{await ne.remove(N.id),t("删除成功"),j(null),M()}catch{t("删除失败","error")}},className:"px-5 py-2 rounded-xl bg-red-500 text-white font-bold text-sm shadow-sm hover:bg-red-600",children:"确认删除"})]})]})})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 bg-black/30 z-50 backdrop-blur-sm",onClick:()=>x(!1)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-64 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg白 rounded-3xl border border-pink-100 shadow-2xl p-6 animate-fade-in w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-cute text-xl text-pink-900",children:"添加新模型"}),e.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ee,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-pink-800 mb-1.5",children:["模型ID ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:h.model_id,onChange:k=>y({...h,model_id:k.target.value}),placeholder:"例如: gpt-4-turbo",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-pink-800 mb-1.5",children:["模型名称 ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:h.model_name,onChange:k=>y({...h,model_name:k.target.value}),placeholder:"例如: GPT-4 Turbo",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-1.5",children:"盲测模型昵称"}),e.jsx("input",{type:"text",value:h.model_nickname,onChange:k=>y({...h,model_nickname:k.target.value}),placeholder:"例如: 智慧之星",className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-5 py-2.5 rounded-xl bg-gray-50 text-gray-600 font-bold text-sm hover:bg-gray-100 transition-colors",children:"取消"}),e.jsx("button",{onClick:$,className:"px-6 py-2.5 rounded-xl bg-pink-500 text白 font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-600 transition-all",children:"保存模型"})]})]})})]})]})},ss=()=>e.jsx(K,{children:e.jsx(ts,{})}),as=()=>{const{showToast:t}=Z(),[r,d]=l.useState([]),[o,s]=l.useState("list"),[i,p]=l.useState({username:"",email:"",password:""}),[x,h]=l.useState(null),[y,N]=l.useState(""),j=async()=>{try{const c=await Y.list();d(c)}catch{t("加载失败","error")}};l.useEffect(()=>{j()},[]);const M=async()=>{if(!i.username||!i.password){t("请填写必填项","error");return}try{const{id:c}=await Y.create(i);d($=>[...$,{id:c,username:i.username,email:i.email||"",isActive:1}]),s("list"),p({username:"",email:"",password:""}),t("管理员添加成功")}catch{t("添加失败","error")}},_=async(c,$)=>{try{await Y.update(c,{isActive:$}),d(k=>k.map(S=>S.id===c?{...S,isActive:$}:S)),t($?"已启用":"已禁用")}catch{t("更新失败","error")}},f=async c=>{try{await Y.remove(c),d($=>$.filter(k=>k.id!==c)),t("删除成功")}catch{t("删除失败","error")}},u=async()=>{if(!y){t("请输入新密码","error");return}try{await Y.changePassword(x.id,y),h(null),N(""),t("密码已更新")}catch{t("更新失败","error")}};return o==="create"?e.jsxs("div",{className:"animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>s("list"),className:"px-5 py-2.5 rounded-xl bg-white text-gray-600 font-bold text-sm shadow-sm hover:bg-gray-50",children:"返回"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-cute text-pink-900",children:"添加管理员"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"创建新的后台管理员账号"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsx("button",{onClick:()=>s("list"),className:"px-6 py-2.5 rounded-xl bg-white text-gray-500 font-bold text-sm shadow-sm hover:bg-gray-50",children:"取消"}),e.jsxs("button",{onClick:M,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-sm shadow-lg shadow-pink-200 flex items-center gap-2",children:[e.jsx(X,{size:16})," 创建管理员"]})]})]}),e.jsxs("div",{className:"solid-card p-8 rounded-3xl space-y-6 max-w-2xl mx-auto",children:[e.jsxs("h3",{className:"font-cute text-lg text-pink-900 flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-1.5 h-4 bg-yellow-400 rounded-full"})," 管理员信息"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"用户名"}),e.jsx("input",{type:"text",value:i.username,onChange:c=>p({...i,username:c.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"邮箱"}),e.jsx("input",{type:"email",value:i.email,onChange:c=>p({...i,email:c.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-2",children:"初始密码"}),e.jsx("input",{type:"password",value:i.password,onChange:c=>p({...i,password:c.target.value}),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]})]})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-cute text-pink-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-6 bg-yellow-400 rounded-full inline-block"}),"管理员账号"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 ml-4",children:"管理后台管理员列表、禁用与密码修改"})]}),e.jsxs("button",{onClick:()=>s("create"),className:"bg-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow-lg shadow-pink-200 hover:bg-pink-600 transition-colors flex items-center gap-2 text-xs",children:[e.jsx(X,{size:14})," 添加管理员"]})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden border border-pink-100",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-pink-100 text-pink-900 font-cute text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 pl-6 w-20",children:"头像"}),e.jsx("th",{className:"p-3 w-20",children:"ID"}),e.jsx("th",{className:"p-3",children:"用户名"}),e.jsx("th",{className:"p-3",children:"昵称"}),e.jsx("th",{className:"p-3",children:"邮箱"}),e.jsx("th",{className:"p-3",children:"状态"}),e.jsx("th",{className:"p-3 text-right pr-6",children:"操作"})]})}),e.jsxs("tbody",{className:"text-sm divide-y divide-pink-100",children:[r.map(c=>e.jsxs("tr",{className:"hover:bg-pink-50/30 transition-colors",children:[e.jsx("td",{className:"p-3 pl-6",children:e.jsx("img",{src:c.avatar||"/uploads/avatars/default_admin.jpg",alt:c.username,className:"w-8 h-8 rounded-full object-cover shadow-sm"})}),e.jsx("td",{className:"p-3 text-gray-500 font-mono",children:c.id.toString().padStart(4,"0")}),e.jsx("td",{className:"p-3 font-bold text-pink-700",children:c.username}),e.jsx("td",{className:"p-3 text-gray-700",children:c.nickname||"-"}),e.jsx("td",{className:"p-3 text-gray-600",children:c.email||"-"}),e.jsx("td",{className:"p-3",children:c.isActive===1?"启用":"禁用"}),e.jsx("td",{className:"p-3 text-right pr-6",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{onClick:()=>h(c),className:"px-3 py-1 rounded bg-white border border-gray-200 text-gray-600 text-xs hover:bg-gray-50",children:"改密"}),e.jsx("button",{onClick:()=>_(c.id,c.isActive===1?0:1),className:`px-3 py-1 rounded text-xs font-bold ${c.isActive===1?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:c.isActive===1?"禁用":"启用"}),e.jsx("button",{onClick:()=>f(c.id),className:"px-3 py-1 rounded bg-red-500 text-white text-xs hover:bg-red-600",children:"删除"})]})})]},c.id)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-8 text-center text-gray-400 text-sm",children:"暂无管理员"})})]})]})}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 z-50",onClick:()=>h(null)}),e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-pink-100 p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-cute text-lg text-pink-900",children:"修改密码"}),e.jsx("button",{onClick:()=>h(null),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ee,{size:20})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-pink-800 mb-1.5",children:"新密码"}),e.jsx("input",{type:"password",value:y,onChange:c=>N(c.target.value),className:"dream-input w-full px-4 py-2.5 rounded-xl text-sm"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{onClick:()=>h(null),className:"px-5 py-2.5 rounded-xl bg-gray-50 text-gray-600 font-bold text-sm hover:bg-gray-100 transition-colors",children:"取消"}),e.jsx("button",{onClick:u,className:"px-6 py-2.5 rounded-xl bg-pink-500 text-white font-bold text-sm shadow-lg shadow-pink-200 hover:bg-pink-600 transition-all",children:"确认修改"})]})]})})]})]})},ns=()=>e.jsx(K,{children:e.jsx(as,{})}),os=()=>{const[t,r]=l.useState(!1),[d,o]=l.useState("templates"),[s,i]=l.useState(""),[p,x]=l.useState(!1),[h,y]=l.useState(""),[N,j]=l.useState(""),[M,_]=l.useState(""),f=async()=>{const c={};if(h&&h.trim()&&(c.nickname=h.trim()),N){if(N!==M)return;c.password=N}try{await Y.updateMe(c),x(!1),y(""),j(""),_("")}catch{}},u=c=>{window.history&&window.history.replaceState&&window.history.replaceState(null,"",c)};return l.useEffect(()=>{const c=localStorage.getItem("admin_access_token"),$=localStorage.getItem("admin_username"),k=window.location.pathname;c?(r(!0),$&&i($),o("templates"),k!=="/super-admin/sysprompt"&&u("/super-admin/sysprompt")):(r(!1),k!=="/super-admin/login"&&u("/super-admin/login"))},[]),t?e.jsxs("div",{className:"flex min-h-screen bg-white",children:[e.jsx(_e,{}),e.jsx(At,{activeTab:d,setActiveTab:c=>{o(c),c==="templates"&&u("/super-admin/sysprompt")},onLogout:()=>{r(!1),localStorage.removeItem("admin_access_token"),localStorage.removeItem("admin_refresh_token"),localStorage.removeItem("admin_username"),u("/super-admin/login")},username:s,onEditProfile:()=>x(!0)}),e.jsxs("main",{className:"flex-1 ml-16 xl:ml-56 p-8 relative z-10 transition-all duration-300 h-screen overflow-y-auto",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 pointer-events-none opacity-20",children:e.jsx(ce,{size:120,className:"text-pink-300"})}),d==="templates"&&e.jsx(Ut,{}),(d==="characters"||d==="official_characters")&&e.jsx(Me,{creatorRole:"admin_role"}),d==="user_characters"&&e.jsx(Me,{creatorRole:"user_role"}),d==="users"&&e.jsx(Wt,{}),d==="model_settings"&&e.jsx(es,{}),d==="model_manage"&&s==="admin"&&e.jsx(ss,{}),d==="admin_accounts"&&s==="admin"&&e.jsx(ns,{})]}),e.jsx("div",{className:"ambient-bg"}),p&&e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-96 shadow-2xl",children:[e.jsx("div",{className:"font-bold mb-4 text-pink-900",children:"修改资料"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:`昵称（当前：${s}）`,value:h,onChange:c=>y(c.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"新密码",value:N,onChange:c=>j(c.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})}),e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"再次输入新密码",value:M,onChange:c=>_(c.target.value),className:"dream-input w-full px-4 py-3 rounded-2xl text-sm font-bold text-gray-700"})})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-5",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-100 text-gray-600",onClick:()=>{x(!1),y(""),j(""),_("")},children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-pink-500 text-white",onClick:f,disabled:!h.trim()&&!N,children:"保存"})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{}),e.jsx(K,{children:e.jsx(Lt,{onLogin:()=>{r(!0);const c=localStorage.getItem("admin_username");c&&i(c),o("templates"),u("/super-admin/sysprompt")}})})]})};export{os as default};
//# sourceMappingURL=AdminDashboard-Di-zzCIo.js.map
