import{r,j as e}from"./index-DiMvcmcb.js";import{m as L,b as P,d as b}from"./App-Bl6Z-21V.js";import{A as C}from"./arrow-left-D36-7upH.js";import{C as z}from"./chevron-up-DfIGDTSU.js";import{C as I}from"./chevron-down-C8dX3bVB.js";import{H as D}from"./heart-CEY8X9zg.js";import"./plus-Bz3dnY0B.js";import"./createLucideIcon-CiU7U1is.js";import"./user-DjmimaIa.js";const B=({character:j,createdId:u,onBack:N,onStartChat:w})=>{var g;const[d,v]=r.useState(!1),[f,l]=r.useState(!0),[a,h]=r.useState(j),[x,n]=r.useState(!1),[y,S]=r.useState(!1);r.useEffect(()=>{let o=!0,i;const p=async()=>{try{const t=await b(u);if(!o)return;const c=typeof(t==null?void 0:t.status)=="string"?t.status.trim():"",m=!!(t!=null&&t.hasSystemPrompt);if(c==="draft"){n(!0),l(!1),i&&clearInterval(i);return}if(c==="publishing"||!m){n(!1),l(!1);return}if(t&&(c==="published"||m)){l(!0),n(!1),h(s=>({...s,id:String(t.id||s.id),name:t.name||s.name,avatar:t.avatar||s.avatar,profileImage:s.profileImage,oneLinePersona:t.tagline||s.oneLinePersona,personality:t.personality||s.personality,profession:String(t.occupation||s.profession||""),age:String(t.age||s.age||""),currentRelationship:String(t.relationship||s.currentRelationship||""),plotTheme:String(t.plot_theme||s.plotTheme||""),plotDescription:String(t.plot_summary||s.plotDescription||""),openingLine:String(t.opening_line||s.openingLine||"")})),i&&clearInterval(i);return}}catch{}};return(async()=>{try{const t=await b(u);if(!o)return;if(t){h(s=>({...s,id:String(t.id||s.id),name:t.name||s.name,avatar:t.avatar||s.avatar,oneLinePersona:t.tagline||s.oneLinePersona,personality:t.personality||s.personality,profession:String(t.occupation||s.profession||""),age:String(t.age||s.age||""),currentRelationship:String(t.relationship||s.currentRelationship||""),plotTheme:String(t.plot_theme||s.plotTheme||""),plotDescription:String(t.plot_summary||s.plotDescription||""),openingLine:String(t.opening_line||s.openingLine||"")}));const c=!!t.hasSystemPrompt,m=typeof t.status=="string"?t.status.trim():"";if(m==="draft"){n(!0),l(!1);return}if(m==="publishing"){n(!1),l(!1),i=setInterval(p,3e3),p();return}if(!c){n(!1),l(!1),i=setInterval(p,3e3),p();return}n(!1),l(!0);return}n(!1),l(!0)}catch{n(!1),l(!0)}})(),()=>{o=!1,clearInterval(i)}},[u]);const k=d?a.tags:a.tags.slice(0,4),T=a.tags.length>4;return e.jsx(L.div,{className:"fixed inset-0 z-50 bg-primary-50",initial:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},animate:{x:0},exit:{x:(navigator==null?void 0:navigator.maxTouchPoints)>0?"100%":0},transition:{duration:(navigator==null?void 0:navigator.maxTouchPoints)>0?.3:0,ease:"linear"},children:e.jsxs("div",{className:"mx-auto w-full max-w-md h-full flex flex-col bg白 shadow-2xl rounded-none md:rounded-3xl md:overflow-hidden relative",children:[e.jsx("button",{onClick:N,className:"absolute top-4 left-4 z-50 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-black/30 transition-all",children:e.jsx(C,{size:24})}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar relative pb-24",children:[e.jsxs("div",{className:"relative w-full h-[55vh]",children:[!y&&(a.profileImage||a.avatar)?e.jsx("img",{src:a.profileImage||a.avatar,alt:a.name,className:"w-full h-full object-cover",onError:()=>S(!0)}):e.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:e.jsx("span",{className:"text-6xl font-bold text-slate-500",children:((g=a.name)==null?void 0:g[0])||"?"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-slate-900/10"}),e.jsxs("div",{className:"absolute bottom-12 left-6 right-6 z-10 text-white flex flex-col items-start space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-5xl font-bold tracking-wide",children:a.name}),e.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-full text-[10px] border border-white/30 text-white flex items-center gap-1",children:[e.jsx("span",{className:"text-green-400",children:"●"})," ",a.roleType||"原创角色"]})]}),e.jsxs("div",{className:"flex items-center text-white text-sm font-medium pl-1",children:[e.jsx("span",{children:a.profession}),e.jsx("span",{className:"mx-2 bg-white w-1 h-1 rounded-full"}),e.jsx("span",{children:a.age})]}),e.jsxs("div",{className:"text-white text-xs font-medium pl-1",children:["by ",a.creator]})]})]}),e.jsxs("div",{className:"relative -mt-6 bg-white rounded-t-none md:rounded-t-[32px] px-6 py-8 min-h-[50vh] z-10",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:k.map((o,i)=>e.jsxs("span",{className:"px-4 py-1.5 rounded-full bg-purple-50 text-purple-600 text-sm font-bold shadow-sm",children:["# ",o]},i))}),T&&e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("button",{onClick:()=>v(!d),className:"text-xs text-purple-300 flex items-center gap-1 font-bold hover:text-purple-400 transition-colors",children:[d?"收起":"展示更多"," ",d?e.jsx(z,{size:14}):e.jsx(I,{size:14})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:"一句话人设"}),e.jsxs("div",{className:"relative pl-4 py-1",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-400 rounded-full"}),e.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-r-xl text-slate-700 font-bold text-lg",children:["“",a.oneLinePersona,"”"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:"性格"}),e.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm",children:a.personality})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-purple-500 font-bold text-sm mb-3",children:"当前关系"}),e.jsx("div",{children:e.jsxs("span",{className:"inline-flex items-center gap-1 bg-pink-100 text-pink-500 px-3 py-1 rounded-full text-sm font-bold",children:[e.jsx(D,{size:12,fill:"currentColor"})," ",a.currentRelationship]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-purple-900 font-extrabold text-lg mb-4",children:"第一情节"}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"bg-pink-400 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:"THEME"}),e.jsx("span",{className:"bg-pink-50 text-pink-800 text-sm font-bold px-2 py-0.5 rounded",children:a.plotTheme})]}),e.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 text-slate-600 leading-7 text-justify text-sm mb-4",children:a.plotDescription}),a.openingLine&&e.jsxs("div",{className:"bg-purple-50/50 rounded-2xl p-4 flex items-center",children:[e.jsx("span",{className:"text-purple-600 font-bold text-sm whitespace-nowrap mr-3",children:"角色开场白"}),e.jsx("div",{className:"h-4 w-[1px] bg-purple-200 mr-4"}),e.jsx("span",{className:"text-slate-700 font-bold text-sm",children:a.openingLine})]})]})]})]}),e.jsx("div",{className:"absolute bottom-3 inset-x-0 z-50",children:e.jsx("div",{className:"mx-auto w-full max-w-md bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 pb-[env(safe-area-inset-bottom)]",children:e.jsx("button",{disabled:!f||x,onClick:()=>w(a),className:`w-full font-bold text-lg py-4 rounded-2xl shadow-lg transition-all flex items-center justify-center gap-2 ${f&&!x?"bg-purple-200 text-purple-900 shadow-purple-100 active:scale-[0.98]":"bg-slate-200 text-slate-500 cursor-not-allowed"}`,children:f&&!x?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:20}),"唤醒角色"]}):x?"请编辑角色和生成角色卡":"角色创建中，请稍等。"})})})]})})};export{B as CharacterProfileAwait,B as default};
//# sourceMappingURL=CharacterProfileAwait-o9KoiBZf.js.map
